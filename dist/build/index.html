<style>body,html{margin:0;padding:0;background-color:#000}div{position:absolute;top:0;bottom:0;left:0;right:0}#canvas{width:100%;height:100%;touch-action:none}</style><div><canvas id="canvas"></canvas></div><script>!function(){"use strict";const t=["CAVE FLOOR","CAVE FLOOR","CAVE FLOOR","","","","DOOM PIT","DOOM PIT"],i=45*Math.PI/180,s=90*Math.PI/180,h=360*Math.PI/180,e={s(){e.e=document.getElementById("canvas"),e.t=e.e.getContext("2d"),e.n(!0)},n(t){let i=window.devicePixelRatio,s=e.e.clientWidth,h=e.e.clientHeight,n=s*i,r=h*i;(t||e.e.width!==n||e.e.height!==r)&&(e.e.width=n,e.e.height=r,e.scale=(10*Math.max(n/240,r/135)|0)/10,e.width=Math.ceil(n/e.scale),e.height=Math.ceil(r/e.scale),e.i={h:e.width/2|0,o:e.height/2|0},e.clientWidth=s,e.clientHeight=h,e.t.imageSmoothingEnabled=!1),e.e.style.cursor="none"},l(){e.t.fillRect(0,0,e.width,e.height)}},n={s(){n.map={KeyW:u.A.u,KeyA:u.A.M,KeyS:u.A.T,KeyD:u.A.p,ArrowUp:u.A.u,ArrowLeft:u.A.M,ArrowDown:u.A.T,ArrowRight:u.A.p,Escape:u.A.m},n.S=[{x:0,y:0,O:0},{x:0,y:-s,O:1},{x:0,y:s,O:1},{x:0,y:0,O:0},{x:-s,y:0,O:1},{x:-i,y:-i,O:1},{x:-i,y:i,O:1},{x:-s,y:0,O:1},{x:s,y:0,O:1},{x:i,y:-i,O:1},{x:i,y:i,O:1},{x:s,y:0,O:1},{x:0,y:0,O:0},{x:0,y:-s,O:1},{x:0,y:s,O:1},{x:0,y:0,O:0}],n.R=[],window.addEventListener("keydown",(t=>{let i=n.map[t.code];i&&(n.R[i]=!0)})),window.addEventListener("keyup",(t=>{let i=n.map[t.code];i&&(n.R[i]=!1)})),n.c()},E(){let t=(n.R[u.A.u]?1:0)+(n.R[u.A.T]?2:0)+(n.R[u.A.M]?4:0)+(n.R[u.A.p]?8:0);n.w=n.S[t]},c(){n.w=n.S[0];for(let t of Object.values(u.A))n.R[t]=!1}},r={volume:.3,sampleRate:44100,x:new(window.AudioContext||webkitAudioContext),destination:void 0,b:function(...t){return this.N(this.I(...t))},N:function(...t){const i=this.x.createBuffer(t.length,t[0].length,this.sampleRate),s=this.x.createBufferSource();return t.map(((t,s)=>i.getChannelData(s).set(t))),s.buffer=i,s.connect(this.destination),s.start(),s},I:function(t=1,i=.05,s=220,h=0,e=0,n=.1,r=0,o=1,l=0,f=0,u=0,a=0,c=0,A=0,M=0,O=0,x=0,E=1,y=0,d=0){const T=2*Math.PI;let w,N,U=this.sampleRate,R=l*=500*T/U/U,m=s*=(1+2*i*Math.random()-i)*T/U,I=[],S=0,p=0,H=0,L=1,v=0,b=0,C=0;for(f*=500*T/U**3,M*=T/U,u*=T/U,a*=U,c=c*U|0,N=(h=h*U+9)+(y*=U)+(e*=U)+(n*=U)+(x*=U)|0;H<N;I[H++]=C)++b%(100*O|0)||(C=r?r>1?r>2?r>3?Math.sin((S%T)**3):Math.max(Math.min(Math.tan(S),1),-1):1-(2*S/T%2+2)%2:1-4*Math.abs(Math.round(S/T)-S/T):Math.sin(S),C=(c?1-d+d*Math.sin(T*H/c):1)*(C>0?1:-1)*Math.abs(C)**o*t*this.volume*(H<h?H/h:H<h+y?1-(H-h)/y*(1-E):H<h+y+e?E:H<N-x?(N-H-x)/n*E:0),C=x?C/2+(x>H?0:(H<N-x?1:(N-H)/x)*I[H-x|0]/2):C),w=(s+=l+=f)*Math.cos(M*p++),S+=w-w*A*(1-1e9*(Math.sin(H)+1)%2),L&&++L>a&&(s+=u,m+=u,L=0),!c||++v%c||(s=m,l=R,L=L||1);return I},v:function(t=0,i=440){return i*2**(t/12)}},o={s(){o.U=!1,o.t=r.x,o.H=o.t.createGain(),o.H.connect(o.t.destination),r.destination=o.H,o.L=[1.01,,1250,.01,.09,.14,,1.77,-6.3,,,,,,23,,,.46,.02],o.k=[1.04,,363,.01,.08,.52,2,.31,.3,,,,,1.5,,.9,,.34,.07],o.g=[2.01,,332,.02,.05,.16,1,.53,-.8,,-7,.01,,.1,,,.03,.48,.04],o.D=[2.03,0,65.40639,.03,.66,.18,2,.95,,,,,.3,.4,,,.19,.21,.1,.04],o.q=[1.56,0,261.6256,,.13,.3,,.41,,,,,,.2,,,.05,.2,.19,.22]},E(){o.U},b(t){o.U&&r.b(...t)},Q(){o.H.gain.linearRampToValueAtTime(0,o.t.currentTime+1)},at(){o.H.gain.linearRampToValueAtTime(1,o.t.currentTime+1)}},l={s(){this.map=[],this.map[0]=u.A.P,this.map[2]=u.A.C,this.R=[],window.addEventListener("mousemove",(t=>{this.G||(this.G={}),this.G.h=t.clientX*e.width/e.clientWidth|0,this.G.o=t.clientY*e.height/e.clientHeight|0,u.mode=2})),window.addEventListener("mouseout",(()=>{this.G=void 0})),window.addEventListener("mousedown",(t=>{let i=this.map[t.button];i&&(this.R[i]=!0),o.U=!0,ut.F="mousedown",u.mode=2,this.V={h:t.clientX*e.width/e.clientWidth|0,o:t.clientY*e.height/e.clientHeight|0}})),window.addEventListener("mouseup",(t=>{let i=this.map[t.button];i&&(this.R[i]=!1),ut.F="mouseup",u.mode=2})),window.addEventListener("click",(t=>{t.preventDefault(),ut.F="click"})),window.addEventListener("contextmenu",(t=>{let i=this.map[t.button];i&&(this.R[i]=!0),this.W=2,t.preventDefault()})),l.c()},E(){this.W&&(this.W--,0===this.W&&(this.R[u.A.C]=!1))},c(){this.G=void 0;for(let t of Object.values(u.A))this.R[t]=!1}},f={s(){this.map=[],this.map[0]=u.A.P,this.R=[],window.addEventListener("touchmove",(t=>{this.G||(this.G={});let i=t.changedTouches[0];this.G.h=i.clientX*e.width/e.clientWidth|0,this.G.o=i.clientY*e.height/e.clientHeight|0,u.mode=1})),window.addEventListener("touchstart",(t=>{let i=this.map[0];i&&(this.R[i]=!0),o.U=!0,ut.F="TOUCHSTART",u.mode=1;let s=t.changedTouches[0];this.V={h:s.clientX*e.width/e.clientWidth|0,o:s.clientY*e.height/e.clientHeight|0},this.G={...this.V}})),window.addEventListener("touchend",(t=>{let i=this.map[0];i&&(this.R[i]=!1),ut.F="TOUCHEND",u.mode=1})),this.c()},E(){},c(){this.G=void 0;for(let t of Object.values(u.A))this.R[t]=!1}},u={A:{u:11,T:12,M:13,p:14,K:21,C:30,m:96,B:97,J:98,P:40,j:41,Y:42},s(){this.w={x:0,y:0,O:0},this.mt={},this.X={},this.R={},this.Z={},n.s(),l.s(),f.s(),this.mode=1,this._=!1},E(){n.E();let t=2===this.mode?l:f;for(let i of Object.values(u.A)){let s=t.R[i]||n.R[i];this.mt[i]=!this.R[i]&&s,this.X[i]=this.R[i]&&!s,this.mt[i]?this.Z[i]=1:this.R[i]&&s&&this.Z[i]++,this.R[i]=s}this.G=t.G,this.w=n.w,this.R[u.A.P]&&(this.Z[u.A.P]>20&&(this._=!0),Math.abs(t.V.h-t.G.h)+Math.abs(t.V.o-t.G.o)>5&&(this._=!0)),this._&&t.G&&(this.$={x:t.G.h-t.V.h,y:t.G.o-t.V.o}),this.X[u.A.P]&&(this._?this._=!1:(this.mt[u.A.Y]=!0,this.Z[u.A.Y]=1))},tt(t){},it(t){}},a={10:0,32:3,33:3,39:2,44:3,46:3,73:2},c={},A={s(){A.st=rt.font.ht;let t=[[101,rt.et[2]],[102,rt.et[4]]];for(let i of t)c[i[0]]=i[1],a[i[0]]=i[1].ht.width+1;A.nt=M(A.st,ht(0,0,0,1)),A.rt=M(A.st,ht(90,20,90,.15)),A.blue=M(A.st,ht(200,40,220,1)),A.ot=M(A.st,ht(240,50,200,.2)),A.lt=M(A.st,ht(240,240,255,.25)),A.red=M(A.st,ht(240,50,50,1)),A.ft=O(A.st,"#ffaa5e","#ffd4a3"),A.ut=O(A.st,"#ffaa5e","#ffd4a3",ht(255,0,0,.7))},ct(t,i,s,h,e=1,n=A.ft,r){for(let o=0;o<i.length;o++){let l=i.charCodeAt(o);if(119!==l)if(114!==l){if(c[l])t.drawImage(c[l].ht,s,h-(c[l].ht.height+4)/2);else{let i=4*(l-32);r&&t.drawImage(r,i%180,6*(i/180|0),3,5,s+1,h+1,3*e,5*e),t.drawImage(n,i%180,6*(i/180|0),3,5,s,h,3*e,5*e)}s+=(a[l]||4)*e}else n=A.ut;else n=A.ft}},dt(t,i,s,h,e,n,r=1,o=A.ft,l){let f=s,u=h,c=i.split(" ");for(let i of c){for(;"\n"===i[0];)i=i.slice(1),f=s,u+=6*r;let h=A.At(i,r);f+h-s>e&&(f=s,u+=6*r),A.ct(t,i,f,u,r,o,l),f+=h+(a[32]||4)}},At:(t,i)=>t.split("").reduce(((t,i)=>t+(a[i.charCodeAt(0)]||4)),0)*i};function M(t,i){let s=et(t.width,t.height);return s.t.fillStyle=i,s.t.fillRect(0,0,t.width,t.height),s.t.globalCompositeOperation="destination-in",s.t.drawImage(t,0,0),s.e}function O(t,i,s,h){let e=et(t.width,t.height);return e.t.fillStyle=s,e.t.fillRect(0,0,t.width,t.height),e.t.fillStyle=i,e.t.fillRect(0,0,t.width,1),e.t.fillRect(0,6,t.width,1),h&&(e.t.fillStyle=h,e.t.fillRect(0,0,t.width,t.height)),e.t.globalCompositeOperation="destination-in",e.t.drawImage(t,0,0),e.e}class x{constructor(t,i,s){this.frames=t,this.yt=i,this.wt=s,this.xt=[],this.Mt=[];var h=t/2;for(let t=0;t<h;t++)this.xt.push(2*Math.random()-1),this.Mt.push(2*Math.random()-1);this.pt=-1}E(){if(this.pt++,this.pt>=this.frames)return!1;let t=this.pt/2,i=0|t,s=i+1,h=1-this.pt/this.frames;return this.x=this.yt*h*(this.xt[i]+(t-i)*(this.xt[s]-this.xt[i])),this.y=this.wt*h*(this.Mt[i]+(t-i)*(this.Mt[s]-this.Mt[i])),!0}}class E{constructor(t,s,h){this.Tt={...t},this.angle=s,this.Et=k(Y(this.angle,h?3:2)),this.a=i,this.St=!0,this.f=h,this.Ot=!0,this.Rt=1,this.r=0,this.Nt=-1,this.d=0===this.f?45:70,this.It=!0}bt(){++this.Nt===this.d&&(this.vt=!0),this.Et.x*=.9,this.Et.y*=.9,this.a*=.95,this.r+=this.a}Ut(){rt.Ht(rt.Lt[this.f],this.Tt,this.r)}}E.kt=t=>E.gt(t,8,(()=>0)),E.Dt=t=>E.gt(t,16,(()=>2*Math.random()|0)),E.gt=(t,i,s)=>{for(let e=0;e<i*(ut.qt?2:1);e++){let i=Math.random()*t.Rt,e=g(t.Tt,Y(Math.random()*h,i));ut.is.push(new E(e,Math.random()*h,s()))}};const y={Pt:[{name:"1F",Ct:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,14,14,0,0,0,0,0,0,0,0,14,14,14,14,14,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,1,1,1,1,14,14,14,0,0,0,0,0,14,14,1,1,1,14,14,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,1,1,1,1,1,1,1,1,14,14,0,0,14,14,14,3,1,1,1,1,14,14,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,1,1,1,1,1,1,7,7,1,1,1,1,14,14,14,14,1,1,1,1,1,1,1,1,14,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,1,1,1,1,1,1,1,1,7,8,8,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,14,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,1,1,1,1,1,1,1,1,1,8,8,1,1,1,1,3,1,1,1,1,1,1,1,1,1,1,14,14,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,14,14,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,1,1,1,14,14,14,0,0],[0,0,0,0,0,0,0,14,14,14,14,14,14,14,1,1,1,14,14,14,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,14,14,0,0,0,0],[0,0,0,0,0,0,14,14,3,1,1,1,1,1,1,1,1,1,14,14,14,1,1,1,1,1,1,1,1,14,14,14,14,1,1,1,1,1,1,1,1,14,14,14,14,0],[0,0,0,0,0,14,14,1,1,1,1,2,1,1,1,7,1,1,1,14,14,14,1,1,1,1,14,14,14,14,14,1,14,14,2,1,3,1,1,1,1,1,1,1,14,14],[0,0,0,0,0,14,1,1,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,14,1,1,1,1,14,3,1,1,1,1,1,14],[0,0,0,0,0,14,1,7,8,1,1,14,14,14,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,7,1,14,1,1,1,1,14,14,1,1,1,1,3,14],[0,0,0,0,0,14,1,1,1,1,14,14,0,14,14,1,1,1,2,1,1,1,1,1,1,1,1,1,1,7,1,1,1,14,1,7,1,14,14,14,1,1,1,1,1,14],[0,0,0,0,0,14,14,1,2,14,14,0,0,14,14,1,1,1,1,1,14,14,14,14,1,1,2,1,1,1,1,1,14,14,1,8,1,14,0,14,14,1,1,2,14,14],[0,0,0,0,0,0,14,14,14,14,0,0,14,14,1,1,1,3,1,14,14,0,0,14,14,1,1,1,1,1,1,14,14,14,1,8,1,14,0,0,14,14,14,14,14,0],[0,0,0,0,0,0,0,0,0,0,0,0,14,1,1,7,1,1,1,14,0,0,0,0,14,14,1,1,1,1,2,14,14,14,1,8,1,14,14,0,0,0,0,0,0,0],[0,0,0,14,14,14,14,14,14,14,14,14,14,1,1,1,1,14,14,14,0,0,0,0,0,14,1,1,1,1,1,1,14,1,1,1,1,2,14,0,0,0,0,0,0,0],[0,14,14,14,1,1,1,1,1,14,14,14,14,1,1,1,1,14,0,0,0,0,0,0,0,14,14,1,1,1,1,1,14,1,1,1,1,1,14,14,0,0,0,0,0,0],[0,14,1,1,1,1,1,1,1,2,14,14,14,1,1,1,1,14,14,0,0,0,0,0,0,0,14,1,1,1,1,1,14,14,14,1,1,1,1,14,0,0,0,0,0,0],[14,14,1,1,1,1,1,1,1,1,14,14,14,1,1,1,1,1,14,14,0,0,0,0,0,0,14,1,1,1,1,1,1,1,14,14,1,1,1,14,0,0,0,0,0,0],[14,1,1,1,1,14,1,1,1,1,1,14,14,14,1,1,2,1,14,14,0,0,0,0,0,0,14,1,2,1,1,7,1,1,1,14,1,7,1,14,14,14,14,14,0,0],[14,1,7,1,1,14,14,1,1,1,1,14,14,14,14,1,1,1,14,14,0,0,0,0,0,0,14,14,1,1,1,8,7,1,1,14,1,1,1,14,14,1,1,14,14,0],[14,1,1,1,1,14,14,1,1,1,1,1,14,14,14,1,1,1,1,14,0,0,0,0,0,0,0,14,14,1,1,1,1,1,1,14,14,1,1,1,1,1,1,1,14,0],[14,14,1,1,1,14,14,1,1,1,1,1,1,14,14,1,1,7,1,14,0,0,0,0,0,0,0,0,14,14,1,1,3,1,14,14,1,1,1,1,1,1,1,1,14,0],[0,14,1,1,1,14,14,14,1,1,1,1,1,14,14,1,1,8,1,14,0,0,0,0,0,0,0,0,0,14,14,14,14,14,14,1,1,1,3,1,1,1,1,1,14,0],[0,14,1,1,1,1,14,14,14,1,1,1,14,14,14,1,1,1,1,14,0,0,0,0,0,0,0,0,0,0,0,14,14,1,1,1,1,14,14,14,1,1,1,14,14,0],[0,14,1,1,1,1,2,14,14,14,14,14,14,14,1,1,1,1,14,14,0,0,0,0,0,0,0,0,0,0,14,14,1,1,1,2,1,14,0,14,14,14,14,14,0,0],[0,14,14,1,1,1,1,1,14,14,14,14,14,2,1,1,1,14,14,0,0,0,0,0,0,0,0,0,0,0,14,1,3,1,14,14,14,14,0,0,0,0,0,0,0,0],[0,0,14,14,1,1,1,1,1,1,1,1,1,1,1,3,1,14,0,0,0,0,0,0,0,0,0,0,0,0,14,1,1,14,14,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,14,14,1,1,1,1,1,1,7,1,1,1,1,14,14,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,14,14,14,1,3,1,1,1,1,1,1,14,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,14,14,14,14,14,14,14,14,14,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],Gt:[],Ft:[{name:"SPAWN",x:42,y:11},{name:"EARTH",x:20,y:3},{name:"EXIT",x:10,y:24},{name:"EARTH",x:41,y:25},{name:"EARTH",x:43,y:22},{name:"EARTH",x:33,y:17},{name:"EARTH",x:40,y:6},{name:"EARTH",x:36,y:3},{name:"EARTH",x:14,y:7},{name:"EARTH",x:31,y:13},{name:"EARTH",x:7,y:13}],Vt:[],id:0}],bounds:[[0,0],[46,32]],Wt:[42,11,0]};class d{constructor(t){this.Tt={...t},this.target={...this.Tt},this.Et={x:0,y:0},this.Kt=1,this.kt=[],this.Rt=3,this.as=2,this.St=!0,this.It=!0,this.Bt=7,this.Jt=[],this.jt=0,this.offset={x:0,y:0},this.Yt=0,this.zt=500,this.Qt=3,this.Xt=0,this.pt=0,this.Zt=Math.floor(16*Math.random()),this._t=ut.pt;let i=$(this.Tt);this.moveTo({$t:i.$t,r:i.r-1})}bt(){0===this.Jt.length&&this.Jt.push({ti:2});let t=this.Jt[this.Jt.length-1];if(this.pt=Math.floor(ut.pt/8)%2+1,9===this.as)return o.b(o.k),void(this.vt=!0);if(3===t.ti)this.target=q(z(t.ii)),B(this.Tt,this.target).O<6&&this.Jt.pop();else if(6===t.ti){if(this.target=q(z(t.ii)),B(this.Tt,this.target).O<6){this.pt=0;let i=J.si(t.ii);i.hi++,i.hi>=i.ei&&this.Jt.pop()}}else if(4===t.ti){this.target=q(z(t.ii));let i=B(this.Tt,this.target),s=J.si(t.ii);s?i.O<6&&(this.pt=0,this.Yt+=this.Qt,s.ni-=this.Qt,this.Yt>=this.zt&&this.Jt.push({ti:5,ii:{$t:J.Wt.$t,r:J.Wt.r}})):(this.Jt.pop(),this.Jt.push({ti:5,ii:{$t:J.Wt.$t,r:J.Wt.r}}))}else 5===t.ti&&(this.target=q(z(t.ii)),B(this.Tt,this.target).O<6&&(this.pt=0,this.Yt-=this.Qt,this.Xt+=this.Qt,this.Xt>=100&&(ut.ri++,this.Xt-=100),this.Yt<=0&&this.Jt.pop()));let i=J.oi(this.Tt,this.target);console.log([this.target,i]);let s=B(this.Tt,i);s.O=Z(s.O,0,.5);let h=k(s);this.Et={x:(this.Et.x+h.x)/2,y:(this.Et.y+h.y)/2}}Ut(){let t=3;0===this.pt&&t--;let i=Math.cos((ut.pt+this.Zt)/16)*t,s=1*Math.sin((ut.pt+this.Zt)/16);rt.Ht(rt.li[this.pt],{x:this.Tt.x+i,y:this.Tt.y+s})}ai(t){this.Jt=[{ti:4,ii:t}],this._t=ut.pt}construct(t){this.Jt.push({ti:6,ii:t}),this._t=ut.pt}moveTo(t){this.Jt=[{ti:3,ii:t}],this._t=ut.pt}fi(){let t=this.Jt[this.Jt.length-1];return t&&2!==t.ti}}d.ui=()=>{let t=ut.is.filter((t=>t instanceof d));return t.sort(((t,i)=>t.fi()&&!i.fi()?1:!t.fi()&&i.fi()?-1:t._t-i._t)),t},d.assign=t=>{let i=d.ui();for(let s=0;s<i.length&&!(s>0&&i[s].fi());s++)t(i[s])};class T{constructor(t,i,s){this.Tt={...t},this.target=i,this.Et={x:0,y:0},this.kt=s||70}bt(){let t=B(this.Tt,this.target.Tt);t.O=Z(t.O,0,2),this.Et={x:(this.Et.x+t.x*t.O)/2,y:(this.Et.y+t.y*t.O)/2},t.O<1&&(this.target.kt.push({ci:this.kt,di:t,Ai:1}),this.vt=!0),this.yi=this.Tt}Ut(){this.yi&&(e.t.globalAlpha=.7,rt.Ht(rt.wi[0],this.yi),e.t.globalAlpha=1),rt.Ht(rt.wi[0],this.Tt)}}const w={xi:()=>!!J.si(J.selected),Mi:()=>rt.buttons[6],Ti:()=>rt.buttons[7],Ei(t,i){let s=J.si(J.selected),h="BUILD TOWER \n"+ut.pi(15,0);s&&(h="FINISH BUILDING"),A.dt(e.t,h,t,i)},mi(){let t=[15,0];if(J.si(J.selected))d.assign((t=>t.construct(J.selected)));else if(ut.Si(...t))return ut.Oi(...t),J.et.push(new N(J.selected)),d.assign((t=>t.construct(J.selected))),!0}};class N{constructor(t){this.ii={...t},this.Ri=10,this.Bt=7,this.as=21,this.hi=0,this.ei=180,this.title="TOWER",this.Ni=rt.et[0]}bt(){if(!(this.hi>=this.ei))return;22!==this.as&&(this.as=22,o.b(o.D));let t,i,s=q(z(this.ii));if(!this.target||this.target.vt){for(let h of ut.is){if(!h.Ii)continue;let e=B(s,h.Tt);e.O<32&&(!i||e.O<i.O)&&(t=h,i=e)}console.log("ATTEMPTED to pick target for building",t),this.target=t}this.Ri>0&&this.Ri--,this.target&&0===this.Ri&&(B(s,this.target),ut.is.push(new T(s,this.target)),this.Ri=100,o.b(o.L))}Ut(){let t=z(this.ii);if(Q(q(t)),e.t.globalAlpha=21===this.as?.5:1,rt.Ht(rt.et[0],t),e.t.globalAlpha=1,21===this.as){let i=Z(Math.floor(8*this.hi/this.ei),0,7);e.t.globalAlpha=.5,rt.Ht(rt.bi[7],t),e.t.globalAlpha=1,rt.Ht(rt.bi[i],t)}}vi(){return this.hi<this.ei?[w]:[]}}const U=[0,2];for(let t=2;t<=19;t++)U[t]=Math.floor(1.5*U[t-1]+1);for(let t=0;t<20;t++)U[t]=5*U[t];const R={xi:()=>!1,Mi:()=>rt.buttons[0],Ti:()=>rt.buttons[1],Ei(t,i){let s=[U[ut.Ui()],0],h="LURE MOTH \n"+ut.pi(...s);A.dt(e.t,h,t,i)},mi(){let t=[U[ut.Ui()],0];if(ut.Si(...t))return ut.Oi(...t),ut.is.push(new d(q(z(J.selected)))),!0}},m={xi:()=>!!J.si(J.selected),Mi:()=>rt.buttons[8],Ti:()=>rt.buttons[9],Ei(t,i){let s=J.si(J.selected),h="MOVE COFFIN \n"+ut.pi(60,10);s&&(h="FINISH BUILDING"),A.dt(e.t,h,t,i)},mi(){let t=[60,10];if(J.si(J.selected))d.assign((t=>t.construct(J.selected)));else if(ut.Si(...t))return ut.Oi(...t),J.et.push(new S(J.selected)),d.assign((t=>t.construct(J.selected))),!0}};class I{constructor(t){this.Tt={...t},this.Nt=-1,this.d=3,this.z=101,this.Hi=Math.random()*Math.PI*2}bt(){++this.Nt===this.d&&(this.vt=!0),this.Hi+=.1}Ut(){let t=this.Nt<2?0:1;rt.Ht(rt.attack[t],this.Tt,this.Hi)}}class S{constructor(t,i){this.ii={...t},this.as=21,this.hi=0,this.ei=180,i&&(this.hi=180,this.as=22),this.title="YOUR COFFIN \nQARUL SOIL",this.Ni=rt.et[1],this.Bt=9}bt(){if(this.hi>=this.ei&&22!==this.as){this.as=22,o.b(o.D);for(let t of J.et)t instanceof S&&t!==this&&(ut.is.push(new I(q(z(t.ii)))),t.vt=!0)}}Ut(){let t=z(this.ii);if(rt.Ht(rt.et[1],t),21===this.as){let i=Z(Math.floor(8*this.hi/this.ei),0,7);e.t.globalAlpha=.5,rt.Ht(rt.bi[7],t),e.t.globalAlpha=1,rt.Ht(rt.bi[i],t)}}vi(){return this.hi<this.ei?[m]:[R]}}class p{constructor(t,i){this.Tt={...t},this.kt=[],this.Et={x:0,y:0},this.Rt=2,this.Li=.2,this.ki=0,this.as=11,this.Ii=!0,this.variant=i,i?1===i?(this.Kt=300,this.gi=8,this.Di=.3):2===i&&(this.Kt=800,this.gi=16,this.Di=.1):(this.Kt=100,this.gi=8,this.Di=.3),this.qi=this.Kt}bt(){let t=ut.is.filter((t=>t instanceof d)),i=t[0];if(!i)return;let s=B(this.Tt,i.Tt);for(let h=1;h<t.length;h++){let e=B(this.Tt,t[h].Tt);e.O<s.O&&(i=t[h],s=e)}const h=J.oi(this.Tt,i.Tt);let e=B(this.Tt,h);11===this.as?s.O<this.gi?(this.as=12,this.Pi=10,this.Ci=i):(e.O=Z(e.O,0,this.Di),this.Et={x:(this.Et.x+e.x*e.O)/2,y:(this.Et.y+e.y*e.O)/2}):12===this.as?(this.Et={x:.9*this.Et.x,y:.9*this.Et.y},this.Pi--,5===this.Pi?this.Ci.kt.push({ci:10,di:{x:0,y:0,O:0},Ai:0}):-30===this.Pi&&(this.as=11)):9===this.as&&(o.b(o.g),this.vt=!0,ut.Gi+=this.variant+1,E.Dt(this))}Ut(){let t=2*this.variant+(12===this.as?1:0),i=rt.Fi[t];if(rt.Ht(i,this.Tt),this.Kt<this.qi){let t=Math.ceil(this.Kt/this.qi*7);t>=0&&rt.Ht(rt.Vi[t],this.Tt)}}}const H={xi:()=>!0,Mi:()=>rt.buttons[2],Ti:()=>rt.buttons[3],Ei(t,i){A.dt(e.t,"GATHER EARTH",t,i)},mi:()=>(d.assign((t=>t.ai(J.selected))),!0)};class L{constructor(t){this.ii={...t},this.ni=15e3,this.title="EARTH",this.Ni=rt.et[2]}bt(){this.title="EARTH \n"+Math.ceil(this.ni/100)+" REMAINING",this.ni<1&&(this.vt=!0)}Ut(){let t=z(this.ii);rt.Ht(rt.et[2],t)}vi(){return[H]}}const v={xi:()=>!0,Mi:()=>rt.buttons[4],Ti:()=>rt.buttons[5],Ei(t,i){A.dt(e.t,"EXPLORE",t,i)},mi:()=>(d.assign((t=>t.moveTo(J.selected))),!0)},b={Wi(t){let i=t.filter((t=>t.Tt&&t.Et&&!t.vt));for(let t=0;t<5;t++){for(let t=0;t<i.length-1;t++)for(let s=t+1;s<i.length;s++)b.Ki(i[t],i[s]);for(let t of i)b.Bi(t)}for(let t of i)t.Tt.x+=t.Et.x,t.Tt.y+=t.Et.y},Ki(t,i){if(t.St||i.St)return;let s=function(t,i,s,h,e,n){[s,n]=[k(s),k(n)];let r=B({x:t.x+s.x,y:t.y+s.y},{x:h.x+n.x,y:h.y+n.y});if(r.O<i+e)return{Ji:r.x,ji:r.y,O:i+e-r.O}}(t.Tt,t.Rt,t.Et,i.Tt,i.Rt,i.Et);if(s)if(t.Ot&&i.Ot)t.Et.x=-s.Ji*s.O,t.Et.y=-s.ji*s.O,i.Et.x=s.Ji*s.O,i.Et.y=s.ji*s.O;else{let h=W(t.Et).O+i.Li,e=W(i.Et).O+t.Li,n=t.Ot?.1:1,r=i.Ot?.1:1;t.Et.x-=s.Ji*s.O*n*h/(h+e),t.Et.y-=s.ji*s.O*n*h/(h+e),i.Et.x+=s.Ji*s.O*r*e/(h+e),i.Et.y+=s.ji*s.O*r*e/(h+e)}},Bi(t){if(!t.It){t.Tt.y<-1e3&&console.log("FUUUUUUUUUUUUUUUU");for(let i of function*(t,i,s){yield*function*(t,i,s){let h=[{x:Math.min(t.x,i.x)-s,y:Math.min(t.y,i.y)-s},{x:Math.max(t.x,i.x)+s,y:Math.max(t.y,i.y)+s}];yield*function*(t){for(let i=t[0].y/8|0;8*i<t[1].y;i++)for(let s=t[0].x/8|0;8*s<t[1].x;s++)yield{$t:s,r:i}}(h)}(t,{x:t.x+i.x,y:t.y+i.y},s)}(t.Tt,t.Et,t.Rt))if(!st(i.$t,i.r)){let s=[z(i),z({$t:i.$t+1,r:i.r+1})],h=_(t.Tt,{x:t.Tt.x+t.Et.x,y:t.Tt.y+t.Et.y},t.Rt,s);h&&(t.Ot?0===h.Ji?t.Et.y=-t.Et.y:0===h.ji?t.Et.x=-t.Et.x:(t.Et.x+=h.Ji,t.Et.y+=h.ji):0===h.Ji?t.Et.y=h.y-t.Tt.y:0===h.ji?t.Et.x=h.x-t.Tt.x:(t.Et.x+=h.Ji,t.Et.y+=h.ji))}}}},C={Wi(t){for(let i of t)if(i.Kt){if(i.kt.length>0){if(9!==i.as&&1!==i.as)for(let t of i.kt)i===ut.Yi&&ut.is.push(new HealthChunkAnimation(i.Kt,t.ci)),i.Kt-=t.ci,t.di.O=t.Ai,i.Et=g(i.Et,t.di),i.zi=t,E.kt(i),ut.is.push(new I(i.Tt));i.kt=[]}i.Kt<=0&&9!==i.as&&(i.as=9)}}},D=[[[0,0],[5,0],[10,0],[15,0]],[[0,0],[1,0],[2,0],[3,0],[10,0],[11,0],[12,0],[15,0],[15,0],[15,0]],[[0,0],[1,0],[2,0],[3,0],[4,0],[5,0],[10,0],[15,1]],[[0,1],[5,0],[5,0],[10,1],[15,0],[15,0],[20,1]],[[0,1],[5,0],[5,0],[10,0],[10,0],[15,0],[15,1],[20,2]]];class P{constructor(t){this.Qi=t,t%=D.length,this.Xi=[...D[t]],this.Zi=360,this._i=!1,this.pt=0,this.$i=60*this.Xi[this.Xi.length-1][0]}E(){if(this.Zi--,this.Zi>=0&&this.Zi<=120&&this.Zi%60==0&&o.b(o.q),this.Zi<=0){this._i=!0;for(let t=0;t<this.Xi.length;t++)this.pt===60*this.Xi[t][0]&&ut.ts.push((i=>new p(i,this.Xi[t][1])));this.pt++}this.pt>=this.$i&&0===ut.is.filter((t=>t.Ii)).length&&(ut.ss=void 0)}}class G{constructor(){this.frames=0}E(){return this.frames++,!0}Ut(){e.t.fillStyle=ht(36,26,20,Z(this.frames/200,0,1)),e.t.fillRect(0,0,e.width,e.height);let t=e.width-32,i="ESCAPE! \n                    \nVILLAGERS STIR UNEASILY IN THEIR BEDS AS YOU EMERGE INTO MOONLIGHT. YOU SENSE WARM BODIES ALL AROUND YOU, RIPE FOR PICKING. IT IS ONLY A MATTER OF TIME NOW BEFORE YOU REGAIN YOUR FULL NECROMANTIC POWER. \n                    \nCONGRATULATIONS... AND THE END.";i=i.slice(0,this.frames),A.dt(e.t,i,16,16,t,1,1)}}class F{constructor(t){this.ii={...t},this.title="REACH EXIT \nTO ESCAPE",this.Ni=rt.et[3],this.Bt=4}bt(){let t=d.ui(),i=q(z(this.ii));for(let s of t)if(B(s.Tt,i).O<2)return void(ut.screen=new G)}Ut(){let t=z(this.ii);rt.Ht(rt.et[3],t)}vi(){return[v]}}const J={s(){this.c()},Ut(){let t=this.Pt[0].Ct,i=Q({x:0,y:0});for(let s=0;s<t.length;s++)for(let h=0;h<t[0].length;h++)t[s][h]>0&&e.t.drawImage(rt.Ct[t[s][h]-1].ht,8*h+i.h,8*s+i.o);for(let t of this.et)t.Ut()},hs(){let t=this.Ct,i=Q({x:0,y:0});for(let s=0;s<t.length;s++)for(let h=0;h<t[0].length;h++)if(t[s][h]>0){let t=1-Z(this.es[s][h]/5,.1,1);0===this.ns[s][h]&&(t=1),e.t.globalAlpha=t,e.t.drawImage(rt.rs[0].ht,8*h+i.h,8*s+i.o)}e.t.globalAlpha=1},c(){this.Pt=y.Pt.map((t=>({Ct:t.Ct.map((t=>[...t])),Ft:t.Ft.map((t=>({...t})))}))),this.bounds=y.bounds,this.Wt={$t:y.Wt[0],r:y.Wt[1]},this.et=[],this.et.push(new S(this.Wt,!0));for(let t of this.Pt[0].Ft)"EARTH"===t.name?this.et.push(new L({$t:t.x,r:t.y})):"EXIT"===t.name&&(this.et.push(new F({$t:t.x,r:t.y})),this.os={$t:t.x,r:t.y});this.selected=void 0,this.Ct=this.Pt[0].Ct,this.width=this.Ct[0].length,this.height=this.Ct.length,this.es=tt(this.width,this.height,(()=>0)),this.ns=tt(this.width,this.height,(()=>0)),this.ls={},this.fs()},E(){for(let t of this.et)t.bt();this.us()},cs(t){return 46===this.ds(t)},As(t){return this.ys.includes(this.Pt[t.z].Ct[t.y][t.x])},ws(t){this.Pt[t.z]},mi(t){let i=$(X(t)),s=this.ds(i);if(!s||s>8||!this.ns[i.r][i.$t])this.selected=void 0;else if(this.selected&&this.selected.$t===i.$t&&this.selected.r===i.r){let t=this.si(this.selected);if(t){let i=t.vi();i[0]&&i[0].xi()&&i[0].mi()}else v.mi()}else this.selected=i,this.si(this.selected)},ds(t){if(t)return this.Pt[0].Ct[t.r]?.[t.$t]},si(t){if(t)for(let i of this.et)if(i.ii.$t===t.$t&&i.ii.r===t.r)return i},us(){let t=[];for(let i of this.et)i.Bt&&t.push({...i.ii,xs:i.Bt});for(let i of ut.is)i.Bt&&t.push({...$(i.Tt),xs:i.Bt});this.es=function(t,i,s=1/0){let h=tt(t[0].length,t.length,(()=>0)),e=[...i];for(;e.length>0;){let{$t:t,r:i,xs:n}=e.shift();h[i][t]>=n||(h[i][t]=n--,h[i][t]>=s||(it(t+1,i)&&h[i][t+1]<n&&e.push({$t:t+1,r:i,xs:n}),it(t-1,i)&&h[i][t-1]<n&&e.push({$t:t-1,r:i,xs:n}),it(t,i+1)&&h[i+1][t]<n&&e.push({$t:t,r:i+1,xs:n}),it(t,i-1)&&h[i-1][t]<n&&e.push({$t:t,r:i-1,xs:n})))}return h}(this.Ct,t);for(let t=0;t<this.es.length;t++)for(let i=0;i<this.es[0].length;i++)this.es[t][i]>this.ns[t][i]&&(this.ns[t][i]=1)},oi(t,i){let s=$(t),h=$(i);var e,n;if(e=s,n=h,Math.abs(e.$t-n.$t)+Math.abs(e.r-n.r)<=1)return i;let r=[h.$t,h.r].join(","),o=this.ls[r];o||(o=this.ls[r]=function(t,i,s=1/0){let h=tt(t[0].length,t.length,(()=>1/0)),e=[{...i,Ms:0}];for(;e.length>0;){let{$t:t,r:i,Ms:n}=e.shift();h[i][t]<=n||(h[i][t]=n++,h[i][t]>=s||(st(t+1,i)&&h[i][t+1]>n&&e.push({$t:t+1,r:i,Ms:n}),st(t-1,i)&&h[i][t-1]>n&&e.push({$t:t-1,r:i,Ms:n}),st(t,i+1)&&h[i+1][t]>n&&e.push({$t:t,r:i+1,Ms:n}),st(t,i-1)&&h[i-1][t]>n&&e.push({$t:t,r:i-1,Ms:n})))}return h}(this.Ct,h)),console.log(Object.keys(this.ls).length);let l=[[s.$t+1,s.r],[s.$t-1,s.r],[s.$t,s.r+1],[s.$t,s.r-1]];for(let t of l)t.push(o[t[1]][t[0]]);return l.sort(((t,i)=>t[2]-i[2])),q(z({$t:l[0][0],r:l[0][1]}))},fs(){for(let t=0;t<this.Ct.length;t++)for(let i=0;i<this.Ct[0].length;i++)if(14===this.Ct[t][i]){let s=0;(this.Ct[t-1]?.[i-1]||99)<8&&(s|=256),(this.Ct[t-1]?.[i]||99)<8&&(s|=128),(this.Ct[t-1]?.[i+1]||99)<8&&(s|=64),(this.Ct[t]?.[i-1]||99)<8&&(s|=32),(this.Ct[t]?.[i+1]||99)<8&&(s|=8),(this.Ct[t+1]?.[i-1]||99)<8&&(s|=4),(this.Ct[t+1]?.[i]||99)<8&&(s|=2),(this.Ct[t+1]?.[i+1]||99)<8&&(s|=1),rt.Ts(s),this.Ct[t][i]=20+s}}},j=18,K={s(){this.Es=et(7,7)},E(){if(J.selected){let t=J.ds(J.selected),i=J.si(J.selected);this.actions=i?i.vi():t>=1&&t<=4?[v,w,m]:[]}else this.actions=[];u._&&(this.ps=void 0)},Ut(){if(e.t.fillStyle=ht(36,26,20,.4),e.t.fillRect(0,0,e.width,9),ut.ss)if(ut.ss._i){let t="WAVE "+(ut.ss.Qi+1),i=A.At(t,1),s=(e.width-i)/2,h=Math.floor(ut.pt/60)%2==0?A.ft:A.ut;A.ct(e.t,t,s,2,1,h)}else{let t=Math.ceil(ut.ss.Zi/60);if(t<=30){let i="NEXT WAVE",s=A.At(i,1)+2,h=(e.width-s)/2;A.ct(e.t,"NEXT WAVE ",h,2),this.Es.t.clearRect(0,0,7,7),this.Es.t.fillStyle=ht(255,212,163,1),this.Es.t.beginPath(),this.Es.t.moveTo(3.5,3.5),this.Es.t.lineTo(3.5,0),this.Es.t.arc(3.5,3.5,3,1.5*Math.PI,1.5*Math.PI+t/30*Math.PI*2),this.Es.t.fill(),e.t.drawImage(this.Es.e,h+s,1)}}let i=ut.is.filter((t=>t instanceof d));for(let t=0;t<i.length;t++)e.t.drawImage(rt.li[1].ht,2+4*t,2);let s,h=ut.ri+"e "+String(ut.Gi).padStart(2)+"f",n=A.At(h,1);if(e.t.fillStyle="rgba(0, 0, 0, 0.1)",A.ct(e.t,h,e.width-n-2,2),J.selected){let t=Q(z(J.selected));e.t.drawImage(rt.Ss[0].ht,t.h,t.o)}if(e.t.fillStyle="#ffd4a3",e.t.fillRect(0,e.height-j,e.width,1),e.t.fillStyle="#8d697a",e.t.fillRect(0,e.height-j+1,e.width,1),e.t.fillStyle="#203c56",e.t.fillRect(0,e.height-j+2,e.width,16),e.t.fillStyle="#8d697a",e.t.fillRect(0,e.height-2,e.width,2),e.t.drawImage(rt.Os[0].ht,-2,e.height-j+1),e.t.drawImage(rt.Os[0].ht,64,e.height-j+1),e.t.drawImage(rt.Os[0].ht,e.width-3,e.height-j+1),J.selected){let i=J.si(J.selected);if(i)e.t.drawImage(i.Ni.ht,3,e.height-j-1),A.dt(e.t,i.title,14,e.height-j+3,e.width);else{let i=J.ds(J.selected);console.log(J.selected,i,t[i-1]),e.t.drawImage(rt.rs[1].ht,4,e.height-j+6),e.t.drawImage(rt.Ct[i-1].ht,3,e.height-j+5),A.dt(e.t,t[i-1],14,e.height-j+3,e.width)}}for(let t=0;t<this.actions.length;t++){let i=this.actions[t],h=this.Rs(t);e.t.drawImage(rt.Os[0].ht,h.h+11,e.height-j+1),e.t.drawImage(i.Mi().ht,h.h,h.o),this.ps===i&&(s=t)}if(s>=0){let t=this.Rs(s);e.t.drawImage(rt.Ns[0].ht,t.h-23,t.o-19),e.t.drawImage(this.ps.Ti().ht,t.h,t.o),this.ps.Ei(t.h-23+3,t.o-19+3)}u.G&&(ut.Is&&(e.t.globalAlpha=.5),rt.Ht(rt.bs,X(u.G)),e.t.globalAlpha=1)},Rs:t=>({h:68+15*t,o:e.height-15}),mi(t){if(t.o>e.height-j){for(let i=0;i<this.actions.length;i++){let s=this.Rs(i);if(t.h>=s.h&&t.h<=s.h+12&&t.o>=s.o&&t.o<=s.o+12)return this.actions[i]===this.ps?this.ps.mi()&&(this.ps=void 0):this.ps=this.actions[i],!0}return this.ps=void 0,!0}return this.ps=void 0,!1}},V={s(){this.Tt={x:0,y:0},this.vs=void 0,this.Et={x:0,y:0}},E(){if(this.vs){let t=B(this.Tt,this.vs);if(t.O<1)return void(this.vs=void 0);t.O=Z(t.O,0,2);let i=k(t);this.Et={x:(this.Et.x+i.x)/2,y:(this.Et.y+i.y)/2},this.Tt.x+=this.Et.x,this.Tt.y+=this.Et.y}u.mt[u.A.P]&&(this.Us={...this.Tt}),u._&&(this.Tt={x:this.Us.x-u.$.x,y:this.Us.y-u.$.y})}};function W(t){let i=Math.sqrt(t.x*t.x+t.y*t.y);return 0===i?{x:0,y:0,O:0}:{x:t.x/i,y:t.y/i,O:i}}function B(t,i){return W({x:i.x-t.x,y:i.y-t.y})}function Y(t,i){return{x:Math.cos(t),y:Math.sin(t),O:i||1}}function k(t){return{x:t.x*(t.O||1),y:t.y*(t.O||1)}}function g(...t){let i={x:0,y:0,O:1};for(let s of t)i.x+=s.x*(s.O||1),i.y+=s.y*(s.O||1);return i}function $(t){return{$t:t.x/8|0,r:t.y/8|0}}function z(t){return{x:8*t.$t,y:8*t.r}}function Q(t){return{h:t.x+e.i.h-V.Tt.x,o:t.y+e.i.o-V.Tt.y}}function X(t){return{x:t.h-e.i.h+V.Tt.x,y:t.o-e.i.o+V.Tt.y}}function q(t){return{x:t.x+4,y:t.y+4}}function Z(t,i,s){return t<i?i:t>s?s:t}function _(t,i,s,h){if(Math.max(t.x,i.x)+s<h[0].x||Math.min(t.x,i.x)-s>h[1].x||Math.max(t.y,i.y)+s<h[0].y||Math.min(t.y,i.y)-s>h[1].y)return;let e=i.x-t.x,n=i.y-t.y,r=0===e?0:1/e,o=0===n?0:1/n,l=1/0,f=1/0;if(t.x-s<h[0].x&&i.x+s>h[0].x){let i=(h[0].x-s-t.x)*r;if(i>=0&&i<=1){let s=n*i+t.y;if(s>=h[0].y&&s<=h[1].y)return{x:e*i+t.x,y:s,Nt:i,Ji:-1,ji:0,Hs:h[0].x,Ls:s}}l=h[0].x}if(t.x+s>h[1].x&&i.x-s<h[1].x){let o=(t.x-(h[1].x+s))*-r;if(o>=0&&o<=1){let s=n*o+i.y;if(s>=h[0].y&&s<=h[1].y)return{x:e*o+t.x,y:s,Nt:o,Ji:1,ji:0,Hs:h[1].x,Ls:s}}l=h[1].x}if(t.y-s<h[0].y&&i.y+s>h[0].y){let i=(h[0].y-s-t.y)*o;if(i>=0&&i<=1){let s=e*i+t.x;if(s>=h[0].x&&s<=h[1].x)return{x:s,y:n*i+t.y,Nt:i,Ji:0,ji:-1,Hs:s,Ls:h[0].y}}f=h[0].y}if(t.y+s>h[1].y&&i.y-s<h[1].y){let i=(t.y-(h[1].y+s))*-o;if(i>=0&&i<=1){let s=e*i+t.x;if(s>=h[0].x&&s<=h[1].x)return{x:s,y:n*i+t.y,Nt:i,Ji:0,ji:1,Hs:s,Ls:h[0].y}}f=h[1].y}if(l===1/0&&f===1/0)return;l!==1/0&&f===1/0&&(f=n>0?h[1].y:h[0].y),f!==1/0&&l===1/0&&(l=e>0?h[1].x:h[0].x);let u=1/s,a=Math.sqrt(e*e+n*n),c=l-t.x,A=f-t.y,M=Math.sqrt(c*c+A*A),O=Math.acos((c*e+A*n)/(a*M));if(M<s)return;if(0===O){let i=(M-s)/a;if(i>1||i<0)return;let h=i*e+t.x,r=i*n+t.y,o=c/M,u=A/M;return isNaN(h)?void 0:{x:h,y:r,Nt:i,Ji:o,ji:u,Hs:l,Ls:f}}let x=Math.sin(O),E=x*M*u;if(Math.abs(E)>1)return;let y=Math.PI-Math.asin(E),d=Math.PI-O-y,T=s*Math.sin(d)/x/a;if(T>1||T<0)return;let w=T*e+t.x,N=T*n+i.y,U=(w-l)*u,R=(N-f)*u;return isNaN(w)?void 0:{x:w,y:N,Nt:T,Ji:U,ji:R,Hs:l,Ls:f}}function tt(t,i,s){return Array.from({length:i},(()=>Array.from({length:t},s)))}function it(t,i){let s=J.Pt[0].Ct;return!(t<0||i<0||i>=s.length||t>=s[i].length)}function st(t,i){let s=J.Pt[0].Ct;return!(t<0||i<0||i>=s.length||t>=s[i].length)&&s[i][t]>=1&&s[i][t]<=4}function ht(t,i,s,h){return`rgba(${t},${i},${s},${h})`}function et(t,i){let s=document.createElement("canvas");s.width=t,s.height=i;let h=s.getContext("2d");return{e:s,t:h}}const nt={attack:[[0,0,10,10],[10,0,10,10]],et:[[0,10,8,16],[8,10,8,16],[16,10,8,16],[24,10,8,16],[32,10,8,16]],wi:[[0,26,3,3]],buttons:[[0,29,12,12],[12,29,12,12],[24,29,12,12],[36,29,12,12],[48,29,12,12],[60,29,12,12],[72,29,12,12],[84,29,12,12],[96,29,12,12],[108,29,12,12]],cursor:[[0,41,10,8]],Vi:[[0,49,9,9],[9,49,9,9],[18,49,9,9],[27,49,9,9],[36,49,9,9],[45,49,9,9],[54,49,9,9],[63,49,9,9]],font:[[0,58,180,12]],Fi:[[0,70,9,9],[9,70,9,9],[18,70,9,9],[27,70,9,9],[36,70,9,9],[45,70,9,9]],Lt:[[0,79,5,5],[5,79,5,5],[10,79,5,5],[15,79,5,5]],Ss:[[0,84,9,9]],ks:[[0,93,13,16]],Os:[[0,109,5,16]],Ns:[[0,125,60,18]],bi:[[0,143,7,7],[7,143,7,7],[14,143,7,7],[21,143,7,7],[28,143,7,7],[35,143,7,7],[42,143,7,7],[49,143,7,7]],li:[[0,150,3,3],[3,150,3,3],[6,150,3,3]],rs:[[0,153,8,8],[8,153,8,8]],Ct:[[0,161,8,8],[8,161,8,8],[16,161,8,8],[24,161,8,8],[32,161,8,8],[40,161,8,8],[48,161,8,8],[56,161,8,8],[64,161,8,8],[72,161,8,8],[80,161,8,8],[88,161,8,8],[96,161,8,8],[104,161,8,8]],gs:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAACpCAMAAAC1W+dFAAAAS1BMVEUAAAD/1KPuw5r/1KMNK0UgPFYkGhQuCAFUTmhcDwB1EgCNaXqPGxvCHQDJAADQgVnRFRXfcSbmAADuw5rwJAD/ql7/1KP/7Nb////35HahAAAABHRSTlMANJapGOAdBgAAA+NJREFUeNrtmQGz4iYUhW93pY3FNml3Af//Ly23B3Oygy86xiiM98MInOQxn1eizjyZpEemkxQw6ILTNGtPZr0vU3fWKPUkPVqfzPpl2hxKP0zyuRiGYQw42uSf/5EKr7TqXJ4rVLh96RCCLBiVpreHOsdDDEvpckiQ0GSx4Xwo1j6IBor2Y26NSrPSfkSBL4cfffPSPoxjYKXVOki70jFLa52zNSuN52ZBYbvgm/THtx9dWkuPhIKOY2H/fBthKASR6Atx/3yzMwjRz8RH8pC55DFTcpxBjjMbrSEdhjBLxNwox9wzVyABoubIKM3r1VkfZf2oj63SUKAcllYBpchFJa5UdCXH8rM0CvP67UE5tVvKKZTbr9K5zXLaNuzdq9J6sTbN9WJtm6Xx5mm77ENtobhxe2iMHPEl9+vSqDO32bNuxJUbCxLIKME8Il+Tvv5O7rKn984/78uly6/xJB2SUo/SMfUoHVOH0mIYhmEYhvE6TkAkzoM4D+I8iBgoGCgYKPJyzvfnFefzWUQfl0NbmaC/udD891yHa6ApHG+WhiRGXBgzzNHWOFdNeKxIPwqWqaqEMULB5Gv4NywC52dKI9u8lyiNmPVhjvljlV7ON1T6fOmrPT1vE/Q8MF+Xrvc0Fqfo4n7pkupVsserqhvyveEep9hMLVa9JVXT9FlwOfaAsstWS0OSL2wpzb37XGd+pmtHWGlM8QSqGp7nEaW5VUr2ZFgkQC/ejOiXJynDi4SVZcWZ7c1ceW6Tj2LS1pbRNH2RJG06T9pasE4pwTAPpruT91JX8WbSgHQGQkq/0utJG9KSBEIo4u2kIaZJpruSD8P4d+5+yp/HToSPf+vox1GOf/2EdDcc9ejMGeJ/SAd8B9IT338DbVqbtEmbtEnb57Rf0o/04MDQkTScYd2NtCMmbdImbdImvTsmbV/j9oOJdCYtnTFk50E6ww1+cN1JO+9M2qRN+lWYtEmbtH2N2w8mr0hvxId5o7N/mPhGafcgJm3SJm3SJm3SJm3SnyAN66ss/0FwndjcD+pfpONVpD0W0tIiKd3f4Tm1IJ3u6lLplGYqnVnpSBPWELjLlkhbLKVTL9KoPJ2vd01y++Z8LzG3zojlsTNW7N8Lh4JJm7RJm7RJt8VhI/M63juuV3LnvebaP7UoBzcoruq/woFKegxOez+OQQ9Ij0Gd1f6AfHyO9ACq/lHpEEI+KO0wOoyaj+HJ0u5OabRKOkDaFaCqIc+7PH9Ppel8dU8T7OnlecxfLl3jCro9ammGet7l+bOlHaWzxJ1cbrxKutrTuG63Tw863+Zy4x3CNenATw/eoJv5D/pn2p8SSijIAAAAAElFTkSuQmCC"},rt={Ds(t){let i=new Image;i.onload=t,i.src=nt.gs,rt.ms=i},s(){rt.font=ot(nt.font[0]),rt.li=nt.li.map(ot),rt.Lt=nt.Lt.map(ot),rt.bs=nt.cursor.map((t=>ot(t,{x:0,y:0})))[0],rt.wi=nt.wi.map(ot),rt.ks=nt.ks.map(ot),rt.Os=nt.Os.map(ot),rt.Ns=nt.Ns.map(ot),rt.Ss=nt.Ss.map(ot),rt.bi=nt.bi.map((t=>ot(t,{x:-1,y:-1}))),rt.Ct=nt.Ct.map(ot),rt.rs=nt.rs.map(ot),rt.Fi=nt.Fi.map(ot),rt.et=nt.et.map((t=>ot(t,{x:0,y:8}))),rt.buttons=nt.buttons.map(ot),rt.qs=lt(function(t){let i=et(544,334);for(let s=0;s<334;s+=32)for(let h=0;h<544;h+=32)i.t.drawImage(t,h,s);return i.e}(rt.Ct[0].ht)),rt.lt=lt(function(){let t=et(500,500),i=t.t.createRadialGradient(250,250,0,250,250,250);return i.addColorStop(.3,ht(0,0,0,0)),i.addColorStop(1,ht(0,0,0,.9)),t.t.fillStyle=i,t.t.fillRect(0,0,500,500),t.e}()),rt.attack=nt.attack.map(ot),rt.Vi=nt.Vi.map(ot)},Ps(t,i,s,h){t.drawImage(i.ht,s-i.$s.x,h-i.$s.y)},Ht(t,i,s){let{h:h,o:n}=this.Cs(t,i);s?(e.t.save(),e.t.translate(h+t.$s.x,n+t.$s.y),e.t.rotate(s),e.t.drawImage(t.ht,-t.$s.x,-t.$s.y),e.t.restore()):e.t.drawImage(t.ht,h,n)},Cs:(t,i)=>({h:i.x-t.$s.x-V.Tt.x+e.i.h,o:i.y-t.$s.y-V.Tt.y+e.i.o}),Ts(t){return this.Ct[t+20-1]||(this.Ct[t+20-1]=lt(function(t,i){let s=et(8,8);return 256&i&&s.t.drawImage(t[12].ht,0,0,4,4,0,0,4,4),64&i&&s.t.drawImage(t[12].ht,5,0,3,3,5,0,3,3),1&i&&s.t.drawImage(t[12].ht,6,6,2,2,6,6,2,2),4&i&&s.t.drawImage(t[12].ht,0,5,3,3,0,5,3,3),8&i&&s.t.drawImage(t[11].ht,5,0,3,8,5,0,3,8),32&i&&s.t.drawImage(t[9].ht,0,0,4,8,0,0,4,8),2&i&&s.t.drawImage(t[8].ht,0,5,8,3,0,5,8,3),128&i&&s.t.drawImage(t[10].ht,0,0,8,4,0,0,8,4),160==(160&i)&&s.t.drawImage(t[13].ht,0,0,5,5,0,0,5,5),136==(136&i)&&s.t.drawImage(t[13].ht,4,0,4,4,4,0,4,4),10==(10&i)&&s.t.drawImage(t[13].ht,4,4,4,4,4,4,4,4),34==(34&i)&&s.t.drawImage(t[13].ht,0,4,5,4,0,4,5,4),s.e}(this.Ct,t),{x:0,y:0})),this.Ct[t+20-1]}};function ot(t,i){return lt(function(t,i,s,h){const e=rt.ms,n=et(s,h);return n.t.drawImage(e,t,i,s,h,0,0,s,h),n.e}(...t),i)}function lt(t,i){let s=t.width,h=t.height;return{ht:t,$s:"object"==typeof i?i:{x:s/2|0,y:h/2|0}}}class ft{constructor(){this.frames=0}E(){return this.frames++,u.mt[u.A.Y]&&this.frames>30&&ut.c(),!0}Ut(){e.t.fillStyle=ht(36,26,20,Z(this.frames/200,0,1)),e.t.fillRect(0,0,e.width,e.height);let t=e.width-32,i="DEFEAT... \n                    \nYOUR LAST MOTH GONE, THIS WORLD SLIPS FROM YOUR GRASP. YOU CURSE THE VILLAGE AND ITS INHABITANTS AS YOU TUMBLE TOWARDS THAT BLEAK BEYOND. \n \nYOUR REIGN OF TERROR HAS ENDED. \n \nTAP TO TRY AGAIN!";i=i.slice(0,this.frames),A.dt(e.t,i,16,16,t,1,1,A.ut)}}const ut=new class{s(){rt.Ds((()=>{e.s(),rt.s(),A.s(),u.s(),o.s(),K.s(),V.s(),J.s(),window.addEventListener("blur",(()=>this.Q())),window.addEventListener("focus",(()=>this.at())),this.c(),this.start()}))}c(){this.is=[],this.Gs={},this.Fs={},this.Vs={},this.Ws=0,this.Ks=[],this.ts=[],this.Qi=0,this.ri=250,this.Gi=25,this.Bs=0,this.is.push(new d(z(J.Wt))),this.screen=void 0,this.ss=void 0,J.c(),V.Tt=q(z(J.os)),V.vs=q(z(J.Wt))}start(){this.pt=0,this.Js=[0],this.E(),window.requestAnimationFrame((t=>this.js(t)))}js(t){let i=(new Date).getTime();this.Js.length>=40&&this.Js.shift(),this.Ys=1e3/((this.Js[this.Js.length-1]-this.Js[0])/this.Js.length),this.pt++,e.n(),this.E(),this.Ut(e.t),window.requestAnimationFrame((t=>this.js(t)));let s=(new Date).getTime();this.Js.push(this.Js[this.Js.length-1]+s-i)}E(){if(this.ss||(this.ss=new P(this.Qi++)),u.E(),!(this.screen&&this.screen.E()||(u.mt[u.A.Y]&&this.mi(u.G),K.E(),this.Xs))){this.ss.E(),this.zs(),console.log(ut.is);for(let t of ut.is)t.bt&&t.bt();C.Wi(this.is),b.Wi(this.is),V.E(),this.is=this.is.filter((t=>!t.vt)),J.et=J.et.filter((t=>!t.vt)),this.Ks=this.Ks.filter((t=>t.E())),J.E(),0===this.is.filter((t=>t instanceof d)).length&&(ut.screen=new ft),ut.pt%6==0&&(this.Ws=10*Math.random()|0),30===ut.pt&&ut.Ks.push(new x(20,20,20)),u.mt[u.A.K]&&!ut.Qs&&(ut.Qs=!0)}}Ut(){e.t.setTransform(1,0,0,1,0,0),e.t.scale(e.scale,e.scale),e.t.fillStyle=ht(36,26,20,1),e.t.fillRect(0,0,e.width,e.height),J.Ut();for(let t of this.is)(!t.z||t.z<100)&&t.Ut();for(let t of this.is)t.z&&t.z>100&&t.Ut();J.hs(),K.Ut(),ut.pt<120&&(e.t.fillStyle=ht(0,0,0,1-ut.pt/120),e.l()),this.screen&&this.screen.Ut()}Q(){this.Xs||(this.Xs=!0,o.Q())}at(){this.Xs&&(this.Xs=!1,o.at())}mi(t){for(let i of[K,J])if(i.mi(t))break}Ui(){return this.is.filter((t=>t instanceof d)).length}pi(t,i){return(t>this.ri?"re":"we")+t+(i>0?(i>this.Gi?" rf":" wf")+i:"")}Si(t,i){return this.ri>=t&&this.Gi>=i}Oi(t,i){this.ri-=t,this.Gi-=i}zs(){let t=this.ts[0];if(t)for(let i=0;i<10;i++){let i=Math.floor(Math.random()*J.Pt[0].Ct[0].length),s=Math.floor(Math.random()*J.Pt[0].Ct.length);if(1!==J.Ct[s][i])continue;if(0!==J.es[s][i])continue;let h=z({$t:i,r:s});console.log("NEW monster"+h.x+","+h.y+","+J.es[s][i]),ut.is.push(t(h)),this.ts.shift();break}}};ut.s()}();
//# sourceMappingURL=app.js.map</script>
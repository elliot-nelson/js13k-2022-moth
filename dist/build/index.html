<style>body,html{margin:0;padding:0;background-color:#000}div{position:absolute;top:0;bottom:0;left:0;right:0}#canvas{width:100%;height:100%;touch-action:none}</style><div><canvas id="canvas"></canvas></div><script>!function(){"use strict";const t=["CAVE FLOOR","CAVE FLOOR","CAVE FLOOR","","","","DOOM PIT","DOOM PIT"],i=45*Math.PI/180,s=90*Math.PI/180,h=360*Math.PI/180,e={s(){e.e=document.getElementById("canvas"),e.t=e.e.getContext("2d"),e.n(!0)},n(t){let i=window.devicePixelRatio,s=e.e.clientWidth,h=e.e.clientHeight,n=s*i,r=h*i;(t||e.e.width!==n||e.e.height!==r)&&(e.e.width=n,e.e.height=r,e.scale=(10*Math.max(n/240,r/135)|0)/10,e.width=Math.ceil(n/e.scale),e.height=Math.ceil(r/e.scale),e.i={h:e.width/2|0,o:e.height/2|0},e.clientWidth=s,e.clientHeight=h,e.t.imageSmoothingEnabled=!1),e.e.style.cursor="none"},l(){e.t.fillRect(0,0,e.width,e.height)}},n={s(){n.map={KeyW:E.A.u,KeyA:E.A.M,KeyS:E.A.T,KeyD:E.A.m,ArrowUp:E.A.u,ArrowLeft:E.A.M,ArrowDown:E.A.T,ArrowRight:E.A.m,Escape:E.A.R},n.p=[{x:0,y:0,O:0},{x:0,y:-s,O:1},{x:0,y:s,O:1},{x:0,y:0,O:0},{x:-s,y:0,O:1},{x:-i,y:-i,O:1},{x:-i,y:i,O:1},{x:-s,y:0,O:1},{x:s,y:0,O:1},{x:i,y:-i,O:1},{x:i,y:i,O:1},{x:s,y:0,O:1},{x:0,y:0,O:0},{x:0,y:-s,O:1},{x:0,y:s,O:1},{x:0,y:0,O:0}],n.S=[],window.addEventListener("keydown",(t=>{let i=n.map[t.code];i&&(n.S[i]=!0)})),window.addEventListener("keyup",(t=>{let i=n.map[t.code];i&&(n.S[i]=!1)})),n.c()},E(){let t=(n.S[E.A.u]?1:0)+(n.S[E.A.T]?2:0)+(n.S[E.A.M]?4:0)+(n.S[E.A.m]?8:0);n.w=n.p[t]},c(){n.w=n.p[0];for(let t of Object.values(E.A))n.S[t]=!1}},r=(...t)=>o(l(...t)),o=(...t)=>{let i=a.createBufferSource(),s=a.createBuffer(t.length,t[0].length,u);return t.map(((t,i)=>s.getChannelData(i).set(t))),i.buffer=s,i.connect(r.k),i.start(),i},l=(t=1,i=.05,s=220,h=0,e=0,n=.1,r=0,o=1,l=0,a=0,c=0,A=0,M=0,E=0,O=0,y=0,R=0,T=1,x=0,d=0)=>{let w,I,m=2*Math.PI,H=l*=500*m/u**2,N=(0<O?1:-1)*m/4,S=s*=(1+2*i*Math.random()-i)*m/u,v=[],U=0,b=0,p=0,D=1,L=0,k=0,F=0;for(a*=500*m/u**3,O*=m/u,c*=m/u,A*=u,M=u*M|0,I=(h=99+u*h)+(x*=u)+(e*=u)+(n*=u)+(R*=u)|0;p<I;v[p++]=F)++k%(100*y|0)||(F=r?1<r?2<r?3<r?Math.sin((U%m)**3):Math.max(Math.min(Math.tan(U),1),-1):1-(2*U/m%2+2)%2:1-4*Math.abs(Math.round(U/m)-U/m):Math.sin(U),F=(M?1-d+d*Math.sin(2*Math.PI*p/M):1)*(0<F?1:-1)*Math.abs(F)**o*t*f*(p<h?p/h:p<h+x?1-(p-h)/x*(1-T):p<h+x+e?T:p<I-R?(I-p-R)/n*T:0),F=R?F/2+(R>p?0:(p<I-R?1:(I-p)/R)*v[p-R|0]/2):F),w=(s+=l+=a)*Math.sin(b*O-N),U+=w-w*E*(1-1e9*(Math.sin(p)+1)%2),b+=w-w*E*(1-1e9*(Math.sin(p)**2+1)%2),D&&++D>A&&(s+=c,S+=c,D=0),!M||++L%M||(s=S,l=H,D=D||1);return v},f=.3,u=44100,a=new(top.AudioContext||webkitAudioContext);r.k=a.destination;const c={s(){c.I=!1,c.t=a,c.N=c.t.createGain(),c.N.connect(c.t.destination),r.k=c.N,c.v=[,,68,.01,,.14,1,1.53,7.5,.1,50,.02,-.01,-.2,.1,.2,,.47,.01],c.U=[,,391,,.19,.01,2,.54,-4,20,,,,,,,.02,.9],c.H=[,,970,.12,.25,.35,,.39,8.1,,10,.1,.2,,.1,,,.6,.09,.13],c.g=[,,454,.06,.86,.71,2,.63,-.7,1.7,-83,.09,.27,.3,.2,,.18,.95,.02,.02],c.D=[1.04,,363,.01,.08,.52,2,.31,.3,,,,,1.5,,.9,,.34,.07],c.L=[1.56,,225,,.05,,3,.79,-7.6,.2,,,.08,,2.1,,.07,.99],c.P=[1.35,,968,.01,.02,,2,.12,-.7,.1,-105,.06,,.1,,,.01,.66,.04],c.q=[2.03,0,65.40639,.03,.66,.18,2,.95,,,,,.3,.4,,,.19,.21,.1,.04],c.C=[1.56,0,261.6256,,.13,.3,,.41,,,,,,.2,,,.05,.2,.19,.22]},E(){c.I},b(t){c.I&&r(...t)},Q(){c.N.gain.linearRampToValueAtTime(0,c.t.currentTime+1)},at(){c.N.gain.linearRampToValueAtTime(1,c.t.currentTime+1)}},A={s(){this.map=[],this.map[0]=E.A.G,this.map[2]=E.A.F,this.S=[],window.addEventListener("mousemove",(t=>{this.V||(this.V={}),this.V.h=t.clientX*e.width/e.clientWidth|0,this.V.o=t.clientY*e.height/e.clientHeight|0,E.mode=2})),window.addEventListener("mouseout",(()=>{this.V=void 0})),window.addEventListener("mousedown",(t=>{let i=this.map[t.button];i&&(this.S[i]=!0),c.I=!0,Mt.B="mousedown",E.mode=2,this.Y={h:t.clientX*e.width/e.clientWidth|0,o:t.clientY*e.height/e.clientHeight|0}})),window.addEventListener("mouseup",(t=>{let i=this.map[t.button];i&&(this.S[i]=!1),Mt.B="mouseup",E.mode=2})),window.addEventListener("click",(t=>{t.preventDefault(),Mt.B="click"})),window.addEventListener("contextmenu",(t=>{let i=this.map[t.button];i&&(this.S[i]=!0),this.W=2,t.preventDefault()})),A.c()},E(){this.W&&(this.W--,0===this.W&&(this.S[E.A.F]=!1))},c(){this.V=void 0;for(let t of Object.values(E.A))this.S[t]=!1}},M={s(){this.map=[],this.map[0]=E.A.G,this.S=[],window.addEventListener("touchmove",(t=>{this.V||(this.V={});let i=t.changedTouches[0];this.V.h=i.clientX*e.width/e.clientWidth|0,this.V.o=i.clientY*e.height/e.clientHeight|0,E.mode=1})),window.addEventListener("touchstart",(t=>{let i=this.map[0];i&&(this.S[i]=!0),c.I=!0,Mt.B="TOUCHSTART",E.mode=1;let s=t.changedTouches[0];this.Y={h:s.clientX*e.width/e.clientWidth|0,o:s.clientY*e.height/e.clientHeight|0},this.V={...this.Y}})),window.addEventListener("touchend",(t=>{let i=this.map[0];i&&(this.S[i]=!1),Mt.B="TOUCHEND",E.mode=1})),this.c()},E(){},c(){this.V=void 0;for(let t of Object.values(E.A))this.S[t]=!1}},E={A:{u:11,T:12,M:13,m:14,K:21,F:30,R:96,j:97,X:98,G:40,J:41,Z:42},s(){this.w={x:0,y:0,O:0},this.mt={},this._={},this.S={},this.$={},n.s(),A.s(),M.s(),this.mode=1,this.tt=!1},E(){n.E();let t=2===this.mode?A:M;for(let i of Object.values(E.A)){let s=t.S[i]||n.S[i];this.mt[i]=!this.S[i]&&s,this._[i]=this.S[i]&&!s,this.mt[i]?this.$[i]=1:this.S[i]&&s&&this.$[i]++,this.S[i]=s}this.V=t.V,this.w=n.w,this.S[E.A.G]&&(this.$[E.A.G]>20&&(this.tt=!0),Math.abs(t.Y.h-t.V.h)+Math.abs(t.Y.o-t.V.o)>5&&(this.tt=!0)),this.tt&&t.V&&(this.it={x:t.V.h-t.Y.h,y:t.V.o-t.Y.o}),this._[E.A.G]&&(this.tt?this.tt=!1:(this.mt[E.A.Z]=!0,this.$[E.A.Z]=1))},st(t){},ht(t){}},O={10:0,32:3,33:3,39:2,44:3,46:3,73:2},y={},R={s(){R.et=ut.font.nt;let t=[[101,ut.rt[2]]];for(let i of t)y[i[0]]=i[1],O[i[0]]=i[1].nt.width+1;R.ot=T(R.et,ot(0,0,0,1)),R.lt=T(R.et,ot(90,20,90,.15)),R.blue=T(R.et,ot(200,40,220,1)),R.ft=T(R.et,ot(240,50,200,.2)),R.ut=T(R.et,ot(240,240,255,.25)),R.red=T(R.et,ot(240,50,50,1)),R.ct=x(R.et,"#ffaa5e","#ffd4a3"),R.dt=x(R.et,"#ffaa5e","#ffd4a3",ot(255,0,0,.7))},At(t,i,s,h,e=1,n=R.ct,r){for(let o=0;o<i.length;o++){let l=i.charCodeAt(o);if(119!==l)if(114!==l){if(y[l])t.drawImage(y[l].nt,s,h-(y[l].nt.height+4)/2);else{let i=4*(l-32);r&&t.drawImage(r,i%180,6*(i/180|0),3,5,s+1,h+1,3*e,5*e),t.drawImage(n,i%180,6*(i/180|0),3,5,s,h,3*e,5*e)}s+=(O[l]||4)*e}else n=R.dt;else n=R.ct}},yt(t,i,s,h,e,n,r=1,o=R.ct,l){let f=s,u=h,a=i.split(" ");for(let i of a){for(;"\n"===i[0];)i=i.slice(1),f=s,u+=6*r;let h=R.Et(i,r);f+h-s>e&&(f=s,u+=6*r),R.At(t,i,f,u,r,o,l),f+=h+(O[32]||4)}},Et:(t,i)=>t.split("").reduce(((t,i)=>t+(O[i.charCodeAt(0)]||4)),0)*i};function T(t,i){let s=lt(t.width,t.height);return s.t.fillStyle=i,s.t.fillRect(0,0,t.width,t.height),s.t.globalCompositeOperation="destination-in",s.t.drawImage(t,0,0),s.e}function x(t,i,s,h){let e=lt(t.width,t.height);return e.t.fillStyle=s,e.t.fillRect(0,0,t.width,t.height),e.t.fillStyle=i,e.t.fillRect(0,0,t.width,1),e.t.fillRect(0,6,t.width,1),h&&(e.t.fillStyle=h,e.t.fillRect(0,0,t.width,t.height)),e.t.globalCompositeOperation="destination-in",e.t.drawImage(t,0,0),e.e}class d{constructor(t,i,s){this.frames=t,this.Mt=i,this.Tt=s,this.xt=[],this.wt=[];var h=t/2;for(let t=0;t<h;t++)this.xt.push(2*Math.random()-1),this.wt.push(2*Math.random()-1);this.pt=-1}E(){if(this.pt++,this.pt>=this.frames)return!1;let t=this.pt/2,i=0|t,s=i+1,h=1-this.pt/this.frames;return this.x=this.Mt*h*(this.xt[i]+(t-i)*(this.xt[s]-this.xt[i])),this.y=this.Tt*h*(this.wt[i]+(t-i)*(this.wt[s]-this.wt[i])),!0}}class w{constructor(t,s,h){this.Rt={...t},this.angle=s,this.Ot=z(Z(this.angle,h?8:5)),this.a=i,this.St=!0,this.f=h,this.bt=!0,this.kt=1,this.r=0,this.It=-1,this.d=0===this.f?45:70,this.Nt=!0}vt(){++this.It===this.d&&(this.Ut=!0),this.Ot.x*=.9,this.Ot.y*=.9,this.a*=.95,this.r+=this.a}Ht(){ut.gt(ut.Dt[this.f],this.Rt,this.r)}}w.U=t=>w.Lt(t,8,(()=>0)),w.Pt=t=>w.Lt(t,16,(()=>4*Math.random()|0)),w.Lt=(t,e,n)=>{let r=t.qt?function(t){let i=Math.atan2(t.y,t.x);return i<0&&(i+=h),i}(t.qt.Ct):Math.random()*h;for(let o=0;o<e*(Mt.g?2:1);o++){let e=Math.random()*t.kt,o=q(t.Rt,Z(Math.random()*h,e));Mt.is.push(new w(o,r+Math.random()*s-i,n()))}};const I={Gt:[{name:"1F",Ft:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,14,14,0,0,0,0,0,0,0,0,14,14,14,14,14,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,1,1,1,1,14,14,14,0,0,0,0,0,14,14,1,1,1,14,14,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,1,1,1,1,1,1,1,1,14,14,0,0,14,14,14,3,1,1,1,1,14,14,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,1,1,1,1,1,1,7,7,1,1,1,1,14,14,14,14,1,1,1,1,1,1,1,1,14,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,1,1,1,1,1,1,1,1,7,8,8,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,14,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,1,1,1,1,1,1,1,1,1,8,8,1,1,1,1,3,1,1,1,1,1,1,1,1,1,1,14,14,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,14,14,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,1,1,1,14,14,14,0,0],[0,0,0,0,0,0,0,14,14,14,14,14,14,14,1,1,1,14,14,14,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,14,14,0,0,0,0],[0,0,0,0,0,0,14,14,3,1,1,1,1,1,1,1,1,1,14,14,14,1,1,1,1,1,1,1,1,14,14,14,14,1,1,1,1,1,1,1,1,14,14,14,14,0],[0,0,0,0,0,14,14,1,1,1,1,2,1,1,1,7,1,1,1,14,14,14,1,1,1,1,14,14,14,14,14,1,14,14,2,1,3,1,1,1,1,1,1,1,14,14],[0,0,0,0,0,14,1,1,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,14,1,1,1,1,14,3,1,1,1,1,1,14],[0,0,0,0,0,14,1,7,8,1,1,14,14,14,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,7,1,14,1,1,1,1,14,14,1,1,1,1,3,14],[0,0,0,0,0,14,1,1,1,1,14,14,0,14,14,1,1,1,2,1,1,1,1,1,1,1,1,1,1,7,1,1,1,14,1,7,1,14,14,14,1,1,1,1,1,14],[0,0,0,0,0,14,14,1,2,14,14,0,0,14,14,1,1,1,1,1,14,14,14,14,1,1,2,1,1,1,1,1,14,14,1,8,1,14,0,14,14,1,1,2,14,14],[0,0,0,0,0,0,14,14,14,14,0,0,14,14,1,1,1,3,1,14,14,0,0,14,14,1,1,1,1,1,1,14,14,14,1,8,1,14,0,0,14,14,14,14,14,0],[0,0,0,0,0,0,0,0,0,0,0,0,14,1,1,7,1,1,1,14,0,0,0,0,14,14,1,1,1,1,2,14,14,14,1,8,1,14,14,0,0,0,0,0,0,0],[0,0,0,14,14,14,14,14,14,14,14,14,14,1,1,1,1,14,14,14,0,0,0,0,0,14,1,1,1,1,1,1,14,1,1,1,1,2,14,0,0,0,0,0,0,0],[0,14,14,14,1,1,1,1,1,14,14,14,14,1,1,1,1,14,0,0,0,0,0,0,0,14,14,1,1,1,1,1,14,1,1,1,1,1,14,14,0,0,0,0,0,0],[0,14,1,1,1,1,1,1,1,2,14,14,14,1,1,1,1,14,14,0,0,0,0,0,0,0,14,1,1,1,1,1,14,14,14,1,1,1,1,14,0,0,0,0,0,0],[14,14,1,1,1,1,1,1,1,1,14,14,14,1,1,1,1,1,14,14,0,0,0,0,0,0,14,1,1,1,1,1,1,1,14,14,1,1,1,14,0,0,0,0,0,0],[14,1,1,1,1,14,1,1,1,1,1,14,14,14,1,1,2,1,14,14,0,0,0,0,0,0,14,1,2,1,1,7,1,1,1,14,1,7,1,14,14,14,14,14,0,0],[14,1,7,1,1,14,14,1,1,1,1,14,14,14,14,1,1,1,14,14,0,0,0,0,0,0,14,14,1,1,1,8,7,1,1,14,1,1,1,14,14,1,1,14,14,0],[14,1,1,1,1,14,14,1,1,1,1,1,14,14,14,1,1,1,1,14,0,0,0,0,0,0,0,14,14,1,1,1,1,1,1,14,14,1,1,1,1,1,1,1,14,0],[14,14,1,1,1,14,14,1,1,1,1,1,1,14,14,1,1,7,1,14,0,0,0,0,0,0,0,0,14,14,1,1,3,1,14,14,1,1,1,1,1,1,1,1,14,0],[0,14,1,1,1,14,14,14,1,1,1,1,1,14,14,1,1,8,1,14,0,0,0,0,0,0,0,0,0,14,14,14,14,14,14,1,1,1,3,1,1,1,1,1,14,0],[0,14,1,1,1,1,14,14,14,1,1,1,14,14,14,1,1,1,1,14,0,0,0,0,0,0,0,0,0,0,0,14,14,1,1,1,1,14,14,14,1,1,1,14,14,0],[0,14,1,1,1,1,2,14,14,14,14,14,14,14,1,1,1,1,14,14,0,0,0,0,0,0,0,0,0,0,14,14,1,1,1,2,1,14,0,14,14,14,14,14,0,0],[0,14,14,1,1,1,1,1,14,14,14,14,14,2,1,1,1,14,14,0,0,0,0,0,0,0,0,0,0,0,14,1,3,1,14,14,14,14,0,0,0,0,0,0,0,0],[0,0,14,14,1,1,1,1,1,1,1,1,1,1,1,3,1,14,0,0,0,0,0,0,0,0,0,0,0,0,14,1,1,14,14,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,14,14,1,1,1,1,1,1,7,1,1,1,1,14,14,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,14,14,14,1,3,1,1,1,1,1,1,14,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,14,14,14,14,14,14,14,14,14,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],Vt:[],Bt:[{name:"SPAWN",x:42,y:11},{name:"EARTH",x:20,y:3},{name:"EXIT",x:10,y:24},{name:"EARTH",x:41,y:25},{name:"EARTH",x:43,y:22},{name:"EARTH",x:33,y:17},{name:"EARTH",x:40,y:6},{name:"EARTH",x:36,y:3},{name:"EARTH",x:14,y:7},{name:"EARTH",x:31,y:13},{name:"EARTH",x:7,y:13}],Yt:[],id:0}],bounds:[[0,0],[46,32]],Wt:[42,11,0]};class m{constructor(t){this.Rt={...t},this.target={...this.Rt},this.Ot={x:0,y:0},this.Kt=1,this.U=[],this.kt=3,this.as=2,this.St=!0,this.Nt=!0,this.jt=7,this.Xt=[],this.Jt=0,this.offset={x:0,y:0},this.Zt=0,this.zt=500,this.Qt=3,this._t=0,this.pt=0,this.$t=Math.floor(16*Math.random()),this.ti=Mt.pt;let i=Q(this.Rt);this.moveTo({ii:i.ii,r:i.r-1})}vt(){0===this.Xt.length&&this.Xt.push({si:2});let t=this.Xt[this.Xt.length-1];if(this.pt=Math.floor(Mt.pt/8)%2+1,9===this.as)return c.b(c.D),void(this.Ut=!0);if(3===t.si)this.target=it($(t.hi)),J(this.Rt,this.target).O<6&&this.Xt.pop();else if(6===t.si){if(this.target=it($(t.hi)),J(this.Rt,this.target).O<6){this.pt=0;let i=V.ei(t.hi);i.ni++,i.ni>=i.ri&&this.Xt.pop()}}else if(4===t.si){this.target=it($(t.hi));let i=J(this.Rt,this.target),s=V.ei(t.hi);s?i.O<6&&(this.pt=0,this.Zt+=this.Qt,s.oi-=this.Qt,this.Zt>=this.zt&&this.Xt.push({si:5,hi:{ii:V.Wt.ii,r:V.Wt.r}})):(this.Xt.pop(),this.Xt.push({si:5,hi:{ii:V.Wt.ii,r:V.Wt.r}}))}else 5===t.si&&(this.target=it($(t.hi)),J(this.Rt,this.target).O<6&&(this.pt=0,this.Zt-=this.Qt,this._t+=this.Qt,this._t>=100&&(Mt.li++,this._t-=100),this.Zt<=0&&this.Xt.pop()));let i=V.ai(this.Rt,this.target);console.log([this.target,i]);let s=J(this.Rt,i);s.O=st(s.O,0,.5);let h=z(s);this.Ot={x:(this.Ot.x+h.x)/2,y:(this.Ot.y+h.y)/2}}Ht(){let t=3;0===this.pt&&t--;let i=Math.cos((Mt.pt+this.$t)/16)*t,s=1*Math.sin((Mt.pt+this.$t)/16);ut.gt(ut.fi[this.pt],{x:this.Rt.x+i,y:this.Rt.y+s})}ui(t){this.Xt=[{si:4,hi:t}],this.ti=Mt.pt}construct(t){this.Xt.push({si:6,hi:t}),this.ti=Mt.pt}moveTo(t){this.Xt=[{si:3,hi:t}],this.ti=Mt.pt}ci(){let t=this.Xt[this.Xt.length-1];return t&&2!==t.si}}m.di=()=>{let t=Mt.is.filter((t=>t instanceof m));return t.sort(((t,i)=>t.ci()&&!i.ci()?1:!t.ci()&&i.ci()?-1:t.ti-i.ti)),t},m.assign=t=>{let i=m.di();for(let s=0;s<i.length&&!(s>0&&i[s].ci());s++)t(i[s])};class H{constructor(t,i,s){this.Rt={...t},this.target=i,this.Ot={x:0,y:0},this.U=s||70}vt(){let t=J(this.Rt,this.target.Rt);t.O=st(t.O,0,2),this.Ot={x:(this.Ot.x+t.x*t.O)/2,y:(this.Ot.y+t.y*t.O)/2},t.O<1&&(this.target.U.push({Ai:this.U,Ct:t,yi:0}),this.Ut=!0,console.log("HIT"))}Ht(){ut.gt(ut.Ei[0],this.Rt,this.r)}}const N={Mi:()=>!!V.ei(V.selected),Ti:()=>ut.buttons[6],xi:()=>ut.buttons[7],wi(t,i){let s=V.ei(V.selected),h=Mt.mi(15)?"BUILD TOWER \ne15":"BUILD TOWER \ner15";s&&(h="FINISH BUILDING"),R.yt(e.t,h,t,i)},Ri(){if(V.ei(V.selected))m.assign((t=>t.construct(V.selected)));else if(Mt.mi(15))return Mt.pi(15),V.rt.push(new S(V.selected)),m.assign((t=>t.construct(V.selected))),!0}};class S{constructor(t){this.hi={...t},this.Oi=10,this.jt=7,this.as=21,this.ni=0,this.ri=180,this.title="TOWER",this.Si=ut.rt[0]}vt(){if(!(this.ni>=this.ri))return;22!==this.as&&(this.as=22,c.b(c.q));let t,i,s=it($(this.hi));if(!this.target||this.target.Ut){for(let h of Mt.is){if(!h.bi)continue;let e=J(s,h.Rt);e.O<32&&(!i||e.O<i.O)&&(t=h,i=e)}console.log("ATTEMPTED to pick target for building",t),this.target=t}this.Oi>0&&this.Oi--,this.target&&0===this.Oi&&(J(s,this.target),Mt.is.push(new H(s,this.target)),this.Oi=100,c.b(c.L))}Ht(){let t=$(this.hi);if(_(it(t)),e.t.globalAlpha=21===this.as?.5:1,ut.gt(ut.rt[0],t),e.t.globalAlpha=1,21===this.as){let i=st(Math.floor(8*this.ni/this.ri),0,7);e.t.globalAlpha=.5,ut.gt(ut.ki[7],t),e.t.globalAlpha=1,ut.gt(ut.ki[i],t)}}Ii(){return this.ni<this.ri?[N]:[]}}const v=[0,2];for(let t=2;t<=19;t++)v[t]=Math.floor(1.5*v[t-1]+1);for(let t=0;t<20;t++)v[t]=5*v[t];const U={Mi:()=>!1,Ti:()=>ut.buttons[0],xi:()=>ut.buttons[1],wi(t,i){let s=v[Mt.Ni()],h=Mt.mi(s)?"LURE MOTH \ne"+s:"LURE MOTH \ner"+s;R.yt(e.t,h,t,i)},Ri(){let t=v[Mt.Ni()];if(Mt.mi(t))return Mt.pi(t),Mt.is.push(new m(it($(V.selected)))),!0}};class b{constructor(t){this.hi={...t},this.title="YOUR COFFIN \nLAST CHANCE",this.Si=ut.rt[1],this.jt=9}vt(){}Ht(){let t=$(this.hi);ut.gt(ut.rt[1],t)}Ii(){return[U]}}class p{constructor(t){this.Rt={...t},this.It=-1,this.d=3,this.z=101,this.vi=Math.random()*Math.PI*2}vt(){++this.It===this.d&&(this.Ut=!0),this.vi+=.1}Ht(){let t=this.It<2?0:1;ut.gt(ut.attack[t],this.Rt,this.vi)}}class D{constructor(t){this.Rt={...t},this.Kt=100,this.U=[],this.Ot={x:0,y:0},this.kt=2,this.Ui=.2,this.Hi=0,this.as=11,this.bi=!0}vt(){let t=Mt.is.filter((t=>t instanceof m)),i=t[0];if(!i)return;let s=J(this.Rt,i.Rt);for(let h=1;h<t.length;h++){let e=J(this.Rt,t[h].Rt);e.O<s.O&&(i=t[h],s=e)}const h=V.ai(this.Rt,i.Rt);let e=J(this.Rt,h);11===this.as?s.O<8?(this.as=12,this.gi=10,this.Di=i):(e.O=st(e.O,0,.3),this.Ot={x:(this.Ot.x+e.x*e.O)/2,y:(this.Ot.y+e.y*e.O)/2}):12===this.as?(this.Ot={x:.9*this.Ot.x,y:.9*this.Ot.y},this.gi--,5===this.gi?(this.Di.U.push({Ai:10,Ct:{x:0,y:0,O:0},yi:0}),Mt.is.push(new p(this.Di.Rt))):-30===this.gi&&(this.as=11)):9===this.as&&(c.b(c.P),this.Ut=!0,w.Pt(this))}Ht(){let t=12===this.as?ut.Li[1]:ut.Li[0];ut.gt(t,this.Rt)}}const L={Mi:()=>!0,Ti:()=>ut.buttons[2],xi:()=>ut.buttons[3],wi(t,i){R.yt(e.t,"GATHER EARTH",t,i)},Ri:()=>(m.assign((t=>t.ui(V.selected))),!0)};class k{constructor(t){this.hi={...t},this.oi=1e4,this.title="EARTH",this.Si=ut.rt[2]}vt(){this.title="EARTH \n"+Math.ceil(this.oi/100)+" REMAINING",this.oi<1&&(this.Ut=!0)}Ht(){let t=$(this.hi);ut.gt(ut.rt[2],t)}Ii(){return[L]}}const F={Mi:()=>!0,Ti:()=>ut.buttons[4],xi:()=>ut.buttons[5],wi(t,i){R.yt(e.t,"EXPLORE",t,i)},Ri:()=>(m.assign((t=>t.moveTo(V.selected))),!0)},G={Pi(t){let i=t.filter((t=>t.Rt&&t.Ot&&!t.Ut));for(let t=0;t<5;t++){for(let t=0;t<i.length-1;t++)for(let s=t+1;s<i.length;s++)G.qi(i[t],i[s]);for(let t of i)G.Ci(t)}for(let t of i)t.Rt.x+=t.Ot.x,t.Rt.y+=t.Ot.y},qi(t,i){if(t.St||i.St)return;let s=function(t,i,s,h,e,n){[s,n]=[z(s),z(n)];let r=J({x:t.x+s.x,y:t.y+s.y},{x:h.x+n.x,y:h.y+n.y});if(r.O<i+e)return{Gi:r.x,Fi:r.y,O:i+e-r.O}}(t.Rt,t.kt,t.Ot,i.Rt,i.kt,i.Ot);if(s)if(t.bt&&i.bt)t.Ot.x=-s.Gi*s.O,t.Ot.y=-s.Fi*s.O,i.Ot.x=s.Gi*s.O,i.Ot.y=s.Fi*s.O;else{let h=W(t.Ot).O+i.Ui,e=W(i.Ot).O+t.Ui,n=t.bt?.1:1,r=i.bt?.1:1;t.Ot.x-=s.Gi*s.O*n*h/(h+e),t.Ot.y-=s.Fi*s.O*n*h/(h+e),i.Ot.x+=s.Gi*s.O*r*e/(h+e),i.Ot.y+=s.Fi*s.O*r*e/(h+e)}},Ci(t){if(!t.Nt){t.Rt.y<-1e3&&console.log("FUUUUUUUUUUUUUUUU");for(let i of function*(t,i,s){yield*function*(t,i,s){let h=[{x:Math.min(t.x,i.x)-s,y:Math.min(t.y,i.y)-s},{x:Math.max(t.x,i.x)+s,y:Math.max(t.y,i.y)+s}];yield*function*(t){for(let i=t[0].y/8|0;8*i<t[1].y;i++)for(let s=t[0].x/8|0;8*s<t[1].x;s++)yield{ii:s,r:i}}(h)}(t,{x:t.x+i.x,y:t.y+i.y},s)}(t.Rt,t.Ot,t.kt))if(!rt(i.ii,i.r)){let s=[$(i),$({ii:i.ii+1,r:i.r+1})],h=ht(t.Rt,{x:t.Rt.x+t.Ot.x,y:t.Rt.y+t.Ot.y},t.kt,s);h&&(t.bt?0===h.Gi?t.Ot.y=-t.Ot.y:0===h.Fi?t.Ot.x=-t.Ot.x:(t.Ot.x+=h.Gi,t.Ot.y+=h.Fi):0===h.Gi?t.Ot.y=h.y-t.Rt.y:0===h.Fi?t.Ot.x=h.x-t.Rt.x:(t.Ot.x+=h.Gi,t.Ot.y+=h.Fi))}}}},C={Pi(t){let i=!1;for(let s of t)if(s.Kt){if(s.U.length>0){if(9!==s.as&&1!==s.as)for(let t of s.U)s===Mt.Vi&&Mt.is.push(new HealthChunkAnimation(s.Kt,t.Ai)),s.Kt-=t.Ai,t.Ct.O=t.yi,s.Ot=q(s.Ot,t.Ct),s.qt=t,w.U(s),i=!0;s.U=[]}s.Kt<=0&&9!==s.as&&(s.as=9)}i&&c.b(c.U)}},P=[[[0,1],[5,1],[10,1],[15,1],[20,1],[21,1],[22,1]]];class B{constructor(t){t%=P.length,this.Bi=[...P[t]],this.Yi=240,this.Wi=!1,this.pt=0,this.Ki=60*this.Bi[this.Bi.length-1][0]}E(){if(this.Yi--,this.Yi>=0&&this.Yi<=120&&this.Yi%60==0&&c.b(c.C),this.Yi<=0){this.Wi=!0;for(let t=0;t<this.Bi.length;t++)this.pt===60*this.Bi[t][0]&&Mt.ji.push(D);this.pt++}this.pt>=this.Ki&&(Mt.Xi=void 0)}}class Y{constructor(){this.frames=0}E(){this.frames++}Ht(){e.t.fillStyle=ot(36,26,20,st(this.frames/200,0,1)),e.t.fillRect(0,0,e.width,e.height);let t=e.width-32,i="ESCAPE! \n                    \nVILLAGERS STIR UNEASILY IN THEIR BEDS AS YOU EMERGE INTO MOONLIGHT. YOU SENSE WARM BODIES ALL AROUND YOU, RIPE FOR PICKING. IT IS ONLY A MATTER OF TIME NOW BEFORE YOU REGAIN YOUR FULL NECROMANTIC POWER. \n                    \nCONGRATULATIONS... AND THE END.";i=i.slice(0,this.frames),R.yt(e.t,i,16,16,t,1,1)}}class g{constructor(t){this.hi={...t},this.title="REACH EXIT \nTO ESCAPE",this.Si=ut.rt[3],this.jt=4}vt(){let t=m.di(),i=it($(this.hi));for(let s of t)if(J(s.Rt,i).O<6)return void(Mt.screen=new Y)}Ht(){let t=$(this.hi);ut.gt(ut.rt[3],t)}Ii(){return[F]}}const V={s(){this.c()},Ht(){let t=this.Gt[0].Ft,i=_({x:0,y:0});for(let s=0;s<t.length;s++)for(let h=0;h<t[0].length;h++)t[s][h]>0&&e.t.drawImage(ut.Ft[t[s][h]-1].nt,8*h+i.h,8*s+i.o);for(let t of this.rt)t.Ht()},Ji(){let t=this.Ft,i=_({x:0,y:0});for(let s=0;s<t.length;s++)for(let h=0;h<t[0].length;h++)if(t[s][h]>0){let t=1-st(this.Zi[s][h]/5,.1,1);0===this.zi[s][h]&&(t=1),e.t.globalAlpha=t,e.t.drawImage(ut.Qi[0].nt,8*h+i.h,8*s+i.o)}e.t.globalAlpha=1},c(){this.Gt=I.Gt.map((t=>({Ft:t.Ft.map((t=>[...t])),Bt:t.Bt.map((t=>({...t})))}))),this.bounds=I.bounds,this.Wt={ii:I.Wt[0],r:I.Wt[1]},this.rt=[],this.rt.push(new b(this.Wt));for(let t of this.Gt[0].Bt)"EARTH"===t.name?this.rt.push(new k({ii:t.x,r:t.y})):"EXIT"===t.name&&(this.rt.push(new g({ii:t.x,r:t.y})),this._i={ii:t.x,r:t.y});this.selected=void 0,this.Ft=this.Gt[0].Ft,this.width=this.Ft[0].length,this.height=this.Ft.length,this.Zi=et(this.width,this.height,(()=>0)),this.zi=et(this.width,this.height,(()=>0)),this.$i={},this.ts()},E(){for(let t of this.rt)t.vt();this.ss()},hs(t){return 46===this.es(t)},ns(t){return this.rs.includes(this.Gt[t.z].Ft[t.y][t.x])},os(t){this.Gt[t.z]},Ri(t){Mt.is.push(new p(tt(t)));let i=Q(tt(t)),s=this.es(i);if(!s||s>8||!this.zi[i.r][i.ii])this.selected=void 0;else if(this.selected&&this.selected.ii===i.ii&&this.selected.r===i.r){let t=this.ei(this.selected);if(t){let i=t.Ii();i[0]&&i[0].Mi()&&i[0].Ri()}else F.Ri()}else this.selected=i,this.ei(this.selected)},es(t){if(t)return this.Gt[0].Ft[t.r]?.[t.ii]},ei(t){if(t)for(let i of this.rt)if(i.hi.ii===t.ii&&i.hi.r===t.r)return i},ss(){let t=[];for(let i of this.rt)i.jt&&t.push({...i.hi,ls:i.jt});for(let i of Mt.is)i.jt&&t.push({...Q(i.Rt),ls:i.jt});this.Zi=function(t,i,s=1/0){let h=et(t[0].length,t.length,(()=>0)),e=[...i];for(;e.length>0;){let{ii:t,r:i,ls:n}=e.shift();h[i][t]>=n||(h[i][t]=n--,h[i][t]>=s||(nt(t+1,i)&&h[i][t+1]<n&&e.push({ii:t+1,r:i,ls:n}),nt(t-1,i)&&h[i][t-1]<n&&e.push({ii:t-1,r:i,ls:n}),nt(t,i+1)&&h[i+1][t]<n&&e.push({ii:t,r:i+1,ls:n}),nt(t,i-1)&&h[i-1][t]<n&&e.push({ii:t,r:i-1,ls:n})))}return h}(this.Ft,t);for(let t=0;t<this.Zi.length;t++)for(let i=0;i<this.Zi[0].length;i++)this.Zi[t][i]>this.zi[t][i]&&(this.zi[t][i]=1)},ai(t,i){let s=Q(t),h=Q(i);var e,n;if(e=s,n=h,Math.abs(e.ii-n.ii)+Math.abs(e.r-n.r)<=1)return i;let r=[h.ii,h.r].join(","),o=this.$i[r];o||(o=this.$i[r]=function(t,i,s=1/0){let h=et(t[0].length,t.length,(()=>1/0)),e=[{...i,fs:0}];for(;e.length>0;){let{ii:t,r:i,fs:n}=e.shift();h[i][t]<=n||(h[i][t]=n++,h[i][t]>=s||(rt(t+1,i)&&h[i][t+1]>n&&e.push({ii:t+1,r:i,fs:n}),rt(t-1,i)&&h[i][t-1]>n&&e.push({ii:t-1,r:i,fs:n}),rt(t,i+1)&&h[i+1][t]>n&&e.push({ii:t,r:i+1,fs:n}),rt(t,i-1)&&h[i-1][t]>n&&e.push({ii:t,r:i-1,fs:n})))}return h}(this.Ft,h)),console.log(Object.keys(this.$i).length);let l=[[s.ii+1,s.r],[s.ii-1,s.r],[s.ii,s.r+1],[s.ii,s.r-1]];for(let t of l)t.push(o[t[1]][t[0]]);return l.sort(((t,i)=>t[2]-i[2])),it($({ii:l[0][0],r:l[0][1]}))},ts(){for(let t=0;t<this.Ft.length;t++)for(let i=0;i<this.Ft[0].length;i++)if(14===this.Ft[t][i]){let s=0;(this.Ft[t-1]?.[i-1]||99)<8&&(s|=256),(this.Ft[t-1]?.[i]||99)<8&&(s|=128),(this.Ft[t-1]?.[i+1]||99)<8&&(s|=64),(this.Ft[t]?.[i-1]||99)<8&&(s|=32),(this.Ft[t]?.[i+1]||99)<8&&(s|=8),(this.Ft[t+1]?.[i-1]||99)<8&&(s|=4),(this.Ft[t+1]?.[i]||99)<8&&(s|=2),(this.Ft[t+1]?.[i+1]||99)<8&&(s|=1),ut.us(s),this.Ft[t][i]=20+s}}},K=18,X={s(){this.cs=lt(7,7)},E(){if(V.selected){let t=V.es(V.selected),i=V.ei(V.selected);this.actions=i?i.Ii():t>=1&&t<=4?[F,N]:[]}else this.actions=[];E.tt&&(this.ds=void 0)},Ht(){if(e.t.fillStyle=ot(36,26,20,.4),e.t.fillRect(0,0,e.width,9),e.t.fillRect(0,9,e.width,1),Mt.Xi)if(Mt.Xi.Wi){let t="INCOMING",i=R.Et(t,1),s=(e.width-i)/2,h=Math.floor(Mt.pt/60)%2==0?R.ct:R.dt;R.At(e.t,t,s,2,1,h)}else{let t=Math.ceil(Mt.Xi.Yi/60);if(t<=30){let i="NEXT WAVE",s=R.Et(i,1)+2,h=(e.width-s)/2;R.At(e.t,"NEXT WAVE ",h,2),this.cs.t.clearRect(0,0,7,7),this.cs.t.fillStyle=ot(255,212,163,1),this.cs.t.beginPath(),this.cs.t.moveTo(3.5,3.5),this.cs.t.lineTo(3.5,0),this.cs.t.arc(3.5,3.5,3,1.5*Math.PI,1.5*Math.PI+t/30*Math.PI*2),this.cs.t.fill(),e.t.drawImage(this.cs.e,h+s,1)}}let i=Mt.is.filter((t=>t instanceof m));for(let t=0;t<i.length;t++)e.t.drawImage(ut.fi[1].nt,2+4*t,2);let s,h=Mt.li+"e",n=R.Et(h,1);if(e.t.fillStyle="rgba(0, 0, 0, 0.1)",R.At(e.t,h,e.width-n-2,2),E.V){let t=E.V.h,i=E.V.o,s=tt(E.V),h=Q(s);if(R.At(e.t,t+","+i+". "+s.x+","+s.y+". "+h.ii+","+h.r+".",e.width-100,20),V.selected){let t=V.Ft[V.selected.r][V.selected.ii];t>20&&(t-=20),R.At(e.t,V.selected.ii+","+V.selected.r+". "+t.toString(2).padStart(9,"0"),e.width-100,29)}}if(V.selected){let t=_({x:8*V.selected.ii,y:8*V.selected.r});e.t.fillStyle=ot(255,212,163,.25),e.t.fillRect(t.h,t.o,9,9)}if(e.t.fillStyle="#ffd4a3",e.t.fillRect(0,e.height-K,e.width,1),e.t.fillStyle="#8d697a",e.t.fillRect(0,e.height-K+1,e.width,1),e.t.fillStyle="#203c56",e.t.fillRect(0,e.height-K+2,e.width,16),e.t.fillStyle="#8d697a",e.t.fillRect(0,e.height-2,e.width,2),e.t.drawImage(ut.As[0].nt,-2,e.height-K+1),e.t.drawImage(ut.As[0].nt,64,e.height-K+1),e.t.drawImage(ut.As[0].nt,e.width-3,e.height-K+1),V.selected){let i=V.ei(V.selected);if(i)e.t.drawImage(i.Si.nt,3,e.height-K-1),R.yt(e.t,i.title,14,e.height-K+3,e.width);else{let i=V.es(V.selected);console.log(V.selected,i,t[i-1]),e.t.drawImage(ut.Qi[1].nt,4,e.height-K+6),e.t.drawImage(ut.Ft[i-1].nt,3,e.height-K+5),R.yt(e.t,t[i-1],14,e.height-K+3,e.width)}}for(let t=0;t<this.actions.length;t++){let i=this.actions[t],h=this.ys(t);e.t.drawImage(ut.As[0].nt,h.h+11,e.height-K+1),e.t.drawImage(i.Ti().nt,h.h,h.o),this.ds===i&&(s=t)}if(s>=0){let t=this.ys(s);e.t.drawImage(ut.Es[0].nt,t.h-23,t.o-19),e.t.drawImage(this.ds.xi().nt,t.h,t.o),this.ds.wi(t.h-23+3,t.o-19+3)}E.V&&(Mt.Ms&&(e.t.globalAlpha=.5),ut.gt(ut.Ts,tt(E.V)),e.t.globalAlpha=1)},ys:t=>({h:68+15*t,o:e.height-15}),Ri(t){if(t.o>e.height-K){for(let i=0;i<this.actions.length;i++){let s=this.ys(i);if(t.h>=s.h&&t.h<=s.h+12&&t.o>=s.o&&t.o<=s.o+12)return this.actions[i]===this.ds?this.ds.Ri()&&(this.ds=void 0):this.ds=this.actions[i],!0}return this.ds=void 0,!0}return this.ds=void 0,!1}},j={s(){this.Rt={x:0,y:0},this.xs=void 0,this.Ot={x:0,y:0}},E(){if(this.xs){let t=J(this.Rt,this.xs);if(t.O<1)return void(this.xs=void 0);t.O=st(t.O,0,2);let i=z(t);this.Ot={x:(this.Ot.x+i.x)/2,y:(this.Ot.y+i.y)/2},this.Rt.x+=this.Ot.x,this.Rt.y+=this.Ot.y}E.mt[E.A.G]&&(this.ws={...this.Rt}),E.tt&&(this.Rt={x:this.ws.x-E.it.x,y:this.ws.y-E.it.y})}};function W(t){let i=Math.sqrt(t.x*t.x+t.y*t.y);return 0===i?{x:0,y:0,O:0}:{x:t.x/i,y:t.y/i,O:i}}function J(t,i){return W({x:i.x-t.x,y:i.y-t.y})}function Z(t,i){return{x:Math.cos(t),y:Math.sin(t),O:i||1}}function z(t){return{x:t.x*(t.O||1),y:t.y*(t.O||1)}}function q(...t){let i={x:0,y:0,O:1};for(let s of t)i.x+=s.x*(s.O||1),i.y+=s.y*(s.O||1);return i}function Q(t){return{ii:t.x/8|0,r:t.y/8|0}}function $(t){return{x:8*t.ii,y:8*t.r}}function _(t){return{h:t.x+e.i.h-j.Rt.x,o:t.y+e.i.o-j.Rt.y}}function tt(t){return{x:t.h-e.i.h+j.Rt.x,y:t.o-e.i.o+j.Rt.y}}function it(t){return{x:t.x+4,y:t.y+4}}function st(t,i,s){return t<i?i:t>s?s:t}function ht(t,i,s,h){if(Math.max(t.x,i.x)+s<h[0].x||Math.min(t.x,i.x)-s>h[1].x||Math.max(t.y,i.y)+s<h[0].y||Math.min(t.y,i.y)-s>h[1].y)return;let e=i.x-t.x,n=i.y-t.y,r=0===e?0:1/e,o=0===n?0:1/n,l=1/0,f=1/0;if(t.x-s<h[0].x&&i.x+s>h[0].x){let i=(h[0].x-s-t.x)*r;if(i>=0&&i<=1){let s=n*i+t.y;if(s>=h[0].y&&s<=h[1].y)return{x:e*i+t.x,y:s,It:i,Gi:-1,Fi:0,Rs:h[0].x,ps:s}}l=h[0].x}if(t.x+s>h[1].x&&i.x-s<h[1].x){let o=(t.x-(h[1].x+s))*-r;if(o>=0&&o<=1){let s=n*o+i.y;if(s>=h[0].y&&s<=h[1].y)return{x:e*o+t.x,y:s,It:o,Gi:1,Fi:0,Rs:h[1].x,ps:s}}l=h[1].x}if(t.y-s<h[0].y&&i.y+s>h[0].y){let i=(h[0].y-s-t.y)*o;if(i>=0&&i<=1){let s=e*i+t.x;if(s>=h[0].x&&s<=h[1].x)return{x:s,y:n*i+t.y,It:i,Gi:0,Fi:-1,Rs:s,ps:h[0].y}}f=h[0].y}if(t.y+s>h[1].y&&i.y-s<h[1].y){let i=(t.y-(h[1].y+s))*-o;if(i>=0&&i<=1){let s=e*i+t.x;if(s>=h[0].x&&s<=h[1].x)return{x:s,y:n*i+t.y,It:i,Gi:0,Fi:1,Rs:s,ps:h[0].y}}f=h[1].y}if(l===1/0&&f===1/0)return;l!==1/0&&f===1/0&&(f=n>0?h[1].y:h[0].y),f!==1/0&&l===1/0&&(l=e>0?h[1].x:h[0].x);let u=1/s,a=Math.sqrt(e*e+n*n),c=l-t.x,A=f-t.y,M=Math.sqrt(c*c+A*A),E=Math.acos((c*e+A*n)/(a*M));if(M<s)return;if(0===E){let i=(M-s)/a;if(i>1||i<0)return;let h=i*e+t.x,r=i*n+t.y,o=c/M,u=A/M;return isNaN(h)?void 0:{x:h,y:r,It:i,Gi:o,Fi:u,Rs:l,ps:f}}let O=Math.sin(E),y=O*M*u;if(Math.abs(y)>1)return;let R=Math.PI-Math.asin(y),T=Math.PI-E-R,x=s*Math.sin(T)/O/a;if(x>1||x<0)return;let d=x*e+t.x,w=x*n+i.y,I=(d-l)*u,m=(w-f)*u;return isNaN(d)?void 0:{x:d,y:w,It:x,Gi:I,Fi:m,Rs:l,ps:f}}function et(t,i,s){return Array.from({length:i},(()=>Array.from({length:t},s)))}function nt(t,i){let s=V.Gt[0].Ft;return!(t<0||i<0||i>=s.length||t>=s[i].length)}function rt(t,i){let s=V.Gt[0].Ft;return!(t<0||i<0||i>=s.length||t>=s[i].length)&&s[i][t]>=1&&s[i][t]<=4}function ot(t,i,s,h){return`rgba(${t},${i},${s},${h})`}function lt(t,i){let s=document.createElement("canvas");s.width=t,s.height=i;let h=s.getContext("2d");return{e:s,t:h}}const ft={attack:[[0,0,10,10],[10,0,10,10]],rt:[[0,10,8,16],[8,10,8,16],[16,10,8,16],[24,10,8,16]],Ei:[[0,26,3,3]],buttons:[[0,29,12,12],[12,29,12,12],[24,29,12,12],[36,29,12,12],[48,29,12,12],[60,29,12,12],[72,29,12,12],[84,29,12,12]],cursor:[[0,41,10,8]],font:[[0,49,180,12]],Li:[[0,61,7,7],[7,61,7,7]],Dt:[[0,68,5,5],[5,68,5,5],[10,68,5,5],[15,68,5,5]],Os:[[0,73,9,9]],Ss:[[0,82,13,16]],As:[[0,98,5,16]],Es:[[0,114,60,18]],ki:[[0,132,7,7],[7,132,7,7],[14,132,7,7],[21,132,7,7],[28,132,7,7],[35,132,7,7],[42,132,7,7],[49,132,7,7]],bs:[[0,139,7,9],[7,139,7,9]],fi:[[0,148,3,3],[3,148,3,3],[6,148,3,3]],Qi:[[0,151,8,8],[8,151,8,8]],Ft:[[0,159,8,8],[8,159,8,8],[16,159,8,8],[24,159,8,8],[32,159,8,8],[40,159,8,8],[48,159,8,8],[56,159,8,8],[64,159,8,8],[72,159,8,8],[80,159,8,8],[88,159,8,8],[96,159,8,8],[104,159,8,8]],ks:[[0,167,4,4],[4,167,4,4]],Is:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAACrCAMAAAD4k0ZOAAAAZlBMVEUAAADuw5oAAAANK0UgPFYhIickGhQuCAFTV1JUTmhcDwBtbnN1EgCNaXqPGxuPn6iRm6ObrbemraXCHQDJAADL2/zQgVnRFRXfcSbmAADuw5ru6WTwJAD78jb/ql7/1KP/7Nb///+8jDFnAAAAAnRSTlMAlm//+0kAAAPPSURBVHja7Z0Jm9o4DIZV8Ow2dENv5rbj//8n1yKfkfN4MnTThERbvcbIEZDnRVWO3nRPGrk/EsBCA8f7i/a9WS/LvUbrY7ImjdZHs76ZtixJD/dkGIbx59JgbpKHM1TRMlt1xnMFC29f2ntPBSdm0+3BzmEffCmNueFis/Me1q0/J5iNS0ul274reK1GuvWnk9dT6RD8uc7JevuVBiisBj6QPj48qbQmjXhAiQBmyy+Eb4AnCi0I8+WXcgY+tBfClLxP5HxIcFhO2qeRJUIaIudFTvKML6RDlpb3c25BaSiIXK/OAgzkwpnxio7mt9MehRzbSb54Pz8tJ53GRY7HhN69uTT6kEfuQx4ebkV75N5FOufb20tfObCyBBwgLfkg+Vp6/Z6emFd9cbHLeEcK6TqN0qHTKK3QugtkGP874vX8KDFGIn7kSRG5HK/vKH9e9iP76AeD9QzSkOxX2Co8o2TeIVaDZI5LT6bfTVUlVO7y2hXp/BkpgmxHkUZuArGWxqOuT8Trkytdbv9GpWOOVU/nNkGUifz70lVPEw17ujxe9FF/S4k4gqtxo28rPS5imXEx+SEZ6bhZgJmsBZEtRy0dh5UfSEvvzuss53QOQllp6MiXkyGnGDGGMOYlNzNRJhCjXFREeVFkijfRoLLISm5pIhzqntbO/f096aHrOnZOQY91xyM5n4caaSZJMya9rDR1xNLoDk3c39MNnI3HS3ihfw5KhA8/KPF0oMP3F0hr4cBTlzPE/yYdRLoFJv2MuSxGjBIM62k75a1EW6JHunE9jSJpdoa1HmknmLRJm/TimLRJm7Rdxu2GSVAmTcpoknNDynBN2zh10q51Jm3SJn0rTNqkTdou43bD1DKkjTCZFZ3byYQVpd1EFEibtEmbtEmbtEmbtEkveZtX/gbB24TN3VAPpMOb0PYopGmLdN1/Cx2HlYHE9dAhMJupdGI0VKwuTe9Ij0HbopTulEij8nAeDZvkylG5MjsmByXsXl93Xz/vdp+/8sqkh5h0iRrprwmuNEeTXlL6M7NDoEWw8zQIaSgj4LEwVuy/wB6YtEmbtEmb9LbY/yYE9m3rOA7yrm05f45gHmnXMK6KY7ieSvrkHf47B8+zlz55dmb7fZ8/zSPd9FRxqrT3Pk2Rdv1qf+L8yc8s7X5Ruh+VtO+lHehVkcTrLm2vUmlYj/W0gJ4mkHt7BekaB9AeQ5wk+XWXtueWdiKdJH6RfOCNSEtP432LnT3E+Tr5wNv7t6S9nD3wPpqDL1++fCRtfPn06Y5+flMo/e2OVPHx7g7GevgXygnzOe5CDjIAAAAASUVORK5CYII="},ut={Ns(t){let i=new Image;i.onload=t,i.src=ft.Is,ut.ms=i},s(){ut.font=at(ft.font[0]),ut.vs=at(ft.bs[0]),ut.Us=at(ft.bs[1]),ut.fi=ft.fi.map(at),ut.Dt=ft.Dt.map(at),ut.Os=ft.Os.map(at),ut.Ts=ft.cursor.map((t=>at(t,{x:0,y:0})))[0],ut.Ei=ft.Ei.map(at),ut.Ss=ft.Ss.map(at),ut.As=ft.As.map(at),ut.Es=ft.Es.map(at),ut.ki=ft.ki.map((t=>at(t,{x:-1,y:-1}))),ut.Ft=ft.Ft.map(at),ut.Qi=ft.Qi.map(at),ut.Li=ft.Li.map(at),ut.rt=ft.rt.map((t=>at(t,{x:0,y:8}))),ut.buttons=ft.buttons.map(at),ut.Hs=ct(function(t){let i=lt(544,334);for(let s=0;s<334;s+=32)for(let h=0;h<544;h+=32)i.t.drawImage(t,h,s);return i.e}(ut.Ft[0].nt)),ut.ut=ct(function(){let t=lt(500,500),i=t.t.createRadialGradient(250,250,0,250,250,250);return i.addColorStop(.3,ot(0,0,0,0)),i.addColorStop(1,ot(0,0,0,.9)),t.t.fillStyle=i,t.t.fillRect(0,0,500,500),t.e}()),ut.attack=ft.attack.map(at)},gs(t,i,s,h){t.drawImage(i.nt,s-i.Xs.x,h-i.Xs.y)},gt(t,i,s){let{h:h,o:n}=this.Ds(t,i);s?(e.t.save(),e.t.translate(h+t.Xs.x,n+t.Xs.y),e.t.rotate(s),e.t.drawImage(t.nt,-t.Xs.x,-t.Xs.y),e.t.restore()):e.t.drawImage(t.nt,h,n)},Ds:(t,i)=>({h:i.x-t.Xs.x-j.Rt.x+e.i.h,o:i.y-t.Xs.y-j.Rt.y+e.i.o}),us(t){return this.Ft[t+20-1]||(this.Ft[t+20-1]=ct(function(t,i){let s=lt(8,8);return 256&i&&s.t.drawImage(t[12].nt,0,0,4,4,0,0,4,4),64&i&&s.t.drawImage(t[12].nt,5,0,3,3,5,0,3,3),1&i&&s.t.drawImage(t[12].nt,6,6,2,2,6,6,2,2),4&i&&s.t.drawImage(t[12].nt,0,5,3,3,0,5,3,3),8&i&&s.t.drawImage(t[11].nt,5,0,3,8,5,0,3,8),32&i&&s.t.drawImage(t[9].nt,0,0,4,8,0,0,4,8),2&i&&s.t.drawImage(t[8].nt,0,5,8,3,0,5,8,3),128&i&&s.t.drawImage(t[10].nt,0,0,8,4,0,0,8,4),160==(160&i)&&s.t.drawImage(t[13].nt,0,0,5,5,0,0,5,5),136==(136&i)&&s.t.drawImage(t[13].nt,4,0,4,4,4,0,4,4),10==(10&i)&&s.t.drawImage(t[13].nt,4,4,4,4,4,4,4,4),34==(34&i)&&s.t.drawImage(t[13].nt,0,4,5,4,0,4,5,4),s.e}(this.Ft,t),{x:0,y:0})),this.Ft[t+20-1]}};function at(t,i){return ct(function(t,i,s,h){const e=ut.ms,n=lt(s,h);return n.t.drawImage(e,t,i,s,h,0,0,s,h),n.e}(...t),i)}function ct(t,i){let s=t.width,h=t.height;return{nt:t,Xs:"object"==typeof i?i:{x:s/2|0,y:h/2|0}}}class At{constructor(){this.frames=0}E(){return this.frames++,E.mt[E.A.Z]&&this.frames>30&&Mt.c(),!0}Ht(){e.t.fillStyle=ot(36,26,20,st(this.frames/200,0,1)),e.t.fillRect(0,0,e.width,e.height);let t=e.width-32,i="DEFEAT... \n                    \nYOUR LAST MOTH GONE, THIS WORLD SLIPS FROM YOUR GRASP. YOU CURSE THE VILLAGE AND ITS INHABITANTS AS YOU TUMBLE TOWARDS THAT BLEAK BEYOND. \n \nYOUR REIGN OF TERROR HAS ENDED. \n \nTAP TO TRY AGAIN!";i=i.slice(0,this.frames),R.yt(e.t,i,16,16,t,1,1,R.dt)}}const Mt=new class{s(){ut.Ns((()=>{e.s(),ut.s(),R.s(),E.s(),c.s(),X.s(),j.s(),V.s(),window.addEventListener("blur",(()=>this.Q())),window.addEventListener("focus",(()=>this.at())),this.c(),this.start()}))}c(){this.is=[],this.Ls={},this.Ps={},this.qs={},this.Cs=0,this.Gs=[],this.ji=[],this.Fs=0,this.li=250,this.Vs=0,this.is.push(new m($(V.Wt))),this.screen=void 0,this.Xi=void 0,V.c(),j.Rt=it($(V._i)),j.xs=it($(V.Wt))}start(){this.pt=0,this.Bs=[0],this.E(),window.requestAnimationFrame((t=>this.Ys(t)))}Ys(t){let i=(new Date).getTime();this.Bs.length>=40&&this.Bs.shift(),this.Ws=1e3/((this.Bs[this.Bs.length-1]-this.Bs[0])/this.Bs.length),this.pt++,e.n(),this.E(),this.Ht(e.t),window.requestAnimationFrame((t=>this.Ys(t)));let s=(new Date).getTime();this.Bs.push(this.Bs[this.Bs.length-1]+s-i)}E(){if(this.Xi||(this.Xi=new B(this.Fs++)),E.E(),!(this.screen&&this.screen.E()||(E.mt[E.A.Z]&&this.Ri(E.V),X.E(),this.Js))){this.Xi.E(),this.Ks(),console.log(Mt.is);for(let t of Mt.is)t.vt&&t.vt();C.Pi(this.is),G.Pi(this.is),j.E(),this.is=this.is.filter((t=>!t.Ut)),V.rt=V.rt.filter((t=>!t.Ut)),this.Gs=this.Gs.filter((t=>t.E())),V.E(),0===this.is.filter((t=>t instanceof m)).length&&(Mt.screen=new At),Mt.pt%6==0&&(this.Cs=10*Math.random()|0),30===Mt.pt&&Mt.Gs.push(new d(20,20,20)),E.mt[E.A.K]&&!Mt.js&&(Mt.js=!0)}}Ht(){e.t.setTransform(1,0,0,1,0,0),e.t.scale(e.scale,e.scale),e.t.fillStyle=ot(36,26,20,1),e.t.fillRect(0,0,e.width,e.height),V.Ht();for(let t of this.is)(!t.z||t.z<100)&&t.Ht();for(let t of this.is)t.z&&t.z>100&&t.Ht();V.Ji(),X.Ht(),Mt.pt<120&&(e.t.fillStyle=ot(0,0,0,1-Mt.pt/120),e.l()),this.screen&&this.screen.Ht()}Q(){this.Js||(this.Js=!0,c.Q())}at(){this.Js&&(this.Js=!1,c.at())}Ri(t){for(let i of[X,V])if(i.Ri(t))break}Ni(){return this.is.filter((t=>t instanceof m)).length}mi(t){if(this.li>=t)return!0}pi(t){this.li-=t}Ks(){let t=this.ji[0];if(t)for(let i=0;i<10;i++){let i=Math.floor(Math.random()*V.Gt[0].Ft[0].length),s=Math.floor(Math.random()*V.Gt[0].Ft.length);if(1!==V.Ft[s][i])continue;if(0!==V.Zi[s][i])continue;let h=$({ii:i,r:s});console.log("NEW monster"+h.x+","+h.y+","+V.Zi[s][i]),Mt.is.push(new t(h)),this.ji.shift();break}}};Mt.s()}();
//# sourceMappingURL=app.js.map</script>
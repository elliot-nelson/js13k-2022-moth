<style>body,html{margin:0;padding:0;background-color:#000}div{position:absolute;top:0;bottom:0;left:0;right:0}#canvas{width:100%;height:100%;touch-action:none}</style><div><canvas id="canvas"></canvas></div><script>!function(){"use strict";const t=45*Math.PI/180,i=90*Math.PI/180,s=360*Math.PI/180,h={s(){h.e=document.getElementById("canvas"),h.t=h.e.getContext("2d"),h.n(!0)},n(t){let i=window.devicePixelRatio,s=h.e.clientWidth,e=h.e.clientHeight,n=s*i,r=e*i;(t||h.e.width!==n||h.e.height!==r)&&(h.e.width=n,h.e.height=r,h.scale=(10*Math.max(n/240,r/135)|0)/10,h.width=Math.ceil(n/h.scale),h.height=Math.ceil(r/h.scale),h.i={h:h.width/2|0,o:h.height/2|0},h.clientWidth=s,h.clientHeight=e,h.t.imageSmoothingEnabled=!1),h.e.style.cursor="none"},l(){h.t.fillRect(0,0,h.width,h.height)}},e={s(){e.map={KeyW:A.A.u,KeyA:A.A.M,KeyS:A.A.T,KeyD:A.A.p,ArrowUp:A.A.u,ArrowLeft:A.A.M,ArrowDown:A.A.T,ArrowRight:A.A.p,Escape:A.A.m},e.S=[{x:0,y:0,R:0},{x:0,y:-i,R:1},{x:0,y:i,R:1},{x:0,y:0,R:0},{x:-i,y:0,R:1},{x:-t,y:-t,R:1},{x:-t,y:t,R:1},{x:-i,y:0,R:1},{x:i,y:0,R:1},{x:t,y:-t,R:1},{x:t,y:t,R:1},{x:i,y:0,R:1},{x:0,y:0,R:0},{x:0,y:-i,R:1},{x:0,y:i,R:1},{x:0,y:0,R:0}],e.O=[],window.addEventListener("keydown",(t=>{let i=e.map[t.code];i&&(e.O[i]=!0)})),window.addEventListener("keyup",(t=>{let i=e.map[t.code];i&&(e.O[i]=!1)})),e.c()},w(){let t=(e.O[A.A.u]?1:0)+(e.O[A.A.T]?2:0)+(e.O[A.A.M]?4:0)+(e.O[A.A.p]?8:0);e.E=e.S[t]},c(){e.E=e.S[0];for(let t of Object.values(A.A))e.O[t]=!1}},n=(t=1,i=.05,s=220,h=0,e=0,n=.1,l=0,f=1,u=0,a=0,c=0,A=0,R=0,y=0,M=0,w=0,E=0,T=1,d=0,U=0)=>{let x,O,I=2*Math.PI,S=u*=500*I/o**2,N=(0<M?1:-1)*I/4,p=s*=(1+2*i*Math.random()-i)*I/o,m=[],D=0,L=0,v=0,P=1,H=0,b=0,k=0;for(a*=500*I/o**3,M*=I/o,c*=I/o,A*=o,R=o*R|0,O=(h=99+o*h)+(d*=o)+(e*=o)+(n*=o)+(E*=o)|0;v<O;m[v++]=k)++b%(100*w|0)||(k=l?1<l?2<l?3<l?Math.sin((D%I)**3):Math.max(Math.min(Math.tan(D),1),-1):1-(2*D/I%2+2)%2:1-4*Math.abs(Math.round(D/I)-D/I):Math.sin(D),k=(R?1-U+U*Math.sin(2*Math.PI*v/R):1)*(0<k?1:-1)*Math.abs(k)**f*t*r*(v<h?v/h:v<h+d?1-(v-h)/d*(1-T):v<h+d+e?T:v<O-E?(O-v-E)/n*T:0),k=E?k/2+(E>v?0:(v<O-E?1:(O-v)/E)*m[v-E|0]/2):k),x=(s+=u+=a)*Math.sin(L*M-N),D+=x-x*y*(1-1e9*(Math.sin(v)+1)%2),L+=x-x*y*(1-1e9*(Math.sin(v)**2+1)%2),P&&++P>A&&(s+=c,p+=c,P=0),!R||++H%R||(s=p,u=S,P=P||1);return m},r=.3,o=44100,l=new(top.AudioContext||webkitAudioContext);l.destination;const f=[[[1.3,0,23,,,.2,3,5],[1.5,0,4e3,,,.03,2,1.25,,,,,.02,6.8,-.3,,.5],[.7,0,2100,,,.2,3,3,,,-400,,,2],[,0,655,,,.11,2,1.65,,,,,,3.8,-.1,.1]],[[[,-.5,13,,,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,14,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,14,,,,],[1,.3,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,],[2,1,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,],[,.6,,,,,13,,18,,19,,,,,,,,19,,18,,,,16,,,,13,,,,,,,,,,13,,18,,19,,,,,,,,18,19,18,,,,13,14,13,,16,,18,,19,,],[3,-1,,,13,,,,,,,,,,,,13,,,,,,,,,,,,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,,,13,13,13,13]],[[,-.5,13,,,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,14,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,14,,,,],[1,.3,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,],[2,1,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,]]],[1,1,0,0,0,0,1,0],,],u={s(){u.U=!1,u.t=l,u.I=u.t.createGain(),u.I.connect(u.t.destination),u.N=[,.01,140,.01,.02,.45,4,2.42,.1,-.1,,,,1.2,,.3,.04,.8,.02],u.b=[,,1233,,.01,.2,1,1.43,,,539,.1,,,,,,.51,.03,.01],u.g=[,,68,.01,,.14,1,1.53,7.5,.1,50,.02,-.01,-.2,.1,.2,,.47,.01],u.k=[,,391,,.19,.01,2,.54,-4,20,,,,,,,.02,.9],u.v=[,,970,.12,.25,.35,,.39,8.1,,10,.1,.2,,.1,,,.6,.09,.13],u.D=[,,454,.06,.86,.71,2,.63,-.7,1.7,-83,.09,.27,.3,.2,,.18,.95,.02,.02],u.P=((t,i,s,h=125)=>{let e,r,l,f,u,a,c,A,R,y,M,w,E,T,d,U=[],x=[],O=[],I=0,S=1,N={},p=o/h*60>>2;for(;S;I++)U=[S=A=w=0],s.map(((h,o)=>{for(c=i[h][I]||[0,0,0],S|=!!i[h][I],T=w+(i[h][0].length-2-!A)*p,r=2,f=w;r<c.length+(o==s.length-1);A=++r){for(u=c[r],R=y!=(c[0]||0)|u|0,l=0;l<p&&A;l++>p-99&&R?M+=(M<1)/99:0)a=(1-M)*U[E++]/2||0,x[f]=(x[f]||0)+a*d-a,O[f]=(O[f++]||0)+a*d+a;u&&(M=u%1,d=c[1]||0,(u|=0)&&(U=N[[y=c[E=0]||0,u]]=N[[y,u]]||(e=[...t[y]],e[2]*=2**((u-12)/12),n(...e))))}w=T}));return[x,O]})(...f),localStorage.L=JSON.stringify(f)},w(){},Q(t){},at(){},pt(){}},a={s(){this.map=[],this.map[0]=A.A.q,this.map[2]=A.A.H,this.O=[],window.addEventListener("mousemove",(t=>{this.C||(this.C={}),this.C.h=t.clientX*h.width/h.clientWidth|0,this.C.o=t.clientY*h.height/h.clientHeight|0,A.mode=2})),window.addEventListener("mouseout",(()=>{this.C=void 0})),window.addEventListener("mousedown",(t=>{let i=this.map[t.button];i&&(this.O[i]=!0),u.U=!0,At.G="mousedown",A.mode=2,this.Y={h:t.clientX*h.width/h.clientWidth|0,o:t.clientY*h.height/h.clientHeight|0}})),window.addEventListener("mouseup",(t=>{let i=this.map[t.button];i&&(this.O[i]=!1),At.G="mouseup",A.mode=2})),window.addEventListener("click",(t=>{t.preventDefault(),At.G="click"})),window.addEventListener("contextmenu",(t=>{let i=this.map[t.button];i&&(this.O[i]=!0),this.K=2,t.preventDefault()})),a.c()},w(){this.K&&(this.K--,0===this.K&&(this.O[A.A.H]=!1))},c(){this.C=void 0;for(let t of Object.values(A.A))this.O[t]=!1}},c={s(){this.map=[],this.map[0]=A.A.q,this.O=[],window.addEventListener("touchmove",(t=>{this.C||(this.C={});let i=t.changedTouches[0];this.C.h=i.clientX*h.width/h.clientWidth|0,this.C.o=i.clientY*h.height/h.clientHeight|0,A.mode=1})),window.addEventListener("touchstart",(t=>{let i=this.map[0];i&&(this.O[i]=!0),u.U=!0,At.G="TOUCHSTART",A.mode=1;let s=t.changedTouches[0];this.Y={h:s.clientX*h.width/h.clientWidth|0,o:s.clientY*h.height/h.clientHeight|0},this.C={...this.Y}})),window.addEventListener("touchend",(t=>{let i=this.map[0];i&&(this.O[i]=!1),At.G="TOUCHEND",A.mode=1})),this.c()},w(){},c(){this.C=void 0;for(let t of Object.values(A.A))this.O[t]=!1}},A={A:{u:11,T:12,M:13,p:14,W:21,H:30,m:96,J:97,X:98,q:40,j:41,F:42},s(){this.E={x:0,y:0,R:0},this.mt={},this.V={},this.O={},this.B={},e.s(),a.s(),c.s(),this.mode=1,this.Z=!1},w(){e.w();let t=2===this.mode?a:c;for(let i of Object.values(A.A)){let s=t.O[i]||e.O[i];this.mt[i]=!this.O[i]&&s,this.V[i]=this.O[i]&&!s,this.mt[i]?this.B[i]=1:this.O[i]&&s&&this.B[i]++,this.O[i]=s}this.C=t.C,this.E=e.E,this.O[A.A.q]&&(this.B[A.A.q]>20&&(this.Z=!0),Math.abs(t.Y.h-t.C.h)+Math.abs(t.Y.o-t.C.o)>5&&(this.Z=!0)),this.Z&&t.C&&(this._={x:t.C.h-t.Y.h,y:t.C.o-t.Y.o}),this.V[A.A.q]&&(this.Z?this.Z=!1:(this.mt[A.A.F]=!0,this.B[A.A.F]=1))},$(t){},tt(t){}},R={10:0,32:3,33:3,39:2,44:3,46:3,73:2},y={},M={s(){M.it=lt.font.st;let t=[[101,lt.ht[2]]];for(let i of t)y[i[0]]=i[1],R[i[0]]=i[1].st.width+1;M.et=w(M.it,nt(0,0,0,1)),M.rt=w(M.it,nt(90,20,90,.15)),M.blue=w(M.it,nt(200,40,220,1)),M.nt=w(M.it,nt(240,50,200,.2)),M.ot=w(M.it,nt(240,240,255,.25)),M.red=w(M.it,nt(240,50,50,1)),M.lt=E(M.it,"#ffaa5e","#ffd4a3"),M.ft=E(M.it,"#ffaa5e","#ffd4a3",nt(255,0,0,.7))},ut(t,i,s,h,e=1,n=M.lt,r){for(let o=0;o<i.length;o++){let l=i.charCodeAt(o);if(119!==l)if(114!==l){if(y[l])t.drawImage(y[l].st,s,h-(y[l].st.height+4)/2);else{let i=4*(l-32);r&&t.drawImage(r,i%180,6*(i/180|0),3,5,s+1,h+1,3*e,5*e),t.drawImage(n,i%180,6*(i/180|0),3,5,s,h,3*e,5*e)}s+=(R[l]||4)*e}else n=M.ft;else n=M.lt}},ct(t,i,s,h,e,n,r=1,o=M.lt,l){let f=s,u=h,a=i.split(" ");for(let i of a){for(;"\n"===i[0];)i=i.slice(1),f=s,u+=6*r;let h=M.dt(i,r);f+h-s>e&&(f=s,u+=6*r),M.ut(t,i,f,u,r,o,l),f+=h+(R[32]||4)}},dt:(t,i)=>t.split("").reduce(((t,i)=>t+(R[i.charCodeAt(0)]||4)),0)*i};function w(t,i){let s=rt(t.width,t.height);return s.t.fillStyle=i,s.t.fillRect(0,0,t.width,t.height),s.t.globalCompositeOperation="destination-in",s.t.drawImage(t,0,0),s.e}function E(t,i,s,h){let e=rt(t.width,t.height);return e.t.fillStyle=s,e.t.fillRect(0,0,t.width,t.height),e.t.fillStyle=i,e.t.fillRect(0,0,t.width,1),e.t.fillRect(0,6,t.width,1),h&&(e.t.fillStyle=h,e.t.fillRect(0,0,t.width,t.height)),e.t.globalCompositeOperation="destination-in",e.t.drawImage(t,0,0),e.e}class T{constructor(t,i,s){this.frames=t,this.At=i,this.yt=s,this.wt=[],this.Mt=[];var h=t/2;for(let t=0;t<h;t++)this.wt.push(2*Math.random()-1),this.Mt.push(2*Math.random()-1);this.is=-1}w(){if(this.is++,this.is>=this.frames)return!1;let t=this.is/2,i=0|t,s=i+1,h=1-this.is/this.frames;return this.x=this.At*h*(this.wt[i]+(t-i)*(this.wt[s]-this.wt[i])),this.y=this.yt*h*(this.Mt[i]+(t-i)*(this.Mt[s]-this.Mt[i])),!0}}class d{constructor(t,i){this.start=t,this.xt=i,this.Tt=-1,this.d=20,this.z=101,this.y=5,this.Et=-.7,this.St=.09}Rt(){++this.Tt===this.d&&(this.Ot=!0),this.y+=this.Et,this.Et+=this.St}Ut(){let t=this.start-this.xt+8;this.Tt>15&&(h.t.globalAlpha=1-.1*this.Tt),h.t.drawImage(lt.It[2].st,t,3,this.xt,3,t+2,this.y,this.xt,3),h.t.globalAlpha=1}}class U{constructor(i,s,h){this.Nt={...i},this.angle=s,this.Et=F(z(this.angle,h?8:5)),this.a=t,this.gt=!0,this.f=h,this.kt=!0,this.vt=1,this.r=0,this.Tt=-1,this.d=0===this.f?45:70,this.bt=!0}Rt(){++this.Tt===this.d&&(this.Ot=!0),this.Et.x*=.9,this.Et.y*=.9,this.a*=.95,this.r+=this.a}Ut(){lt.Dt(lt.Pt[this.f],this.Nt,this.r)}}U.k=t=>U.Lt(t,8,(()=>0)),U.qt=t=>U.Lt(t,16,(()=>4*Math.random()|0)),U.Lt=(h,e,n)=>{let r=h.Ht?function(t){let i=Math.atan2(t.y,t.x);return i<0&&(i+=s),i}(h.Ht.Ct):Math.random()*s;for(let o=0;o<e*(At.D?2:1);o++){let e=Math.random()*h.vt,o=Q(h.Nt,z(Math.random()*s,e));At.as.push(new U(o,r+Math.random()*i-t,n()))}};const x={Gt:[{name:"1F",Yt:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,0,0,14,14,14,14,14,14,14,14,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,1,1,14,0,14,14,1,1,1,1,1,1,14,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,14,1,1,14,14,1,14,0,14,1,1,1,1,1,1,1,14,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,14,1,1,1,1,1,14,0,14,1,1,1,1,1,1,1,14,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,14,1,1,1,1,1,14,0,14,1,1,1,1,1,1,1,14,0,0],[14,14,14,14,14,14,14,0,0,0,0,0,14,14,1,1,1,1,14,14,14,14,14,14,1,14,14,14,14,0,0],[14,1,1,1,1,1,14,0,0,0,0,0,0,14,14,14,14,1,1,14,14,14,1,1,1,1,14,0,0,0,0],[14,1,1,1,1,1,14,0,0,0,0,0,0,0,0,0,14,1,1,1,1,14,1,1,1,1,14,0,0,0,0],[14,1,1,1,1,1,14,0,0,0,0,0,0,0,0,0,14,14,1,1,1,14,1,1,1,1,14,14,14,14,14],[14,14,1,1,1,1,14,14,0,0,0,0,0,14,14,14,14,14,14,1,14,14,1,1,1,1,1,1,1,1,14],[0,14,1,1,1,1,1,14,0,0,0,0,0,14,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,14],[0,14,1,1,1,1,1,14,14,14,14,14,14,14,1,1,1,1,1,14,14,14,14,1,1,1,1,1,1,1,14],[0,14,1,1,1,1,1,1,1,1,1,1,1,1,1,1,14,14,14,14,0,0,14,14,14,14,1,1,1,1,14],[0,14,14,1,1,1,1,1,1,1,1,1,1,1,1,1,14,0,0,0,0,0,0,0,0,14,1,1,1,1,14],[0,0,14,14,1,1,1,1,1,1,1,1,1,1,1,1,14,0,0,0,0,0,0,0,0,14,14,14,14,14,14],[0,0,0,14,14,14,14,14,14,1,1,1,1,1,1,1,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,14,14,14,14,14,14,14,14,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],Kt:[],Wt:[{name:"SPAWN",x:28,y:11},{name:"EARTH",x:26,y:9},{name:"EARTH",x:24,y:11},{name:"EARTH",x:25,y:2},{name:"EXIT",x:3,y:7}],Jt:[],id:0}],bounds:[[0,0],[31,17]],Xt:[28,11,0]};class O{constructor(t){this.Nt={...t},this.target={...this.Nt},this.Et={x:0,y:0},this.jt=1,this.k=[],this.vt=3,this.ms=2,this.gt=!0,this.bt=!0,this.Ft=7,this.Vt=[],this.Qt=0,this.offset={x:0,y:0},this.zt=0,this.Bt=500,this.Zt=3,this._t=0,this.is=0,this.$t=Math.floor(16*Math.random()),this.ti=At.is}Rt(){0===this.Vt.length&&this.Vt.push({ii:2});let t=this.Vt[this.Vt.length-1];if(this.is=Math.floor(At.is/8)%2+1,9===this.ms)return void(this.Ot=!0);if(3===t.ii)this.target=_(V(t.si)),j(this.Nt,this.target).R<6&&this.Vt.pop();else if(6===t.ii){if(this.target=_(V(t.si)),j(this.Nt,this.target).R<6){this.is=0;let i=Y.hi(t.si);i.ei++,i.ei>=i.ri&&this.Vt.pop()}}else if(4===t.ii){this.target=_(V(t.si));let i=j(this.Nt,this.target),s=Y.hi(t.si);s?i.R<6&&(this.is=0,this.zt+=this.Zt,s.ni-=this.Zt,this.zt>=this.Bt&&this.Vt.push({ii:5,si:{oi:Y.Xt.oi,r:Y.Xt.r}})):(this.Vt.pop(),this.Vt.push({ii:5,si:{oi:Y.Xt.oi,r:Y.Xt.r}}))}else 5===t.ii&&(this.target=_(V(t.si)),j(this.Nt,this.target).R<6&&(this.is=0,this.zt-=this.Zt,this._t+=this.Zt,this._t>=100&&(At.li++,this._t-=100),this.zt<=0&&this.Vt.pop()));let i=Y.ai(this.Nt,this.target);console.log([this.target,i]);let s=j(this.Nt,i);s.R=tt(s.R,0,.5);let h=F(s);this.Et={x:(this.Et.x+h.x)/2,y:(this.Et.y+h.y)/2}}Ut(){let t=3;0===this.is&&t--;let i=Math.cos((At.is+this.$t)/16)*t,s=1*Math.sin((At.is+this.$t)/16);lt.Dt(lt.fi[this.is],{x:this.Nt.x+i,y:this.Nt.y+s})}ui(t){this.Vt=[{ii:4,si:t}],this.ti=At.is}construct(t){this.Vt.push({ii:6,si:t}),this.ti=At.is}moveTo(t){this.Vt=[{ii:3,si:t}],this.ti=At.is}ci(){let t=this.Vt[this.Vt.length-1];return t&&2!==t.ii}}O.di=()=>{let t=At.as.filter((t=>t instanceof O));return t.sort(((t,i)=>t.ci()&&!i.ci()?1:!t.ci()&&i.ci()?-1:t.ti-i.ti)),t},O.assign=t=>{let i=O.di();for(let s=0;s<i.length&&!(s>0&&i[s].ci());s++)t(i[s])};class I{constructor(t,i,s){this.Nt={...t},this.target=i,this.Et={x:0,y:0},this.k=s||70}Rt(){let t=j(this.Nt,this.target.Nt);t.R=tt(t.R,0,2),this.Et={x:(this.Et.x+t.x*t.R)/2,y:(this.Et.y+t.y*t.R)/2},t.R<1&&(this.target.k.push({xt:this.k,Ct:t,Ai:0}),this.Ot=!0,console.log("HIT"))}Ut(){lt.Dt(lt.yi[0],this.Nt,this.r)}}class S{constructor(t){this.si={...t},this.wi=10,this.ms=21,this.ei=0,this.ri=180,this.title="TOWER",this.Mi=lt.ht[0]}Rt(){this.ei>=this.ri&&(this.ms=22);let t,i,s=_(V(this.si));if(!this.target||this.target.Ot){for(let h of At.as){if(!h.xi)continue;let e=j(s,h.Nt);e.R<32&&(!i||e.R<i.R)&&(t=h,i=e)}console.log("ATTEMPTED to pick target for building",t),this.target=t}this.wi>0&&this.wi--,this.target&&0===this.wi&&(j(s,this.target),At.as.push(new I(s,this.target)),this.wi=100)}Ut(){let t=V(this.si);if(Z(_(t)),h.t.globalAlpha=21===this.ms?.5:1,lt.Dt(lt.ht[0],t),h.t.globalAlpha=1,21===this.ms){let i=tt(Math.floor(8*this.ei/this.ri),0,7);h.t.globalAlpha=.5,lt.Dt(lt.Ti[7],t),h.t.globalAlpha=1,lt.Dt(lt.Ti[i],t)}}Ei(){return[]}}const N=[0,2];for(let t=2;t<=19;t++)N[t]=Math.floor(1.5*N[t-1]+1);for(let t=0;t<20;t++)N[t]=5*N[t];const p={pi:()=>lt.buttons[0],mi:()=>lt.buttons[1],Si(t,i){let s=N[At.Ri()],e=At.Oi(s)?"LURE MOTH \ne"+s:"LURE MOTH \ner"+s;M.ct(h.t,e,t,i)},Ui(){let t=N[At.Ri()];if(At.Oi(t))return At.Ii(t),At.as.push(new O(_(V(Y.selected)))),!0}};class m{constructor(t){this.si={...t},this.title="YOUR CORPSE \nLAST CHANCE",this.Mi=lt.ht[1],this.Ft=9}Rt(){}Ut(){let t=V(this.si);lt.Dt(lt.ht[1],t)}Ei(){return[p]}}class D{constructor(t){this.Nt={...t},this.jt=100,this.k=[],this.Et={x:0,y:0},this.vt=2,this.Ni=.2,this.gi=0,this.ms=11,this.xi=!0}Rt(){let t=At.as.filter((t=>t instanceof O)),i=t[0];if(console.log(t.map((t=>t.Nt))),!i)return;let s=j(this.Nt,i.Nt);for(let h=1;h<t.length;h++){let e=j(this.Nt,t[h].Nt);e.R<s.R&&(i=t[h],s=e)}const h=Y.ai(this.Nt,i.Nt);let e=j(this.Nt,h);11===this.ms?s.R<8?(console.log("KILL"),i.k.push({xt:10,Ct:e,Ai:0}),this.Ot=!0):(e.R=tt(e.R,0,.4),this.Et={x:(this.Et.x+e.x*e.R)/2,y:(this.Et.y+e.y*e.R)/2}):9===this.ms&&(this.Ot=!0,U.qt(this))}Ut(){let t=lt.ki[0];lt.Dt(t,this.Nt)}}const L={vi:!0,pi:()=>lt.buttons[2],mi:()=>lt.buttons[3],Si(t,i){M.ct(h.t,"GATHER EARTH",t,i)},Ui:()=>(O.assign((t=>t.ui(Y.selected))),!0)};class v{constructor(t){this.si={...t},this.ni=1e4,this.title="EARTH",this.Mi=lt.ht[2]}Rt(){this.title="EARTH \n"+Math.ceil(this.ni/100)+" REMAINING",this.ni<1&&(this.Ot=!0)}Ut(){let t=V(this.si);lt.Dt(lt.ht[2],t)}Ei(){return[L]}}const P={vi:!0,pi:()=>lt.buttons[4],mi:()=>lt.buttons[5],Si(t,i){M.ct(h.t,"EXPLORE",t,i)},Ui:()=>(O.assign((t=>t.moveTo(Y.selected))),!0)},H={bi(t){let i=t.filter((t=>t.Nt&&t.Et&&!t.Ot));for(let t=0;t<5;t++){for(let t=0;t<i.length-1;t++)for(let s=t+1;s<i.length;s++)H.Di(i[t],i[s]);for(let t of i)H.Pi(t)}for(let t of i)t.Nt.x+=t.Et.x,t.Nt.y+=t.Et.y},Di(t,i){if(t.gt||i.gt)return;let s=function(t,i,s,h,e,n){[s,n]=[F(s),F(n)];let r=j({x:t.x+s.x,y:t.y+s.y},{x:h.x+n.x,y:h.y+n.y});if(r.R<i+e)return{Li:r.x,qi:r.y,R:i+e-r.R}}(t.Nt,t.vt,t.Et,i.Nt,i.vt,i.Et);if(s)if(t.kt&&i.kt)t.Et.x=-s.Li*s.R,t.Et.y=-s.qi*s.R,i.Et.x=s.Li*s.R,i.Et.y=s.qi*s.R;else{let h=q(t.Et).R+i.Ni,e=q(i.Et).R+t.Ni,n=t.kt?.1:1,r=i.kt?.1:1;t.Et.x-=s.Li*s.R*n*h/(h+e),t.Et.y-=s.qi*s.R*n*h/(h+e),i.Et.x+=s.Li*s.R*r*e/(h+e),i.Et.y+=s.qi*s.R*r*e/(h+e)}},Pi(t){if(!t.bt){t.Nt.y<-1e3&&console.log("FUUUUUUUUUUUUUUUU");for(let i of function*(t,i,s){yield*function*(t,i,s){let h=[{x:Math.min(t.x,i.x)-s,y:Math.min(t.y,i.y)-s},{x:Math.max(t.x,i.x)+s,y:Math.max(t.y,i.y)+s}];yield*function*(t){for(let i=t[0].y/8|0;8*i<t[1].y;i++)for(let s=t[0].x/8|0;8*s<t[1].x;s++)yield{oi:s,r:i}}(h)}(t,{x:t.x+i.x,y:t.y+i.y},s)}(t.Nt,t.Et,t.vt))if(!et(i.oi,i.r)){let s=[V(i),V({oi:i.oi+1,r:i.r+1})],h=it(t.Nt,{x:t.Nt.x+t.Et.x,y:t.Nt.y+t.Et.y},t.vt,s);h&&(t.kt?0===h.Li?t.Et.y=-t.Et.y:0===h.qi?t.Et.x=-t.Et.x:(t.Et.x+=h.Li,t.Et.y+=h.qi):0===h.Li?t.Et.y=h.y-t.Nt.y:0===h.qi?t.Et.x=h.x-t.Nt.x:(t.Et.x+=h.Li,t.Et.y+=h.qi))}}}},b={bi(t){for(let i of t)if(i.jt){if(i.k.length>0){if(9!==i.ms&&1!==i.ms)for(let t of i.k)i===At.Hi&&At.as.push(new d(i.jt,t.xt)),i.jt-=t.xt,t.Ct.R=t.Ai,i.Et=Q(i.Et,t.Ct),i.Ht=t,U.k(i);i.k=[]}i.jt<=0&&9!==i.ms&&(i.ms=9)}}},k=[[[0,1],[5,1],[10,1],[15,1],[20,1],[21,1],[22,1]]];class C{constructor(t){t%=k.length,this.Ci=[...k[t]],this.Gi=1800,this.Yi=!1,this.is=0,this.Ki=60*this.Ci[this.Ci.length-1][0]}w(){if(this.Gi--,this.Gi<=0){this.Yi=!0;for(let t=0;t<this.Ci.length;t++)this.is===60*this.Ci[t][0]&&At.Wi.push(D);this.is++}this.is>=this.Ki&&(At.Ji=void 0)}}class G{constructor(){this.frames=0}w(){this.frames++}Ut(){h.t.fillStyle=nt(36,26,20,tt(this.frames/200,0,1)),h.t.fillRect(0,0,h.width,h.height);let t=h.width-32,i="ESCAPE! \n                    \nVILLAGERS STIR UNEASILY IN THEIR BEDS AS YOU EMERGE INTO MOONLIGHT. YOU SENSE WARM BODIES ALL AROUND YOU, RIPE FOR PICKING. IT IS ONLY A MATTER OF TIME NOW BEFORE YOU REGAIN YOUR FULL NECROMANTIC POWER. \n                    \nCONGRATULATIONS... AND THE END.";i=i.slice(0,this.frames),M.ct(h.t,i,16,16,t,1,1)}}class g{constructor(t){this.si={...t},this.title="REACH THE EXIT \nTO SURVIVE",this.Mi=lt.ht[3],this.Ft=4}Rt(){let t=O.di();for(let i of t){let t=B(i.Nt);if(t.oi===this.si.oi&&t.r===this.si.r)return void(At.screen=new G)}}Ut(){let t=V(this.si);lt.Dt(lt.ht[3],t)}Ei(){return[P]}}const Y={s(){this.c()},Ut(){let t=this.Gt[0].Yt,i=Z({x:0,y:0});for(let s=0;s<t.length;s++)for(let e=0;e<t[0].length;e++)t[s][e]>0&&h.t.drawImage(lt.Yt[t[s][e]-1].st,8*e+i.h,8*s+i.o);for(let t of this.ht)t.Ut()},Xi(){let t=this.Yt,i=Z({x:0,y:0});for(let s=0;s<t.length;s++)for(let e=0;e<t[0].length;e++)if(t[s][e]>0){let t=1-tt(this.ji[s][e]/5,.1,1);0===this.Fi[s][e]&&(t=1),h.t.globalAlpha=t,h.t.drawImage(lt.Vi[0].st,8*e+i.h,8*s+i.o)}h.t.globalAlpha=1},c(){this.Gt=x.Gt.map((t=>({Yt:t.Yt.map((t=>[...t])),Wt:t.Wt.map((t=>({...t})))}))),this.bounds=x.bounds,this.Xt={oi:x.Xt[0],r:x.Xt[1]},this.ht=[],this.ht.push(new m(this.Xt));for(let t of this.Gt[0].Wt)"EARTH"===t.name?this.ht.push(new v({oi:t.x,r:t.y})):"EXIT"===t.name&&this.ht.push(new g({oi:t.x,r:t.y}));this.selected=void 0,this.Yt=this.Gt[0].Yt,this.width=this.Yt[0].length,this.height=this.Yt.length,this.ji=st(this.width,this.height,(()=>0)),this.Fi=st(this.width,this.height,(()=>0)),this.Qi={},this.zi()},w(){for(let t of this.ht)t.Rt();this.Bi()},Zi(t){return 46===this._i(t)},$i(t){return this.ts.includes(this.Gt[t.z].Yt[t.y][t.x])},ss(t){this.Gt[t.z]},Ui(t){let i=B($(t)),s=this._i(i);if(!s||s>=8)this.selected=void 0;else if(this.selected&&this.selected.oi===i.oi&&this.selected.r===i.r){let t=this.hi(this.selected);if(t){let i=t.Ei();i[0]&&i[0].vi&&i[0].Ui()}else P.Ui()}else this.selected=i,this.hi(this.selected)},_i(t){if(t)return this.Gt[0].Yt[t.r]?.[t.oi]},hi(t){if(t)for(let i of this.ht)if(i.si.oi===t.oi&&i.si.r===t.r)return i},Bi(){let t=[];for(let i of this.ht)i.Ft&&t.push({...i.si,hs:i.Ft});for(let i of At.as)i.Ft&&t.push({...B(i.Nt),hs:i.Ft});this.ji=function(t,i,s=1/0){let h=st(t[0].length,t.length,(()=>0)),e=[...i];for(;e.length>0;){let{oi:t,r:i,hs:n}=e.shift();h[i][t]>=n||(h[i][t]=n--,h[i][t]>=s||(ht(t+1,i)&&h[i][t+1]<n&&e.push({oi:t+1,r:i,hs:n}),ht(t-1,i)&&h[i][t-1]<n&&e.push({oi:t-1,r:i,hs:n}),ht(t,i+1)&&h[i+1][t]<n&&e.push({oi:t,r:i+1,hs:n}),ht(t,i-1)&&h[i-1][t]<n&&e.push({oi:t,r:i-1,hs:n})))}return h}(this.Yt,t);for(let t=0;t<this.ji.length;t++)for(let i=0;i<this.ji[0].length;i++)this.ji[t][i]>this.Fi[t][i]&&(this.Fi[t][i]=1)},ai(t,i){let s=B(t),h=B(i);var e,n;if(e=s,n=h,Math.abs(e.oi-n.oi)+Math.abs(e.r-n.r)<=1)return i;let r=[h.oi,h.r].join(","),o=this.Qi[r];o||(o=this.Qi[r]=function(t,i,s=1/0){let h=st(t[0].length,t.length,(()=>1/0)),e=[{...i,es:0}];for(;e.length>0;){let{oi:t,r:i,es:n}=e.shift();h[i][t]<=n||(h[i][t]=n++,h[i][t]>=s||(et(t+1,i)&&h[i][t+1]>n&&e.push({oi:t+1,r:i,es:n}),et(t-1,i)&&h[i][t-1]>n&&e.push({oi:t-1,r:i,es:n}),et(t,i+1)&&h[i+1][t]>n&&e.push({oi:t,r:i+1,es:n}),et(t,i-1)&&h[i-1][t]>n&&e.push({oi:t,r:i-1,es:n})))}return h}(this.Yt,h)),console.log(Object.keys(this.Qi).length);let l=[[s.oi+1,s.r],[s.oi-1,s.r],[s.oi,s.r+1],[s.oi,s.r-1]];for(let t of l)t.push(o[t[1]][t[0]]);return l.sort(((t,i)=>t[2]-i[2])),_(V({oi:l[0][0],r:l[0][1]}))},zi(){for(let t=0;t<this.Yt.length;t++)for(let i=0;i<this.Yt[0].length;i++)if(14===this.Yt[t][i]){let s=0;(this.Yt[t-1]?.[i-1]||99)<8&&(s|=256),(this.Yt[t-1]?.[i]||99)<8&&(s|=128),(this.Yt[t-1]?.[i+1]||99)<8&&(s|=64),(this.Yt[t]?.[i-1]||99)<8&&(s|=32),(this.Yt[t]?.[i+1]||99)<8&&(s|=8),(this.Yt[t+1]?.[i-1]||99)<8&&(s|=4),(this.Yt[t+1]?.[i]||99)<8&&(s|=2),(this.Yt[t+1]?.[i+1]||99)<8&&(s|=1),lt.rs(s),this.Yt[t][i]=20+s}}},X={pi:()=>lt.buttons[6],mi:()=>lt.buttons[7],Si(t,i){let s=At.Oi(15)?"BUILD TOWER \ne15":"BUILD TOWER \ner15";M.ct(h.t,s,t,i)},Ui(){if(At.Oi(15))return At.Ii(15),Y.ht.push(new S(Y.selected)),O.assign((t=>t.construct(Y.selected))),!0}},J=18,K={w(){if(Y.selected){let t=Y.hi(Y.selected);this.actions=t?t.Ei():[P,X]}else this.actions=[];A.Z&&(this.ns=void 0)},Ut(){if(At.Ji)if(At.Ji.Yi)M.ut(h.t,"INCOMING",40,3);else{let t=Math.ceil(At.Ji.Gi/60);M.ut(h.t,"COUNTDOWN "+t,40,3)}let t=At.as.filter((t=>t instanceof O));for(let i=0;i<t.length;i++)h.t.drawImage(lt.fi[1].st,2+4*i,2);let i,s=At.li+"e",e=M.dt(s,1);if(h.t.fillStyle="rgba(0, 0, 0, 0.1)",M.ut(h.t,s,h.width-e-2,2),A.C){let t=A.C.h,i=A.C.o,s=$(A.C),e=B(s);if(M.ut(h.t,t+","+i+". "+s.x+","+s.y+". "+e.oi+","+e.r+".",h.width-100,20),Y.selected){let t=Y.Yt[Y.selected.r][Y.selected.oi];t>20&&(t-=20),M.ut(h.t,Y.selected.oi+","+Y.selected.r+". "+t.toString(2).padStart(9,"0"),h.width-100,29)}}if(Y.selected){let t=Z({x:8*Y.selected.oi,y:8*Y.selected.r});h.t.fillStyle=nt(255,212,163,.25),h.t.fillRect(t.h,t.o,9,9)}if(h.t.fillStyle="#ffd4a3",h.t.fillRect(0,h.height-J,h.width,1),h.t.fillStyle="#8d697a",h.t.fillRect(0,h.height-J+1,h.width,1),h.t.fillStyle="#203c56",h.t.fillRect(0,h.height-J+2,h.width,16),h.t.fillStyle="#8d697a",h.t.fillRect(0,h.height-2,h.width,2),Y.selected){let t=Y.hi(Y.selected);t&&(h.t.drawImage(t.Mi.st,2,h.height-J-1),M.ct(h.t,t.title,13,h.height-J+3,h.width))}h.t.drawImage(lt.os[0].st,-2,h.height-J+1),h.t.drawImage(lt.os[0].st,64,h.height-J+1),h.t.drawImage(lt.os[0].st,h.width-3,h.height-J+1);for(let t=0;t<this.actions.length;t++){let s=this.actions[t],e=this.ls(t);h.t.drawImage(lt.os[0].st,e.h+11,h.height-J+1),h.t.drawImage(s.pi().st,e.h,e.o),this.ns===s&&(i=t)}if(i>=0){let t=this.ls(i);h.t.drawImage(lt.fs[0].st,t.h-23,t.o-19),h.t.drawImage(this.ns.mi().st,t.h,t.o),this.ns.Si(t.h-23+3,t.o-19+3)}A.C&&(At.us&&(h.t.globalAlpha=.5),lt.Dt(lt.cs,$(A.C)),h.t.globalAlpha=1)},ls:t=>({h:68+15*t,o:h.height-15}),Ui(t){if(t.o>h.height-J){for(let i=0;i<this.actions.length;i++){let s=this.ls(i);if(t.h>=s.h&&t.h<=s.h+12&&t.o>=s.o&&t.o<=s.o+12)return this.actions[i]===this.ns?this.ns.Ui()&&(this.ns=void 0):this.ns=this.actions[i],!0}return this.ns=void 0,!0}return this.ns=void 0,!1}},W={s(){this.Nt={x:0,y:0,z:0}},w(){A.mt[A.A.q]&&(this.ds={...this.Nt}),A.Z&&(this.Nt={x:this.ds.x-A._.x,y:this.ds.y-A._.y})}};function q(t){let i=Math.sqrt(t.x*t.x+t.y*t.y);return 0===i?{x:0,y:0,R:0}:{x:t.x/i,y:t.y/i,R:i}}function j(t,i){return q({x:i.x-t.x,y:i.y-t.y})}function z(t,i){return{x:Math.cos(t),y:Math.sin(t),R:i||1}}function F(t){return{x:t.x*(t.R||1),y:t.y*(t.R||1)}}function Q(...t){let i={x:0,y:0,R:1};for(let s of t)i.x+=s.x*(s.R||1),i.y+=s.y*(s.R||1);return i}function B(t){return{oi:t.x/8|0,r:t.y/8|0}}function V(t){return{x:8*t.oi,y:8*t.r}}function Z(t){return{h:t.x+h.i.h-W.Nt.x,o:t.y+h.i.o-W.Nt.y}}function $(t){return{x:t.h-h.i.h+W.Nt.x,y:t.o-h.i.o+W.Nt.y}}function _(t){return{x:t.x+4,y:t.y+4}}function tt(t,i,s){return t<i?i:t>s?s:t}function it(t,i,s,h){if(Math.max(t.x,i.x)+s<h[0].x||Math.min(t.x,i.x)-s>h[1].x||Math.max(t.y,i.y)+s<h[0].y||Math.min(t.y,i.y)-s>h[1].y)return;let e=i.x-t.x,n=i.y-t.y,r=0===e?0:1/e,o=0===n?0:1/n,l=1/0,f=1/0;if(t.x-s<h[0].x&&i.x+s>h[0].x){let i=(h[0].x-s-t.x)*r;if(i>=0&&i<=1){let s=n*i+t.y;if(s>=h[0].y&&s<=h[1].y)return{x:e*i+t.x,y:s,Tt:i,Li:-1,qi:0,As:h[0].x,ys:s}}l=h[0].x}if(t.x+s>h[1].x&&i.x-s<h[1].x){let o=(t.x-(h[1].x+s))*-r;if(o>=0&&o<=1){let s=n*o+i.y;if(s>=h[0].y&&s<=h[1].y)return{x:e*o+t.x,y:s,Tt:o,Li:1,qi:0,As:h[1].x,ys:s}}l=h[1].x}if(t.y-s<h[0].y&&i.y+s>h[0].y){let i=(h[0].y-s-t.y)*o;if(i>=0&&i<=1){let s=e*i+t.x;if(s>=h[0].x&&s<=h[1].x)return{x:s,y:n*i+t.y,Tt:i,Li:0,qi:-1,As:s,ys:h[0].y}}f=h[0].y}if(t.y+s>h[1].y&&i.y-s<h[1].y){let i=(t.y-(h[1].y+s))*-o;if(i>=0&&i<=1){let s=e*i+t.x;if(s>=h[0].x&&s<=h[1].x)return{x:s,y:n*i+t.y,Tt:i,Li:0,qi:1,As:s,ys:h[0].y}}f=h[1].y}if(l===1/0&&f===1/0)return;l!==1/0&&f===1/0&&(f=n>0?h[1].y:h[0].y),f!==1/0&&l===1/0&&(l=e>0?h[1].x:h[0].x);let u=1/s,a=Math.sqrt(e*e+n*n),c=l-t.x,A=f-t.y,R=Math.sqrt(c*c+A*A),y=Math.acos((c*e+A*n)/(a*R));if(R<s)return;if(0===y){let i=(R-s)/a;if(i>1||i<0)return;let h=i*e+t.x,r=i*n+t.y,o=c/R,u=A/R;return isNaN(h)?void 0:{x:h,y:r,Tt:i,Li:o,qi:u,As:l,ys:f}}let M=Math.sin(y),w=M*R*u;if(Math.abs(w)>1)return;let E=Math.PI-Math.asin(w),T=Math.PI-y-E,d=s*Math.sin(T)/M/a;if(d>1||d<0)return;let U=d*e+t.x,x=d*n+i.y,O=(U-l)*u,I=(x-f)*u;return isNaN(U)?void 0:{x:U,y:x,Tt:d,Li:O,qi:I,As:l,ys:f}}function st(t,i,s){return Array.from({length:i},(()=>Array.from({length:t},s)))}function ht(t,i){let s=Y.Gt[0].Yt;return!(t<0||i<0||i>=s.length||t>=s[i].length)}function et(t,i){let s=Y.Gt[0].Yt;return!(t<0||i<0||i>=s.length||t>=s[i].length)&&1===s[i][t]}function nt(t,i,s,h){return`rgba(${t},${i},${s},${h})`}function rt(t,i){let s=document.createElement("canvas");s.width=t,s.height=i;let h=s.getContext("2d");return{e:s,t:h}}const ot={ht:[[0,0,8,16],[8,0,8,16],[16,0,8,16],[24,0,8,16]],yi:[[0,16,3,3]],buttons:[[0,19,12,12],[12,19,12,12],[24,19,12,12],[36,19,12,12],[48,19,12,12],[60,19,12,12],[72,19,12,12],[84,19,12,12]],cursor:[[0,31,10,8]],us:[[0,39,15,15],[15,39,15,15],[30,39,15,15]],font:[[0,54,180,12]],ki:[[0,66,5,5]],Pt:[[0,71,5,5],[5,71,5,5],[10,71,5,5],[15,71,5,5]],ws:[[0,76,9,9]],Ms:[[0,85,13,16]],os:[[0,101,5,16]],fs:[[0,117,60,18]],Ti:[[0,135,7,7],[7,135,7,7],[14,135,7,7],[21,135,7,7],[28,135,7,7],[35,135,7,7],[42,135,7,7],[49,135,7,7]],xs:[[0,142,7,9],[7,142,7,9]],fi:[[0,151,3,3],[3,151,3,3],[6,151,3,3]],Vi:[[0,154,8,8]],Yt:[[0,162,8,8],[8,162,8,8],[16,162,8,8],[24,162,8,8],[32,162,8,8],[40,162,8,8],[48,162,8,8],[56,162,8,8],[64,162,8,8],[72,162,8,8],[80,162,8,8],[88,162,8,8],[96,162,8,8],[104,162,8,8]],Ts:[[0,170,4,4],[4,170,4,4]],Es:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAACuCAMAAACoXtf9AAAAY1BMVEUAAADuw5oAAAANK0UgPFYhIickGhQuCAFTV1JUTmhcDwBtbnN1EgCNaXqPn6iRm6ObrbemraXCHQDJAADL2/zQgVnfcSbmAADm5rjuw5ru6WTwJAD78jb/ql7/1KP/7Nb///+u5EtCAAAAAnRSTlMAlm//+0kAAAPkSURBVHja7ZmJcqQ4DIa1tLM79Cxz58aG93/K9T/IkSl3yKRjCmtLn9vIVh/1jUYcVaHaGIZh9Dyb5O43VDCAVp35WABhddK3oOn2IBrvRhrHMZPm2XKxRx6RwePoQevSY5Ielq7wmBoqPTrU+fbWa6k0hhtR52hdv9LGXxqdH1Vak0Y8g3Vgaub3wPeMJwoDE+rld3QGPgwvhGvyPpLyIYKwn7SPI0mEOERO8oPkgc+kQ5KWzyO3ozQriNyiDgHAcgGE1yq6kW+nPTI52Ek++zwO+0nH8SKH8c7ePUSa+xAj9SGGZ7esPVLvcjrlhwOkt0+sJMEOLC35gPxR0kUb1MqrvrnYbXwihUyTRukwaZRWaD0F+v9hGB3gJXUJwrpd5QcAQeoelg2I6/hq1FkseSf7DocGKSwLa43S6JuGneFXSiPqkt7GpE1axyXPpA+4IwJ1zx4qn/IaZt7MbzPPMxFeaWLwht/D3Ia/K78jv7EMwOsK0iy5rHgnnrzD2GIuBsnclr6K5WeKKnHl+D1sNpDvSBFkP4s0566yvCAtleUpeRyurnS+/0Cl5xSLnk5twlEm57eli54mWvd0dr4opPxXSuQz+NJAfm+kx0Us8bqY/Jdc7rg6sJmsBZHNRyk9ryq/lpberess13QEQSqdtnxAlCGXGDFOwpKv6SyCMtdecjJylDczGfkQrSrLWcntDVc+bxPlTNOkzxlDnTQgDeiXJkXO+rl/Cc/071mJ8PknVo9nOv94hrQizpiKnEX8HzXP1BrQL/3E09iXeZZgWE/bJe8ghhw90r1b6BVJszOs9Ug7waRN2qRN2qR3x6TtNm4PTIIyaVJGH517Uobrh96pk3aDM2mTNmmTNmmTNumN27g9MNmjKYWrOdB5uJpwoLS7ElXSJm3SJm3SJm3SJm3S9R/z8j8QXCY090C9kg4XofbIpKlFpul9YUI4FJF4M0wcQDOVjmyFNYdL07b0RagtculJg7RUXpwvhyZ5++Q8kg6koIRuHLtvX7ruyzesTHqNSeeokf4WQaURTXpP6S+g40D1seu0EOJQRuDXzlix/2aoSUzapE3apE369EGIOQ2DQ1zl3TAgT4hMHWnXA/eOGPI9Madb7xCH21uPuUjfejjD/rTkb+tI9wu/Y/ijGGCNiFUh7b2PU6TdsjrdIn/rK0uHCGLot2OfIj4v0n6RdsyiiqS875yvLA2JP4yFtPS0wD2dv499dek43pZG4D2iY9AepbQk8b5z1dvjuphOvFekpaf5c0dcPYqYTryTvyTt5erBn6MafP369RNp4+vnzzf067tC6e83pIpPNzeqjMF/TdcNxK/LXMwAAAAASUVORK5CYII="},lt={ps(t){let i=new Image;i.onload=t,i.src=ot.Es,lt.Xs=i},s(){lt.font=ft(ot.font[0]),lt.Ss=ft(ot.xs[0]),lt.Rs=ft(ot.xs[1]),lt.fi=ot.fi.map(ft),lt.Pt=ot.Pt.map(ft),lt.ws=ot.ws.map(ft),lt.cs=ot.cursor.map((t=>ft(t,{x:0,y:0})))[0],lt.yi=ot.yi.map(ft),lt.Ms=ot.Ms.map(ft),lt.os=ot.os.map(ft),lt.fs=ot.fs.map(ft),lt.Ti=ot.Ti.map((t=>ft(t,{x:-1,y:-1}))),lt.Yt=ot.Yt.map(ft),lt.Vi=ot.Vi.map(ft),lt.ki=ot.ki.map(ft),lt.ht=ot.ht.map((t=>ft(t,{x:0,y:8}))),lt.buttons=ot.buttons.map(ft),lt.Os=ut(function(t){let i=rt(544,334);for(let s=0;s<334;s+=32)for(let h=0;h<544;h+=32)i.t.drawImage(t,h,s);return i.e}(lt.Yt[0].st)),lt.ot=ut(function(){let t=rt(500,500),i=t.t.createRadialGradient(250,250,0,250,250,250);return i.addColorStop(.3,nt(0,0,0,0)),i.addColorStop(1,nt(0,0,0,.9)),t.t.fillStyle=i,t.t.fillRect(0,0,500,500),t.e}());let t=ot.us.map(ft);lt.Us=ut(function(t,i){let s=rt(130,45);return s.t.drawImage(at(t).e,0,5),s.t.drawImage(i,5,0),s.e}(t[0].st,t[2].st)),lt.Is=ut(at(t[1].st).e)},Ns(t,i,s,h){t.drawImage(i.st,s-i.Js.x,h-i.Js.y)},Dt(t,i,s){let{h:e,o:n}=this.gs(t,i);s?(h.t.save(),h.t.translate(e+t.Js.x,n+t.Js.y),h.t.rotate(s),h.t.drawImage(t.st,-t.Js.x,-t.Js.y),h.t.restore()):h.t.drawImage(t.st,e,n)},gs:(t,i)=>({h:i.x-t.Js.x-W.Nt.x+h.i.h,o:i.y-t.Js.y-W.Nt.y+h.i.o}),rs(t){return this.Yt[t+20-1]||(this.Yt[t+20-1]=ut(function(t,i){let s=rt(8,8);return 256&i&&s.t.drawImage(t[12].st,0,0,4,4,0,0,4,4),64&i&&s.t.drawImage(t[12].st,5,0,3,3,5,0,3,3),1&i&&s.t.drawImage(t[12].st,6,6,2,2,6,6,2,2),4&i&&s.t.drawImage(t[12].st,0,5,3,3,0,5,3,3),8&i&&s.t.drawImage(t[11].st,5,0,3,8,5,0,3,8),32&i&&s.t.drawImage(t[9].st,0,0,4,8,0,0,4,8),2&i&&s.t.drawImage(t[8].st,0,5,8,3,0,5,8,3),128&i&&s.t.drawImage(t[10].st,0,0,8,4,0,0,8,4),160==(160&i)&&s.t.drawImage(t[13].st,0,0,5,5,0,0,5,5),136==(136&i)&&s.t.drawImage(t[13].st,4,0,4,4,4,0,4,4),10==(10&i)&&s.t.drawImage(t[13].st,4,4,4,4,4,4,4,4),34==(34&i)&&s.t.drawImage(t[13].st,0,4,5,4,0,4,5,4),s.e}(this.Yt,t),{x:0,y:0})),this.Yt[t+20-1]}};function ft(t,i){return ut(function(t,i,s,h){const e=lt.Xs,n=rt(s,h);return n.t.drawImage(e,t,i,s,h,0,0,s,h),n.e}(...t),i)}function ut(t,i){let s=t.width,h=t.height;return{st:t,Js:"object"==typeof i?i:{x:s/2|0,y:h/2|0}}}function at(t){let i=rt(130,40);for(let s=0;s<40;s+=5)for(let h=0;h<130;h+=5){let e=0===h?0:125===h?10:5,n=0===s?0:35===s?10:5;i.t.drawImage(t,e,n,5,5,h,s,5,5)}return i}class ct{constructor(){this.frames=0}w(){return this.frames++,A.mt[A.A.F]&&this.frames>30&&At.c(),!0}Ut(){h.t.fillStyle=nt(36,26,20,tt(this.frames/200,0,1)),h.t.fillRect(0,0,h.width,h.height);let t=h.width-32,i="DEFEAT... \n                    \nYOUR LAST MOTH GONE, THIS WORLD SLIPS FROM YOUR GRASP. YOU CURSE THE VILLAGE AND ITS INHABITANTS AS YOU TUMBLE TOWARDS THAT BLEAK BEYOND. \n \nYOUR REIGN OF TERROR HAS ENDED. \n \nTAP TO TRY AGAIN!";i=i.slice(0,this.frames),M.ct(h.t,i,16,16,t,1,1,M.ft)}}const At=new class{s(){lt.ps((()=>{h.s(),lt.s(),M.s(),A.s(),u.s(),W.s(),Y.s(),window.addEventListener("blur",(()=>this.at())),window.addEventListener("focus",(()=>this.pt())),this.c(),this.start()}))}c(){this.as=[],this.ks={},this.vs={},this.bs={},this.Ds=0,this.Ps=[],this.Wi=[],this.Ls=0,W.Nt=_(V(Y.Xt)),this.li=250,this.qs=0,this.as.push(new O(W.Nt)),this.screen=void 0,Y.c()}start(){this.is=0,this.Hs=[0],this.w(),window.requestAnimationFrame((t=>this.Cs(t)))}Cs(t){let i=(new Date).getTime();this.Hs.length>=40&&this.Hs.shift(),this.Gs=1e3/((this.Hs[this.Hs.length-1]-this.Hs[0])/this.Hs.length),this.is++,h.n(),this.w(),this.Ut(h.t),window.requestAnimationFrame((t=>this.Cs(t)));let s=(new Date).getTime();this.Hs.push(this.Hs[this.Hs.length-1]+s-i)}w(){if(this.Ji||(this.Ji=new C(this.Ls++)),A.w(),!(this.screen&&this.screen.w()||(A.mt[A.A.F]&&this.Ui(A.C),K.w(),this.Ws))){this.Ji.w(),this.Ys(),console.log(At.as);for(let t of At.as)t.Rt&&t.Rt();b.bi(this.as),H.bi(this.as),W.w(),this.as=this.as.filter((t=>!t.Ot)),Y.ht=Y.ht.filter((t=>!t.Ot)),this.Ps=this.Ps.filter((t=>t.w())),Y.w(),0===this.as.filter((t=>t instanceof O)).length&&(At.screen=new ct),At.is%6==0&&(this.Ds=10*Math.random()|0),30===At.is&&At.Ps.push(new T(20,20,20)),A.mt[A.A.W]&&!At.Ks&&(At.Ks=!0)}}Ut(){h.t.setTransform(1,0,0,1,0,0),h.t.scale(h.scale,h.scale),h.t.fillStyle=nt(36,26,20,1),h.t.fillRect(0,0,h.width,h.height),Y.Ut();for(let t of this.as)(!t.z||t.z<100)&&t.Ut();for(let t of this.as)t.z&&t.z>100&&t.Ut();Y.Xi(),K.Ut(),At.is<120&&(h.t.fillStyle=nt(0,0,0,1-At.is/120),h.l()),this.screen&&this.screen.Ut()}at(){this.Ws||(this.Ws=!0)}pt(){this.Ws&&(this.Ws=!1)}Ui(t){for(let i of[K,Y])if(i.Ui(t))break}Ri(){return this.as.filter((t=>t instanceof O)).length}Oi(t){if(this.li>=t)return!0}Ii(t){this.li-=t}Ys(){let t=this.Wi[0];if(t)for(let i=0;i<10;i++){let i=Math.floor(Math.random()*Y.Gt[0].Yt[0].length),s=Math.floor(Math.random()*Y.Gt[0].Yt.length);if(1!==Y.Yt[s][i])continue;if(0!==Y.ji[s][i])continue;let h=V({oi:i,r:s});console.log("NEW monster"+h.x+","+h.y+","+Y.ji[s][i]),At.as.push(new t(h)),this.Wi.shift();break}}};At.s()}();
//# sourceMappingURL=app.js.map</script>
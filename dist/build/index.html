<style>body,html{margin:0;padding:0;background-color:#000}div{position:absolute;top:0;bottom:0;left:0;right:0}#canvas{width:100%;height:100%;touch-action:none}</style><div><canvas id="canvas"></canvas></div><script>!function(){"use strict";const t=["CAVE FLOOR","CAVE FLOOR","CAVE FLOOR","","","","DOOM PIT","DOOM PIT"],i=45*Math.PI/180,s=90*Math.PI/180,h=360*Math.PI/180,e={s(){e.e=document.getElementById("canvas"),e.t=e.e.getContext("2d"),e.w(!0)},w(t){let i=window.devicePixelRatio,s=e.e.clientWidth,h=e.e.clientHeight,n=s*i,r=h*i;(t||e.e.width!==n||e.e.height!==r)&&(e.e.width=n,e.e.height=r,e.scale=(10*Math.max(n/240,r/135)|0)/10,e.width=Math.ceil(n/e.scale),e.height=Math.ceil(r/e.scale),e.i={h:e.width/2|0,o:e.height/2|0},e.clientWidth=s,e.clientHeight=h,e.t.imageSmoothingEnabled=!1),e.e.style.cursor="none"},l(){e.t.fillRect(0,0,e.width,e.height)}},n={s(){n.map={KeyW:O.A.u,KeyA:O.A.M,KeyS:O.A.T,KeyD:O.A.p,ArrowUp:O.A.u,ArrowLeft:O.A.M,ArrowDown:O.A.T,ArrowRight:O.A.p,Escape:O.A.R},n.m=[{x:0,y:0,O:0},{x:0,y:-s,O:1},{x:0,y:s,O:1},{x:0,y:0,O:0},{x:-s,y:0,O:1},{x:-i,y:-i,O:1},{x:-i,y:i,O:1},{x:-s,y:0,O:1},{x:s,y:0,O:1},{x:i,y:-i,O:1},{x:i,y:i,O:1},{x:s,y:0,O:1},{x:0,y:0,O:0},{x:0,y:-s,O:1},{x:0,y:s,O:1},{x:0,y:0,O:0}],n.I=[],window.addEventListener("keydown",(t=>{let i=n.map[t.code];i&&(n.I[i]=!0)})),window.addEventListener("keyup",(t=>{let i=n.map[t.code];i&&(n.I[i]=!1)})),n.E()},b(){let t=(n.I[O.A.u]?1:0)+(n.I[O.A.T]?2:0)+(n.I[O.A.M]?4:0)+(n.I[O.A.p]?8:0);n.Q=n.m[t]},E(){n.Q=n.m[0];for(let t of Object.values(O.A))n.I[t]=!1}},r=(...t)=>o(f(...t)),o=(...t)=>{let i=a.createBufferSource(),s=a.createBuffer(t.length,t[0].length,u);return t.map(((t,i)=>s.getChannelData(i).set(t))),i.buffer=s,i.connect(r.S),i.start(),i},f=(t=1,i=.05,s=220,h=0,e=0,n=.1,r=0,o=1,f=0,a=0,c=0,A=0,M=0,y=0,d=0,O=0,T=0,w=1,x=0,R=0)=>{let E,I,L=2*Math.PI,N=f*=500*L/u**2,U=(0<d?1:-1)*L/4,v=s*=(1+2*i*Math.random()-i)*L/u,H=[],D=0,m=0,p=0,S=1,b=0,j=0,g=0;for(a*=500*L/u**3,d*=L/u,c*=L/u,A*=u,M=u*M|0,I=(h=99+u*h)+(x*=u)+(e*=u)+(n*=u)+(T*=u)|0;p<I;H[p++]=g)++j%(100*O|0)||(g=r?1<r?2<r?3<r?Math.sin((D%L)**3):Math.max(Math.min(Math.tan(D),1),-1):1-(2*D/L%2+2)%2:1-4*Math.abs(Math.round(D/L)-D/L):Math.sin(D),g=(M?1-R+R*Math.sin(2*Math.PI*p/M):1)*(0<g?1:-1)*Math.abs(g)**o*t*l*(p<h?p/h:p<h+x?1-(p-h)/x*(1-w):p<h+x+e?w:p<I-T?(I-p-T)/n*w:0),g=T?g/2+(T>p?0:(p<I-T?1:(I-p)/T)*H[p-T|0]/2):g),E=(s+=f+=a)*Math.sin(m*d-U),D+=E-E*y*(1-1e9*(Math.sin(p)+1)%2),m+=E-E*y*(1-1e9*(Math.sin(p)**2+1)%2),S&&++S>A&&(s+=c,v+=c,S=0),!M||++b%M||(s=v,f=N,S=S||1);return H},l=.3,u=44100,a=new(top.AudioContext||webkitAudioContext);r.S=a.destination;const c=function(){var t,i,s,h,e,n=function(t){return Math.sin(6.283184*t)},r=function(t){return.003959503758*2**((t-128)/12)},o=function(t,i,s){var h,e,n,o,l,u,a=f[t.v[0]],c=t.v[1],A=t.v[3]/32,M=f[t.v[4]],y=t.v[5],d=t.v[8]/32,O=t.v[9],T=t.v[10]*t.v[10]*4,w=t.v[11]*t.v[11]*4,x=t.v[12]*t.v[12]*4,R=1/x,E=-t.v[13]/16,I=t.v[14],L=s*2**(2-t.v[15]),N=new Int32Array(T+w+x),U=0,v=0;for(h=0,e=0;h<T+w+x;h++,e++)e>=0&&(e-=L,l=r(i+(15&(I=I>>8|(255&I)<<4))+t.v[2]-128),u=r(i+(15&I)+t.v[6]-128)*(1+8e-4*t.v[7])),n=1,h<T?n=h/T:h>=T+w&&(n=(1-(n=(h-T-w)*R))*3**(E*n)),o=a(U+=l*n**A)*c,o+=M(v+=u*n**d)*y,O&&(o+=(2*Math.random()-1)*O),N[h]=80*o*n|0;return N},f=[n,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var i=t%1*4;return i<2?i-1:3-i}];this.s=function(n){t=n,i=n.U,s=0,h=n.N*n.L*(i+1)*2,e=new Int32Array(h)},this.g=function(){var r,l,u,a,c,A,M,y,d,O,T,w,x,R,E=new Int32Array(h),I=t.H[s],L=t.N,N=t.L,U=0,v=0,H=!1,D=[];for(u=0;u<=i;++u)for(M=I.D[u],a=0;a<N;++a){var m=M?I.c[M-1].f[a]:0;m&&(I.v[m-1]=I.c[M-1].f[a+N]||0,m<17&&(D=[]));var p=f[I.v[16]],S=I.v[17]/512,b=2**(I.v[18]-9)/L,j=I.v[19],g=I.v[20],F=43.23529*I.v[21]*3.141592/44100,W=1-I.v[22]/255,C=1e-5*I.v[23],P=I.v[24]/32,Y=I.v[25]/512,q=6.283184*2**(I.v[26]-9)/L,B=I.v[27]/255,K=I.v[28]*L&-2;for(T=(u*N+a)*L,c=0;c<4;++c)if(A=M?I.c[M-1].n[a+c*N]:0){D[A]||(D[A]=o(I,A,L));var G=D[A];for(l=0,r=2*T;l<G.length;l++,r+=2)E[r]+=G[l]}for(l=0;l<L;l++)(O=E[y=2*(T+l)])||H?(w=F,j&&(w*=p(b*y)*S+.5),v+=(w=1.5*Math.sin(w))*(x=W*(O-v)-(U+=w*v)),O=3==g?v:1==g?x:U,C&&(O=(O*=C)<1?O>-1?n(.25*O):-1:1,O/=C),H=(O*=P)*O>1e-5,R=O*(1-(d=Math.sin(q*y)*Y+.5)),O*=d):R=0,y>=K&&(R+=E[y-K+1]*B,O+=E[y-K]*B),E[y]=0|R,E[y+1]=0|O,e[y]+=0|R,e[y+1]+=0|O}return++s/t.q},this.k=function(t){for(var i=t.createBuffer(2,h/2,44100),s=0;s<2;s++)for(var n=i.getChannelData(s),r=s;r<h;r+=2)n[r>>1]=e[r]/65536;return i},this.P=function(){var t=44+2*h-8,i=t-36,s=new Uint8Array(44+2*h);s.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&i,i>>8&255,i>>16&255,i>>24&255]);for(var n=0,r=44;n<h;++n){var o=e[n];o=o<-32767?-32767:o>32767?32767:o,s[r++]=255&o,s[r++]=o>>8&255}return s},this.getData=function(t,i){for(var s=2*Math.floor(44100*t),h=new Array(i),n=0;n<2*i;n+=1){var r=s+n;h[n]=t>0&&r<e.length?e[r]/32768:0}return h}},A={H:[{v:[1,192,128,0,1,191,116,9,0,0,6,22,34,0,0,0,0,69,3,1,1,23,167,0,32,77,6,25,6],D:[],c:[]},{v:[0,255,117,64,0,255,110,0,64,0,4,6,35,0,0,0,0,0,0,0,2,14,0,1,39,76,5,0,0],D:[],c:[]},{v:[0,255,116,79,0,255,116,0,83,0,4,6,69,52,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],D:[4,4,4,4],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[135,,,135,,,,,,140,,140,,,,,135,,,135,,,,,,140,,140],f:[]}]},{v:[0,192,104,64,0,80,99,0,0,0,4,0,66,0,0,0,3,0,0,0,1,0,1,2,32,37,4,0,0],D:[5,5,3,5],c:[{n:[],f:[]},{n:[],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,135,,,,,,153,,,,,153,153,,153,153,,153,152,163,,163,,160,,161,,159,,159],f:[]},{n:[],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,135,,,,,,153,,,,,,,149,,,135,137,,,,,153],f:[]}]},{v:[2,192,128,0,2,192,140,18,0,0,107,115,138,0,0,0,0,136,5,1,2,8,92,21,32,148,5,85,8],D:[7,6,7],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[123,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,141,,,,,,,,,,,,,,,,,,,,,,,,142,,,,,,,,,,,,,,,,,,,,,,,,123],f:[]},{n:[123,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,126,,,,,,,,,,,,,,,,,,,,,,,,142,,,,,,,,,,,,,,,,,,,,,,,,123],f:[]}]}],N:6820,L:32,U:3,q:5},M={s(){for(M.C=!1,M.t=a,M.Y=M.t.createGain(),M.Y.connect(M.t.destination),r.S=M.Y,M.B=[,,68,.01,,.14,1,1.53,7.5,.1,50,.02,-.01,-.2,.1,.2,,.47,.01],M.F=[,,391,,.19,.01,2,.54,-4,20,,,,,,,.02,.9],M.V=[,,970,.12,.25,.35,,.39,8.1,,10,.1,.2,,.1,,,.6,.09,.13],M.W=[,,454,.06,.86,.71,2,.63,-.7,1.7,-83,.09,.27,.3,.2,,.18,.95,.02,.02],M.G=[1.04,,363,.01,.08,.52,2,.31,.3,,,,,1.5,,.9,,.34,.07],M.j=[1.56,,225,,.05,,3,.79,-7.6,.2,,,.08,,2.1,,.07,.99],M.K=[1.35,,968,.01,.02,,2,.12,-.7,.1,-105,.06,,.1,,,.01,.66,.04],M.J=[2.03,0,65.40639,.03,.66,.18,2,.95,,,,,.3,.4,,,.19,.21,.1,.04],M.X=[1.56,0,261.6256,,.13,.3,,.41,,,,,,.2,,,.05,.2,.19,.22],this.Z=new c,this.Z.s(A);1!==this.Z.g();)console.log("generating");let t=this.Z.k(M.t);this._=M.t.createBufferSource(),this._.buffer=t,this._.connect(M.Y)},b(){M.C&&(M.$||(this._.start(),M.$=!0))},at(t){M.C&&r(...t)},mt(){M.Y.gain.linearRampToValueAtTime(0,M.t.currentTime+1)},pt(){M.Y.gain.linearRampToValueAtTime(1,M.t.currentTime+1)}},y={s(){this.map=[],this.map[0]=O.A.tt,this.map[2]=O.A.it,this.I=[],window.addEventListener("mousemove",(t=>{this.st||(this.st={}),this.st.h=t.clientX*e.width/e.clientWidth|0,this.st.o=t.clientY*e.height/e.clientHeight|0,O.mode=2})),window.addEventListener("mouseout",(()=>{this.st=void 0})),window.addEventListener("mousedown",(t=>{let i=this.map[t.button];i&&(this.I[i]=!0),M.C=!0,yt.ht="mousedown",O.mode=2,this.et={h:t.clientX*e.width/e.clientWidth|0,o:t.clientY*e.height/e.clientHeight|0}})),window.addEventListener("mouseup",(t=>{let i=this.map[t.button];i&&(this.I[i]=!1),yt.ht="mouseup",O.mode=2})),window.addEventListener("click",(t=>{t.preventDefault(),yt.ht="click"})),window.addEventListener("contextmenu",(t=>{let i=this.map[t.button];i&&(this.I[i]=!0),this.nt=2,t.preventDefault()})),y.E()},b(){this.nt&&(this.nt--,0===this.nt&&(this.I[O.A.it]=!1))},E(){this.st=void 0;for(let t of Object.values(O.A))this.I[t]=!1}},d={s(){this.map=[],this.map[0]=O.A.tt,this.I=[],window.addEventListener("touchmove",(t=>{this.st||(this.st={});let i=t.changedTouches[0];this.st.h=i.clientX*e.width/e.clientWidth|0,this.st.o=i.clientY*e.height/e.clientHeight|0,O.mode=1})),window.addEventListener("touchstart",(t=>{let i=this.map[0];i&&(this.I[i]=!0),M.C=!0,yt.ht="TOUCHSTART",O.mode=1;let s=t.changedTouches[0];this.et={h:s.clientX*e.width/e.clientWidth|0,o:s.clientY*e.height/e.clientHeight|0},this.st={...this.et}})),window.addEventListener("touchend",(t=>{let i=this.map[0];i&&(this.I[i]=!1),yt.ht="TOUCHEND",O.mode=1})),this.E()},b(){},E(){this.st=void 0;for(let t of Object.values(O.A))this.I[t]=!1}},O={A:{u:11,T:12,M:13,p:14,rt:21,it:30,R:96,ot:97,lt:98,tt:40,ft:41,ut:42},s(){this.Q={x:0,y:0,O:0},this.is={},this.ct={},this.I={},this.At={},n.s(),y.s(),d.s(),this.mode=1,this.dt=!1},b(){n.b();let t=2===this.mode?y:d;for(let i of Object.values(O.A)){let s=t.I[i]||n.I[i];this.is[i]=!this.I[i]&&s,this.ct[i]=this.I[i]&&!s,this.is[i]?this.At[i]=1:this.I[i]&&s&&this.At[i]++,this.I[i]=s}this.st=t.st,this.Q=n.Q,this.I[O.A.tt]&&(this.At[O.A.tt]>20&&(this.dt=!0),Math.abs(t.et.h-t.st.h)+Math.abs(t.et.o-t.st.o)>5&&(this.dt=!0)),this.dt&&t.st&&(this.yt={x:t.st.h-t.et.h,y:t.st.o-t.et.o}),this.ct[O.A.tt]&&(this.dt?this.dt=!1:(this.is[O.A.ut]=!0,this.At[O.A.ut]=1))},wt(t){},Mt(t){}},T={10:0,32:3,33:3,39:2,44:3,46:3,73:2},w={},x={s(){x.Tt=at.font.xt;let t=[[101,at.Et[2]]];for(let i of t)w[i[0]]=i[1],T[i[0]]=i[1].xt.width+1;x.Rt=R(x.Tt,ft(0,0,0,1)),x.Ot=R(x.Tt,ft(90,20,90,.15)),x.blue=R(x.Tt,ft(200,40,220,1)),x.It=R(x.Tt,ft(240,50,200,.2)),x.St=R(x.Tt,ft(240,240,255,.25)),x.red=R(x.Tt,ft(240,50,50,1)),x.vt=E(x.Tt,"#ffaa5e","#ffd4a3"),x.Ut=E(x.Tt,"#ffaa5e","#ffd4a3",ft(255,0,0,.7))},Nt(t,i,s,h,e=1,n=x.vt,r){for(let o=0;o<i.length;o++){let f=i.charCodeAt(o);if(119!==f)if(114!==f){if(w[f])t.drawImage(w[f].xt,s,h-(w[f].xt.height+4)/2);else{let i=4*(f-32);r&&t.drawImage(r,i%180,6*(i/180|0),3,5,s+1,h+1,3*e,5*e),t.drawImage(n,i%180,6*(i/180|0),3,5,s,h,3*e,5*e)}s+=(T[f]||4)*e}else n=x.Ut;else n=x.vt}},bt(t,i,s,h,e,n,r=1,o=x.vt,f){let l=s,u=h,a=i.split(" ");for(let i of a){for(;"\n"===i[0];)i=i.slice(1),l=s,u+=6*r;let h=x.Lt(i,r);l+h-s>e&&(l=s,u+=6*r),x.Nt(t,i,l,u,r,o,f),l+=h+(T[32]||4)}},Lt:(t,i)=>t.split("").reduce(((t,i)=>t+(T[i.charCodeAt(0)]||4)),0)*i};function R(t,i){let s=lt(t.width,t.height);return s.t.fillStyle=i,s.t.fillRect(0,0,t.width,t.height),s.t.globalCompositeOperation="destination-in",s.t.drawImage(t,0,0),s.e}function E(t,i,s,h){let e=lt(t.width,t.height);return e.t.fillStyle=s,e.t.fillRect(0,0,t.width,t.height),e.t.fillStyle=i,e.t.fillRect(0,0,t.width,1),e.t.fillRect(0,6,t.width,1),h&&(e.t.fillStyle=h,e.t.fillRect(0,0,t.width,t.height)),e.t.globalCompositeOperation="destination-in",e.t.drawImage(t,0,0),e.e}class I{constructor(t,i,s){this.frames=t,this.gt=i,this.Ht=s,this.Dt=[],this.qt=[];var h=t/2;for(let t=0;t<h;t++)this.Dt.push(2*Math.random()-1),this.qt.push(2*Math.random()-1);this.as=-1}b(){if(this.as++,this.as>=this.frames)return!1;let t=this.as/2,i=0|t,s=i+1,h=1-this.as/this.frames;return this.x=this.gt*h*(this.Dt[i]+(t-i)*(this.Dt[s]-this.Dt[i])),this.y=this.Ht*h*(this.qt[i]+(t-i)*(this.qt[s]-this.qt[i])),!0}}class L{constructor(t,s,h){this.kt={...t},this.angle=s,this.Pt=Z(X(this.angle,h?8:5)),this.a=i,this.Ct=!0,this.f=h,this.Yt=!0,this.Bt=1,this.r=0,this.Ft=-1,this.d=0===this.f?45:70,this.Vt=!0}Wt(){++this.Ft===this.d&&(this.Gt=!0),this.Pt.x*=.9,this.Pt.y*=.9,this.a*=.95,this.r+=this.a}jt(){at.Kt(at.Jt[this.f],this.kt,this.r)}}L.F=t=>L.Xt(t,8,(()=>0)),L.Qt=t=>L.Xt(t,16,(()=>4*Math.random()|0)),L.Xt=(t,e,n)=>{let r=t.Zt?function(t){let i=Math.atan2(t.y,t.x);return i<0&&(i+=h),i}(t.Zt.zt):Math.random()*h;for(let o=0;o<e*(yt.W?2:1);o++){let e=Math.random()*t.Bt,o=z(t.kt,X(Math.random()*h,e));yt.ms.push(new L(o,r+Math.random()*s-i,n()))}};const N={_t:[{name:"1F",$t:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,14,14,0,0,0,0,0,0,0,0,14,14,14,14,14,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,1,1,1,1,14,14,14,0,0,0,0,0,14,14,1,1,1,14,14,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,1,1,1,1,1,1,1,1,14,14,0,0,14,14,14,3,1,1,1,1,14,14,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,1,1,1,1,1,1,7,7,1,1,1,1,14,14,14,14,1,1,1,1,1,1,1,1,14,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,1,1,1,1,1,1,1,1,7,8,8,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,14,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,1,1,1,1,1,1,1,1,1,8,8,1,1,1,1,3,1,1,1,1,1,1,1,1,1,1,14,14,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,14,14,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,1,1,1,14,14,14,0,0],[0,0,0,0,0,0,0,14,14,14,14,14,14,14,1,1,1,14,14,14,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,14,14,0,0,0,0],[0,0,0,0,0,0,14,14,3,1,1,1,1,1,1,1,1,1,14,14,14,1,1,1,1,1,1,1,1,14,14,14,14,1,1,1,1,1,1,1,1,14,14,14,14,0],[0,0,0,0,0,14,14,1,1,1,1,2,1,1,1,7,1,1,1,14,14,14,1,1,1,1,14,14,14,14,14,1,14,14,2,1,3,1,1,1,1,1,1,1,14,14],[0,0,0,0,0,14,1,1,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,14,1,1,1,1,14,3,1,1,1,1,1,14],[0,0,0,0,0,14,1,7,8,1,1,14,14,14,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,7,1,14,1,1,1,1,14,14,1,1,1,1,3,14],[0,0,0,0,0,14,1,1,1,1,14,14,0,14,14,1,1,1,2,1,1,1,1,1,1,1,1,1,1,7,1,1,1,14,1,7,1,14,14,14,1,1,1,1,1,14],[0,0,0,0,0,14,14,1,2,14,14,0,0,14,14,1,1,1,1,1,14,14,14,14,1,1,2,1,1,1,1,1,14,14,1,8,1,14,0,14,14,1,1,2,14,14],[0,0,0,0,0,0,14,14,14,14,0,0,14,14,1,1,1,3,1,14,14,0,0,14,14,1,1,1,1,1,1,14,14,14,1,8,1,14,0,0,14,14,14,14,14,0],[0,0,0,0,0,0,0,0,0,0,0,0,14,1,1,7,1,1,1,14,0,0,0,0,14,14,1,1,1,1,2,14,14,14,1,8,1,14,14,0,0,0,0,0,0,0],[0,0,0,14,14,14,14,14,14,14,14,14,14,1,1,1,1,14,14,14,0,0,0,0,0,14,1,1,1,1,1,1,14,1,1,1,1,2,14,0,0,0,0,0,0,0],[0,14,14,14,1,1,1,1,1,14,14,14,14,1,1,1,1,14,0,0,0,0,0,0,0,14,14,1,1,1,1,1,14,1,1,1,1,1,14,14,0,0,0,0,0,0],[0,14,1,1,1,1,1,1,1,2,14,14,14,1,1,1,1,14,14,0,0,0,0,0,0,0,14,1,1,1,1,1,14,14,14,1,1,1,1,14,0,0,0,0,0,0],[14,14,1,1,1,1,1,1,1,1,14,14,14,1,1,1,1,1,14,14,0,0,0,0,0,0,14,1,1,1,1,1,1,1,14,14,1,1,1,14,0,0,0,0,0,0],[14,1,1,1,1,14,1,1,1,1,1,14,14,14,1,1,2,1,14,14,0,0,0,0,0,0,14,1,2,1,1,7,1,1,1,14,1,7,1,14,14,14,14,14,0,0],[14,1,7,1,1,14,14,1,1,1,1,14,14,14,14,1,1,1,14,14,0,0,0,0,0,0,14,14,1,1,1,8,7,1,1,14,1,1,1,14,14,1,1,14,14,0],[14,1,1,1,1,14,14,1,1,1,1,1,14,14,14,1,1,1,1,14,0,0,0,0,0,0,0,14,14,1,1,1,1,1,1,14,14,1,1,1,1,1,1,1,14,0],[14,14,1,1,1,14,14,1,1,1,1,1,1,14,14,1,1,7,1,14,0,0,0,0,0,0,0,0,14,14,1,1,3,1,14,14,1,1,1,1,1,1,1,1,14,0],[0,14,1,1,1,14,14,14,1,1,1,1,1,14,14,1,1,8,1,14,0,0,0,0,0,0,0,0,0,14,14,14,14,14,14,1,1,1,3,1,1,1,1,1,14,0],[0,14,1,1,1,1,14,14,14,1,1,1,14,14,14,1,1,1,1,14,0,0,0,0,0,0,0,0,0,0,0,14,14,1,1,1,1,14,14,14,1,1,1,14,14,0],[0,14,1,1,1,1,2,14,14,14,14,14,14,14,1,1,1,1,14,14,0,0,0,0,0,0,0,0,0,0,14,14,1,1,1,2,1,14,0,14,14,14,14,14,0,0],[0,14,14,1,1,1,1,1,14,14,14,14,14,2,1,1,1,14,14,0,0,0,0,0,0,0,0,0,0,0,14,1,3,1,14,14,14,14,0,0,0,0,0,0,0,0],[0,0,14,14,1,1,1,1,1,1,1,1,1,1,1,3,1,14,0,0,0,0,0,0,0,0,0,0,0,0,14,1,1,14,14,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,14,14,1,1,1,1,1,1,7,1,1,1,1,14,14,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,14,14,14,1,3,1,1,1,1,1,1,14,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,14,14,14,14,14,14,14,14,14,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],ti:[],ii:[{name:"SPAWN",x:42,y:11},{name:"EARTH",x:20,y:3},{name:"EXIT",x:10,y:24},{name:"EARTH",x:41,y:25},{name:"EARTH",x:43,y:22},{name:"EARTH",x:33,y:17},{name:"EARTH",x:40,y:6},{name:"EARTH",x:36,y:3},{name:"EARTH",x:14,y:7},{name:"EARTH",x:31,y:13},{name:"EARTH",x:7,y:13}],si:[],id:0}],bounds:[[0,0],[46,32]],hi:[42,11,0]};class U{constructor(t){this.kt={...t},this.target={...this.kt},this.Pt={x:0,y:0},this.ei=1,this.F=[],this.Bt=3,this.sh=2,this.Ct=!0,this.Vt=!0,this.ni=7,this.ri=[],this.oi=0,this.offset={x:0,y:0},this.li=0,this.ai=500,this.fi=3,this.ui=0,this.as=0,this.ci=Math.floor(16*Math.random()),this.Ai=yt.as;let i=$(this.kt);this.moveTo({di:i.di,r:i.r-1})}Wt(){0===this.ri.length&&this.ri.push({yi:2});let t=this.ri[this.ri.length-1];if(this.as=Math.floor(yt.as/8)%2+1,9===this.sh)return M.at(M.G),void(this.Gt=!0);if(3===t.yi)this.target=st(_(t.wi)),Q(this.kt,this.target).O<6&&this.ri.pop();else if(6===t.yi){if(this.target=st(_(t.wi)),Q(this.kt,this.target).O<6){this.as=0;let i=K.Mi(t.wi);i.Ti++,i.Ti>=i.xi&&this.ri.pop()}}else if(4===t.yi){this.target=st(_(t.wi));let i=Q(this.kt,this.target),s=K.Mi(t.wi);s?i.O<6&&(this.as=0,this.li+=this.fi,s.pi-=this.fi,this.li>=this.ai&&this.ri.push({yi:5,wi:{di:K.hi.di,r:K.hi.r}})):(this.ri.pop(),this.ri.push({yi:5,wi:{di:K.hi.di,r:K.hi.r}}))}else 5===t.yi&&(this.target=st(_(t.wi)),Q(this.kt,this.target).O<6&&(this.as=0,this.li-=this.fi,this.ui+=this.fi,this.ui>=100&&(yt.Ei++,this.ui-=100),this.li<=0&&this.ri.pop()));let i=K.Ri(this.kt,this.target);console.log([this.target,i]);let s=Q(this.kt,i);s.O=ht(s.O,0,.5);let h=Z(s);this.Pt={x:(this.Pt.x+h.x)/2,y:(this.Pt.y+h.y)/2}}jt(){let t=3;0===this.as&&t--;let i=Math.cos((yt.as+this.ci)/16)*t,s=1*Math.sin((yt.as+this.ci)/16);at.Kt(at.mi[this.as],{x:this.kt.x+i,y:this.kt.y+s})}Oi(t){this.ri=[{yi:4,wi:t}],this.Ai=yt.as}construct(t){this.ri.push({yi:6,wi:t}),this.Ai=yt.as}moveTo(t){this.ri=[{yi:3,wi:t}],this.Ai=yt.as}Ii(){let t=this.ri[this.ri.length-1];return t&&2!==t.yi}}U.Si=()=>{let t=yt.ms.filter((t=>t instanceof U));return t.sort(((t,i)=>t.Ii()&&!i.Ii()?1:!t.Ii()&&i.Ii()?-1:t.Ai-i.Ai)),t},U.assign=t=>{let i=U.Si();for(let s=0;s<i.length&&!(s>0&&i[s].Ii());s++)t(i[s])};class v{constructor(t,i,s){this.kt={...t},this.target=i,this.Pt={x:0,y:0},this.F=s||70}Wt(){let t=Q(this.kt,this.target.kt);t.O=ht(t.O,0,2),this.Pt={x:(this.Pt.x+t.x*t.O)/2,y:(this.Pt.y+t.y*t.O)/2},t.O<1&&(this.target.F.push({vi:this.F,zt:t,Ui:0}),this.Gt=!0,console.log("HIT"))}jt(){at.Kt(at.Ni[0],this.kt,this.r)}}const H={bi:()=>!!K.Mi(K.selected),Li:()=>at.buttons[6],gi:()=>at.buttons[7],Hi(t,i){let s=K.Mi(K.selected),h=yt.Di(15)?"BUILD TOWER \ne15":"BUILD TOWER \ner15";s&&(h="FINISH BUILDING"),x.bt(e.t,h,t,i)},qi(){if(K.Mi(K.selected))U.assign((t=>t.construct(K.selected)));else if(yt.Di(15))return yt.ki(15),K.Et.push(new D(K.selected)),U.assign((t=>t.construct(K.selected))),!0}};class D{constructor(t){this.wi={...t},this.Pi=10,this.ni=7,this.sh=21,this.Ti=0,this.xi=180,this.title="TOWER",this.Ci=at.Et[0]}Wt(){if(!(this.Ti>=this.xi))return;22!==this.sh&&(this.sh=22,M.at(M.J));let t,i,s=st(_(this.wi));if(!this.target||this.target.Gt){for(let h of yt.ms){if(!h.Yi)continue;let e=Q(s,h.kt);e.O<32&&(!i||e.O<i.O)&&(t=h,i=e)}console.log("ATTEMPTED to pick target for building",t),this.target=t}this.Pi>0&&this.Pi--,this.target&&0===this.Pi&&(Q(s,this.target),yt.ms.push(new v(s,this.target)),this.Pi=100,M.at(M.j))}jt(){let t=_(this.wi);if(tt(st(t)),e.t.globalAlpha=21===this.sh?.5:1,at.Kt(at.Et[0],t),e.t.globalAlpha=1,21===this.sh){let i=ht(Math.floor(8*this.Ti/this.xi),0,7);e.t.globalAlpha=.5,at.Kt(at.Bi[7],t),e.t.globalAlpha=1,at.Kt(at.Bi[i],t)}}Fi(){return this.Ti<this.xi?[H]:[]}}const m=[0,2];for(let t=2;t<=19;t++)m[t]=Math.floor(1.5*m[t-1]+1);for(let t=0;t<20;t++)m[t]=5*m[t];const p={bi:()=>!1,Li:()=>at.buttons[0],gi:()=>at.buttons[1],Hi(t,i){let s=m[yt.Vi()],h=yt.Di(s)?"LURE MOTH \ne"+s:"LURE MOTH \ner"+s;x.bt(e.t,h,t,i)},qi(){let t=m[yt.Vi()];if(yt.Di(t))return yt.ki(t),yt.ms.push(new U(st(_(K.selected)))),!0}};class S{constructor(t){this.wi={...t},this.title="YOUR COFFIN \nLAST CHANCE",this.Ci=at.Et[1],this.ni=9}Wt(){}jt(){let t=_(this.wi);at.Kt(at.Et[1],t)}Fi(){return[p]}}class b{constructor(t){this.kt={...t},this.ei=100,this.F=[],this.Pt={x:0,y:0},this.Bt=2,this.Wi=.2,this.Gi=0,this.sh=11,this.Yi=!0}Wt(){let t=yt.ms.filter((t=>t instanceof U)),i=t[0];if(console.log(t.map((t=>t.kt))),!i)return;let s=Q(this.kt,i.kt);for(let h=1;h<t.length;h++){let e=Q(this.kt,t[h].kt);e.O<s.O&&(i=t[h],s=e)}const h=K.Ri(this.kt,i.kt);let e=Q(this.kt,h);11===this.sh?s.O<8?(console.log("KILL"),i.F.push({vi:10,zt:e,Ui:0}),this.Gt=!0):(e.O=ht(e.O,0,.4),this.Pt={x:(this.Pt.x+e.x*e.O)/2,y:(this.Pt.y+e.y*e.O)/2}):9===this.sh&&(M.at(M.K),this.Gt=!0,L.Qt(this))}jt(){let t=at.ji[0];at.Kt(t,this.kt)}}const j={bi:()=>!0,Li:()=>at.buttons[2],gi:()=>at.buttons[3],Hi(t,i){x.bt(e.t,"GATHER EARTH",t,i)},qi:()=>(U.assign((t=>t.Oi(K.selected))),!0)};class g{constructor(t){this.wi={...t},this.pi=1e4,this.title="EARTH",this.Ci=at.Et[2]}Wt(){this.title="EARTH \n"+Math.ceil(this.pi/100)+" REMAINING",this.pi<1&&(this.Gt=!0)}jt(){let t=_(this.wi);at.Kt(at.Et[2],t)}Fi(){return[j]}}const F={bi:()=>!0,Li:()=>at.buttons[4],gi:()=>at.buttons[5],Hi(t,i){x.bt(e.t,"EXPLORE",t,i)},qi:()=>(U.assign((t=>t.moveTo(K.selected))),!0)},W={Ki(t){let i=t.filter((t=>t.kt&&t.Pt&&!t.Gt));for(let t=0;t<5;t++){for(let t=0;t<i.length-1;t++)for(let s=t+1;s<i.length;s++)W.Ji(i[t],i[s]);for(let t of i)W.Xi(t)}for(let t of i)t.kt.x+=t.Pt.x,t.kt.y+=t.Pt.y},Ji(t,i){if(t.Ct||i.Ct)return;let s=function(t,i,s,h,e,n){[s,n]=[Z(s),Z(n)];let r=Q({x:t.x+s.x,y:t.y+s.y},{x:h.x+n.x,y:h.y+n.y});if(r.O<i+e)return{Qi:r.x,Zi:r.y,O:i+e-r.O}}(t.kt,t.Bt,t.Pt,i.kt,i.Bt,i.Pt);if(s)if(t.Yt&&i.Yt)t.Pt.x=-s.Qi*s.O,t.Pt.y=-s.Zi*s.O,i.Pt.x=s.Qi*s.O,i.Pt.y=s.Zi*s.O;else{let h=k(t.Pt).O+i.Wi,e=k(i.Pt).O+t.Wi,n=t.Yt?.1:1,r=i.Yt?.1:1;t.Pt.x-=s.Qi*s.O*n*h/(h+e),t.Pt.y-=s.Zi*s.O*n*h/(h+e),i.Pt.x+=s.Qi*s.O*r*e/(h+e),i.Pt.y+=s.Zi*s.O*r*e/(h+e)}},Xi(t){if(!t.Vt){t.kt.y<-1e3&&console.log("FUUUUUUUUUUUUUUUU");for(let i of function*(t,i,s){yield*function*(t,i,s){let h=[{x:Math.min(t.x,i.x)-s,y:Math.min(t.y,i.y)-s},{x:Math.max(t.x,i.x)+s,y:Math.max(t.y,i.y)+s}];yield*function*(t){for(let i=t[0].y/8|0;8*i<t[1].y;i++)for(let s=t[0].x/8|0;8*s<t[1].x;s++)yield{di:s,r:i}}(h)}(t,{x:t.x+i.x,y:t.y+i.y},s)}(t.kt,t.Pt,t.Bt))if(!ot(i.di,i.r)){let s=[_(i),_({di:i.di+1,r:i.r+1})],h=et(t.kt,{x:t.kt.x+t.Pt.x,y:t.kt.y+t.Pt.y},t.Bt,s);h&&(t.Yt?0===h.Qi?t.Pt.y=-t.Pt.y:0===h.Zi?t.Pt.x=-t.Pt.x:(t.Pt.x+=h.Qi,t.Pt.y+=h.Zi):0===h.Qi?t.Pt.y=h.y-t.kt.y:0===h.Zi?t.Pt.x=h.x-t.kt.x:(t.Pt.x+=h.Qi,t.Pt.y+=h.Zi))}}}},C={Ki(t){let i=!1;for(let s of t)if(s.ei){if(s.F.length>0){if(9!==s.sh&&1!==s.sh)for(let t of s.F)s===yt.Z&&yt.ms.push(new HealthChunkAnimation(s.ei,t.vi)),s.ei-=t.vi,t.zt.O=t.Ui,s.Pt=z(s.Pt,t.zt),s.Zt=t,L.F(s),i=!0;s.F=[]}s.ei<=0&&9!==s.sh&&(s.sh=9)}i&&M.at(M.F)}},P=[[[0,1],[5,1],[10,1],[15,1],[20,1],[21,1],[22,1]]];class Y{constructor(t){t%=P.length,this.zi=[...P[t]],this._i=240,this.$i=!1,this.as=0,this.ts=60*this.zi[this.zi.length-1][0]}b(){if(this._i--,this._i>=0&&this._i<=120&&this._i%60==0&&M.at(M.X),this._i<=0){this.$i=!0;for(let t=0;t<this.zi.length;t++)this.as===60*this.zi[t][0]&&yt.ss.push(b);this.as++}this.as>=this.ts&&(yt.hs=void 0)}}class q{constructor(){this.frames=0}b(){this.frames++}jt(){e.t.fillStyle=ft(36,26,20,ht(this.frames/200,0,1)),e.t.fillRect(0,0,e.width,e.height);let t=e.width-32,i="ESCAPE! \n                    \nVILLAGERS STIR UNEASILY IN THEIR BEDS AS YOU EMERGE INTO MOONLIGHT. YOU SENSE WARM BODIES ALL AROUND YOU, RIPE FOR PICKING. IT IS ONLY A MATTER OF TIME NOW BEFORE YOU REGAIN YOUR FULL NECROMANTIC POWER. \n                    \nCONGRATULATIONS... AND THE END.";i=i.slice(0,this.frames),x.bt(e.t,i,16,16,t,1,1)}}class B{constructor(t){this.wi={...t},this.title="REACH EXIT \nTO ESCAPE",this.Ci=at.Et[3],this.ni=4}Wt(){let t=U.Si(),i=st(_(this.wi));for(let s of t)if(Q(s.kt,i).O<6)return void(yt.screen=new q)}jt(){let t=_(this.wi);at.Kt(at.Et[3],t)}Fi(){return[F]}}const K={s(){this.E()},jt(){let t=this._t[0].$t,i=tt({x:0,y:0});for(let s=0;s<t.length;s++)for(let h=0;h<t[0].length;h++)t[s][h]>0&&e.t.drawImage(at.$t[t[s][h]-1].xt,8*h+i.h,8*s+i.o);for(let t of this.Et)t.jt()},es(){let t=this.$t,i=tt({x:0,y:0});for(let s=0;s<t.length;s++)for(let h=0;h<t[0].length;h++)if(t[s][h]>0){let t=1-ht(this.ns[s][h]/5,.1,1);0===this.rs[s][h]&&(t=1),e.t.globalAlpha=t,e.t.drawImage(at.os[0].xt,8*h+i.h,8*s+i.o)}e.t.globalAlpha=1},E(){this._t=N._t.map((t=>({$t:t.$t.map((t=>[...t])),ii:t.ii.map((t=>({...t})))}))),this.bounds=N.bounds,this.hi={di:N.hi[0],r:N.hi[1]},this.Et=[],this.Et.push(new S(this.hi));for(let t of this._t[0].ii)"EARTH"===t.name?this.Et.push(new g({di:t.x,r:t.y})):"EXIT"===t.name&&(this.Et.push(new B({di:t.x,r:t.y})),this.ls={di:t.x,r:t.y});this.selected=void 0,this.$t=this._t[0].$t,this.width=this.$t[0].length,this.height=this.$t.length,this.ns=nt(this.width,this.height,(()=>0)),this.rs=nt(this.width,this.height,(()=>0)),this.fs={},this.us()},b(){for(let t of this.Et)t.Wt();this.cs()},As(t){return 46===this.ds(t)},ys(t){return this.ws.includes(this._t[t.z].$t[t.y][t.x])},Ms(t){this._t[t.z]},qi(t){let i=$(it(t)),s=this.ds(i);if(!s||s>8||!this.rs[i.r][i.di])this.selected=void 0;else if(this.selected&&this.selected.di===i.di&&this.selected.r===i.r){let t=this.Mi(this.selected);if(t){let i=t.Fi();i[0]&&i[0].bi()&&i[0].qi()}else F.qi()}else this.selected=i,this.Mi(this.selected)},ds(t){if(t)return this._t[0].$t[t.r]?.[t.di]},Mi(t){if(t)for(let i of this.Et)if(i.wi.di===t.di&&i.wi.r===t.r)return i},cs(){let t=[];for(let i of this.Et)i.ni&&t.push({...i.wi,Ts:i.ni});for(let i of yt.ms)i.ni&&t.push({...$(i.kt),Ts:i.ni});this.ns=function(t,i,s=1/0){let h=nt(t[0].length,t.length,(()=>0)),e=[...i];for(;e.length>0;){let{di:t,r:i,Ts:n}=e.shift();h[i][t]>=n||(h[i][t]=n--,h[i][t]>=s||(rt(t+1,i)&&h[i][t+1]<n&&e.push({di:t+1,r:i,Ts:n}),rt(t-1,i)&&h[i][t-1]<n&&e.push({di:t-1,r:i,Ts:n}),rt(t,i+1)&&h[i+1][t]<n&&e.push({di:t,r:i+1,Ts:n}),rt(t,i-1)&&h[i-1][t]<n&&e.push({di:t,r:i-1,Ts:n})))}return h}(this.$t,t);for(let t=0;t<this.ns.length;t++)for(let i=0;i<this.ns[0].length;i++)this.ns[t][i]>this.rs[t][i]&&(this.rs[t][i]=1)},Ri(t,i){let s=$(t),h=$(i);var e,n;if(e=s,n=h,Math.abs(e.di-n.di)+Math.abs(e.r-n.r)<=1)return i;let r=[h.di,h.r].join(","),o=this.fs[r];o||(o=this.fs[r]=function(t,i,s=1/0){let h=nt(t[0].length,t.length,(()=>1/0)),e=[{...i,xs:0}];for(;e.length>0;){let{di:t,r:i,xs:n}=e.shift();h[i][t]<=n||(h[i][t]=n++,h[i][t]>=s||(ot(t+1,i)&&h[i][t+1]>n&&e.push({di:t+1,r:i,xs:n}),ot(t-1,i)&&h[i][t-1]>n&&e.push({di:t-1,r:i,xs:n}),ot(t,i+1)&&h[i+1][t]>n&&e.push({di:t,r:i+1,xs:n}),ot(t,i-1)&&h[i-1][t]>n&&e.push({di:t,r:i-1,xs:n})))}return h}(this.$t,h)),console.log(Object.keys(this.fs).length);let f=[[s.di+1,s.r],[s.di-1,s.r],[s.di,s.r+1],[s.di,s.r-1]];for(let t of f)t.push(o[t[1]][t[0]]);return f.sort(((t,i)=>t[2]-i[2])),st(_({di:f[0][0],r:f[0][1]}))},us(){for(let t=0;t<this.$t.length;t++)for(let i=0;i<this.$t[0].length;i++)if(14===this.$t[t][i]){let s=0;(this.$t[t-1]?.[i-1]||99)<8&&(s|=256),(this.$t[t-1]?.[i]||99)<8&&(s|=128),(this.$t[t-1]?.[i+1]||99)<8&&(s|=64),(this.$t[t]?.[i-1]||99)<8&&(s|=32),(this.$t[t]?.[i+1]||99)<8&&(s|=8),(this.$t[t+1]?.[i-1]||99)<8&&(s|=4),(this.$t[t+1]?.[i]||99)<8&&(s|=2),(this.$t[t+1]?.[i+1]||99)<8&&(s|=1),at.ps(s),this.$t[t][i]=20+s}}},G=18,V={s(){this.Es=lt(7,7)},b(){if(K.selected){let t=K.ds(K.selected),i=K.Mi(K.selected);this.actions=i?i.Fi():t>=1&&t<=4?[F,H]:[]}else this.actions=[];O.dt&&(this.Rs=void 0)},jt(){if(e.t.fillStyle=ft(36,26,20,.4),e.t.fillRect(0,0,e.width,9),e.t.fillRect(0,9,e.width,1),yt.hs)if(yt.hs.$i){let t="INCOMING",i=x.Lt(t,1),s=(e.width-i)/2,h=Math.floor(yt.as/60)%2==0?x.vt:x.Ut;x.Nt(e.t,t,s,2,1,h)}else{let t=Math.ceil(yt.hs._i/60);if(t<=30){let i="NEXT WAVE",s=x.Lt(i,1)+2,h=(e.width-s)/2;x.Nt(e.t,"NEXT WAVE ",h,2),this.Es.t.clearRect(0,0,7,7),this.Es.t.fillStyle=ft(255,212,163,1),this.Es.t.beginPath(),this.Es.t.moveTo(3.5,3.5),this.Es.t.lineTo(3.5,0),this.Es.t.arc(3.5,3.5,3,1.5*Math.PI,1.5*Math.PI+t/30*Math.PI*2),this.Es.t.fill(),e.t.drawImage(this.Es.e,h+s,1)}}let i=yt.ms.filter((t=>t instanceof U));for(let t=0;t<i.length;t++)e.t.drawImage(at.mi[1].xt,2+4*t,2);let s,h=yt.Ei+"e",n=x.Lt(h,1);if(e.t.fillStyle="rgba(0, 0, 0, 0.1)",x.Nt(e.t,h,e.width-n-2,2),O.st){let t=O.st.h,i=O.st.o,s=it(O.st),h=$(s);if(x.Nt(e.t,t+","+i+". "+s.x+","+s.y+". "+h.di+","+h.r+".",e.width-100,20),K.selected){let t=K.$t[K.selected.r][K.selected.di];t>20&&(t-=20),x.Nt(e.t,K.selected.di+","+K.selected.r+". "+t.toString(2).padStart(9,"0"),e.width-100,29)}}if(K.selected){let t=tt({x:8*K.selected.di,y:8*K.selected.r});e.t.fillStyle=ft(255,212,163,.25),e.t.fillRect(t.h,t.o,9,9)}if(e.t.fillStyle="#ffd4a3",e.t.fillRect(0,e.height-G,e.width,1),e.t.fillStyle="#8d697a",e.t.fillRect(0,e.height-G+1,e.width,1),e.t.fillStyle="#203c56",e.t.fillRect(0,e.height-G+2,e.width,16),e.t.fillStyle="#8d697a",e.t.fillRect(0,e.height-2,e.width,2),e.t.drawImage(at.Os[0].xt,-2,e.height-G+1),e.t.drawImage(at.Os[0].xt,64,e.height-G+1),e.t.drawImage(at.Os[0].xt,e.width-3,e.height-G+1),K.selected){let i=K.Mi(K.selected);if(i)e.t.drawImage(i.Ci.xt,3,e.height-G-1),x.bt(e.t,i.title,14,e.height-G+3,e.width);else{let i=K.ds(K.selected);console.log(K.selected,i,t[i-1]),e.t.drawImage(at.os[1].xt,4,e.height-G+6),e.t.drawImage(at.$t[i-1].xt,3,e.height-G+5),x.bt(e.t,t[i-1],14,e.height-G+3,e.width)}}for(let t=0;t<this.actions.length;t++){let i=this.actions[t],h=this.Is(t);e.t.drawImage(at.Os[0].xt,h.h+11,e.height-G+1),e.t.drawImage(i.Li().xt,h.h,h.o),this.Rs===i&&(s=t)}if(s>=0){let t=this.Is(s);e.t.drawImage(at.Ss[0].xt,t.h-23,t.o-19),e.t.drawImage(this.Rs.gi().xt,t.h,t.o),this.Rs.Hi(t.h-23+3,t.o-19+3)}O.st&&(yt.vs&&(e.t.globalAlpha=.5),at.Kt(at.Us,it(O.st)),e.t.globalAlpha=1)},Is:t=>({h:68+15*t,o:e.height-15}),qi(t){if(t.o>e.height-G){for(let i=0;i<this.actions.length;i++){let s=this.Is(i);if(t.h>=s.h&&t.h<=s.h+12&&t.o>=s.o&&t.o<=s.o+12)return this.actions[i]===this.Rs?this.Rs.qi()&&(this.Rs=void 0):this.Rs=this.actions[i],!0}return this.Rs=void 0,!0}return this.Rs=void 0,!1}},J={s(){this.kt={x:0,y:0},this.Ns=void 0,this.Pt={x:0,y:0}},b(){if(this.Ns){let t=Q(this.kt,this.Ns);if(t.O<1)return void(this.Ns=void 0);t.O=ht(t.O,0,2);let i=Z(t);this.Pt={x:(this.Pt.x+i.x)/2,y:(this.Pt.y+i.y)/2},this.kt.x+=this.Pt.x,this.kt.y+=this.Pt.y}O.is[O.A.tt]&&(this.bs={...this.kt}),O.dt&&(this.kt={x:this.bs.x-O.yt.x,y:this.bs.y-O.yt.y})}};function k(t){let i=Math.sqrt(t.x*t.x+t.y*t.y);return 0===i?{x:0,y:0,O:0}:{x:t.x/i,y:t.y/i,O:i}}function Q(t,i){return k({x:i.x-t.x,y:i.y-t.y})}function X(t,i){return{x:Math.cos(t),y:Math.sin(t),O:i||1}}function Z(t){return{x:t.x*(t.O||1),y:t.y*(t.O||1)}}function z(...t){let i={x:0,y:0,O:1};for(let s of t)i.x+=s.x*(s.O||1),i.y+=s.y*(s.O||1);return i}function $(t){return{di:t.x/8|0,r:t.y/8|0}}function _(t){return{x:8*t.di,y:8*t.r}}function tt(t){return{h:t.x+e.i.h-J.kt.x,o:t.y+e.i.o-J.kt.y}}function it(t){return{x:t.h-e.i.h+J.kt.x,y:t.o-e.i.o+J.kt.y}}function st(t){return{x:t.x+4,y:t.y+4}}function ht(t,i,s){return t<i?i:t>s?s:t}function et(t,i,s,h){if(Math.max(t.x,i.x)+s<h[0].x||Math.min(t.x,i.x)-s>h[1].x||Math.max(t.y,i.y)+s<h[0].y||Math.min(t.y,i.y)-s>h[1].y)return;let e=i.x-t.x,n=i.y-t.y,r=0===e?0:1/e,o=0===n?0:1/n,f=1/0,l=1/0;if(t.x-s<h[0].x&&i.x+s>h[0].x){let i=(h[0].x-s-t.x)*r;if(i>=0&&i<=1){let s=n*i+t.y;if(s>=h[0].y&&s<=h[1].y)return{x:e*i+t.x,y:s,Ft:i,Qi:-1,Zi:0,Ls:h[0].x,gs:s}}f=h[0].x}if(t.x+s>h[1].x&&i.x-s<h[1].x){let o=(t.x-(h[1].x+s))*-r;if(o>=0&&o<=1){let s=n*o+i.y;if(s>=h[0].y&&s<=h[1].y)return{x:e*o+t.x,y:s,Ft:o,Qi:1,Zi:0,Ls:h[1].x,gs:s}}f=h[1].x}if(t.y-s<h[0].y&&i.y+s>h[0].y){let i=(h[0].y-s-t.y)*o;if(i>=0&&i<=1){let s=e*i+t.x;if(s>=h[0].x&&s<=h[1].x)return{x:s,y:n*i+t.y,Ft:i,Qi:0,Zi:-1,Ls:s,gs:h[0].y}}l=h[0].y}if(t.y+s>h[1].y&&i.y-s<h[1].y){let i=(t.y-(h[1].y+s))*-o;if(i>=0&&i<=1){let s=e*i+t.x;if(s>=h[0].x&&s<=h[1].x)return{x:s,y:n*i+t.y,Ft:i,Qi:0,Zi:1,Ls:s,gs:h[0].y}}l=h[1].y}if(f===1/0&&l===1/0)return;f!==1/0&&l===1/0&&(l=n>0?h[1].y:h[0].y),l!==1/0&&f===1/0&&(f=e>0?h[1].x:h[0].x);let u=1/s,a=Math.sqrt(e*e+n*n),c=f-t.x,A=l-t.y,M=Math.sqrt(c*c+A*A),y=Math.acos((c*e+A*n)/(a*M));if(M<s)return;if(0===y){let i=(M-s)/a;if(i>1||i<0)return;let h=i*e+t.x,r=i*n+t.y,o=c/M,u=A/M;return isNaN(h)?void 0:{x:h,y:r,Ft:i,Qi:o,Zi:u,Ls:f,gs:l}}let d=Math.sin(y),O=d*M*u;if(Math.abs(O)>1)return;let T=Math.PI-Math.asin(O),w=Math.PI-y-T,x=s*Math.sin(w)/d/a;if(x>1||x<0)return;let R=x*e+t.x,E=x*n+i.y,I=(R-f)*u,L=(E-l)*u;return isNaN(R)?void 0:{x:R,y:E,Ft:x,Qi:I,Zi:L,Ls:f,gs:l}}function nt(t,i,s){return Array.from({length:i},(()=>Array.from({length:t},s)))}function rt(t,i){let s=K._t[0].$t;return!(t<0||i<0||i>=s.length||t>=s[i].length)}function ot(t,i){let s=K._t[0].$t;return!(t<0||i<0||i>=s.length||t>=s[i].length)&&s[i][t]>=1&&s[i][t]<=4}function ft(t,i,s,h){return`rgba(${t},${i},${s},${h})`}function lt(t,i){let s=document.createElement("canvas");s.width=t,s.height=i;let h=s.getContext("2d");return{e:s,t:h}}const ut={Et:[[0,0,8,16],[8,0,8,16],[16,0,8,16],[24,0,8,16]],Ni:[[0,16,3,3]],buttons:[[0,19,12,12],[12,19,12,12],[24,19,12,12],[36,19,12,12],[48,19,12,12],[60,19,12,12],[72,19,12,12],[84,19,12,12]],cursor:[[0,31,10,8]],font:[[0,39,180,12]],ji:[[0,51,5,5]],Jt:[[0,56,5,5],[5,56,5,5],[10,56,5,5],[15,56,5,5]],Hs:[[0,61,9,9]],Ds:[[0,70,13,16]],Os:[[0,86,5,16]],Ss:[[0,102,60,18]],Bi:[[0,120,7,7],[7,120,7,7],[14,120,7,7],[21,120,7,7],[28,120,7,7],[35,120,7,7],[42,120,7,7],[49,120,7,7]],qs:[[0,127,7,9],[7,127,7,9]],mi:[[0,136,3,3],[3,136,3,3],[6,136,3,3]],os:[[0,139,8,8],[8,139,8,8]],$t:[[0,147,8,8],[8,147,8,8],[16,147,8,8],[24,147,8,8],[32,147,8,8],[40,147,8,8],[48,147,8,8],[56,147,8,8],[64,147,8,8],[72,147,8,8],[80,147,8,8],[88,147,8,8],[96,147,8,8],[104,147,8,8]],ks:[[0,155,4,4],[4,155,4,4]],Ps:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAACfCAMAAABneAP1AAAAYFBMVEUAAADuw5oAAAANK0UgPFYhIickGhQuCAFTV1JUTmhcDwBtbnN1EgCNaXqPn6iRm6ObrbemraXCHQDJAADL2/zQgVnfcSbmAADuw5ru6WTwJAD78jb/ql7/1KP/7Nb///8Vya2DAAAAAnRSTlMAlm//+0kAAAOSSURBVHja7Z2JcqQ4DIadxr0bOuvcd2z8/m+5qPlpacqhmCFcmtLnOAJx1NcaccztDMMw5qbG3CWvZ1xBIPbqjO8FJLx/6RijE7wQu24Pck5VilIac8fFJucK1iGeE8TOpbnSoesKWlYjHeLLS9RT6ZTiuc6t9f4rDVBYDVw5fVy9q7R2GomAlhOYLb8QsQbRuRRAmiu/nDOIKVxIU/Kxpc+nFgrLScd29BKpHSyHPMF5Igrp1Evz/pRbUBoKLNepkwABuXRmsKLD+f20h5AjO86L/enbctLtuMjRmNa760qjD2n0fUgjwk20R9+7SPf5sL70yIUFCThAWuQT8ttIl20wT94eLqof441TSKPRukmNRunUKJR2fx2GkQfz4+ScnaOvfrqMXB/HT4TjxXn4HN0gsDyDNCS7JawJzywyw+RiOJ4j0lPoTlNUCZW7bBuR7o/hIvB6ZmnkJpBLaXyV9cnYPrnSYv0nlc59LHq6bxNEnsiPSPO+XF3Z0+J6UUj5KTniCi7HKp+We1qKgWEx+UNSdtyMdkXPAZaVo5SGJPaV0rJ353XmezoFRlYaOuLDyYEPwcYQxrzkZibzBGyUsYTIG6VM5qrLyiLLuaVB5WWbKKdpGn3ONNRJE24NTNqt6Gy8XcKn+++kRPj0REvvJ3d6/IS0Fk404axL/F+ng+zWwKQ/MJfFyJmDYT1tt7yNCBI90rXvqBVJw5ms9Uh7xqRN2qQXx6RN2qTtMW4vTIwyaaeMunWunTJ8HWqvTtoHb9ImbdImbdJrYdL2GLcXpkA4baTJbOgcJpM2lPYT0Sxt0iZt0iZt0iZt0iY9w2ue/A2C70m7e6H+RTp9i9sfQtrtkab5s9BQ2BpIjIYGgdhNpVsGQ8Hm0gijthK3L6R0o0QalYfzYNgl4xfnlhyIPijh8PV1uL89HG7vacmkATBpiRrp+xaqNMUlpU36ljgguEWw+zRI7VBGwtfCWLH/ARUwaZM2aZM26X1R/RAHqhD8Ocq8D4Hy5wjmkfY14Ys4hO8opF+ix38yEGl20i+RnMm+6vIv80jXHUWcKh1jbCdL+26peqH8S5xZ2v+mdDcK6dhJe9CpIont3se4SaVhPdTTDHpabsf62tIlHlB7lNKcpO2+XZ9b2rM09+wY/YU3IM09jf0Wu3uMOzP9hVfF76Qj3z2wn5uDu7u7a6eNu5ubo3t+UCj9cHSquD4e9RiD/wFS6eHMqLh/ewAAAABJRU5ErkJggg=="},at={Cs(t){let i=new Image;i.onload=t,i.src=ut.Ps,at.hh=i},s(){at.font=ct(ut.font[0]),at.Ys=ct(ut.qs[0]),at.Bs=ct(ut.qs[1]),at.mi=ut.mi.map(ct),at.Jt=ut.Jt.map(ct),at.Hs=ut.Hs.map(ct),at.Us=ut.cursor.map((t=>ct(t,{x:0,y:0})))[0],at.Ni=ut.Ni.map(ct),at.Ds=ut.Ds.map(ct),at.Os=ut.Os.map(ct),at.Ss=ut.Ss.map(ct),at.Bi=ut.Bi.map((t=>ct(t,{x:-1,y:-1}))),at.$t=ut.$t.map(ct),at.os=ut.os.map(ct),at.ji=ut.ji.map(ct),at.Et=ut.Et.map((t=>ct(t,{x:0,y:8}))),at.buttons=ut.buttons.map(ct),at.Fs=At(function(t){let i=lt(544,334);for(let s=0;s<334;s+=32)for(let h=0;h<544;h+=32)i.t.drawImage(t,h,s);return i.e}(at.$t[0].xt)),at.St=At(function(){let t=lt(500,500),i=t.t.createRadialGradient(250,250,0,250,250,250);return i.addColorStop(.3,ft(0,0,0,0)),i.addColorStop(1,ft(0,0,0,.9)),t.t.fillStyle=i,t.t.fillRect(0,0,500,500),t.e}())},Vs(t,i,s,h){t.drawImage(i.xt,s-i.eh.x,h-i.eh.y)},Kt(t,i,s){let{h:h,o:n}=this.Ws(t,i);s?(e.t.save(),e.t.translate(h+t.eh.x,n+t.eh.y),e.t.rotate(s),e.t.drawImage(t.xt,-t.eh.x,-t.eh.y),e.t.restore()):e.t.drawImage(t.xt,h,n)},Ws:(t,i)=>({h:i.x-t.eh.x-J.kt.x+e.i.h,o:i.y-t.eh.y-J.kt.y+e.i.o}),ps(t){return this.$t[t+20-1]||(this.$t[t+20-1]=At(function(t,i){let s=lt(8,8);return 256&i&&s.t.drawImage(t[12].xt,0,0,4,4,0,0,4,4),64&i&&s.t.drawImage(t[12].xt,5,0,3,3,5,0,3,3),1&i&&s.t.drawImage(t[12].xt,6,6,2,2,6,6,2,2),4&i&&s.t.drawImage(t[12].xt,0,5,3,3,0,5,3,3),8&i&&s.t.drawImage(t[11].xt,5,0,3,8,5,0,3,8),32&i&&s.t.drawImage(t[9].xt,0,0,4,8,0,0,4,8),2&i&&s.t.drawImage(t[8].xt,0,5,8,3,0,5,8,3),128&i&&s.t.drawImage(t[10].xt,0,0,8,4,0,0,8,4),160==(160&i)&&s.t.drawImage(t[13].xt,0,0,5,5,0,0,5,5),136==(136&i)&&s.t.drawImage(t[13].xt,4,0,4,4,4,0,4,4),10==(10&i)&&s.t.drawImage(t[13].xt,4,4,4,4,4,4,4,4),34==(34&i)&&s.t.drawImage(t[13].xt,0,4,5,4,0,4,5,4),s.e}(this.$t,t),{x:0,y:0})),this.$t[t+20-1]}};function ct(t,i){return At(function(t,i,s,h){const e=at.hh,n=lt(s,h);return n.t.drawImage(e,t,i,s,h,0,0,s,h),n.e}(...t),i)}function At(t,i){let s=t.width,h=t.height;return{xt:t,eh:"object"==typeof i?i:{x:s/2|0,y:h/2|0}}}class Mt{constructor(){this.frames=0}b(){return this.frames++,O.is[O.A.ut]&&this.frames>30&&yt.E(),!0}jt(){e.t.fillStyle=ft(36,26,20,ht(this.frames/200,0,1)),e.t.fillRect(0,0,e.width,e.height);let t=e.width-32,i="DEFEAT... \n                    \nYOUR LAST MOTH GONE, THIS WORLD SLIPS FROM YOUR GRASP. YOU CURSE THE VILLAGE AND ITS INHABITANTS AS YOU TUMBLE TOWARDS THAT BLEAK BEYOND. \n \nYOUR REIGN OF TERROR HAS ENDED. \n \nTAP TO TRY AGAIN!";i=i.slice(0,this.frames),x.bt(e.t,i,16,16,t,1,1,x.Ut)}}const yt=new class{s(){at.Cs((()=>{e.s(),at.s(),x.s(),O.s(),M.s(),V.s(),J.s(),K.s(),window.addEventListener("blur",(()=>this.mt())),window.addEventListener("focus",(()=>this.pt())),this.E(),this.start()}))}E(){this.ms=[],this.Gs={},this.js={},this.Ks={},this.Js=0,this.Xs=[],this.ss=[],this.Qs=0,this.Ei=250,this.Zs=0,this.ms.push(new U(_(K.hi))),this.screen=void 0,this.hs=void 0,K.E(),J.kt=st(_(K.ls)),J.Ns=st(_(K.hi))}start(){this.as=0,this.zs=[0],this.b(),window.requestAnimationFrame((t=>this._s(t)))}_s(t){let i=(new Date).getTime();this.zs.length>=40&&this.zs.shift(),this.$s=1e3/((this.zs[this.zs.length-1]-this.zs[0])/this.zs.length),this.as++,e.w(),this.b(),this.jt(e.t),window.requestAnimationFrame((t=>this._s(t)));let s=(new Date).getTime();this.zs.push(this.zs[this.zs.length-1]+s-i)}b(){if(this.hs||(this.hs=new Y(this.Qs++)),O.b(),!(this.screen&&this.screen.b()||(O.is[O.A.ut]&&this.qi(O.st),V.b(),this.nh))){M.b(),this.hs.b(),this.th(),console.log(yt.ms);for(let t of yt.ms)t.Wt&&t.Wt();C.Ki(this.ms),W.Ki(this.ms),J.b(),this.ms=this.ms.filter((t=>!t.Gt)),K.Et=K.Et.filter((t=>!t.Gt)),this.Xs=this.Xs.filter((t=>t.b())),K.b(),0===this.ms.filter((t=>t instanceof U)).length&&(yt.screen=new Mt),yt.as%6==0&&(this.Js=10*Math.random()|0),30===yt.as&&yt.Xs.push(new I(20,20,20)),O.is[O.A.rt]&&!yt.ih&&(yt.ih=!0)}}jt(){e.t.setTransform(1,0,0,1,0,0),e.t.scale(e.scale,e.scale),e.t.fillStyle=ft(36,26,20,1),e.t.fillRect(0,0,e.width,e.height),K.jt();for(let t of this.ms)(!t.z||t.z<100)&&t.jt();for(let t of this.ms)t.z&&t.z>100&&t.jt();K.es(),V.jt(),yt.as<120&&(e.t.fillStyle=ft(0,0,0,1-yt.as/120),e.l()),this.screen&&this.screen.jt()}mt(){this.nh||(this.nh=!0,M.mt())}pt(){this.nh&&(this.nh=!1,M.pt())}qi(t){for(let i of[V,K])if(i.qi(t))break}Vi(){return this.ms.filter((t=>t instanceof U)).length}Di(t){if(this.Ei>=t)return!0}ki(t){this.Ei-=t}th(){let t=this.ss[0];if(t)for(let i=0;i<10;i++){let i=Math.floor(Math.random()*K._t[0].$t[0].length),s=Math.floor(Math.random()*K._t[0].$t.length);if(1!==K.$t[s][i])continue;if(0!==K.ns[s][i])continue;let h=_({di:i,r:s});console.log("NEW monster"+h.x+","+h.y+","+K.ns[s][i]),yt.ms.push(new t(h)),this.ss.shift();break}}};yt.s()}();
//# sourceMappingURL=app.js.map</script>
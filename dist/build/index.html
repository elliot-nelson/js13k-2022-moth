<style>body,html{margin:0;padding:0;background-color:#000}div{position:absolute;top:0;bottom:0;left:0;right:0}#canvas{width:100%;height:100%;touch-action:none}</style><div><canvas id="canvas"></canvas></div><script>!function(){"use strict";const t=["CAVE FLOOR","CAVE FLOOR","CAVE FLOOR","","","","DOOM PIT","DOOM PIT"],i=45*Math.PI/180,s=90*Math.PI/180,h=360*Math.PI/180,e={s(){e.e=document.getElementById("canvas"),e.t=e.e.getContext("2d"),e.n(!0)},n(t){let i=window.devicePixelRatio,s=e.e.clientWidth,h=e.e.clientHeight,n=s*i,r=h*i;(t||e.e.width!==n||e.e.height!==r)&&(e.e.width=n,e.e.height=r,e.scale=(10*Math.max(n/240,r/135)|0)/10,e.width=Math.ceil(n/e.scale),e.height=Math.ceil(r/e.scale),e.i={h:e.width/2|0,o:e.height/2|0},e.clientWidth=s,e.clientHeight=h,e.t.imageSmoothingEnabled=!1),e.e.style.cursor="none"},l(){e.t.fillRect(0,0,e.width,e.height)}},n={s(){n.map={KeyW:M.A.u,KeyA:M.A.T,KeyS:M.A.M,KeyD:M.A.O,ArrowUp:M.A.u,ArrowLeft:M.A.T,ArrowDown:M.A.M,ArrowRight:M.A.O,Escape:M.A.m},n.p=[{x:0,y:0,R:0},{x:0,y:-s,R:1},{x:0,y:s,R:1},{x:0,y:0,R:0},{x:-s,y:0,R:1},{x:-i,y:-i,R:1},{x:-i,y:i,R:1},{x:-s,y:0,R:1},{x:s,y:0,R:1},{x:i,y:-i,R:1},{x:i,y:i,R:1},{x:s,y:0,R:1},{x:0,y:0,R:0},{x:0,y:-s,R:1},{x:0,y:s,R:1},{x:0,y:0,R:0}],n.S=[],window.addEventListener("keydown",(t=>{let i=n.map[t.code];i&&(n.S[i]=!0)})),window.addEventListener("keyup",(t=>{let i=n.map[t.code];i&&(n.S[i]=!1)})),n.c()},E(){let t=(n.S[M.A.u]?1:0)+(n.S[M.A.M]?2:0)+(n.S[M.A.T]?4:0)+(n.S[M.A.O]?8:0);n.w=n.p[t]},c(){n.w=n.p[0];for(let t of Object.values(M.A))n.S[t]=!1}},r=(t=1,i=.05,s=220,h=0,e=0,n=.1,r=0,f=1,u=0,a=0,c=0,A=0,M=0,y=0,E=0,T=0,R=0,x=1,d=0,O=0)=>{let w,N,I=2*Math.PI,U=u*=500*I/l**2,S=(0<E?1:-1)*I/4,H=s*=(1+2*i*Math.random()-i)*I/l,D=[],L=0,m=0,v=0,p=1,b=0,B=0,g=0;for(a*=500*I/l**3,E*=I/l,c*=I/l,A*=l,M=l*M|0,N=(h=99+l*h)+(d*=l)+(e*=l)+(n*=l)+(R*=l)|0;v<N;D[v++]=g)++B%(100*T|0)||(g=r?1<r?2<r?3<r?Math.sin((L%I)**3):Math.max(Math.min(Math.tan(L),1),-1):1-(2*L/I%2+2)%2:1-4*Math.abs(Math.round(L/I)-L/I):Math.sin(L),g=(M?1-O+O*Math.sin(2*Math.PI*v/M):1)*(0<g?1:-1)*Math.abs(g)**f*t*o*(v<h?v/h:v<h+d?1-(v-h)/d*(1-x):v<h+d+e?x:v<N-R?(N-v-R)/n*x:0),g=R?g/2+(R>v?0:(v<N-R?1:(N-v)/R)*D[v-R|0]/2):g),w=(s+=u+=a)*Math.sin(m*E-S),L+=w-w*y*(1-1e9*(Math.sin(v)+1)%2),m+=w-w*y*(1-1e9*(Math.sin(v)**2+1)%2),p&&++p>A&&(s+=c,H+=c,p=0),!M||++b%M||(s=H,u=U,p=p||1);return D},o=.3,l=44100,f=new(top.AudioContext||webkitAudioContext);f.destination;const u=[[[1.3,0,23,,,.2,3,5],[1.5,0,4e3,,,.03,2,1.25,,,,,.02,6.8,-.3,,.5],[.7,0,2100,,,.2,3,3,,,-400,,,2],[,0,655,,,.11,2,1.65,,,,,,3.8,-.1,.1]],[[[,-.5,13,,,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,14,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,14,,,,],[1,.3,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,],[2,1,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,],[,.6,,,,,13,,18,,19,,,,,,,,19,,18,,,,16,,,,13,,,,,,,,,,13,,18,,19,,,,,,,,18,19,18,,,,13,14,13,,16,,18,,19,,],[3,-1,,,13,,,,,,,,,,,,13,,,,,,,,,,,,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,,,13,13,13,13]],[[,-.5,13,,,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,14,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,14,,,,],[1,.3,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,],[2,1,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,]]],[1,1,0,0,0,0,1,0],,],a={s(){a.U=!1,a.t=f,a.I=a.t.createGain(),a.I.connect(a.t.destination),a.v=[,.01,140,.01,.02,.45,4,2.42,.1,-.1,,,,1.2,,.3,.04,.8,.02],a.b=[,,1233,,.01,.2,1,1.43,,,539,.1,,,,,,.51,.03,.01],a.N=[,,68,.01,,.14,1,1.53,7.5,.1,50,.02,-.01,-.2,.1,.2,,.47,.01],a.H=[,,391,,.19,.01,2,.54,-4,20,,,,,,,.02,.9],a.D=[,,970,.12,.25,.35,,.39,8.1,,10,.1,.2,,.1,,,.6,.09,.13],a.L=[,,454,.06,.86,.71,2,.63,-.7,1.7,-83,.09,.27,.3,.2,,.18,.95,.02,.02],a.g=((t,i,s,h=125)=>{let e,n,o,f,u,a,c,A,M,y,E,T,R,x,d,O=[],w=[],N=[],I=0,U=1,S={},H=l/h*60>>2;for(;U;I++)O=[U=A=T=0],s.map(((h,l)=>{for(c=i[h][I]||[0,0,0],U|=!!i[h][I],x=T+(i[h][0].length-2-!A)*H,n=2,f=T;n<c.length+(l==s.length-1);A=++n){for(u=c[n],M=y!=(c[0]||0)|u|0,o=0;o<H&&A;o++>H-99&&M?E+=(E<1)/99:0)a=(1-E)*O[R++]/2||0,w[f]=(w[f]||0)+a*d-a,N[f]=(N[f++]||0)+a*d+a;u&&(E=u%1,d=c[1]||0,(u|=0)&&(O=S[[y=c[R=0]||0,u]]=S[[y,u]]||(e=[...t[y]],e[2]*=2**((u-12)/12),r(...e))))}T=x}));return[w,N]})(...u),localStorage.k=JSON.stringify(u)},E(){},Q(t){},at(){},mt(){}},c={s(){this.map=[],this.map[0]=M.A.q,this.map[2]=M.A.V,this.S=[],window.addEventListener("mousemove",(t=>{this.P||(this.P={}),this.P.h=t.clientX*e.width/e.clientWidth|0,this.P.o=t.clientY*e.height/e.clientHeight|0,M.mode=2})),window.addEventListener("mouseout",(()=>{this.P=void 0})),window.addEventListener("mousedown",(t=>{let i=this.map[t.button];i&&(this.S[i]=!0),a.U=!0,At.B="mousedown",M.mode=2,this.C={h:t.clientX*e.width/e.clientWidth|0,o:t.clientY*e.height/e.clientHeight|0}})),window.addEventListener("mouseup",(t=>{let i=this.map[t.button];i&&(this.S[i]=!1),At.B="mouseup",M.mode=2})),window.addEventListener("click",(t=>{t.preventDefault(),At.B="click"})),window.addEventListener("contextmenu",(t=>{let i=this.map[t.button];i&&(this.S[i]=!0),this.W=2,t.preventDefault()})),c.c()},E(){this.W&&(this.W--,0===this.W&&(this.S[M.A.V]=!1))},c(){this.P=void 0;for(let t of Object.values(M.A))this.S[t]=!1}},A={s(){this.map=[],this.map[0]=M.A.q,this.S=[],window.addEventListener("touchmove",(t=>{this.P||(this.P={});let i=t.changedTouches[0];this.P.h=i.clientX*e.width/e.clientWidth|0,this.P.o=i.clientY*e.height/e.clientHeight|0,M.mode=1})),window.addEventListener("touchstart",(t=>{let i=this.map[0];i&&(this.S[i]=!0),a.U=!0,At.B="TOUCHSTART",M.mode=1;let s=t.changedTouches[0];this.C={h:s.clientX*e.width/e.clientWidth|0,o:s.clientY*e.height/e.clientHeight|0},this.P={...this.C}})),window.addEventListener("touchend",(t=>{let i=this.map[0];i&&(this.S[i]=!1),At.B="TOUCHEND",M.mode=1})),this.c()},E(){},c(){this.P=void 0;for(let t of Object.values(M.A))this.S[t]=!1}},M={A:{u:11,M:12,T:13,O:14,F:21,V:30,m:96,Y:97,j:98,q:40,G:41,J:42},s(){this.w={x:0,y:0,R:0},this.pt={},this.K={},this.S={},this.Z={},n.s(),c.s(),A.s(),this.mode=1,this.X=!1},E(){n.E();let t=2===this.mode?c:A;for(let i of Object.values(M.A)){let s=t.S[i]||n.S[i];this.pt[i]=!this.S[i]&&s,this.K[i]=this.S[i]&&!s,this.pt[i]?this.Z[i]=1:this.S[i]&&s&&this.Z[i]++,this.S[i]=s}this.P=t.P,this.w=n.w,this.S[M.A.q]&&(this.Z[M.A.q]>20&&(this.X=!0),Math.abs(t.C.h-t.P.h)+Math.abs(t.C.o-t.P.o)>5&&(this.X=!0)),this.X&&t.P&&(this._={x:t.P.h-t.C.h,y:t.P.o-t.C.o}),this.K[M.A.q]&&(this.X?this.X=!1:(this.pt[M.A.J]=!0,this.Z[M.A.J]=1))},$(t){},tt(t){}},y={10:0,32:3,33:3,39:2,44:3,46:3,73:2},E={},T={s(){T.it=lt.font.st;let t=[[101,lt.ht[2]]];for(let i of t)E[i[0]]=i[1],y[i[0]]=i[1].st.width+1;T.et=R(T.it,nt(0,0,0,1)),T.nt=R(T.it,nt(90,20,90,.15)),T.blue=R(T.it,nt(200,40,220,1)),T.rt=R(T.it,nt(240,50,200,.2)),T.ot=R(T.it,nt(240,240,255,.25)),T.red=R(T.it,nt(240,50,50,1)),T.lt=x(T.it,"#ffaa5e","#ffd4a3"),T.ft=x(T.it,"#ffaa5e","#ffd4a3",nt(255,0,0,.7))},ut(t,i,s,h,e=1,n=T.lt,r){for(let o=0;o<i.length;o++){let l=i.charCodeAt(o);if(119!==l)if(114!==l){if(E[l])t.drawImage(E[l].st,s,h-(E[l].st.height+4)/2);else{let i=4*(l-32);r&&t.drawImage(r,i%180,6*(i/180|0),3,5,s+1,h+1,3*e,5*e),t.drawImage(n,i%180,6*(i/180|0),3,5,s,h,3*e,5*e)}s+=(y[l]||4)*e}else n=T.ft;else n=T.lt}},ct(t,i,s,h,e,n,r=1,o=T.lt,l){let f=s,u=h,a=i.split(" ");for(let i of a){for(;"\n"===i[0];)i=i.slice(1),f=s,u+=6*r;let h=T.dt(i,r);f+h-s>e&&(f=s,u+=6*r),T.ut(t,i,f,u,r,o,l),f+=h+(y[32]||4)}},dt:(t,i)=>t.split("").reduce(((t,i)=>t+(y[i.charCodeAt(0)]||4)),0)*i};function R(t,i){let s=rt(t.width,t.height);return s.t.fillStyle=i,s.t.fillRect(0,0,t.width,t.height),s.t.globalCompositeOperation="destination-in",s.t.drawImage(t,0,0),s.e}function x(t,i,s,h){let e=rt(t.width,t.height);return e.t.fillStyle=s,e.t.fillRect(0,0,t.width,t.height),e.t.fillStyle=i,e.t.fillRect(0,0,t.width,1),e.t.fillRect(0,6,t.width,1),h&&(e.t.fillStyle=h,e.t.fillRect(0,0,t.width,t.height)),e.t.globalCompositeOperation="destination-in",e.t.drawImage(t,0,0),e.e}class d{constructor(t,i,s){this.frames=t,this.At=i,this.yt=s,this.Tt=[],this.xt=[];var h=t/2;for(let t=0;t<h;t++)this.Tt.push(2*Math.random()-1),this.xt.push(2*Math.random()-1);this.is=-1}E(){if(this.is++,this.is>=this.frames)return!1;let t=this.is/2,i=0|t,s=i+1,h=1-this.is/this.frames;return this.x=this.At*h*(this.Tt[i]+(t-i)*(this.Tt[s]-this.Tt[i])),this.y=this.yt*h*(this.xt[i]+(t-i)*(this.xt[s]-this.xt[i])),!0}}class O{constructor(t,s,h){this.Et={...t},this.angle=s,this.wt=K(q(this.angle,h?8:5)),this.a=i,this.Mt=!0,this.f=h,this.Ot=!0,this.Rt=1,this.r=0,this.St=-1,this.d=0===this.f?45:70,this.Ut=!0}It(){++this.St===this.d&&(this.vt=!0),this.wt.x*=.9,this.wt.y*=.9,this.a*=.95,this.r+=this.a}Nt(){lt.Ht(lt.Dt[this.f],this.Et,this.r)}}O.H=t=>O.Lt(t,8,(()=>0)),O.gt=t=>O.Lt(t,16,(()=>4*Math.random()|0)),O.Lt=(t,e,n)=>{let r=t.bt?function(t){let i=Math.atan2(t.y,t.x);return i<0&&(i+=h),i}(t.bt.kt):Math.random()*h;for(let o=0;o<e*(At.L?2:1);o++){let e=Math.random()*t.Rt,o=X(t.Et,q(Math.random()*h,e));At.as.push(new O(o,r+Math.random()*s-i,n()))}};const w={qt:[{name:"1F",Vt:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,14,14,0,0,0,0,0,0,0,0,14,14,14,14,14,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,1,1,1,1,14,14,14,0,0,0,0,0,14,14,1,1,1,14,14,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,1,1,1,1,1,1,1,1,14,14,0,0,14,14,14,3,1,1,1,1,14,14,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,1,1,1,1,1,1,7,7,1,1,1,1,14,14,14,14,1,1,1,1,1,1,1,1,14,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,1,1,1,1,1,1,1,1,7,8,8,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,14,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,1,1,1,1,1,1,1,1,1,8,8,1,1,1,1,3,1,1,1,1,1,1,1,1,1,1,14,14,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,14,14,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,1,1,1,14,14,14,0,0],[0,0,0,0,0,0,0,14,14,14,14,14,14,14,1,1,1,14,14,14,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,14,14,0,0,0,0],[0,0,0,0,0,0,14,14,3,1,1,1,1,1,1,1,1,1,14,14,14,1,1,1,1,1,1,1,1,14,14,14,14,1,1,1,1,1,1,1,1,14,14,14,14,0],[0,0,0,0,0,14,14,1,1,1,1,2,1,1,1,7,1,1,1,14,14,14,1,1,1,1,14,14,14,14,14,1,14,14,2,1,3,1,1,1,1,1,1,1,14,14],[0,0,0,0,0,14,1,1,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,14,1,1,1,1,14,3,1,1,1,1,1,14],[0,0,0,0,0,14,1,7,8,1,1,14,14,14,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,7,1,14,1,1,1,1,14,14,1,1,1,1,3,14],[0,0,0,0,0,14,1,1,1,1,14,14,0,14,14,1,1,1,2,1,1,1,1,1,1,1,1,1,1,7,1,1,1,14,1,7,1,14,14,14,1,1,1,1,1,14],[0,0,0,0,0,14,14,1,2,14,14,0,0,14,14,1,1,1,1,1,14,14,14,14,1,1,2,1,1,1,1,1,14,14,1,8,1,14,0,14,14,1,1,2,14,14],[0,0,0,0,0,0,14,14,14,14,0,0,14,14,1,1,1,3,1,14,14,0,0,14,14,1,1,1,1,1,1,14,14,14,1,8,1,14,0,0,14,14,14,14,14,0],[0,0,0,0,0,0,0,0,0,0,0,0,14,1,1,7,1,1,1,14,0,0,0,0,14,14,1,1,1,1,2,14,14,14,1,8,1,14,14,0,0,0,0,0,0,0],[0,0,0,14,14,14,14,14,14,14,14,14,14,1,1,1,1,14,14,14,0,0,0,0,0,14,1,1,1,1,1,1,14,1,1,1,1,2,14,0,0,0,0,0,0,0],[0,14,14,14,1,1,1,1,1,14,14,14,14,1,1,1,1,14,0,0,0,0,0,0,0,14,14,1,1,1,1,1,14,1,1,1,1,1,14,14,0,0,0,0,0,0],[0,14,1,1,1,1,1,1,1,2,14,14,14,1,1,1,1,14,14,0,0,0,0,0,0,0,14,1,1,1,1,1,14,14,14,1,1,1,1,14,0,0,0,0,0,0],[14,14,1,1,1,1,1,1,1,1,14,14,14,1,1,1,1,1,14,14,0,0,0,0,0,0,14,1,1,1,1,1,1,1,14,14,1,1,1,14,0,0,0,0,0,0],[14,1,1,1,1,14,1,1,1,1,1,14,14,14,1,1,2,1,14,14,0,0,0,0,0,0,14,1,2,1,1,7,1,1,1,14,1,7,1,14,14,14,14,14,0,0],[14,1,7,1,1,14,14,1,1,1,1,14,14,14,14,1,1,1,14,14,0,0,0,0,0,0,14,14,1,1,1,8,7,1,1,14,1,1,1,14,14,1,1,14,14,0],[14,1,1,1,1,14,14,1,1,1,1,1,14,14,14,1,1,1,1,14,0,0,0,0,0,0,0,14,14,1,1,1,1,1,1,14,14,1,1,1,1,1,1,1,14,0],[14,14,1,1,1,14,14,1,1,1,1,1,1,14,14,1,1,7,1,14,0,0,0,0,0,0,0,0,14,14,1,1,3,1,14,14,1,1,1,1,1,1,1,1,14,0],[0,14,1,1,1,14,14,14,1,1,1,1,1,14,14,1,1,8,1,14,0,0,0,0,0,0,0,0,0,14,14,14,14,14,14,1,1,1,3,1,1,1,1,1,14,0],[0,14,1,1,1,1,14,14,14,1,1,1,14,14,14,1,1,1,1,14,0,0,0,0,0,0,0,0,0,0,0,14,14,1,1,1,1,14,14,14,1,1,1,14,14,0],[0,14,1,1,1,1,2,14,14,14,14,14,14,14,1,1,1,1,14,14,0,0,0,0,0,0,0,0,0,0,14,14,1,1,1,2,1,14,0,14,14,14,14,14,0,0],[0,14,14,1,1,1,1,1,14,14,14,14,14,2,1,1,1,14,14,0,0,0,0,0,0,0,0,0,0,0,14,1,3,1,14,14,14,14,0,0,0,0,0,0,0,0],[0,0,14,14,1,1,1,1,1,1,1,1,1,1,1,3,1,14,0,0,0,0,0,0,0,0,0,0,0,0,14,1,1,14,14,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,14,14,1,1,1,1,1,1,7,1,1,1,1,14,14,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,14,14,14,1,3,1,1,1,1,1,1,14,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,14,14,14,14,14,14,14,14,14,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],Pt:[],Bt:[{name:"SPAWN",x:42,y:11},{name:"EARTH",x:20,y:3},{name:"EXIT",x:10,y:24},{name:"EARTH",x:41,y:25},{name:"EARTH",x:43,y:22},{name:"EARTH",x:33,y:17},{name:"EARTH",x:40,y:6},{name:"EARTH",x:36,y:3},{name:"EARTH",x:14,y:7},{name:"EARTH",x:31,y:13},{name:"EARTH",x:7,y:13}],Ct:[],id:0}],bounds:[[0,0],[46,32]],Wt:[42,11,0]};class N{constructor(t){this.Et={...t},this.target={...this.Et},this.wt={x:0,y:0},this.Ft=1,this.H=[],this.Rt=3,this.ms=2,this.Mt=!0,this.Ut=!0,this.Yt=7,this.jt=[],this.Gt=0,this.offset={x:0,y:0},this.Jt=0,this.Kt=500,this.Zt=3,this.Xt=0,this.is=0,this.zt=Math.floor(16*Math.random()),this.Qt=At.is;let i=Z(this.Et);this.moveTo({_t:i._t,r:i.r-1})}It(){0===this.jt.length&&this.jt.push({$t:2});let t=this.jt[this.jt.length-1];if(this.is=Math.floor(At.is/8)%2+1,9===this.ms)return void(this.vt=!0);if(3===t.$t)this.target=$(z(t.ti)),J(this.Et,this.target).R<6&&this.jt.pop();else if(6===t.$t){if(this.target=$(z(t.ti)),J(this.Et,this.target).R<6){this.is=0;let i=P.ii(t.ti);i.si++,i.si>=i.hi&&this.jt.pop()}}else if(4===t.$t){this.target=$(z(t.ti));let i=J(this.Et,this.target),s=P.ii(t.ti);s?i.R<6&&(this.is=0,this.Jt+=this.Zt,s.ei-=this.Zt,this.Jt>=this.Kt&&this.jt.push({$t:5,ti:{_t:P.Wt._t,r:P.Wt.r}})):(this.jt.pop(),this.jt.push({$t:5,ti:{_t:P.Wt._t,r:P.Wt.r}}))}else 5===t.$t&&(this.target=$(z(t.ti)),J(this.Et,this.target).R<6&&(this.is=0,this.Jt-=this.Zt,this.Xt+=this.Zt,this.Xt>=100&&(At.ni++,this.Xt-=100),this.Jt<=0&&this.jt.pop()));let i=P.ri(this.Et,this.target);console.log([this.target,i]);let s=J(this.Et,i);s.R=tt(s.R,0,.5);let h=K(s);this.wt={x:(this.wt.x+h.x)/2,y:(this.wt.y+h.y)/2}}Nt(){let t=3;0===this.is&&t--;let i=Math.cos((At.is+this.zt)/16)*t,s=1*Math.sin((At.is+this.zt)/16);lt.Ht(lt.oi[this.is],{x:this.Et.x+i,y:this.Et.y+s})}li(t){this.jt=[{$t:4,ti:t}],this.Qt=At.is}construct(t){this.jt.push({$t:6,ti:t}),this.Qt=At.is}moveTo(t){this.jt=[{$t:3,ti:t}],this.Qt=At.is}ai(){let t=this.jt[this.jt.length-1];return t&&2!==t.$t}}N.fi=()=>{let t=At.as.filter((t=>t instanceof N));return t.sort(((t,i)=>t.ai()&&!i.ai()?1:!t.ai()&&i.ai()?-1:t.Qt-i.Qt)),t},N.assign=t=>{let i=N.fi();for(let s=0;s<i.length&&!(s>0&&i[s].ai());s++)t(i[s])};class I{constructor(t,i,s){this.Et={...t},this.target=i,this.wt={x:0,y:0},this.H=s||70}It(){let t=J(this.Et,this.target.Et);t.R=tt(t.R,0,2),this.wt={x:(this.wt.x+t.x*t.R)/2,y:(this.wt.y+t.y*t.R)/2},t.R<1&&(this.target.H.push({ui:this.H,kt:t,ci:0}),this.vt=!0,console.log("HIT"))}Nt(){lt.Ht(lt.di[0],this.Et,this.r)}}const U={Ai:()=>!!P.ii(P.selected),yi:()=>lt.buttons[6],Ti:()=>lt.buttons[7],xi(t,i){let s=P.ii(P.selected),h=At.Ei(15)?"BUILD TOWER \ne15":"BUILD TOWER \ner15";s&&(h="FINISH BUILDING"),T.ct(e.t,h,t,i)},wi(){if(P.ii(P.selected))N.assign((t=>t.construct(P.selected)));else if(At.Ei(15))return At.Mi(15),P.ht.push(new S(P.selected)),N.assign((t=>t.construct(P.selected))),!0}};class S{constructor(t){this.ti={...t},this.Oi=10,this.Yt=7,this.ms=21,this.si=0,this.hi=180,this.title="TOWER",this.mi=lt.ht[0]}It(){this.si>=this.hi&&(this.ms=22);let t,i,s=$(z(this.ti));if(!this.target||this.target.vt){for(let h of At.as){if(!h.pi)continue;let e=J(s,h.Et);e.R<32&&(!i||e.R<i.R)&&(t=h,i=e)}console.log("ATTEMPTED to pick target for building",t),this.target=t}this.Oi>0&&this.Oi--,this.target&&0===this.Oi&&(J(s,this.target),At.as.push(new I(s,this.target)),this.Oi=100)}Nt(){let t=z(this.ti);if(Q($(t)),e.t.globalAlpha=21===this.ms?.5:1,lt.Ht(lt.ht[0],t),e.t.globalAlpha=1,21===this.ms){let i=tt(Math.floor(8*this.si/this.hi),0,7);e.t.globalAlpha=.5,lt.Ht(lt.Ri[7],t),e.t.globalAlpha=1,lt.Ht(lt.Ri[i],t)}}Si(){return this.si<this.hi?[U]:[]}}const H=[0,2];for(let t=2;t<=19;t++)H[t]=Math.floor(1.5*H[t-1]+1);for(let t=0;t<20;t++)H[t]=5*H[t];const D={Ai:()=>!1,yi:()=>lt.buttons[0],Ti:()=>lt.buttons[1],xi(t,i){let s=H[At.Ui()],h=At.Ei(s)?"LURE MOTH \ne"+s:"LURE MOTH \ner"+s;T.ct(e.t,h,t,i)},wi(){let t=H[At.Ui()];if(At.Ei(t))return At.Mi(t),At.as.push(new N($(z(P.selected)))),!0}};class L{constructor(t){this.ti={...t},this.title="YOUR COFFIN \nLAST CHANCE",this.mi=lt.ht[1],this.Yt=9}It(){}Nt(){let t=z(this.ti);lt.Ht(lt.ht[1],t)}Si(){return[D]}}class m{constructor(t){this.Et={...t},this.Ft=100,this.H=[],this.wt={x:0,y:0},this.Rt=2,this.Ii=.2,this.vi=0,this.ms=11,this.pi=!0}It(){let t=At.as.filter((t=>t instanceof N)),i=t[0];if(console.log(t.map((t=>t.Et))),!i)return;let s=J(this.Et,i.Et);for(let h=1;h<t.length;h++){let e=J(this.Et,t[h].Et);e.R<s.R&&(i=t[h],s=e)}const h=P.ri(this.Et,i.Et);let e=J(this.Et,h);11===this.ms?s.R<8?(console.log("KILL"),i.H.push({ui:10,kt:e,ci:0}),this.vt=!0):(e.R=tt(e.R,0,.4),this.wt={x:(this.wt.x+e.x*e.R)/2,y:(this.wt.y+e.y*e.R)/2}):9===this.ms&&(this.vt=!0,O.gt(this))}Nt(){let t=lt.Ni[0];lt.Ht(t,this.Et)}}const v={Ai:()=>!0,yi:()=>lt.buttons[2],Ti:()=>lt.buttons[3],xi(t,i){T.ct(e.t,"GATHER EARTH",t,i)},wi:()=>(N.assign((t=>t.li(P.selected))),!0)};class p{constructor(t){this.ti={...t},this.ei=1e4,this.title="EARTH",this.mi=lt.ht[2]}It(){this.title="EARTH \n"+Math.ceil(this.ei/100)+" REMAINING",this.ei<1&&(this.vt=!0)}Nt(){let t=z(this.ti);lt.Ht(lt.ht[2],t)}Si(){return[v]}}const b={Ai:()=>!0,yi:()=>lt.buttons[4],Ti:()=>lt.buttons[5],xi(t,i){T.ct(e.t,"EXPLORE",t,i)},wi:()=>(N.assign((t=>t.moveTo(P.selected))),!0)},B={Hi(t){let i=t.filter((t=>t.Et&&t.wt&&!t.vt));for(let t=0;t<5;t++){for(let t=0;t<i.length-1;t++)for(let s=t+1;s<i.length;s++)B.Di(i[t],i[s]);for(let t of i)B.Li(t)}for(let t of i)t.Et.x+=t.wt.x,t.Et.y+=t.wt.y},Di(t,i){if(t.Mt||i.Mt)return;let s=function(t,i,s,h,e,n){[s,n]=[K(s),K(n)];let r=J({x:t.x+s.x,y:t.y+s.y},{x:h.x+n.x,y:h.y+n.y});if(r.R<i+e)return{gi:r.x,bi:r.y,R:i+e-r.R}}(t.Et,t.Rt,t.wt,i.Et,i.Rt,i.wt);if(s)if(t.Ot&&i.Ot)t.wt.x=-s.gi*s.R,t.wt.y=-s.bi*s.R,i.wt.x=s.gi*s.R,i.wt.y=s.bi*s.R;else{let h=G(t.wt).R+i.Ii,e=G(i.wt).R+t.Ii,n=t.Ot?.1:1,r=i.Ot?.1:1;t.wt.x-=s.gi*s.R*n*h/(h+e),t.wt.y-=s.bi*s.R*n*h/(h+e),i.wt.x+=s.gi*s.R*r*e/(h+e),i.wt.y+=s.bi*s.R*r*e/(h+e)}},Li(t){if(!t.Ut){t.Et.y<-1e3&&console.log("FUUUUUUUUUUUUUUUU");for(let i of function*(t,i,s){yield*function*(t,i,s){let h=[{x:Math.min(t.x,i.x)-s,y:Math.min(t.y,i.y)-s},{x:Math.max(t.x,i.x)+s,y:Math.max(t.y,i.y)+s}];yield*function*(t){for(let i=t[0].y/8|0;8*i<t[1].y;i++)for(let s=t[0].x/8|0;8*s<t[1].x;s++)yield{_t:s,r:i}}(h)}(t,{x:t.x+i.x,y:t.y+i.y},s)}(t.Et,t.wt,t.Rt))if(!et(i._t,i.r)){let s=[z(i),z({_t:i._t+1,r:i.r+1})],h=it(t.Et,{x:t.Et.x+t.wt.x,y:t.Et.y+t.wt.y},t.Rt,s);h&&(t.Ot?0===h.gi?t.wt.y=-t.wt.y:0===h.bi?t.wt.x=-t.wt.x:(t.wt.x+=h.gi,t.wt.y+=h.bi):0===h.gi?t.wt.y=h.y-t.Et.y:0===h.bi?t.wt.x=h.x-t.Et.x:(t.wt.x+=h.gi,t.wt.y+=h.bi))}}}},g={Hi(t){for(let i of t)if(i.Ft){if(i.H.length>0){if(9!==i.ms&&1!==i.ms)for(let t of i.H)i===At.ki&&At.as.push(new HealthChunkAnimation(i.Ft,t.ui)),i.Ft-=t.ui,t.kt.R=t.ci,i.wt=X(i.wt,t.kt),i.bt=t,O.H(i);i.H=[]}i.Ft<=0&&9!==i.ms&&(i.ms=9)}}},V=[[[0,1],[5,1],[10,1],[15,1],[20,1],[21,1],[22,1]]];class Y{constructor(t){t%=V.length,this.qi=[...V[t]],this.Vi=2700,this.Pi=!1,this.is=0,this.Bi=60*this.qi[this.qi.length-1][0]}E(){if(this.Vi--,this.Vi<=0){this.Pi=!0;for(let t=0;t<this.qi.length;t++)this.is===60*this.qi[t][0]&&At.Ci.push(m);this.is++}this.is>=this.Bi&&(At.Wi=void 0)}}class C{constructor(){this.frames=0}E(){this.frames++}Nt(){e.t.fillStyle=nt(36,26,20,tt(this.frames/200,0,1)),e.t.fillRect(0,0,e.width,e.height);let t=e.width-32,i="ESCAPE! \n                    \nVILLAGERS STIR UNEASILY IN THEIR BEDS AS YOU EMERGE INTO MOONLIGHT. YOU SENSE WARM BODIES ALL AROUND YOU, RIPE FOR PICKING. IT IS ONLY A MATTER OF TIME NOW BEFORE YOU REGAIN YOUR FULL NECROMANTIC POWER. \n                    \nCONGRATULATIONS... AND THE END.";i=i.slice(0,this.frames),T.ct(e.t,i,16,16,t,1,1)}}class F{constructor(t){this.ti={...t},this.title="REACH EXIT \nTO ESCAPE",this.mi=lt.ht[3],this.Yt=4}It(){let t=N.fi(),i=$(z(this.ti));for(let s of t)if(J(s.Et,i).R<6)return void(At.screen=new C)}Nt(){let t=z(this.ti);lt.Ht(lt.ht[3],t)}Si(){return[b]}}const P={s(){this.c()},Nt(){let t=this.qt[0].Vt,i=Q({x:0,y:0});for(let s=0;s<t.length;s++)for(let h=0;h<t[0].length;h++)t[s][h]>0&&e.t.drawImage(lt.Vt[t[s][h]-1].st,8*h+i.h,8*s+i.o);for(let t of this.ht)t.Nt()},Fi(){let t=this.Vt,i=Q({x:0,y:0});for(let s=0;s<t.length;s++)for(let h=0;h<t[0].length;h++)if(t[s][h]>0){let t=1-tt(this.Yi[s][h]/5,.1,1);0===this.ji[s][h]&&(t=1),e.t.globalAlpha=t,e.t.drawImage(lt.Gi[0].st,8*h+i.h,8*s+i.o)}e.t.globalAlpha=1},c(){this.qt=w.qt.map((t=>({Vt:t.Vt.map((t=>[...t])),Bt:t.Bt.map((t=>({...t})))}))),this.bounds=w.bounds,this.Wt={_t:w.Wt[0],r:w.Wt[1]},this.ht=[],this.ht.push(new L(this.Wt));for(let t of this.qt[0].Bt)"EARTH"===t.name?this.ht.push(new p({_t:t.x,r:t.y})):"EXIT"===t.name&&(this.ht.push(new F({_t:t.x,r:t.y})),this.Ji={_t:t.x,r:t.y});this.selected=void 0,this.Vt=this.qt[0].Vt,this.width=this.Vt[0].length,this.height=this.Vt.length,this.Yi=st(this.width,this.height,(()=>0)),this.ji=st(this.width,this.height,(()=>0)),this.Ki={},this.Zi()},E(){for(let t of this.ht)t.It();this.Xi()},zi(t){return 46===this.Qi(t)},_i(t){return this.$i.includes(this.qt[t.z].Vt[t.y][t.x])},ts(t){this.qt[t.z]},wi(t){let i=Z(_(t)),s=this.Qi(i);if(!s||s>8||!this.ji[i.r][i._t])this.selected=void 0;else if(this.selected&&this.selected._t===i._t&&this.selected.r===i.r){let t=this.ii(this.selected);if(t){let i=t.Si();i[0]&&i[0].Ai()&&i[0].wi()}else b.wi()}else this.selected=i,this.ii(this.selected)},Qi(t){if(t)return this.qt[0].Vt[t.r]?.[t._t]},ii(t){if(t)for(let i of this.ht)if(i.ti._t===t._t&&i.ti.r===t.r)return i},Xi(){let t=[];for(let i of this.ht)i.Yt&&t.push({...i.ti,ss:i.Yt});for(let i of At.as)i.Yt&&t.push({...Z(i.Et),ss:i.Yt});this.Yi=function(t,i,s=1/0){let h=st(t[0].length,t.length,(()=>0)),e=[...i];for(;e.length>0;){let{_t:t,r:i,ss:n}=e.shift();h[i][t]>=n||(h[i][t]=n--,h[i][t]>=s||(ht(t+1,i)&&h[i][t+1]<n&&e.push({_t:t+1,r:i,ss:n}),ht(t-1,i)&&h[i][t-1]<n&&e.push({_t:t-1,r:i,ss:n}),ht(t,i+1)&&h[i+1][t]<n&&e.push({_t:t,r:i+1,ss:n}),ht(t,i-1)&&h[i-1][t]<n&&e.push({_t:t,r:i-1,ss:n})))}return h}(this.Vt,t);for(let t=0;t<this.Yi.length;t++)for(let i=0;i<this.Yi[0].length;i++)this.Yi[t][i]>this.ji[t][i]&&(this.ji[t][i]=1)},ri(t,i){let s=Z(t),h=Z(i);var e,n;if(e=s,n=h,Math.abs(e._t-n._t)+Math.abs(e.r-n.r)<=1)return i;let r=[h._t,h.r].join(","),o=this.Ki[r];o||(o=this.Ki[r]=function(t,i,s=1/0){let h=st(t[0].length,t.length,(()=>1/0)),e=[{...i,hs:0}];for(;e.length>0;){let{_t:t,r:i,hs:n}=e.shift();h[i][t]<=n||(h[i][t]=n++,h[i][t]>=s||(et(t+1,i)&&h[i][t+1]>n&&e.push({_t:t+1,r:i,hs:n}),et(t-1,i)&&h[i][t-1]>n&&e.push({_t:t-1,r:i,hs:n}),et(t,i+1)&&h[i+1][t]>n&&e.push({_t:t,r:i+1,hs:n}),et(t,i-1)&&h[i-1][t]>n&&e.push({_t:t,r:i-1,hs:n})))}return h}(this.Vt,h)),console.log(Object.keys(this.Ki).length);let l=[[s._t+1,s.r],[s._t-1,s.r],[s._t,s.r+1],[s._t,s.r-1]];for(let t of l)t.push(o[t[1]][t[0]]);return l.sort(((t,i)=>t[2]-i[2])),$(z({_t:l[0][0],r:l[0][1]}))},Zi(){for(let t=0;t<this.Vt.length;t++)for(let i=0;i<this.Vt[0].length;i++)if(14===this.Vt[t][i]){let s=0;(this.Vt[t-1]?.[i-1]||99)<8&&(s|=256),(this.Vt[t-1]?.[i]||99)<8&&(s|=128),(this.Vt[t-1]?.[i+1]||99)<8&&(s|=64),(this.Vt[t]?.[i-1]||99)<8&&(s|=32),(this.Vt[t]?.[i+1]||99)<8&&(s|=8),(this.Vt[t+1]?.[i-1]||99)<8&&(s|=4),(this.Vt[t+1]?.[i]||99)<8&&(s|=2),(this.Vt[t+1]?.[i+1]||99)<8&&(s|=1),lt.es(s),this.Vt[t][i]=20+s}}},W=18,j={s(){this.ns=rt(7,7)},E(){if(P.selected){let t=P.Qi(P.selected),i=P.ii(P.selected);this.actions=i?i.Si():t>=1&&t<=4?[b,U]:[]}else this.actions=[];M.X&&(this.rs=void 0)},Nt(){if(e.t.fillStyle=nt(36,26,20,.4),e.t.fillRect(0,0,e.width,9),e.t.fillRect(0,9,e.width,1),At.Wi)if(At.Wi.Pi){let t="INCOMING",i=T.dt(t,1),s=(e.width-i)/2,h=Math.floor(At.is/60)%2==0?T.lt:T.ft;T.ut(e.t,t,s,2,1,h)}else{let t=Math.ceil(At.Wi.Vi/60);if(t<=30){let i="NEXT WAVE",s=T.dt(i,1)+2,h=(e.width-s)/2;T.ut(e.t,"NEXT WAVE ",h,2),this.ns.t.clearRect(0,0,7,7),this.ns.t.fillStyle=nt(255,212,163,1),this.ns.t.beginPath(),this.ns.t.moveTo(3.5,3.5),this.ns.t.lineTo(3.5,0),this.ns.t.arc(3.5,3.5,3,1.5*Math.PI,1.5*Math.PI+t/30*Math.PI*2),this.ns.t.fill(),e.t.drawImage(this.ns.e,h+s,1)}}let i=At.as.filter((t=>t instanceof N));for(let t=0;t<i.length;t++)e.t.drawImage(lt.oi[1].st,2+4*t,2);let s,h=At.ni+"e",n=T.dt(h,1);if(e.t.fillStyle="rgba(0, 0, 0, 0.1)",T.ut(e.t,h,e.width-n-2,2),M.P){let t=M.P.h,i=M.P.o,s=_(M.P),h=Z(s);if(T.ut(e.t,t+","+i+". "+s.x+","+s.y+". "+h._t+","+h.r+".",e.width-100,20),P.selected){let t=P.Vt[P.selected.r][P.selected._t];t>20&&(t-=20),T.ut(e.t,P.selected._t+","+P.selected.r+". "+t.toString(2).padStart(9,"0"),e.width-100,29)}}if(P.selected){let t=Q({x:8*P.selected._t,y:8*P.selected.r});e.t.fillStyle=nt(255,212,163,.25),e.t.fillRect(t.h,t.o,9,9)}if(e.t.fillStyle="#ffd4a3",e.t.fillRect(0,e.height-W,e.width,1),e.t.fillStyle="#8d697a",e.t.fillRect(0,e.height-W+1,e.width,1),e.t.fillStyle="#203c56",e.t.fillRect(0,e.height-W+2,e.width,16),e.t.fillStyle="#8d697a",e.t.fillRect(0,e.height-2,e.width,2),e.t.drawImage(lt.os[0].st,-2,e.height-W+1),e.t.drawImage(lt.os[0].st,64,e.height-W+1),e.t.drawImage(lt.os[0].st,e.width-3,e.height-W+1),P.selected){let i=P.ii(P.selected);if(i)e.t.drawImage(i.mi.st,3,e.height-W-1),T.ct(e.t,i.title,14,e.height-W+3,e.width);else{let i=P.Qi(P.selected);console.log(P.selected,i,t[i-1]),e.t.drawImage(lt.Gi[1].st,4,e.height-W+6),e.t.drawImage(lt.Vt[i-1].st,3,e.height-W+5),T.ct(e.t,t[i-1],14,e.height-W+3,e.width)}}for(let t=0;t<this.actions.length;t++){let i=this.actions[t],h=this.ls(t);e.t.drawImage(lt.os[0].st,h.h+11,e.height-W+1),e.t.drawImage(i.yi().st,h.h,h.o),this.rs===i&&(s=t)}if(s>=0){let t=this.ls(s);e.t.drawImage(lt.fs[0].st,t.h-23,t.o-19),e.t.drawImage(this.rs.Ti().st,t.h,t.o),this.rs.xi(t.h-23+3,t.o-19+3)}M.P&&(At.us&&(e.t.globalAlpha=.5),lt.Ht(lt.cs,_(M.P)),e.t.globalAlpha=1)},ls:t=>({h:68+15*t,o:e.height-15}),wi(t){if(t.o>e.height-W){for(let i=0;i<this.actions.length;i++){let s=this.ls(i);if(t.h>=s.h&&t.h<=s.h+12&&t.o>=s.o&&t.o<=s.o+12)return this.actions[i]===this.rs?this.rs.wi()&&(this.rs=void 0):this.rs=this.actions[i],!0}return this.rs=void 0,!0}return this.rs=void 0,!1}},k={s(){this.Et={x:0,y:0},this.ds=void 0,this.wt={x:0,y:0}},E(){if(this.ds){let t=J(this.Et,this.ds);if(t.R<1)return void(this.ds=void 0);t.R=tt(t.R,0,2);let i=K(t);this.wt={x:(this.wt.x+i.x)/2,y:(this.wt.y+i.y)/2},this.Et.x+=this.wt.x,this.Et.y+=this.wt.y}M.pt[M.A.q]&&(this.As={...this.Et}),M.X&&(this.Et={x:this.As.x-M._.x,y:this.As.y-M._.y})}};function G(t){let i=Math.sqrt(t.x*t.x+t.y*t.y);return 0===i?{x:0,y:0,R:0}:{x:t.x/i,y:t.y/i,R:i}}function J(t,i){return G({x:i.x-t.x,y:i.y-t.y})}function q(t,i){return{x:Math.cos(t),y:Math.sin(t),R:i||1}}function K(t){return{x:t.x*(t.R||1),y:t.y*(t.R||1)}}function X(...t){let i={x:0,y:0,R:1};for(let s of t)i.x+=s.x*(s.R||1),i.y+=s.y*(s.R||1);return i}function Z(t){return{_t:t.x/8|0,r:t.y/8|0}}function z(t){return{x:8*t._t,y:8*t.r}}function Q(t){return{h:t.x+e.i.h-k.Et.x,o:t.y+e.i.o-k.Et.y}}function _(t){return{x:t.h-e.i.h+k.Et.x,y:t.o-e.i.o+k.Et.y}}function $(t){return{x:t.x+4,y:t.y+4}}function tt(t,i,s){return t<i?i:t>s?s:t}function it(t,i,s,h){if(Math.max(t.x,i.x)+s<h[0].x||Math.min(t.x,i.x)-s>h[1].x||Math.max(t.y,i.y)+s<h[0].y||Math.min(t.y,i.y)-s>h[1].y)return;let e=i.x-t.x,n=i.y-t.y,r=0===e?0:1/e,o=0===n?0:1/n,l=1/0,f=1/0;if(t.x-s<h[0].x&&i.x+s>h[0].x){let i=(h[0].x-s-t.x)*r;if(i>=0&&i<=1){let s=n*i+t.y;if(s>=h[0].y&&s<=h[1].y)return{x:e*i+t.x,y:s,St:i,gi:-1,bi:0,ys:h[0].x,Ts:s}}l=h[0].x}if(t.x+s>h[1].x&&i.x-s<h[1].x){let o=(t.x-(h[1].x+s))*-r;if(o>=0&&o<=1){let s=n*o+i.y;if(s>=h[0].y&&s<=h[1].y)return{x:e*o+t.x,y:s,St:o,gi:1,bi:0,ys:h[1].x,Ts:s}}l=h[1].x}if(t.y-s<h[0].y&&i.y+s>h[0].y){let i=(h[0].y-s-t.y)*o;if(i>=0&&i<=1){let s=e*i+t.x;if(s>=h[0].x&&s<=h[1].x)return{x:s,y:n*i+t.y,St:i,gi:0,bi:-1,ys:s,Ts:h[0].y}}f=h[0].y}if(t.y+s>h[1].y&&i.y-s<h[1].y){let i=(t.y-(h[1].y+s))*-o;if(i>=0&&i<=1){let s=e*i+t.x;if(s>=h[0].x&&s<=h[1].x)return{x:s,y:n*i+t.y,St:i,gi:0,bi:1,ys:s,Ts:h[0].y}}f=h[1].y}if(l===1/0&&f===1/0)return;l!==1/0&&f===1/0&&(f=n>0?h[1].y:h[0].y),f!==1/0&&l===1/0&&(l=e>0?h[1].x:h[0].x);let u=1/s,a=Math.sqrt(e*e+n*n),c=l-t.x,A=f-t.y,M=Math.sqrt(c*c+A*A),y=Math.acos((c*e+A*n)/(a*M));if(M<s)return;if(0===y){let i=(M-s)/a;if(i>1||i<0)return;let h=i*e+t.x,r=i*n+t.y,o=c/M,u=A/M;return isNaN(h)?void 0:{x:h,y:r,St:i,gi:o,bi:u,ys:l,Ts:f}}let E=Math.sin(y),T=E*M*u;if(Math.abs(T)>1)return;let R=Math.PI-Math.asin(T),x=Math.PI-y-R,d=s*Math.sin(x)/E/a;if(d>1||d<0)return;let O=d*e+t.x,w=d*n+i.y,N=(O-l)*u,I=(w-f)*u;return isNaN(O)?void 0:{x:O,y:w,St:d,gi:N,bi:I,ys:l,Ts:f}}function st(t,i,s){return Array.from({length:i},(()=>Array.from({length:t},s)))}function ht(t,i){let s=P.qt[0].Vt;return!(t<0||i<0||i>=s.length||t>=s[i].length)}function et(t,i){let s=P.qt[0].Vt;return!(t<0||i<0||i>=s.length||t>=s[i].length)&&s[i][t]>=1&&s[i][t]<=4}function nt(t,i,s,h){return`rgba(${t},${i},${s},${h})`}function rt(t,i){let s=document.createElement("canvas");s.width=t,s.height=i;let h=s.getContext("2d");return{e:s,t:h}}const ot={ht:[[0,0,8,16],[8,0,8,16],[16,0,8,16],[24,0,8,16]],di:[[0,16,3,3]],buttons:[[0,19,12,12],[12,19,12,12],[24,19,12,12],[36,19,12,12],[48,19,12,12],[60,19,12,12],[72,19,12,12],[84,19,12,12]],cursor:[[0,31,10,8]],us:[[0,39,15,15],[15,39,15,15],[30,39,15,15]],font:[[0,54,180,12]],Ni:[[0,66,5,5]],Dt:[[0,71,5,5],[5,71,5,5],[10,71,5,5],[15,71,5,5]],xs:[[0,76,9,9]],Es:[[0,85,13,16]],os:[[0,101,5,16]],fs:[[0,117,60,18]],Ri:[[0,135,7,7],[7,135,7,7],[14,135,7,7],[21,135,7,7],[28,135,7,7],[35,135,7,7],[42,135,7,7],[49,135,7,7]],ws:[[0,142,7,9],[7,142,7,9]],oi:[[0,151,3,3],[3,151,3,3],[6,151,3,3]],Gi:[[0,154,8,8],[8,154,8,8]],Vt:[[0,162,8,8],[8,162,8,8],[16,162,8,8],[24,162,8,8],[32,162,8,8],[40,162,8,8],[48,162,8,8],[56,162,8,8],[64,162,8,8],[72,162,8,8],[80,162,8,8],[88,162,8,8],[96,162,8,8],[104,162,8,8]],Ms:[[0,170,4,4],[4,170,4,4]],Os:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAACuCAMAAACoXtf9AAAAY1BMVEUAAADuw5oAAAANK0UgPFYhIickGhQuCAFTV1JUTmhcDwBtbnN1EgCNaXqPn6iRm6ObrbemraXCHQDJAADL2/zQgVnfcSbmAADm5rjuw5ru6WTwJAD78jb/ql7/1KP/7Nb///+u5EtCAAAAAnRSTlMAlm//+0kAAAPXSURBVHja7Z0Bb7M2EIZdcLaSzk27ja1da8P//5XzwUvOkYvoKBDfdI/jnn3Q6Ml9B0H6JNVsjaIoSoNZJH8NmAxHlOqMnxkkXL60994ktETR7UHOoQ4+lcYsuNjkXMPa+SFBFC7NlXZjV9BajLTzbevlVDoEP9Q5WpdfaYDCSuDByOPhXaS1kYgHtA5gs/xO+AZ4Y4IDYav8fs7AB3clrMn7yJQPEQr7Sfs4JokQB8t5luM84RPpMEnz+ZTbURoKLDeqkwABuTAwW9H5fDntkciRHeeT8+nHftJxXOVorOvdY6XRhzSmPqTh4Za0x9S7SE95d7z0woUFCThAOskHzufSZfT0irx+uYj+Gu+MQDqJ1l3oJEoLtO6C+f+hKBWBZdyAYV2u8hsxCFZvcQPiOr4KdWZL7HgfdyVa55aZtUBp9E2RzrDMpBFFSS+g0iot4+6h0sd/IwJZzx4in/IKpl/Oz9L3vTH0miYNbHBs+Y3wu/w+/B7jILDeQBqS4wq7xLNPMvP02TA8F6TXML5NViVUDsewmYN/h4vA+56lkVtjmUvjldenx/G1lU73P6l0P8Wsp6c2QeRJ+0XprKeHA4locr1IJPuUHHEFZ+OYT5v2OIuBebH0nyTvuA3tsp4DLJuOXBqSODeVTnt3W2e+p1NguNLYph+OB99i2BjCmNfcxvQ8ARv1WCHyQZZJTjI3lUWWc3uDyqdtIpyu6+Q50xAnTZgDUOlDu0P5+xo+zG9nIcLnP2j1fjbn3z8gLYUzTVnOEP9VzDP1Eaj0P5j7ovQ9B0V7Wm95d8KlyJFu7EgjSJqcYS1H2jIqrdIqvTsqrdIqrV/j+sDECJM2wmiic2OEYRvXWHHS1lmVVmmVVmmVVmmVzr/G9YFJH02ZsJo7OrvVhDtK25WotEqrtEqrtEqrtEpLlt7gMS/9D4KvCcU9UN9Ihy8x5ZFImxLpuv8WOgr3BhKLoUMgiql0ZDZk3F0aYdk2wZRFKt0JkUbl4TwbimThqrwzFTEFIVSfn9XLc1U9v9BKpW9R6RQx0i+RodIRld5T+pmoEMwu6H0ahDiEEfDaGS32L6AGKq3SKq3SKl0W9Q8xoHbOUrzJW+eGPEWwjbRtCJvFOexIJt16i79/5WmO0q0nZ7Kvx3y7jXQzksW10t77OFnajqu6pXzrN5a235QeRybtR2kLRlUkcdzG/fGVZuu5nmbQ0+lx7I+WzrGA2iOX5iQdt3G/tbRl6SjxTaYLb0aaexrn7Xb3YOdlpguv9l9Je7574DyzBZfL5dFI4/L0dDJ/vgqUfj0ZUTyeTjCWw7868wTFHSkzKgAAAABJRU5ErkJggg=="},lt={ps(t){let i=new Image;i.onload=t,i.src=ot.Os,lt.Ys=i},s(){lt.font=ft(ot.font[0]),lt.Rs=ft(ot.ws[0]),lt.Ss=ft(ot.ws[1]),lt.oi=ot.oi.map(ft),lt.Dt=ot.Dt.map(ft),lt.xs=ot.xs.map(ft),lt.cs=ot.cursor.map((t=>ft(t,{x:0,y:0})))[0],lt.di=ot.di.map(ft),lt.Es=ot.Es.map(ft),lt.os=ot.os.map(ft),lt.fs=ot.fs.map(ft),lt.Ri=ot.Ri.map((t=>ft(t,{x:-1,y:-1}))),lt.Vt=ot.Vt.map(ft),lt.Gi=ot.Gi.map(ft),lt.Ni=ot.Ni.map(ft),lt.ht=ot.ht.map((t=>ft(t,{x:0,y:8}))),lt.buttons=ot.buttons.map(ft),lt.Us=ut(function(t){let i=rt(544,334);for(let s=0;s<334;s+=32)for(let h=0;h<544;h+=32)i.t.drawImage(t,h,s);return i.e}(lt.Vt[0].st)),lt.ot=ut(function(){let t=rt(500,500),i=t.t.createRadialGradient(250,250,0,250,250,250);return i.addColorStop(.3,nt(0,0,0,0)),i.addColorStop(1,nt(0,0,0,.9)),t.t.fillStyle=i,t.t.fillRect(0,0,500,500),t.e}());let t=ot.us.map(ft);lt.Is=ut(function(t,i){let s=rt(130,45);return s.t.drawImage(at(t).e,0,5),s.t.drawImage(i,5,0),s.e}(t[0].st,t[2].st)),lt.vs=ut(at(t[1].st).e)},Ns(t,i,s,h){t.drawImage(i.st,s-i.js.x,h-i.js.y)},Ht(t,i,s){let{h:h,o:n}=this.Hs(t,i);s?(e.t.save(),e.t.translate(h+t.js.x,n+t.js.y),e.t.rotate(s),e.t.drawImage(t.st,-t.js.x,-t.js.y),e.t.restore()):e.t.drawImage(t.st,h,n)},Hs:(t,i)=>({h:i.x-t.js.x-k.Et.x+e.i.h,o:i.y-t.js.y-k.Et.y+e.i.o}),es(t){return this.Vt[t+20-1]||(this.Vt[t+20-1]=ut(function(t,i){let s=rt(8,8);return 256&i&&s.t.drawImage(t[12].st,0,0,4,4,0,0,4,4),64&i&&s.t.drawImage(t[12].st,5,0,3,3,5,0,3,3),1&i&&s.t.drawImage(t[12].st,6,6,2,2,6,6,2,2),4&i&&s.t.drawImage(t[12].st,0,5,3,3,0,5,3,3),8&i&&s.t.drawImage(t[11].st,5,0,3,8,5,0,3,8),32&i&&s.t.drawImage(t[9].st,0,0,4,8,0,0,4,8),2&i&&s.t.drawImage(t[8].st,0,5,8,3,0,5,8,3),128&i&&s.t.drawImage(t[10].st,0,0,8,4,0,0,8,4),160==(160&i)&&s.t.drawImage(t[13].st,0,0,5,5,0,0,5,5),136==(136&i)&&s.t.drawImage(t[13].st,4,0,4,4,4,0,4,4),10==(10&i)&&s.t.drawImage(t[13].st,4,4,4,4,4,4,4,4),34==(34&i)&&s.t.drawImage(t[13].st,0,4,5,4,0,4,5,4),s.e}(this.Vt,t),{x:0,y:0})),this.Vt[t+20-1]}};function ft(t,i){return ut(function(t,i,s,h){const e=lt.Ys,n=rt(s,h);return n.t.drawImage(e,t,i,s,h,0,0,s,h),n.e}(...t),i)}function ut(t,i){let s=t.width,h=t.height;return{st:t,js:"object"==typeof i?i:{x:s/2|0,y:h/2|0}}}function at(t){let i=rt(130,40);for(let s=0;s<40;s+=5)for(let h=0;h<130;h+=5){let e=0===h?0:125===h?10:5,n=0===s?0:35===s?10:5;i.t.drawImage(t,e,n,5,5,h,s,5,5)}return i}class ct{constructor(){this.frames=0}E(){return this.frames++,M.pt[M.A.J]&&this.frames>30&&At.c(),!0}Nt(){e.t.fillStyle=nt(36,26,20,tt(this.frames/200,0,1)),e.t.fillRect(0,0,e.width,e.height);let t=e.width-32,i="DEFEAT... \n                    \nYOUR LAST MOTH GONE, THIS WORLD SLIPS FROM YOUR GRASP. YOU CURSE THE VILLAGE AND ITS INHABITANTS AS YOU TUMBLE TOWARDS THAT BLEAK BEYOND. \n \nYOUR REIGN OF TERROR HAS ENDED. \n \nTAP TO TRY AGAIN!";i=i.slice(0,this.frames),T.ct(e.t,i,16,16,t,1,1,T.ft)}}const At=new class{s(){lt.ps((()=>{e.s(),lt.s(),T.s(),M.s(),a.s(),j.s(),k.s(),P.s(),window.addEventListener("blur",(()=>this.at())),window.addEventListener("focus",(()=>this.mt())),this.c(),this.start()}))}c(){this.as=[],this.Ds={},this.Ls={},this.gs={},this.bs=0,this.ks=[],this.Ci=[],this.qs=0,this.ni=250,this.Vs=0,this.as.push(new N(z(P.Wt))),this.screen=void 0,this.Wi=void 0,P.c(),k.Et=$(z(P.Ji)),k.ds=$(z(P.Wt))}start(){this.is=0,this.Ps=[0],this.E(),window.requestAnimationFrame((t=>this.Bs(t)))}Bs(t){let i=(new Date).getTime();this.Ps.length>=40&&this.Ps.shift(),this.Cs=1e3/((this.Ps[this.Ps.length-1]-this.Ps[0])/this.Ps.length),this.is++,e.n(),this.E(),this.Nt(e.t),window.requestAnimationFrame((t=>this.Bs(t)));let s=(new Date).getTime();this.Ps.push(this.Ps[this.Ps.length-1]+s-i)}E(){if(this.Wi||(this.Wi=new Y(this.qs++)),M.E(),!(this.screen&&this.screen.E()||(M.pt[M.A.J]&&this.wi(M.P),j.E(),this.Gs))){this.Wi.E(),this.Ws(),console.log(At.as);for(let t of At.as)t.It&&t.It();g.Hi(this.as),B.Hi(this.as),k.E(),this.as=this.as.filter((t=>!t.vt)),P.ht=P.ht.filter((t=>!t.vt)),this.ks=this.ks.filter((t=>t.E())),P.E(),0===this.as.filter((t=>t instanceof N)).length&&(At.screen=new ct),At.is%6==0&&(this.bs=10*Math.random()|0),30===At.is&&At.ks.push(new d(20,20,20)),M.pt[M.A.F]&&!At.Fs&&(At.Fs=!0)}}Nt(){e.t.setTransform(1,0,0,1,0,0),e.t.scale(e.scale,e.scale),e.t.fillStyle=nt(36,26,20,1),e.t.fillRect(0,0,e.width,e.height),P.Nt();for(let t of this.as)(!t.z||t.z<100)&&t.Nt();for(let t of this.as)t.z&&t.z>100&&t.Nt();P.Fi(),j.Nt(),At.is<120&&(e.t.fillStyle=nt(0,0,0,1-At.is/120),e.l()),this.screen&&this.screen.Nt()}at(){this.Gs||(this.Gs=!0)}mt(){this.Gs&&(this.Gs=!1)}wi(t){for(let i of[j,P])if(i.wi(t))break}Ui(){return this.as.filter((t=>t instanceof N)).length}Ei(t){if(this.ni>=t)return!0}Mi(t){this.ni-=t}Ws(){let t=this.Ci[0];if(t)for(let i=0;i<10;i++){let i=Math.floor(Math.random()*P.qt[0].Vt[0].length),s=Math.floor(Math.random()*P.qt[0].Vt.length);if(1!==P.Vt[s][i])continue;if(0!==P.Yi[s][i])continue;let h=z({_t:i,r:s});console.log("NEW monster"+h.x+","+h.y+","+P.Yi[s][i]),At.as.push(new t(h)),this.Ci.shift();break}}};At.s()}();
//# sourceMappingURL=app.js.map</script>
<style>body,html{margin:0;padding:0;background-color:#000}div{position:absolute;top:0;bottom:0;left:0;right:0}#canvas{width:100%;height:100%;touch-action:none}</style><div><canvas id="canvas"></canvas></div><script>!function(){"use strict";const t=["CAVE FLOOR","CAVE FLOOR","CAVE FLOOR","","","","DOOM PIT","DOOM PIT"],i=45*Math.PI/180,s=90*Math.PI/180,h=360*Math.PI/180,e={s(){e.e=document.getElementById("canvas"),e.t=e.e.getContext("2d"),e.n(!0)},n(t){let i=window.devicePixelRatio,s=e.e.clientWidth,h=e.e.clientHeight,n=s*i,r=h*i;(t||e.e.width!==n||e.e.height!==r)&&(e.e.width=n,e.e.height=r,e.scale=(10*Math.max(n/240,r/135)|0)/10,e.width=Math.ceil(n/e.scale),e.height=Math.ceil(r/e.scale),e.i={h:e.width/2|0,o:e.height/2|0},e.clientWidth=s,e.clientHeight=h,e.t.imageSmoothingEnabled=!1),e.e.style.cursor="none"},l(){e.t.fillRect(0,0,e.width,e.height)}},n={s(){n.map={KeyW:u.A.u,KeyA:u.A.M,KeyS:u.A.T,KeyD:u.A.p,ArrowUp:u.A.u,ArrowLeft:u.A.M,ArrowDown:u.A.T,ArrowRight:u.A.p,Escape:u.A.m},n.R=[{x:0,y:0,O:0},{x:0,y:-s,O:1},{x:0,y:s,O:1},{x:0,y:0,O:0},{x:-s,y:0,O:1},{x:-i,y:-i,O:1},{x:-i,y:i,O:1},{x:-s,y:0,O:1},{x:s,y:0,O:1},{x:i,y:-i,O:1},{x:i,y:i,O:1},{x:s,y:0,O:1},{x:0,y:0,O:0},{x:0,y:-s,O:1},{x:0,y:s,O:1},{x:0,y:0,O:0}],n.S=[],window.addEventListener("keydown",(t=>{let i=n.map[t.code];i&&(n.S[i]=!0)})),window.addEventListener("keyup",(t=>{let i=n.map[t.code];i&&(n.S[i]=!1)})),n.c()},E(){let t=(n.S[u.A.u]?1:0)+(n.S[u.A.T]?2:0)+(n.S[u.A.M]?4:0)+(n.S[u.A.p]?8:0);n.w=n.R[t]},c(){n.w=n.R[0];for(let t of Object.values(u.A))n.S[t]=!1}},r={volume:.3,sampleRate:44100,x:new(window.AudioContext||webkitAudioContext),destination:void 0,b:function(...t){return this.v(this.N(...t))},v:function(...t){const i=this.x.createBuffer(t.length,t[0].length,this.sampleRate),s=this.x.createBufferSource();return t.map(((t,s)=>i.getChannelData(s).set(t))),s.buffer=i,s.connect(this.destination),s.start(),s},N:function(t=1,i=.05,s=220,h=0,e=0,n=.1,r=0,o=1,l=0,f=0,u=0,a=0,c=0,A=0,M=0,y=0,O=0,d=1,E=0,x=0){const T=2*Math.PI;let w,R,N=this.sampleRate,I=l*=500*T/N/N,p=s*=(1+2*i*Math.random()-i)*T/N,m=[],U=0,v=0,H=0,b=1,S=0,L=0,k=0;for(f*=500*T/N**3,M*=T/N,u*=T/N,a*=N,c=c*N|0,R=(h=h*N+9)+(E*=N)+(e*=N)+(n*=N)+(O*=N)|0;H<R;m[H++]=k)++L%(100*y|0)||(k=r?r>1?r>2?r>3?Math.sin((U%T)**3):Math.max(Math.min(Math.tan(U),1),-1):1-(2*U/T%2+2)%2:1-4*Math.abs(Math.round(U/T)-U/T):Math.sin(U),k=(c?1-x+x*Math.sin(T*H/c):1)*(k>0?1:-1)*Math.abs(k)**o*t*this.volume*(H<h?H/h:H<h+E?1-(H-h)/E*(1-d):H<h+E+e?d:H<R-O?(R-H-O)/n*d:0),k=O?k/2+(O>H?0:(H<R-O?1:(R-H)/O)*m[H-O|0]/2):k),w=(s+=l+=f)*Math.cos(M*v++),U+=w-w*A*(1-1e9*(Math.sin(H)+1)%2),b&&++b>a&&(s+=u,p+=u,b=0),!c||++S%c||(s=p,l=I,b=b||1);return m},U:function(t=0,i=440){return i*2**(t/12)}},o={s(){o.I=!1,o.t=r.x,o.g=o.t.createGain(),o.g.connect(o.t.destination),r.destination=o.g,o.k=[,,391,,.19,.01,2,.54,-4,20,,,,,,,.02,.9],o.H=[,,454,.06,.86,.71,2,.63,-.7,1.7,-83,.09,.27,.3,.2,,.18,.95,.02,.02],o.L=[1.01,,1250,.01,.09,.14,,1.77,-6.3,,,,,,23,,,.46,.02],o.D=[1.04,,363,.01,.08,.52,2,.31,.3,,,,,1.5,,.9,,.34,.07],o.F=[2.01,,332,.02,.05,.16,1,.53,-.8,,-7,.01,,.1,,,.03,.48,.04],o.P=[2.03,0,65.40639,.03,.66,.18,2,.95,,,,,.3,.4,,,.19,.21,.1,.04],o.q=[1.56,0,261.6256,,.13,.3,,.41,,,,,,.2,,,.05,.2,.19,.22]},E(){o.I},b(t){o.I&&r.b(...t)},Q(){o.g.gain.linearRampToValueAtTime(0,o.t.currentTime+1)},at(){o.g.gain.linearRampToValueAtTime(1,o.t.currentTime+1)}},l={s(){this.map=[],this.map[0]=u.A.j,this.map[2]=u.A.V,this.S=[],window.addEventListener("mousemove",(t=>{this.Y||(this.Y={}),this.Y.h=t.clientX*e.width/e.clientWidth|0,this.Y.o=t.clientY*e.height/e.clientHeight|0,u.mode=2})),window.addEventListener("mouseout",(()=>{this.Y=void 0})),window.addEventListener("mousedown",(t=>{let i=this.map[t.button];i&&(this.S[i]=!0),o.I=!0,ft.W="mousedown",u.mode=2,this.G={h:t.clientX*e.width/e.clientWidth|0,o:t.clientY*e.height/e.clientHeight|0}})),window.addEventListener("mouseup",(t=>{let i=this.map[t.button];i&&(this.S[i]=!1),ft.W="mouseup",u.mode=2})),window.addEventListener("click",(t=>{t.preventDefault(),ft.W="click"})),window.addEventListener("contextmenu",(t=>{let i=this.map[t.button];i&&(this.S[i]=!0),this.B=2,t.preventDefault()})),l.c()},E(){this.B&&(this.B--,0===this.B&&(this.S[u.A.V]=!1))},c(){this.Y=void 0;for(let t of Object.values(u.A))this.S[t]=!1}},f={s(){this.map=[],this.map[0]=u.A.j,this.S=[],window.addEventListener("touchmove",(t=>{this.Y||(this.Y={});let i=t.changedTouches[0];this.Y.h=i.clientX*e.width/e.clientWidth|0,this.Y.o=i.clientY*e.height/e.clientHeight|0,u.mode=1})),window.addEventListener("touchstart",(t=>{let i=this.map[0];i&&(this.S[i]=!0),o.I=!0,ft.W="TOUCHSTART",u.mode=1;let s=t.changedTouches[0];this.G={h:s.clientX*e.width/e.clientWidth|0,o:s.clientY*e.height/e.clientHeight|0},this.Y={...this.G}})),window.addEventListener("touchend",(t=>{let i=this.map[0];i&&(this.S[i]=!1),ft.W="TOUCHEND",u.mode=1})),this.c()},E(){},c(){this.Y=void 0;for(let t of Object.values(u.A))this.S[t]=!1}},u={A:{u:11,T:12,M:13,p:14,C:21,V:30,m:96,J:97,K:98,j:40,Z:41,X:42},s(){this.w={x:0,y:0,O:0},this.pt={},this._={},this.S={},this.$={},n.s(),l.s(),f.s(),this.mode=1,this.tt=!1},E(){n.E();let t=2===this.mode?l:f;for(let i of Object.values(u.A)){let s=t.S[i]||n.S[i];this.pt[i]=!this.S[i]&&s,this._[i]=this.S[i]&&!s,this.pt[i]?this.$[i]=1:this.S[i]&&s&&this.$[i]++,this.S[i]=s}this.Y=t.Y,this.w=n.w,this.S[u.A.j]&&(this.$[u.A.j]>20&&(this.tt=!0),Math.abs(t.G.h-t.Y.h)+Math.abs(t.G.o-t.Y.o)>5&&(this.tt=!0)),this.tt&&t.Y&&(this.it={x:t.Y.h-t.G.h,y:t.Y.o-t.G.o}),this._[u.A.j]&&(this.tt?this.tt=!1:(this.pt[u.A.X]=!0,this.$[u.A.X]=1))},st(t){},ht(t){}},a={10:0,32:3,33:3,39:2,44:3,46:3,73:2},c={},A={s(){A.et=nt.font.nt;let t=[[101,nt.rt[2]]];for(let i of t)c[i[0]]=i[1],a[i[0]]=i[1].nt.width+1;A.ot=M(A.et,st(0,0,0,1)),A.lt=M(A.et,st(90,20,90,.15)),A.blue=M(A.et,st(200,40,220,1)),A.ft=M(A.et,st(240,50,200,.2)),A.ut=M(A.et,st(240,240,255,.25)),A.red=M(A.et,st(240,50,50,1)),A.ct=y(A.et,"#ffaa5e","#ffd4a3"),A.At=y(A.et,"#ffaa5e","#ffd4a3",st(255,0,0,.7))},dt(t,i,s,h,e=1,n=A.ct,r){for(let o=0;o<i.length;o++){let l=i.charCodeAt(o);if(119!==l)if(114!==l){if(c[l])t.drawImage(c[l].nt,s,h-(c[l].nt.height+4)/2);else{let i=4*(l-32);r&&t.drawImage(r,i%180,6*(i/180|0),3,5,s+1,h+1,3*e,5*e),t.drawImage(n,i%180,6*(i/180|0),3,5,s,h,3*e,5*e)}s+=(a[l]||4)*e}else n=A.At;else n=A.ct}},yt(t,i,s,h,e,n,r=1,o=A.ct,l){let f=s,u=h,c=i.split(" ");for(let i of c){for(;"\n"===i[0];)i=i.slice(1),f=s,u+=6*r;let h=A.wt(i,r);f+h-s>e&&(f=s,u+=6*r),A.dt(t,i,f,u,r,o,l),f+=h+(a[32]||4)}},wt:(t,i)=>t.split("").reduce(((t,i)=>t+(a[i.charCodeAt(0)]||4)),0)*i};function M(t,i){let s=ht(t.width,t.height);return s.t.fillStyle=i,s.t.fillRect(0,0,t.width,t.height),s.t.globalCompositeOperation="destination-in",s.t.drawImage(t,0,0),s.e}function y(t,i,s,h){let e=ht(t.width,t.height);return e.t.fillStyle=s,e.t.fillRect(0,0,t.width,t.height),e.t.fillStyle=i,e.t.fillRect(0,0,t.width,1),e.t.fillRect(0,6,t.width,1),h&&(e.t.fillStyle=h,e.t.fillRect(0,0,t.width,t.height)),e.t.globalCompositeOperation="destination-in",e.t.drawImage(t,0,0),e.e}class O{constructor(t,i,s){this.frames=t,this.Mt=i,this.xt=s,this.Tt=[],this.Et=[];var h=t/2;for(let t=0;t<h;t++)this.Tt.push(2*Math.random()-1),this.Et.push(2*Math.random()-1);this.mt=-1}E(){if(this.mt++,this.mt>=this.frames)return!1;let t=this.mt/2,i=0|t,s=i+1,h=1-this.mt/this.frames;return this.x=this.Mt*h*(this.Tt[i]+(t-i)*(this.Tt[s]-this.Tt[i])),this.y=this.xt*h*(this.Et[i]+(t-i)*(this.Et[s]-this.Et[i])),!0}}class d{constructor(t,s,h){this.Rt={...t},this.angle=s,this.Ot=W(J(this.angle,h?8:5)),this.a=i,this.St=!0,this.f=h,this.vt=!0,this.bt=1,this.r=0,this.Nt=-1,this.d=0===this.f?45:70,this.Ut=!0}It(){++this.Nt===this.d&&(this.gt=!0),this.Ot.x*=.9,this.Ot.y*=.9,this.a*=.95,this.r+=this.a}kt(){nt.Ht(nt.Lt[this.f],this.Rt,this.r)}}d.k=t=>d.Dt(t,8,(()=>0)),d.Ft=t=>d.Dt(t,16,(()=>4*Math.random()|0)),d.Dt=(t,e,n)=>{let r=t.Pt?function(t){let i=Math.atan2(t.y,t.x);return i<0&&(i+=h),i}(t.Pt.qt):Math.random()*h;for(let o=0;o<e*(ft.H?2:1);o++){let e=Math.random()*t.bt,o=z(t.Rt,J(Math.random()*h,e));ft.is.push(new d(o,r+Math.random()*s-i,n()))}};const E={jt:[{name:"1F",Vt:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,14,14,0,0,0,0,0,0,0,0,14,14,14,14,14,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,1,1,1,1,14,14,14,0,0,0,0,0,14,14,1,1,1,14,14,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,1,1,1,1,1,1,1,1,14,14,0,0,14,14,14,3,1,1,1,1,14,14,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,1,1,1,1,1,1,7,7,1,1,1,1,14,14,14,14,1,1,1,1,1,1,1,1,14,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,1,1,1,1,1,1,1,1,7,8,8,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,14,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,1,1,1,1,1,1,1,1,1,8,8,1,1,1,1,3,1,1,1,1,1,1,1,1,1,1,14,14,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,14,14,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,1,1,1,14,14,14,0,0],[0,0,0,0,0,0,0,14,14,14,14,14,14,14,1,1,1,14,14,14,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,14,14,0,0,0,0],[0,0,0,0,0,0,14,14,3,1,1,1,1,1,1,1,1,1,14,14,14,1,1,1,1,1,1,1,1,14,14,14,14,1,1,1,1,1,1,1,1,14,14,14,14,0],[0,0,0,0,0,14,14,1,1,1,1,2,1,1,1,7,1,1,1,14,14,14,1,1,1,1,14,14,14,14,14,1,14,14,2,1,3,1,1,1,1,1,1,1,14,14],[0,0,0,0,0,14,1,1,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,14,1,1,1,1,14,3,1,1,1,1,1,14],[0,0,0,0,0,14,1,7,8,1,1,14,14,14,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,7,1,14,1,1,1,1,14,14,1,1,1,1,3,14],[0,0,0,0,0,14,1,1,1,1,14,14,0,14,14,1,1,1,2,1,1,1,1,1,1,1,1,1,1,7,1,1,1,14,1,7,1,14,14,14,1,1,1,1,1,14],[0,0,0,0,0,14,14,1,2,14,14,0,0,14,14,1,1,1,1,1,14,14,14,14,1,1,2,1,1,1,1,1,14,14,1,8,1,14,0,14,14,1,1,2,14,14],[0,0,0,0,0,0,14,14,14,14,0,0,14,14,1,1,1,3,1,14,14,0,0,14,14,1,1,1,1,1,1,14,14,14,1,8,1,14,0,0,14,14,14,14,14,0],[0,0,0,0,0,0,0,0,0,0,0,0,14,1,1,7,1,1,1,14,0,0,0,0,14,14,1,1,1,1,2,14,14,14,1,8,1,14,14,0,0,0,0,0,0,0],[0,0,0,14,14,14,14,14,14,14,14,14,14,1,1,1,1,14,14,14,0,0,0,0,0,14,1,1,1,1,1,1,14,1,1,1,1,2,14,0,0,0,0,0,0,0],[0,14,14,14,1,1,1,1,1,14,14,14,14,1,1,1,1,14,0,0,0,0,0,0,0,14,14,1,1,1,1,1,14,1,1,1,1,1,14,14,0,0,0,0,0,0],[0,14,1,1,1,1,1,1,1,2,14,14,14,1,1,1,1,14,14,0,0,0,0,0,0,0,14,1,1,1,1,1,14,14,14,1,1,1,1,14,0,0,0,0,0,0],[14,14,1,1,1,1,1,1,1,1,14,14,14,1,1,1,1,1,14,14,0,0,0,0,0,0,14,1,1,1,1,1,1,1,14,14,1,1,1,14,0,0,0,0,0,0],[14,1,1,1,1,14,1,1,1,1,1,14,14,14,1,1,2,1,14,14,0,0,0,0,0,0,14,1,2,1,1,7,1,1,1,14,1,7,1,14,14,14,14,14,0,0],[14,1,7,1,1,14,14,1,1,1,1,14,14,14,14,1,1,1,14,14,0,0,0,0,0,0,14,14,1,1,1,8,7,1,1,14,1,1,1,14,14,1,1,14,14,0],[14,1,1,1,1,14,14,1,1,1,1,1,14,14,14,1,1,1,1,14,0,0,0,0,0,0,0,14,14,1,1,1,1,1,1,14,14,1,1,1,1,1,1,1,14,0],[14,14,1,1,1,14,14,1,1,1,1,1,1,14,14,1,1,7,1,14,0,0,0,0,0,0,0,0,14,14,1,1,3,1,14,14,1,1,1,1,1,1,1,1,14,0],[0,14,1,1,1,14,14,14,1,1,1,1,1,14,14,1,1,8,1,14,0,0,0,0,0,0,0,0,0,14,14,14,14,14,14,1,1,1,3,1,1,1,1,1,14,0],[0,14,1,1,1,1,14,14,14,1,1,1,14,14,14,1,1,1,1,14,0,0,0,0,0,0,0,0,0,0,0,14,14,1,1,1,1,14,14,14,1,1,1,14,14,0],[0,14,1,1,1,1,2,14,14,14,14,14,14,14,1,1,1,1,14,14,0,0,0,0,0,0,0,0,0,0,14,14,1,1,1,2,1,14,0,14,14,14,14,14,0,0],[0,14,14,1,1,1,1,1,14,14,14,14,14,2,1,1,1,14,14,0,0,0,0,0,0,0,0,0,0,0,14,1,3,1,14,14,14,14,0,0,0,0,0,0,0,0],[0,0,14,14,1,1,1,1,1,1,1,1,1,1,1,3,1,14,0,0,0,0,0,0,0,0,0,0,0,0,14,1,1,14,14,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,14,14,1,1,1,1,1,1,7,1,1,1,1,14,14,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,14,14,14,1,3,1,1,1,1,1,1,14,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,14,14,14,14,14,14,14,14,14,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],Yt:[],Wt:[{name:"SPAWN",x:42,y:11},{name:"EARTH",x:20,y:3},{name:"EXIT",x:10,y:24},{name:"EARTH",x:41,y:25},{name:"EARTH",x:43,y:22},{name:"EARTH",x:33,y:17},{name:"EARTH",x:40,y:6},{name:"EARTH",x:36,y:3},{name:"EARTH",x:14,y:7},{name:"EARTH",x:31,y:13},{name:"EARTH",x:7,y:13}],Gt:[],id:0}],bounds:[[0,0],[46,32]],Bt:[42,11,0]};class x{constructor(t){this.Rt={...t},this.target={...this.Rt},this.Ot={x:0,y:0},this.Ct=1,this.k=[],this.bt=3,this.as=2,this.St=!0,this.Ut=!0,this.zt=7,this.Jt=[],this.Kt=0,this.offset={x:0,y:0},this.Zt=0,this.Qt=500,this.Xt=3,this._t=0,this.mt=0,this.$t=Math.floor(16*Math.random()),this.ti=ft.mt;let i=C(this.Rt);this.moveTo({ii:i.ii,r:i.r-1})}It(){0===this.Jt.length&&this.Jt.push({si:2});let t=this.Jt[this.Jt.length-1];if(this.mt=Math.floor(ft.mt/8)%2+1,9===this.as)return o.b(o.D),void(this.gt=!0);if(3===t.si)this.target=X(Z(t.hi)),g(this.Rt,this.target).O<6&&this.Jt.pop();else if(6===t.si){if(this.target=X(Z(t.hi)),g(this.Rt,this.target).O<6){this.mt=0;let i=j.ei(t.hi);i.ni++,i.ni>=i.ri&&this.Jt.pop()}}else if(4===t.si){this.target=X(Z(t.hi));let i=g(this.Rt,this.target),s=j.ei(t.hi);s?i.O<6&&(this.mt=0,this.Zt+=this.Xt,s.oi-=this.Xt,this.Zt>=this.Qt&&this.Jt.push({si:5,hi:{ii:j.Bt.ii,r:j.Bt.r}})):(this.Jt.pop(),this.Jt.push({si:5,hi:{ii:j.Bt.ii,r:j.Bt.r}}))}else 5===t.si&&(this.target=X(Z(t.hi)),g(this.Rt,this.target).O<6&&(this.mt=0,this.Zt-=this.Xt,this._t+=this.Xt,this._t>=100&&(ft.li++,this._t-=100),this.Zt<=0&&this.Jt.pop()));let i=j.ai(this.Rt,this.target);console.log([this.target,i]);let s=g(this.Rt,i);s.O=q(s.O,0,.5);let h=W(s);this.Ot={x:(this.Ot.x+h.x)/2,y:(this.Ot.y+h.y)/2}}kt(){let t=3;0===this.mt&&t--;let i=Math.cos((ft.mt+this.$t)/16)*t,s=1*Math.sin((ft.mt+this.$t)/16);nt.Ht(nt.fi[this.mt],{x:this.Rt.x+i,y:this.Rt.y+s})}ui(t){this.Jt=[{si:4,hi:t}],this.ti=ft.mt}construct(t){this.Jt.push({si:6,hi:t}),this.ti=ft.mt}moveTo(t){this.Jt=[{si:3,hi:t}],this.ti=ft.mt}ci(){let t=this.Jt[this.Jt.length-1];return t&&2!==t.si}}x.Ai=()=>{let t=ft.is.filter((t=>t instanceof x));return t.sort(((t,i)=>t.ci()&&!i.ci()?1:!t.ci()&&i.ci()?-1:t.ti-i.ti)),t},x.assign=t=>{let i=x.Ai();for(let s=0;s<i.length&&!(s>0&&i[s].ci());s++)t(i[s])};class T{constructor(t,i,s){this.Rt={...t},this.target=i,this.Ot={x:0,y:0},this.k=s||70}It(){let t=g(this.Rt,this.target.Rt);t.O=q(t.O,0,2),this.Ot={x:(this.Ot.x+t.x*t.O)/2,y:(this.Ot.y+t.y*t.O)/2},t.O<1&&(this.target.k.push({di:this.k,qt:t,yi:0}),this.gt=!0,console.log("HIT"))}kt(){nt.Ht(nt.wi[0],this.Rt,this.r)}}const w={Mi:()=>!!j.ei(j.selected),xi:()=>nt.buttons[6],Ti:()=>nt.buttons[7],pi(t,i){let s=j.ei(j.selected),h=ft.Ei(15)?"BUILD TOWER \ne15":"BUILD TOWER \ner15";s&&(h="FINISH BUILDING"),A.yt(e.t,h,t,i)},mi(){if(j.ei(j.selected))x.assign((t=>t.construct(j.selected)));else if(ft.Ei(15))return ft.Ri(15),j.rt.push(new R(j.selected)),x.assign((t=>t.construct(j.selected))),!0}};class R{constructor(t){this.hi={...t},this.Oi=10,this.zt=7,this.as=21,this.ni=0,this.ri=180,this.title="TOWER",this.Si=nt.rt[0]}It(){if(!(this.ni>=this.ri))return;22!==this.as&&(this.as=22,o.b(o.P));let t,i,s=X(Z(this.hi));if(!this.target||this.target.gt){for(let h of ft.is){if(!h.vi)continue;let e=g(s,h.Rt);e.O<32&&(!i||e.O<i.O)&&(t=h,i=e)}console.log("ATTEMPTED to pick target for building",t),this.target=t}this.Oi>0&&this.Oi--,this.target&&0===this.Oi&&(g(s,this.target),ft.is.push(new T(s,this.target)),this.Oi=100,o.b(o.L))}kt(){let t=Z(this.hi);if(K(X(t)),e.t.globalAlpha=21===this.as?.5:1,nt.Ht(nt.rt[0],t),e.t.globalAlpha=1,21===this.as){let i=q(Math.floor(8*this.ni/this.ri),0,7);e.t.globalAlpha=.5,nt.Ht(nt.bi[7],t),e.t.globalAlpha=1,nt.Ht(nt.bi[i],t)}}Ni(){return this.ni<this.ri?[w]:[]}}const N=[0,2];for(let t=2;t<=19;t++)N[t]=Math.floor(1.5*N[t-1]+1);for(let t=0;t<20;t++)N[t]=5*N[t];const I={Mi:()=>!1,xi:()=>nt.buttons[0],Ti:()=>nt.buttons[1],pi(t,i){let s=N[ft.Ui()],h=ft.Ei(s)?"LURE MOTH \ne"+s:"LURE MOTH \ner"+s;A.yt(e.t,h,t,i)},mi(){let t=N[ft.Ui()];if(ft.Ei(t))return ft.Ri(t),ft.is.push(new x(X(Z(j.selected)))),!0}};class p{constructor(t){this.hi={...t},this.title="YOUR COFFIN \nLAST CHANCE",this.Si=nt.rt[1],this.zt=9}It(){}kt(){let t=Z(this.hi);nt.Ht(nt.rt[1],t)}Ni(){return[I]}}class m{constructor(t){this.Rt={...t},this.Nt=-1,this.d=3,this.z=101,this.Ii=Math.random()*Math.PI*2}It(){++this.Nt===this.d&&(this.gt=!0),this.Ii+=.1}kt(){let t=this.Nt<2?0:1;nt.Ht(nt.attack[t],this.Rt,this.Ii)}}class U{constructor(t,i){this.Rt={...t},this.k=[],this.Ot={x:0,y:0},this.bt=2,this.gi=.2,this.ki=0,this.as=11,this.vi=!0,this.variant=i,i?1===i?(this.Ct=300,this.Hi=8,this.Li=.3):2===i&&(this.Ct=800,this.Hi=16,this.Li=.1):(this.Ct=100,this.Hi=8,this.Li=.3),this.Di=this.Ct}It(){let t=ft.is.filter((t=>t instanceof x)),i=t[0];if(!i)return;let s=g(this.Rt,i.Rt);for(let h=1;h<t.length;h++){let e=g(this.Rt,t[h].Rt);e.O<s.O&&(i=t[h],s=e)}const h=j.ai(this.Rt,i.Rt);let e=g(this.Rt,h);11===this.as?s.O<this.Hi?(this.as=12,this.Fi=10,this.Pi=i):(e.O=q(e.O,0,this.Li),this.Ot={x:(this.Ot.x+e.x*e.O)/2,y:(this.Ot.y+e.y*e.O)/2}):12===this.as?(this.Ot={x:.9*this.Ot.x,y:.9*this.Ot.y},this.Fi--,5===this.Fi?(this.Pi.k.push({di:10,qt:{x:0,y:0,O:0},yi:0}),ft.is.push(new m(this.Pi.Rt))):-30===this.Fi&&(this.as=11)):9===this.as&&(o.b(o.F),this.gt=!0,d.Ft(this))}kt(){let t=2*this.variant+(12===this.as?1:0),i=nt.qi[t];if(nt.Ht(i,this.Rt),this.Ct<this.Di){let t=Math.ceil(this.Ct/this.Di*7);t>=0&&nt.Ht(nt.ji[t],this.Rt)}}}const v={Mi:()=>!0,xi:()=>nt.buttons[2],Ti:()=>nt.buttons[3],pi(t,i){A.yt(e.t,"GATHER EARTH",t,i)},mi:()=>(x.assign((t=>t.ui(j.selected))),!0)};class H{constructor(t){this.hi={...t},this.oi=15e3,this.title="EARTH",this.Si=nt.rt[2]}It(){this.title="EARTH \n"+Math.ceil(this.oi/100)+" REMAINING",this.oi<1&&(this.gt=!0)}kt(){let t=Z(this.hi);nt.Ht(nt.rt[2],t)}Ni(){return[v]}}const b={Mi:()=>!0,xi:()=>nt.buttons[4],Ti:()=>nt.buttons[5],pi(t,i){A.yt(e.t,"EXPLORE",t,i)},mi:()=>(x.assign((t=>t.moveTo(j.selected))),!0)},S={Vi(t){let i=t.filter((t=>t.Rt&&t.Ot&&!t.gt));for(let t=0;t<5;t++){for(let t=0;t<i.length-1;t++)for(let s=t+1;s<i.length;s++)S.Yi(i[t],i[s]);for(let t of i)S.Wi(t)}for(let t of i)t.Rt.x+=t.Ot.x,t.Rt.y+=t.Ot.y},Yi(t,i){if(t.St||i.St)return;let s=function(t,i,s,h,e,n){[s,n]=[W(s),W(n)];let r=g({x:t.x+s.x,y:t.y+s.y},{x:h.x+n.x,y:h.y+n.y});if(r.O<i+e)return{Gi:r.x,Bi:r.y,O:i+e-r.O}}(t.Rt,t.bt,t.Ot,i.Rt,i.bt,i.Ot);if(s)if(t.vt&&i.vt)t.Ot.x=-s.Gi*s.O,t.Ot.y=-s.Bi*s.O,i.Ot.x=s.Gi*s.O,i.Ot.y=s.Bi*s.O;else{let h=V(t.Ot).O+i.gi,e=V(i.Ot).O+t.gi,n=t.vt?.1:1,r=i.vt?.1:1;t.Ot.x-=s.Gi*s.O*n*h/(h+e),t.Ot.y-=s.Bi*s.O*n*h/(h+e),i.Ot.x+=s.Gi*s.O*r*e/(h+e),i.Ot.y+=s.Bi*s.O*r*e/(h+e)}},Wi(t){if(!t.Ut){t.Rt.y<-1e3&&console.log("FUUUUUUUUUUUUUUUU");for(let i of function*(t,i,s){yield*function*(t,i,s){let h=[{x:Math.min(t.x,i.x)-s,y:Math.min(t.y,i.y)-s},{x:Math.max(t.x,i.x)+s,y:Math.max(t.y,i.y)+s}];yield*function*(t){for(let i=t[0].y/8|0;8*i<t[1].y;i++)for(let s=t[0].x/8|0;8*s<t[1].x;s++)yield{ii:s,r:i}}(h)}(t,{x:t.x+i.x,y:t.y+i.y},s)}(t.Rt,t.Ot,t.bt))if(!it(i.ii,i.r)){let s=[Z(i),Z({ii:i.ii+1,r:i.r+1})],h=$(t.Rt,{x:t.Rt.x+t.Ot.x,y:t.Rt.y+t.Ot.y},t.bt,s);h&&(t.vt?0===h.Gi?t.Ot.y=-t.Ot.y:0===h.Bi?t.Ot.x=-t.Ot.x:(t.Ot.x+=h.Gi,t.Ot.y+=h.Bi):0===h.Gi?t.Ot.y=h.y-t.Rt.y:0===h.Bi?t.Ot.x=h.x-t.Rt.x:(t.Ot.x+=h.Gi,t.Ot.y+=h.Bi))}}}},L={Vi(t){for(let i of t)if(i.Ct){if(i.k.length>0){if(9!==i.as&&1!==i.as)for(let t of i.k)i===ft.Ci&&ft.is.push(new HealthChunkAnimation(i.Ct,t.di)),i.Ct-=t.di,t.qt.O=t.yi,i.Ot=z(i.Ot,t.qt),i.Pt=t,d.k(i);i.k=[]}i.Ct<=0&&9!==i.as&&(i.as=9)}}},k=[[[0,0],[5,0],[10,0],[15,0]],[[0,0],[1,0],[2,0],[3,0],[10,0],[11,0],[12,0],[15,0],[15,0],[15,0]],[[0,0],[1,0],[2,0],[3,0],[4,0],[5,0],[10,0],[15,1]],[[0,1],[5,0],[5,0],[10,1],[15,0],[15,0],[20,1]],[[0,1],[5,0],[5,0],[10,0],[10,0],[15,0],[15,1],[20,2]]];class F{constructor(t){this.zi=t,t%=k.length,this.Ji=[...k[t]],this.Ki=720,this.Zi=!1,this.mt=0,this.Qi=60*this.Ji[this.Ji.length-1][0]}E(){if(this.Ki--,this.Ki>=0&&this.Ki<=120&&this.Ki%60==0&&o.b(o.q),this.Ki<=0){this.Zi=!0;for(let t=0;t<this.Ji.length;t++)this.mt===60*this.Ji[t][0]&&ft.Xi.push((i=>new U(i,this.Ji[t][1])));this.mt++}this.mt>=this.Qi&&0===ft.is.filter((t=>t.vi)).length&&(ft._i=void 0)}}class D{constructor(){this.frames=0}E(){this.frames++}kt(){e.t.fillStyle=st(36,26,20,q(this.frames/200,0,1)),e.t.fillRect(0,0,e.width,e.height);let t=e.width-32,i="ESCAPE! \n                    \nVILLAGERS STIR UNEASILY IN THEIR BEDS AS YOU EMERGE INTO MOONLIGHT. YOU SENSE WARM BODIES ALL AROUND YOU, RIPE FOR PICKING. IT IS ONLY A MATTER OF TIME NOW BEFORE YOU REGAIN YOUR FULL NECROMANTIC POWER. \n                    \nCONGRATULATIONS... AND THE END.";i=i.slice(0,this.frames),A.yt(e.t,i,16,16,t,1,1)}}class P{constructor(t){this.hi={...t},this.title="REACH EXIT \nTO ESCAPE",this.Si=nt.rt[3],this.zt=4}It(){let t=x.Ai(),i=X(Z(this.hi));for(let s of t)if(g(s.Rt,i).O<6)return void(ft.screen=new D)}kt(){let t=Z(this.hi);nt.Ht(nt.rt[3],t)}Ni(){return[b]}}const j={s(){this.c()},kt(){let t=this.jt[0].Vt,i=K({x:0,y:0});for(let s=0;s<t.length;s++)for(let h=0;h<t[0].length;h++)t[s][h]>0&&e.t.drawImage(nt.Vt[t[s][h]-1].nt,8*h+i.h,8*s+i.o);for(let t of this.rt)t.kt()},$i(){let t=this.Vt,i=K({x:0,y:0});for(let s=0;s<t.length;s++)for(let h=0;h<t[0].length;h++)if(t[s][h]>0){let t=1-q(this.ts[s][h]/5,.1,1);0===this.ss[s][h]&&(t=1),e.t.globalAlpha=t,e.t.drawImage(nt.hs[0].nt,8*h+i.h,8*s+i.o)}e.t.globalAlpha=1},c(){this.jt=E.jt.map((t=>({Vt:t.Vt.map((t=>[...t])),Wt:t.Wt.map((t=>({...t})))}))),this.bounds=E.bounds,this.Bt={ii:E.Bt[0],r:E.Bt[1]},this.rt=[],this.rt.push(new p(this.Bt));for(let t of this.jt[0].Wt)"EARTH"===t.name?this.rt.push(new H({ii:t.x,r:t.y})):"EXIT"===t.name&&(this.rt.push(new P({ii:t.x,r:t.y})),this.es={ii:t.x,r:t.y});this.selected=void 0,this.Vt=this.jt[0].Vt,this.width=this.Vt[0].length,this.height=this.Vt.length,this.ts=_(this.width,this.height,(()=>0)),this.ss=_(this.width,this.height,(()=>0)),this.ns={},this.rs()},E(){for(let t of this.rt)t.It();this.os()},ls(t){return 46===this.fs(t)},us(t){return this.cs.includes(this.jt[t.z].Vt[t.y][t.x])},As(t){this.jt[t.z]},mi(t){ft.is.push(new m(Q(t)));let i=C(Q(t)),s=this.fs(i);if(!s||s>8||!this.ss[i.r][i.ii])this.selected=void 0;else if(this.selected&&this.selected.ii===i.ii&&this.selected.r===i.r){let t=this.ei(this.selected);if(t){let i=t.Ni();i[0]&&i[0].Mi()&&i[0].mi()}else b.mi()}else this.selected=i,this.ei(this.selected)},fs(t){if(t)return this.jt[0].Vt[t.r]?.[t.ii]},ei(t){if(t)for(let i of this.rt)if(i.hi.ii===t.ii&&i.hi.r===t.r)return i},os(){let t=[];for(let i of this.rt)i.zt&&t.push({...i.hi,ds:i.zt});for(let i of ft.is)i.zt&&t.push({...C(i.Rt),ds:i.zt});this.ts=function(t,i,s=1/0){let h=_(t[0].length,t.length,(()=>0)),e=[...i];for(;e.length>0;){let{ii:t,r:i,ds:n}=e.shift();h[i][t]>=n||(h[i][t]=n--,h[i][t]>=s||(tt(t+1,i)&&h[i][t+1]<n&&e.push({ii:t+1,r:i,ds:n}),tt(t-1,i)&&h[i][t-1]<n&&e.push({ii:t-1,r:i,ds:n}),tt(t,i+1)&&h[i+1][t]<n&&e.push({ii:t,r:i+1,ds:n}),tt(t,i-1)&&h[i-1][t]<n&&e.push({ii:t,r:i-1,ds:n})))}return h}(this.Vt,t);for(let t=0;t<this.ts.length;t++)for(let i=0;i<this.ts[0].length;i++)this.ts[t][i]>this.ss[t][i]&&(this.ss[t][i]=1)},ai(t,i){let s=C(t),h=C(i);var e,n;if(e=s,n=h,Math.abs(e.ii-n.ii)+Math.abs(e.r-n.r)<=1)return i;let r=[h.ii,h.r].join(","),o=this.ns[r];o||(o=this.ns[r]=function(t,i,s=1/0){let h=_(t[0].length,t.length,(()=>1/0)),e=[{...i,ys:0}];for(;e.length>0;){let{ii:t,r:i,ys:n}=e.shift();h[i][t]<=n||(h[i][t]=n++,h[i][t]>=s||(it(t+1,i)&&h[i][t+1]>n&&e.push({ii:t+1,r:i,ys:n}),it(t-1,i)&&h[i][t-1]>n&&e.push({ii:t-1,r:i,ys:n}),it(t,i+1)&&h[i+1][t]>n&&e.push({ii:t,r:i+1,ys:n}),it(t,i-1)&&h[i-1][t]>n&&e.push({ii:t,r:i-1,ys:n})))}return h}(this.Vt,h)),console.log(Object.keys(this.ns).length);let l=[[s.ii+1,s.r],[s.ii-1,s.r],[s.ii,s.r+1],[s.ii,s.r-1]];for(let t of l)t.push(o[t[1]][t[0]]);return l.sort(((t,i)=>t[2]-i[2])),X(Z({ii:l[0][0],r:l[0][1]}))},rs(){for(let t=0;t<this.Vt.length;t++)for(let i=0;i<this.Vt[0].length;i++)if(14===this.Vt[t][i]){let s=0;(this.Vt[t-1]?.[i-1]||99)<8&&(s|=256),(this.Vt[t-1]?.[i]||99)<8&&(s|=128),(this.Vt[t-1]?.[i+1]||99)<8&&(s|=64),(this.Vt[t]?.[i-1]||99)<8&&(s|=32),(this.Vt[t]?.[i+1]||99)<8&&(s|=8),(this.Vt[t+1]?.[i-1]||99)<8&&(s|=4),(this.Vt[t+1]?.[i]||99)<8&&(s|=2),(this.Vt[t+1]?.[i+1]||99)<8&&(s|=1),nt.ws(s),this.Vt[t][i]=20+s}}},B=18,G={s(){this.Ms=ht(7,7)},E(){if(j.selected){let t=j.fs(j.selected),i=j.ei(j.selected);this.actions=i?i.Ni():t>=1&&t<=4?[b,w]:[]}else this.actions=[];u.tt&&(this.xs=void 0)},kt(){if(e.t.fillStyle=st(36,26,20,.4),e.t.fillRect(0,0,e.width,9),ft._i)if(ft._i.Zi){let t="WAVE "+(ft._i.zi+1),i=A.wt(t,1),s=(e.width-i)/2,h=Math.floor(ft.mt/60)%2==0?A.ct:A.At;A.dt(e.t,t,s,2,1,h)}else{let t=Math.ceil(ft._i.Ki/60);if(t<=30){let i="NEXT WAVE",s=A.wt(i,1)+2,h=(e.width-s)/2;A.dt(e.t,"NEXT WAVE ",h,2),this.Ms.t.clearRect(0,0,7,7),this.Ms.t.fillStyle=st(255,212,163,1),this.Ms.t.beginPath(),this.Ms.t.moveTo(3.5,3.5),this.Ms.t.lineTo(3.5,0),this.Ms.t.arc(3.5,3.5,3,1.5*Math.PI,1.5*Math.PI+t/30*Math.PI*2),this.Ms.t.fill(),e.t.drawImage(this.Ms.e,h+s,1)}}let i=ft.is.filter((t=>t instanceof x));for(let t=0;t<i.length;t++)e.t.drawImage(nt.fi[1].nt,2+4*t,2);let s,h=ft.li+"e",n=A.wt(h,1);if(e.t.fillStyle="rgba(0, 0, 0, 0.1)",A.dt(e.t,h,e.width-n-2,2),u.Y){let t=u.Y.h,i=u.Y.o,s=Q(u.Y),h=C(s);if(A.dt(e.t,t+","+i+". "+s.x+","+s.y+". "+h.ii+","+h.r+".",e.width-100,20),j.selected){let t=j.Vt[j.selected.r][j.selected.ii];t>20&&(t-=20),A.dt(e.t,j.selected.ii+","+j.selected.r+". "+t.toString(2).padStart(9,"0"),e.width-100,29)}}if(j.selected){let t=K({x:8*j.selected.ii,y:8*j.selected.r});e.t.fillStyle=st(255,212,163,.25),e.t.fillRect(t.h,t.o,9,9)}if(e.t.fillStyle="#ffd4a3",e.t.fillRect(0,e.height-B,e.width,1),e.t.fillStyle="#8d697a",e.t.fillRect(0,e.height-B+1,e.width,1),e.t.fillStyle="#203c56",e.t.fillRect(0,e.height-B+2,e.width,16),e.t.fillStyle="#8d697a",e.t.fillRect(0,e.height-2,e.width,2),e.t.drawImage(nt.Ts[0].nt,-2,e.height-B+1),e.t.drawImage(nt.Ts[0].nt,64,e.height-B+1),e.t.drawImage(nt.Ts[0].nt,e.width-3,e.height-B+1),j.selected){let i=j.ei(j.selected);if(i)e.t.drawImage(i.Si.nt,3,e.height-B-1),A.yt(e.t,i.title,14,e.height-B+3,e.width);else{let i=j.fs(j.selected);console.log(j.selected,i,t[i-1]),e.t.drawImage(nt.hs[1].nt,4,e.height-B+6),e.t.drawImage(nt.Vt[i-1].nt,3,e.height-B+5),A.yt(e.t,t[i-1],14,e.height-B+3,e.width)}}for(let t=0;t<this.actions.length;t++){let i=this.actions[t],h=this.ps(t);e.t.drawImage(nt.Ts[0].nt,h.h+11,e.height-B+1),e.t.drawImage(i.xi().nt,h.h,h.o),this.xs===i&&(s=t)}if(s>=0){let t=this.ps(s);e.t.drawImage(nt.Es[0].nt,t.h-23,t.o-19),e.t.drawImage(this.xs.Ti().nt,t.h,t.o),this.xs.pi(t.h-23+3,t.o-19+3)}u.Y&&(ft.Rs&&(e.t.globalAlpha=.5),nt.Ht(nt.Os,Q(u.Y)),e.t.globalAlpha=1)},ps:t=>({h:68+15*t,o:e.height-15}),mi(t){if(t.o>e.height-B){for(let i=0;i<this.actions.length;i++){let s=this.ps(i);if(t.h>=s.h&&t.h<=s.h+12&&t.o>=s.o&&t.o<=s.o+12)return this.actions[i]===this.xs?this.xs.mi()&&(this.xs=void 0):this.xs=this.actions[i],!0}return this.xs=void 0,!0}return this.xs=void 0,!1}},Y={s(){this.Rt={x:0,y:0},this.Ss=void 0,this.Ot={x:0,y:0}},E(){if(this.Ss){let t=g(this.Rt,this.Ss);if(t.O<1)return void(this.Ss=void 0);t.O=q(t.O,0,2);let i=W(t);this.Ot={x:(this.Ot.x+i.x)/2,y:(this.Ot.y+i.y)/2},this.Rt.x+=this.Ot.x,this.Rt.y+=this.Ot.y}u.pt[u.A.j]&&(this.vs={...this.Rt}),u.tt&&(this.Rt={x:this.vs.x-u.it.x,y:this.vs.y-u.it.y})}};function V(t){let i=Math.sqrt(t.x*t.x+t.y*t.y);return 0===i?{x:0,y:0,O:0}:{x:t.x/i,y:t.y/i,O:i}}function g(t,i){return V({x:i.x-t.x,y:i.y-t.y})}function J(t,i){return{x:Math.cos(t),y:Math.sin(t),O:i||1}}function W(t){return{x:t.x*(t.O||1),y:t.y*(t.O||1)}}function z(...t){let i={x:0,y:0,O:1};for(let s of t)i.x+=s.x*(s.O||1),i.y+=s.y*(s.O||1);return i}function C(t){return{ii:t.x/8|0,r:t.y/8|0}}function Z(t){return{x:8*t.ii,y:8*t.r}}function K(t){return{h:t.x+e.i.h-Y.Rt.x,o:t.y+e.i.o-Y.Rt.y}}function Q(t){return{x:t.h-e.i.h+Y.Rt.x,y:t.o-e.i.o+Y.Rt.y}}function X(t){return{x:t.x+4,y:t.y+4}}function q(t,i,s){return t<i?i:t>s?s:t}function $(t,i,s,h){if(Math.max(t.x,i.x)+s<h[0].x||Math.min(t.x,i.x)-s>h[1].x||Math.max(t.y,i.y)+s<h[0].y||Math.min(t.y,i.y)-s>h[1].y)return;let e=i.x-t.x,n=i.y-t.y,r=0===e?0:1/e,o=0===n?0:1/n,l=1/0,f=1/0;if(t.x-s<h[0].x&&i.x+s>h[0].x){let i=(h[0].x-s-t.x)*r;if(i>=0&&i<=1){let s=n*i+t.y;if(s>=h[0].y&&s<=h[1].y)return{x:e*i+t.x,y:s,Nt:i,Gi:-1,Bi:0,bs:h[0].x,Ns:s}}l=h[0].x}if(t.x+s>h[1].x&&i.x-s<h[1].x){let o=(t.x-(h[1].x+s))*-r;if(o>=0&&o<=1){let s=n*o+i.y;if(s>=h[0].y&&s<=h[1].y)return{x:e*o+t.x,y:s,Nt:o,Gi:1,Bi:0,bs:h[1].x,Ns:s}}l=h[1].x}if(t.y-s<h[0].y&&i.y+s>h[0].y){let i=(h[0].y-s-t.y)*o;if(i>=0&&i<=1){let s=e*i+t.x;if(s>=h[0].x&&s<=h[1].x)return{x:s,y:n*i+t.y,Nt:i,Gi:0,Bi:-1,bs:s,Ns:h[0].y}}f=h[0].y}if(t.y+s>h[1].y&&i.y-s<h[1].y){let i=(t.y-(h[1].y+s))*-o;if(i>=0&&i<=1){let s=e*i+t.x;if(s>=h[0].x&&s<=h[1].x)return{x:s,y:n*i+t.y,Nt:i,Gi:0,Bi:1,bs:s,Ns:h[0].y}}f=h[1].y}if(l===1/0&&f===1/0)return;l!==1/0&&f===1/0&&(f=n>0?h[1].y:h[0].y),f!==1/0&&l===1/0&&(l=e>0?h[1].x:h[0].x);let u=1/s,a=Math.sqrt(e*e+n*n),c=l-t.x,A=f-t.y,M=Math.sqrt(c*c+A*A),y=Math.acos((c*e+A*n)/(a*M));if(M<s)return;if(0===y){let i=(M-s)/a;if(i>1||i<0)return;let h=i*e+t.x,r=i*n+t.y,o=c/M,u=A/M;return isNaN(h)?void 0:{x:h,y:r,Nt:i,Gi:o,Bi:u,bs:l,Ns:f}}let O=Math.sin(y),d=O*M*u;if(Math.abs(d)>1)return;let E=Math.PI-Math.asin(d),x=Math.PI-y-E,T=s*Math.sin(x)/O/a;if(T>1||T<0)return;let w=T*e+t.x,R=T*n+i.y,N=(w-l)*u,I=(R-f)*u;return isNaN(w)?void 0:{x:w,y:R,Nt:T,Gi:N,Bi:I,bs:l,Ns:f}}function _(t,i,s){return Array.from({length:i},(()=>Array.from({length:t},s)))}function tt(t,i){let s=j.jt[0].Vt;return!(t<0||i<0||i>=s.length||t>=s[i].length)}function it(t,i){let s=j.jt[0].Vt;return!(t<0||i<0||i>=s.length||t>=s[i].length)&&s[i][t]>=1&&s[i][t]<=4}function st(t,i,s,h){return`rgba(${t},${i},${s},${h})`}function ht(t,i){let s=document.createElement("canvas");s.width=t,s.height=i;let h=s.getContext("2d");return{e:s,t:h}}const et={attack:[[0,0,10,10],[10,0,10,10]],rt:[[0,10,8,16],[8,10,8,16],[16,10,8,16],[24,10,8,16]],wi:[[0,26,3,3]],buttons:[[0,29,12,12],[12,29,12,12],[24,29,12,12],[36,29,12,12],[48,29,12,12],[60,29,12,12],[72,29,12,12],[84,29,12,12]],cursor:[[0,41,10,8]],ji:[[0,49,9,9],[9,49,9,9],[18,49,9,9],[27,49,9,9],[36,49,9,9],[45,49,9,9],[54,49,9,9],[63,49,9,9]],font:[[0,58,180,12]],qi:[[0,70,9,9],[9,70,9,9],[18,70,9,9],[27,70,9,9],[36,70,9,9],[45,70,9,9]],Lt:[[0,79,5,5],[5,79,5,5],[10,79,5,5],[15,79,5,5]],Us:[[0,84,9,9]],Is:[[0,93,13,16]],Ts:[[0,109,5,16]],Es:[[0,125,60,18]],bi:[[0,143,7,7],[7,143,7,7],[14,143,7,7],[21,143,7,7],[28,143,7,7],[35,143,7,7],[42,143,7,7],[49,143,7,7]],gs:[[0,150,7,9],[7,150,7,9]],fi:[[0,159,3,3],[3,159,3,3],[6,159,3,3]],hs:[[0,162,8,8],[8,162,8,8]],Vt:[[0,170,8,8],[8,170,8,8],[16,170,8,8],[24,170,8,8],[32,170,8,8],[40,170,8,8],[48,170,8,8],[56,170,8,8],[64,170,8,8],[72,170,8,8],[80,170,8,8],[88,170,8,8],[96,170,8,8],[104,170,8,8]],ks:[[0,178,4,4],[4,178,4,4]],Hs:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAC2CAMAAABH21cLAAAAZlBMVEUAAADuw5oAAAANK0UgPFYhIickGhQuCAFTV1JUTmhcDwBtbnN1EgCNaXqPGxuPn6iRm6ObrbemraXCHQDJAADL2/zQgVnRFRXfcSbmAADuw5ru6WTwJAD78jb/ql7/1KP/7Nb///+8jDFnAAAAAnRSTlMAlm//+0kAAAP5SURBVHja7Z2Llps4DIbVxLNb0mV6D73a+P1fclH4sZzjZsKyEKwz+hyPhHI5X1Ul0OtQRxrpngkg0cBzl7Q7s96WTps1Wt2RRutns36YtqSkh44MwzBeLw12lXy7QAUtU6szvhawcP3S3nvKODNVjwc7h2PwuTR2xc1m5yOsW38pMJVLS6fbcSo4VyPd+vPZ6+l0CP7S58G6/k4DNFYDb0gfb36otCaNeMB5AGvWt8A3wBOFFoS16ts5Ax/aRFhS9wNTPQxw2E7aNz5JhGGJHOqM1BmfSYdJWh7PtQ2loSByozoLMJALF2529Ha9nvHI5NhO6tnj+ct20sNKcrwWzO7DpTGHvKY55OXhlo3HNLsoT/V2B+mX31iQgAOks3pAfRfpYgzWqqs+udhpvCeF9Bqt+9BrlFZo3Qd6HIZhGIZhGM8jRCElISUhJSElISUhJYEeTpxdL4kxEvFt2hRRm+KMF8Jz5XXkNcbFIF9BGpJjhqPMM6b1ErFYJHu+NJgpTUWX0Ll03x3p6TnSBDmOIo3aAmIpjVvZn4j7l3Y6P17Q6cI5FjM9jQmibNRflC5nmuh6pvP3i0KKH6VEvIPLNda3RmZcxBKlWPFTcmPiVgFmkgsim69SOl53PpfOZ3dVZ/lM5yDknYYOUip7GFMm0hE71VYmygZiFJEh5neKTJSu551FVWpbg87nY/Kq6HjVZdR1Nyo9Lz7uedVg3ff9aDgk3ezKvpRdvF/ZnZ5BE3vF0vcr+0tTj3FFE+9X6qHrqJtfMV4P31P4Rf+clAifvnD240Snz78grYUTbzjrEv+bdBDpEZj0T+xtMWKUYNhM20feTrQ5eqQbN9IokoYzW+uRdoJJm7RJb45Jm7RJ22ncLpgEZdKkjGZwbkgZrmkbp07atc6kTdqkTdqkH4VJ22ncLphahrQRFrOjc7uYsKO0W4hJA5M2aZM2aZM26X0w6f0v8/I/IPgzoboL6ivp8EeoPjJpqpG+/2+h57A3kLgbegSmmk4P3AwFu0sjzLMFVBe5dK9EGp2H8+1QI3felTtzYFLQweH378PH94fD+4+cmfQ1Jp2jRvrjAHea45bSJv2eOSDQJtjnNAjDUkbAbWOs2X+BIzBpkzZpkzbpujj+Twgc29ZxvKq7tuX6JYJ1pF3DuCLewo0U0mfv8F2ZPO9R+uzZme2PY/28jnQzUsSl0t573knajdnxzPWzX1nazZQeVyHtR2kHRlUUcb8bjnfpNKxvzbSAmc7v5+MdpEsc4PEopaXI97vheG1pJ9KDxEymN94NaZlpPG6jTw84z2R64x39n6S9fHrgcbQGHz58eEva+PDu3RN9/aRQ+tMTqeLt0xOM9fAvdZAFlnbFTwYAAAAASUVORK5CYII="},nt={Ls(t){let i=new Image;i.onload=t,i.src=et.Hs,nt.ms=i},s(){nt.font=rt(et.font[0]),nt.Ds=rt(et.gs[0]),nt.Fs=rt(et.gs[1]),nt.fi=et.fi.map(rt),nt.Lt=et.Lt.map(rt),nt.Us=et.Us.map(rt),nt.Os=et.cursor.map((t=>rt(t,{x:0,y:0})))[0],nt.wi=et.wi.map(rt),nt.Is=et.Is.map(rt),nt.Ts=et.Ts.map(rt),nt.Es=et.Es.map(rt),nt.bi=et.bi.map((t=>rt(t,{x:-1,y:-1}))),nt.Vt=et.Vt.map(rt),nt.hs=et.hs.map(rt),nt.qi=et.qi.map(rt),nt.rt=et.rt.map((t=>rt(t,{x:0,y:8}))),nt.buttons=et.buttons.map(rt),nt.Ps=ot(function(t){let i=ht(544,334);for(let s=0;s<334;s+=32)for(let h=0;h<544;h+=32)i.t.drawImage(t,h,s);return i.e}(nt.Vt[0].nt)),nt.ut=ot(function(){let t=ht(500,500),i=t.t.createRadialGradient(250,250,0,250,250,250);return i.addColorStop(.3,st(0,0,0,0)),i.addColorStop(1,st(0,0,0,.9)),t.t.fillStyle=i,t.t.fillRect(0,0,500,500),t.e}()),nt.attack=et.attack.map(rt),nt.ji=et.ji.map(rt)},qs(t,i,s,h){t.drawImage(i.nt,s-i.Xs.x,h-i.Xs.y)},Ht(t,i,s){let{h:h,o:n}=this.js(t,i);s?(e.t.save(),e.t.translate(h+t.Xs.x,n+t.Xs.y),e.t.rotate(s),e.t.drawImage(t.nt,-t.Xs.x,-t.Xs.y),e.t.restore()):e.t.drawImage(t.nt,h,n)},js:(t,i)=>({h:i.x-t.Xs.x-Y.Rt.x+e.i.h,o:i.y-t.Xs.y-Y.Rt.y+e.i.o}),ws(t){return this.Vt[t+20-1]||(this.Vt[t+20-1]=ot(function(t,i){let s=ht(8,8);return 256&i&&s.t.drawImage(t[12].nt,0,0,4,4,0,0,4,4),64&i&&s.t.drawImage(t[12].nt,5,0,3,3,5,0,3,3),1&i&&s.t.drawImage(t[12].nt,6,6,2,2,6,6,2,2),4&i&&s.t.drawImage(t[12].nt,0,5,3,3,0,5,3,3),8&i&&s.t.drawImage(t[11].nt,5,0,3,8,5,0,3,8),32&i&&s.t.drawImage(t[9].nt,0,0,4,8,0,0,4,8),2&i&&s.t.drawImage(t[8].nt,0,5,8,3,0,5,8,3),128&i&&s.t.drawImage(t[10].nt,0,0,8,4,0,0,8,4),160==(160&i)&&s.t.drawImage(t[13].nt,0,0,5,5,0,0,5,5),136==(136&i)&&s.t.drawImage(t[13].nt,4,0,4,4,4,0,4,4),10==(10&i)&&s.t.drawImage(t[13].nt,4,4,4,4,4,4,4,4),34==(34&i)&&s.t.drawImage(t[13].nt,0,4,5,4,0,4,5,4),s.e}(this.Vt,t),{x:0,y:0})),this.Vt[t+20-1]}};function rt(t,i){return ot(function(t,i,s,h){const e=nt.ms,n=ht(s,h);return n.t.drawImage(e,t,i,s,h,0,0,s,h),n.e}(...t),i)}function ot(t,i){let s=t.width,h=t.height;return{nt:t,Xs:"object"==typeof i?i:{x:s/2|0,y:h/2|0}}}class lt{constructor(){this.frames=0}E(){return this.frames++,u.pt[u.A.X]&&this.frames>30&&ft.c(),!0}kt(){e.t.fillStyle=st(36,26,20,q(this.frames/200,0,1)),e.t.fillRect(0,0,e.width,e.height);let t=e.width-32,i="DEFEAT... \n                    \nYOUR LAST MOTH GONE, THIS WORLD SLIPS FROM YOUR GRASP. YOU CURSE THE VILLAGE AND ITS INHABITANTS AS YOU TUMBLE TOWARDS THAT BLEAK BEYOND. \n \nYOUR REIGN OF TERROR HAS ENDED. \n \nTAP TO TRY AGAIN!";i=i.slice(0,this.frames),A.yt(e.t,i,16,16,t,1,1,A.At)}}const ft=new class{s(){nt.Ls((()=>{e.s(),nt.s(),A.s(),u.s(),o.s(),G.s(),Y.s(),j.s(),window.addEventListener("blur",(()=>this.Q())),window.addEventListener("focus",(()=>this.at())),this.c(),this.start()}))}c(){this.is=[],this.Vs={},this.Ys={},this.Ws={},this.Gs=0,this.Bs=[],this.Xi=[],this.zi=0,this.li=250,this.Cs=0,this.is.push(new x(Z(j.Bt))),this.screen=void 0,this._i=void 0,j.c(),Y.Rt=X(Z(j.es)),Y.Ss=X(Z(j.Bt))}start(){this.mt=0,this.zs=[0],this.E(),window.requestAnimationFrame((t=>this.Js(t)))}Js(t){let i=(new Date).getTime();this.zs.length>=40&&this.zs.shift(),this.Ks=1e3/((this.zs[this.zs.length-1]-this.zs[0])/this.zs.length),this.mt++,e.n(),this.E(),this.kt(e.t),window.requestAnimationFrame((t=>this.Js(t)));let s=(new Date).getTime();this.zs.push(this.zs[this.zs.length-1]+s-i)}E(){if(this._i||(this._i=new F(this.zi++)),u.E(),!(this.screen&&this.screen.E()||(u.pt[u.A.X]&&this.mi(u.Y),G.E(),this.$s))){this._i.E(),this.Zs(),console.log(ft.is);for(let t of ft.is)t.It&&t.It();L.Vi(this.is),S.Vi(this.is),Y.E(),this.is=this.is.filter((t=>!t.gt)),j.rt=j.rt.filter((t=>!t.gt)),this.Bs=this.Bs.filter((t=>t.E())),j.E(),0===this.is.filter((t=>t instanceof x)).length&&(ft.screen=new lt),ft.mt%6==0&&(this.Gs=10*Math.random()|0),30===ft.mt&&ft.Bs.push(new O(20,20,20)),u.pt[u.A.C]&&!ft.Qs&&(ft.Qs=!0)}}kt(){e.t.setTransform(1,0,0,1,0,0),e.t.scale(e.scale,e.scale),e.t.fillStyle=st(36,26,20,1),e.t.fillRect(0,0,e.width,e.height),j.kt();for(let t of this.is)(!t.z||t.z<100)&&t.kt();for(let t of this.is)t.z&&t.z>100&&t.kt();j.$i(),G.kt(),ft.mt<120&&(e.t.fillStyle=st(0,0,0,1-ft.mt/120),e.l()),this.screen&&this.screen.kt()}Q(){this.$s||(this.$s=!0,o.Q())}at(){this.$s&&(this.$s=!1,o.at())}mi(t){for(let i of[G,j])if(i.mi(t))break}Ui(){return this.is.filter((t=>t instanceof x)).length}Ei(t){if(this.li>=t)return!0}Ri(t){this.li-=t}Zs(){let t=this.Xi[0];if(t)for(let i=0;i<10;i++){let i=Math.floor(Math.random()*j.jt[0].Vt[0].length),s=Math.floor(Math.random()*j.jt[0].Vt.length);if(1!==j.Vt[s][i])continue;if(0!==j.ts[s][i])continue;let h=Z({ii:i,r:s});console.log("NEW monster"+h.x+","+h.y+","+j.ts[s][i]),ft.is.push(t(h)),this.Xi.shift();break}}};ft.s()}();
//# sourceMappingURL=app.js.map</script>
<style>body,html{margin:0;padding:0;background-color:#000}div{position:absolute;top:0;bottom:0;left:0;right:0}#canvas{width:100%;height:100%;touch-action:none}</style><div><canvas id="canvas"></canvas></div><script>!function(){"use strict";const t=45*Math.PI/180,i=90*Math.PI/180,s=360*Math.PI/180,h={s(){h.e=document.getElementById("canvas"),h.t=h.e.getContext("2d"),h.n(!0)},n(t){let i=window.devicePixelRatio,s=h.e.clientWidth,e=h.e.clientHeight,n=s*i,r=e*i;(t||h.e.width!==n||h.e.height!==r)&&(h.e.width=n,h.e.height=r,h.scale=(10*Math.max(n/240,r/135)|0)/10,h.width=Math.ceil(n/h.scale),h.height=Math.ceil(r/h.scale),h.i={h:h.width/2|0,o:h.height/2|0},h.clientWidth=s,h.clientHeight=e,h.t.imageSmoothingEnabled=!1),h.e.style.cursor="none"},l(){h.t.fillRect(0,0,h.width,h.height)}},e={s(){e.map={KeyW:M.A.u,KeyA:M.A.M,KeyS:M.A.T,KeyD:M.A.p,ArrowUp:M.A.u,ArrowLeft:M.A.M,ArrowDown:M.A.T,ArrowRight:M.A.p,Escape:M.A.m},e.O=[{x:0,y:0,S:0},{x:0,y:-i,S:1},{x:0,y:i,S:1},{x:0,y:0,S:0},{x:-i,y:0,S:1},{x:-t,y:-t,S:1},{x:-t,y:t,S:1},{x:-i,y:0,S:1},{x:i,y:0,S:1},{x:t,y:-t,S:1},{x:t,y:t,S:1},{x:i,y:0,S:1},{x:0,y:0,S:0},{x:0,y:-i,S:1},{x:0,y:i,S:1},{x:0,y:0,S:0}],e.R=[],window.addEventListener("keydown",(t=>{let i=e.map[t.code];i&&(e.R[i]=!0)})),window.addEventListener("keyup",(t=>{let i=e.map[t.code];i&&(e.R[i]=!1)})),e.c()},E(){let t=(e.R[M.A.u]?1:0)+(e.R[M.A.T]?2:0)+(e.R[M.A.M]?4:0)+(e.R[M.A.p]?8:0);e.w=e.O[t]},c(){e.w=e.O[0];for(let t of Object.values(M.A))e.R[t]=!1}},n=(t=1,i=.05,s=220,h=0,e=0,n=.1,l=0,f=1,u=0,a=0,c=0,M=0,A=0,d=0,E=0,y=0,w=0,x=1,S=0,O=0)=>{let R,T,U=2*Math.PI,I=u*=500*U/o**2,H=(0<E?1:-1)*U/4,N=s*=(1+2*i*Math.random()-i)*U/o,b=[],k=0,L=0,p=0,m=1,C=0,v=0,D=0;for(a*=500*U/o**3,E*=U/o,c*=U/o,M*=o,A=o*A|0,T=(h=99+o*h)+(S*=o)+(e*=o)+(n*=o)+(w*=o)|0;p<T;b[p++]=D)++v%(100*y|0)||(D=l?1<l?2<l?3<l?Math.sin((k%U)**3):Math.max(Math.min(Math.tan(k),1),-1):1-(2*k/U%2+2)%2:1-4*Math.abs(Math.round(k/U)-k/U):Math.sin(k),D=(A?1-O+O*Math.sin(2*Math.PI*p/A):1)*(0<D?1:-1)*Math.abs(D)**f*t*r*(p<h?p/h:p<h+S?1-(p-h)/S*(1-x):p<h+S+e?x:p<T-w?(T-p-w)/n*x:0),D=w?D/2+(w>p?0:(p<T-w?1:(T-p)/w)*b[p-w|0]/2):D),R=(s+=u+=a)*Math.sin(L*E-H),k+=R-R*d*(1-1e9*(Math.sin(p)+1)%2),L+=R-R*d*(1-1e9*(Math.sin(p)**2+1)%2),m&&++m>M&&(s+=c,N+=c,m=0),!A||++C%A||(s=N,u=I,m=m||1);return b},r=.3,o=44100,l=new(top.AudioContext||webkitAudioContext);l.destination;const f=[[[1.3,0,23,,,.2,3,5],[1.5,0,4e3,,,.03,2,1.25,,,,,.02,6.8,-.3,,.5],[.7,0,2100,,,.2,3,3,,,-400,,,2],[,0,655,,,.11,2,1.65,,,,,,3.8,-.1,.1]],[[[,-.5,13,,,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,14,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,14,,,,],[1,.3,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,],[2,1,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,],[,.6,,,,,13,,18,,19,,,,,,,,19,,18,,,,16,,,,13,,,,,,,,,,13,,18,,19,,,,,,,,18,19,18,,,,13,14,13,,16,,18,,19,,],[3,-1,,,13,,,,,,,,,,,,13,,,,,,,,,,,,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,,,13,13,13,13]],[[,-.5,13,,,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,14,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,14,,,,],[1,.3,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,],[2,1,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,]]],[1,1,0,0,0,0,1,0],,],u={s(){u.U=!1,u.t=l,u.I=u.t.createGain(),u.I.connect(u.t.destination),u.k=[,.01,140,.01,.02,.45,4,2.42,.1,-.1,,,,1.2,,.3,.04,.8,.02],u.b=[,,1233,,.01,.2,1,1.43,,,539,.1,,,,,,.51,.03,.01],u.g=[,,68,.01,,.14,1,1.53,7.5,.1,50,.02,-.01,-.2,.1,.2,,.47,.01],u.v=[,,391,,.19,.01,2,.54,-4,20,,,,,,,.02,.9],u.L=[,,970,.12,.25,.35,,.39,8.1,,10,.1,.2,,.1,,,.6,.09,.13],u.H=[,,454,.06,.86,.71,2,.63,-.7,1.7,-83,.09,.27,.3,.2,,.18,.95,.02,.02],u.N=((t,i,s,h=125)=>{let e,r,l,f,u,a,c,M,A,d,E,y,w,x,S,O=[],R=[],T=[],U=0,I=1,H={},N=o/h*60>>2;for(;I;U++)O=[I=M=y=0],s.map(((h,o)=>{for(c=i[h][U]||[0,0,0],I|=!!i[h][U],x=y+(i[h][0].length-2-!M)*N,r=2,f=y;r<c.length+(o==s.length-1);M=++r){for(u=c[r],A=d!=(c[0]||0)|u|0,l=0;l<N&&M;l++>N-99&&A?E+=(E<1)/99:0)a=(1-E)*O[w++]/2||0,R[f]=(R[f]||0)+a*S-a,T[f]=(T[f++]||0)+a*S+a;u&&(E=u%1,S=c[1]||0,(u|=0)&&(O=H[[d=c[w=0]||0,u]]=H[[d,u]]||(e=[...t[d]],e[2]*=2**((u-12)/12),n(...e))))}y=x}));return[R,T]})(...f),localStorage.q=JSON.stringify(f)},E(){},Q(t){},at(){},pt(){}},a={s(){this.map=[],this.map[0]=M.A.D,this.map[2]=M.A.C,this.R=[],window.addEventListener("mousemove",(t=>{this.P||(this.P={}),this.P.h=t.clientX*h.width/h.clientWidth|0,this.P.o=t.clientY*h.height/h.clientHeight|0,M.mode=2})),window.addEventListener("mouseout",(()=>{this.P=void 0})),window.addEventListener("mousedown",(t=>{let i=this.map[t.button];i&&(this.R[i]=!0),u.U=!0,ct.Y="mousedown",M.mode=2,this.G={h:t.clientX*h.width/h.clientWidth|0,o:t.clientY*h.height/h.clientHeight|0}})),window.addEventListener("mouseup",(t=>{let i=this.map[t.button];i&&(this.R[i]=!1),ct.Y="mouseup",M.mode=2})),window.addEventListener("click",(t=>{t.preventDefault(),ct.Y="click"})),window.addEventListener("contextmenu",(t=>{let i=this.map[t.button];i&&(this.R[i]=!0),this.V=2,t.preventDefault()})),a.c()},E(){this.V&&(this.V--,0===this.V&&(this.R[M.A.C]=!1))},c(){this.P=void 0;for(let t of Object.values(M.A))this.R[t]=!1}},c={s(){this.map=[],this.map[0]=M.A.D,this.R=[],window.addEventListener("touchmove",(t=>{this.P||(this.P={});let i=t.changedTouches[0];this.P.h=i.clientX*h.width/h.clientWidth|0,this.P.o=i.clientY*h.height/h.clientHeight|0,M.mode=1})),window.addEventListener("touchstart",(t=>{let i=this.map[0];i&&(this.R[i]=!0),u.U=!0,ct.Y="TOUCHSTART",M.mode=1;let s=t.changedTouches[0];this.G={h:s.clientX*h.width/h.clientWidth|0,o:s.clientY*h.height/h.clientHeight|0},this.P={...this.G}})),window.addEventListener("touchend",(t=>{let i=this.map[0];i&&(this.R[i]=!1),ct.Y="TOUCHEND",M.mode=1})),this.c()},E(){},c(){this.P=void 0;for(let t of Object.values(M.A))this.R[t]=!1}},M={A:{u:11,T:12,M:13,p:14,W:21,C:30,m:96,F:97,B:98,D:40,Z:41,j:42},s(){this.w={x:0,y:0,S:0},this.mt={},this.K={},this.R={},this.X={},e.s(),a.s(),c.s(),this.mode=1,this.J=!1},E(){e.E();let t=2===this.mode?a:c;for(let i of Object.values(M.A)){let s=t.R[i]||e.R[i];this.mt[i]=!this.R[i]&&s,this.K[i]=this.R[i]&&!s,this.mt[i]?this.X[i]=1:this.R[i]&&s&&this.X[i]++,this.R[i]=s}this.P=t.P,this.w=e.w,this.R[M.A.D]&&(this.X[M.A.D]>20&&(this.J=!0),Math.abs(t.G.h-t.P.h)+Math.abs(t.G.o-t.P.o)>5&&(this.J=!0)),this.J&&t.P&&(this._={x:t.P.h-t.G.h,y:t.P.o-t.G.o}),this.K[M.A.D]&&(this.J?this.J=!1:(this.mt[M.A.j]=!0,this.X[M.A.j]=1))},$(t){},tt(t){}},A={10:0,32:3,33:3,39:2,44:3,46:3,73:2},d={},E={s(){E.it=ot.font.st;let t=[[101,ot.ht[2]]];for(let i of t)d[i[0]]=i[1],A[i[0]]=i[1].st.width+1;E.et=y(E.it,et(0,0,0,1)),E.nt=y(E.it,et(90,20,90,.15)),E.blue=y(E.it,et(200,40,220,1)),E.rt=y(E.it,et(240,50,200,.2)),E.ot=y(E.it,et(240,240,255,.25)),E.red=y(E.it,et(240,50,50,1)),E.lt=w(E.it,"#ffaa5e","#ffd4a3"),E.ft=w(E.it,"#ffaa5e","#ffd4a3",et(255,0,0,.7))},ut(t,i,s,h,e=1,n=E.lt,r){for(let o=0;o<i.length;o++){let l=i.charCodeAt(o);if(119!==l)if(114!==l){if(d[l])t.drawImage(d[l].st,s,h-(d[l].st.height+4)/2);else{let i=4*(l-32);r&&t.drawImage(r,i%180,6*(i/180|0),3,5,s+1,h+1,3*e,5*e),t.drawImage(n,i%180,6*(i/180|0),3,5,s,h,3*e,5*e)}s+=(A[l]||4)*e}else n=E.ft;else n=E.lt}},ct(t,i,s,h,e,n,r=1,o=E.lt,l){let f=s,u=h,a=i.split(" ");for(let i of a){for(;"\n"===i[0];)i=i.slice(1),f=s,u+=6*r;let h=E.dt(i,r);f+h-s>e&&(f=s,u+=6*r),E.ut(t,i,f,u,r,o,l),f+=h+(A[32]||4)}},dt:(t,i)=>t.split("").reduce(((t,i)=>t+(A[i.charCodeAt(0)]||4)),0)*i};function y(t,i){let s=nt(t.width,t.height);return s.t.fillStyle=i,s.t.fillRect(0,0,t.width,t.height),s.t.globalCompositeOperation="destination-in",s.t.drawImage(t,0,0),s.e}function w(t,i,s,h){let e=nt(t.width,t.height);return e.t.fillStyle=s,e.t.fillRect(0,0,t.width,t.height),e.t.fillStyle=i,e.t.fillRect(0,0,t.width,1),e.t.fillRect(0,6,t.width,1),h&&(e.t.fillStyle=h,e.t.fillRect(0,0,t.width,t.height)),e.t.globalCompositeOperation="destination-in",e.t.drawImage(t,0,0),e.e}class x{constructor(t,i,s){this.frames=t,this.At=i,this.wt=s,this.Mt=[],this.yt=[];var h=t/2;for(let t=0;t<h;t++)this.Mt.push(2*Math.random()-1),this.yt.push(2*Math.random()-1);this.is=-1}E(){if(this.is++,this.is>=this.frames)return!1;let t=this.is/2,i=0|t,s=i+1,h=1-this.is/this.frames;return this.x=this.At*h*(this.Mt[i]+(t-i)*(this.Mt[s]-this.Mt[i])),this.y=this.wt*h*(this.yt[i]+(t-i)*(this.yt[s]-this.yt[i])),!0}}class S{constructor(i,s,h){this.xt={...i},this.angle=s,this.Et=X(V(this.angle,h?8:5)),this.a=t,this.Tt=!0,this.f=h,this.Ot=!0,this.St=1,this.r=0,this.Rt=-1,this.d=0===this.f?45:70,this.Ut=!0}bt(){++this.Rt===this.d&&(this.It=!0),this.Et.x*=.9,this.Et.y*=.9,this.a*=.95,this.r+=this.a}kt(){ot.gt(ot.vt[this.f],this.xt,this.r)}}S.v=t=>S.Lt(t,8,(()=>0)),S.Ht=t=>S.Lt(t,16,(()=>4*Math.random()|0)),S.Lt=(h,e,n)=>{let r=h.Nt?function(t){let i=Math.atan2(t.y,t.x);return i<0&&(i+=s),i}(h.Nt.qt):Math.random()*s;for(let o=0;o<e*(ct.H?2:1);o++){let e=Math.random()*h.St,o=K(h.xt,V(Math.random()*s,e));ct.as.push(new S(o,r+Math.random()*i-t,n()))}};const O={Dt:[{name:"1F",Ct:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,0,0,14,14,14,14,14,14,14,14,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,1,1,14,0,14,14,1,1,1,1,1,1,14,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,14,1,1,14,14,1,14,0,14,1,1,1,1,1,1,1,14,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,14,1,1,1,1,1,14,0,14,1,1,1,1,1,1,1,14,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,14,1,1,1,1,1,14,0,14,1,1,1,1,1,1,1,14,0,0],[14,14,14,14,14,14,14,0,0,0,0,0,14,14,1,1,1,1,14,14,14,14,14,14,1,14,14,14,14,0,0],[14,1,1,1,1,1,14,0,0,0,0,0,0,14,14,14,14,1,1,14,14,14,1,1,1,1,14,0,0,0,0],[14,1,1,1,1,1,14,0,0,0,0,0,0,0,0,0,14,1,1,1,1,14,1,1,1,1,14,0,0,0,0],[14,1,1,1,1,1,14,0,0,0,0,0,0,0,0,0,14,14,1,1,1,14,1,1,1,1,14,14,14,14,14],[14,14,1,1,1,1,14,14,0,0,0,0,0,14,14,14,14,14,14,1,14,14,1,1,1,1,1,1,1,1,14],[0,14,1,1,1,1,1,14,0,0,0,0,0,14,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,14],[0,14,1,1,1,1,1,14,14,14,14,14,14,14,1,1,1,1,1,14,14,14,14,1,1,1,1,1,1,1,14],[0,14,1,1,1,1,1,1,1,1,1,1,1,1,1,1,14,14,14,14,0,0,14,14,14,14,1,1,1,1,14],[0,14,14,1,1,1,1,1,1,1,1,1,1,1,1,1,14,0,0,0,0,0,0,0,0,14,1,1,1,1,14],[0,0,14,14,1,1,1,1,1,1,1,1,1,1,1,1,14,0,0,0,0,0,0,0,0,14,14,14,14,14,14],[0,0,0,14,14,14,14,14,14,1,1,1,1,1,1,1,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,14,14,14,14,14,14,14,14,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],Pt:[],Yt:[{name:"SPAWN",x:28,y:11},{name:"EARTH",x:26,y:9},{name:"EARTH",x:24,y:11},{name:"EARTH",x:25,y:2},{name:"EXIT",x:3,y:7}],Gt:[],id:0}],bounds:[[0,0],[31,17]],Vt:[28,11,0]};class R{constructor(t){this.xt={...t},this.target={...this.xt},this.Et={x:0,y:0},this.Wt=1,this.v=[],this.St=3,this.ms=2,this.Tt=!0,this.Ut=!0,this.Ft=7,this.Bt=[],this.Zt=0,this.offset={x:0,y:0},this.jt=0,this.Kt=500,this.Xt=3,this.zt=0,this.is=0,this.Jt=Math.floor(16*Math.random()),this.Qt=ct.is;let i=j(this.xt);this.moveTo({_t:i._t,r:i.r-1})}bt(){0===this.Bt.length&&this.Bt.push({$t:2});let t=this.Bt[this.Bt.length-1];if(this.is=Math.floor(ct.is/8)%2+1,9===this.ms)return void(this.It=!0);if(3===t.$t)this.target=Q(z(t.ti)),F(this.xt,this.target).S<6&&this.Bt.pop();else if(6===t.$t){if(this.target=Q(z(t.ti)),F(this.xt,this.target).S<6){this.is=0;let i=G.ii(t.ti);i.si++,i.si>=i.hi&&this.Bt.pop()}}else if(4===t.$t){this.target=Q(z(t.ti));let i=F(this.xt,this.target),s=G.ii(t.ti);s?i.S<6&&(this.is=0,this.jt+=this.Xt,s.ei-=this.Xt,this.jt>=this.Kt&&this.Bt.push({$t:5,ti:{_t:G.Vt._t,r:G.Vt.r}})):(this.Bt.pop(),this.Bt.push({$t:5,ti:{_t:G.Vt._t,r:G.Vt.r}}))}else 5===t.$t&&(this.target=Q(z(t.ti)),F(this.xt,this.target).S<6&&(this.is=0,this.jt-=this.Xt,this.zt+=this.Xt,this.zt>=100&&(ct.ni++,this.zt-=100),this.jt<=0&&this.Bt.pop()));let i=G.ri(this.xt,this.target);console.log([this.target,i]);let s=F(this.xt,i);s.S=$(s.S,0,.5);let h=X(s);this.Et={x:(this.Et.x+h.x)/2,y:(this.Et.y+h.y)/2}}kt(){let t=3;0===this.is&&t--;let i=Math.cos((ct.is+this.Jt)/16)*t,s=1*Math.sin((ct.is+this.Jt)/16);ot.gt(ot.oi[this.is],{x:this.xt.x+i,y:this.xt.y+s})}li(t){this.Bt=[{$t:4,ti:t}],this.Qt=ct.is}construct(t){this.Bt.push({$t:6,ti:t}),this.Qt=ct.is}moveTo(t){this.Bt=[{$t:3,ti:t}],this.Qt=ct.is}ai(){let t=this.Bt[this.Bt.length-1];return t&&2!==t.$t}}R.fi=()=>{let t=ct.as.filter((t=>t instanceof R));return t.sort(((t,i)=>t.ai()&&!i.ai()?1:!t.ai()&&i.ai()?-1:t.Qt-i.Qt)),t},R.assign=t=>{let i=R.fi();for(let s=0;s<i.length&&!(s>0&&i[s].ai());s++)t(i[s])};class T{constructor(t,i,s){this.xt={...t},this.target=i,this.Et={x:0,y:0},this.v=s||70}bt(){let t=F(this.xt,this.target.xt);t.S=$(t.S,0,2),this.Et={x:(this.Et.x+t.x*t.S)/2,y:(this.Et.y+t.y*t.S)/2},t.S<1&&(this.target.v.push({ui:this.v,qt:t,ci:0}),this.It=!0,console.log("HIT"))}kt(){ot.gt(ot.di[0],this.xt,this.r)}}const U={Ai:()=>!!G.ii(G.selected),wi:()=>ot.buttons[6],Mi:()=>ot.buttons[7],yi(t,i){let s=G.ii(G.selected),e=ct.xi(15)?"BUILD TOWER \ne15":"BUILD TOWER \ner15";s&&(e="FINISH BUILDING"),E.ct(h.t,e,t,i)},Ei(){if(G.ii(G.selected))R.assign((t=>t.construct(G.selected)));else if(ct.xi(15))return ct.Ti(15),G.ht.push(new I(G.selected)),R.assign((t=>t.construct(G.selected))),!0}};class I{constructor(t){this.ti={...t},this.pi=10,this.Ft=7,this.ms=21,this.si=0,this.hi=180,this.title="TOWER",this.mi=ot.ht[0]}bt(){this.si>=this.hi&&(this.ms=22);let t,i,s=Q(z(this.ti));if(!this.target||this.target.It){for(let h of ct.as){if(!h.Oi)continue;let e=F(s,h.xt);e.S<32&&(!i||e.S<i.S)&&(t=h,i=e)}console.log("ATTEMPTED to pick target for building",t),this.target=t}this.pi>0&&this.pi--,this.target&&0===this.pi&&(F(s,this.target),ct.as.push(new T(s,this.target)),this.pi=100)}kt(){let t=z(this.ti);if(J(Q(t)),h.t.globalAlpha=21===this.ms?.5:1,ot.gt(ot.ht[0],t),h.t.globalAlpha=1,21===this.ms){let i=$(Math.floor(8*this.si/this.hi),0,7);h.t.globalAlpha=.5,ot.gt(ot.Si[7],t),h.t.globalAlpha=1,ot.gt(ot.Si[i],t)}}Ri(){return this.si<this.hi?[U]:[]}}const H=[0,2];for(let t=2;t<=19;t++)H[t]=Math.floor(1.5*H[t-1]+1);for(let t=0;t<20;t++)H[t]=5*H[t];const N={Ai:()=>!1,wi:()=>ot.buttons[0],Mi:()=>ot.buttons[1],yi(t,i){let s=H[ct.Ui()],e=ct.xi(s)?"LURE MOTH \ne"+s:"LURE MOTH \ner"+s;E.ct(h.t,e,t,i)},Ei(){let t=H[ct.Ui()];if(ct.xi(t))return ct.Ti(t),ct.as.push(new R(Q(z(G.selected)))),!0}};class b{constructor(t){this.ti={...t},this.title="YOUR COFFIN \nLAST CHANCE",this.mi=ot.ht[1],this.Ft=9}bt(){}kt(){let t=z(this.ti);ot.gt(ot.ht[1],t)}Ri(){return[N]}}class k{constructor(t){this.xt={...t},this.Wt=100,this.v=[],this.Et={x:0,y:0},this.St=2,this.bi=.2,this.Ii=0,this.ms=11,this.Oi=!0}bt(){let t=ct.as.filter((t=>t instanceof R)),i=t[0];if(console.log(t.map((t=>t.xt))),!i)return;let s=F(this.xt,i.xt);for(let h=1;h<t.length;h++){let e=F(this.xt,t[h].xt);e.S<s.S&&(i=t[h],s=e)}const h=G.ri(this.xt,i.xt);let e=F(this.xt,h);11===this.ms?s.S<8?(console.log("KILL"),i.v.push({ui:10,qt:e,ci:0}),this.It=!0):(e.S=$(e.S,0,.4),this.Et={x:(this.Et.x+e.x*e.S)/2,y:(this.Et.y+e.y*e.S)/2}):9===this.ms&&(this.It=!0,S.Ht(this))}kt(){let t=ot.ki[0];ot.gt(t,this.xt)}}const L={Ai:()=>!0,wi:()=>ot.buttons[2],Mi:()=>ot.buttons[3],yi(t,i){E.ct(h.t,"GATHER EARTH",t,i)},Ei:()=>(R.assign((t=>t.li(G.selected))),!0)};class p{constructor(t){this.ti={...t},this.ei=1e4,this.title="EARTH",this.mi=ot.ht[2]}bt(){this.title="EARTH \n"+Math.ceil(this.ei/100)+" REMAINING",this.ei<1&&(this.It=!0)}kt(){let t=z(this.ti);ot.gt(ot.ht[2],t)}Ri(){return[L]}}const m={Ai:()=>!0,wi:()=>ot.buttons[4],Mi:()=>ot.buttons[5],yi(t,i){E.ct(h.t,"EXPLORE",t,i)},Ei:()=>(R.assign((t=>t.moveTo(G.selected))),!0)},C={gi(t){let i=t.filter((t=>t.xt&&t.Et&&!t.It));for(let t=0;t<5;t++){for(let t=0;t<i.length-1;t++)for(let s=t+1;s<i.length;s++)C.vi(i[t],i[s]);for(let t of i)C.Li(t)}for(let t of i)t.xt.x+=t.Et.x,t.xt.y+=t.Et.y},vi(t,i){if(t.Tt||i.Tt)return;let s=function(t,i,s,h,e,n){[s,n]=[X(s),X(n)];let r=F({x:t.x+s.x,y:t.y+s.y},{x:h.x+n.x,y:h.y+n.y});if(r.S<i+e)return{Hi:r.x,Ni:r.y,S:i+e-r.S}}(t.xt,t.St,t.Et,i.xt,i.St,i.Et);if(s)if(t.Ot&&i.Ot)t.Et.x=-s.Hi*s.S,t.Et.y=-s.Ni*s.S,i.Et.x=s.Hi*s.S,i.Et.y=s.Ni*s.S;else{let h=q(t.Et).S+i.bi,e=q(i.Et).S+t.bi,n=t.Ot?.1:1,r=i.Ot?.1:1;t.Et.x-=s.Hi*s.S*n*h/(h+e),t.Et.y-=s.Ni*s.S*n*h/(h+e),i.Et.x+=s.Hi*s.S*r*e/(h+e),i.Et.y+=s.Ni*s.S*r*e/(h+e)}},Li(t){if(!t.Ut){t.xt.y<-1e3&&console.log("FUUUUUUUUUUUUUUUU");for(let i of function*(t,i,s){yield*function*(t,i,s){let h=[{x:Math.min(t.x,i.x)-s,y:Math.min(t.y,i.y)-s},{x:Math.max(t.x,i.x)+s,y:Math.max(t.y,i.y)+s}];yield*function*(t){for(let i=t[0].y/8|0;8*i<t[1].y;i++)for(let s=t[0].x/8|0;8*s<t[1].x;s++)yield{_t:s,r:i}}(h)}(t,{x:t.x+i.x,y:t.y+i.y},s)}(t.xt,t.Et,t.St))if(!ht(i._t,i.r)){let s=[z(i),z({_t:i._t+1,r:i.r+1})],h=tt(t.xt,{x:t.xt.x+t.Et.x,y:t.xt.y+t.Et.y},t.St,s);h&&(t.Ot?0===h.Hi?t.Et.y=-t.Et.y:0===h.Ni?t.Et.x=-t.Et.x:(t.Et.x+=h.Hi,t.Et.y+=h.Ni):0===h.Hi?t.Et.y=h.y-t.xt.y:0===h.Ni?t.Et.x=h.x-t.xt.x:(t.Et.x+=h.Hi,t.Et.y+=h.Ni))}}}},v={gi(t){for(let i of t)if(i.Wt){if(i.v.length>0){if(9!==i.ms&&1!==i.ms)for(let t of i.v)i===ct.qi&&ct.as.push(new HealthChunkAnimation(i.Wt,t.ui)),i.Wt-=t.ui,t.qt.S=t.ci,i.Et=K(i.Et,t.qt),i.Nt=t,S.v(i);i.v=[]}i.Wt<=0&&9!==i.ms&&(i.ms=9)}}},D=[[[0,1],[5,1],[10,1],[15,1],[20,1],[21,1],[22,1]]];class Y{constructor(t){t%=D.length,this.Di=[...D[t]],this.Ci=1800,this.Pi=!1,this.is=0,this.Yi=60*this.Di[this.Di.length-1][0]}E(){if(this.Ci--,this.Ci<=0){this.Pi=!0;for(let t=0;t<this.Di.length;t++)this.is===60*this.Di[t][0]&&ct.Gi.push(k);this.is++}this.is>=this.Yi&&(ct.Vi=void 0)}}class g{constructor(){this.frames=0}E(){this.frames++}kt(){h.t.fillStyle=et(36,26,20,$(this.frames/200,0,1)),h.t.fillRect(0,0,h.width,h.height);let t=h.width-32,i="ESCAPE! \n                    \nVILLAGERS STIR UNEASILY IN THEIR BEDS AS YOU EMERGE INTO MOONLIGHT. YOU SENSE WARM BODIES ALL AROUND YOU, RIPE FOR PICKING. IT IS ONLY A MATTER OF TIME NOW BEFORE YOU REGAIN YOUR FULL NECROMANTIC POWER. \n                    \nCONGRATULATIONS... AND THE END.";i=i.slice(0,this.frames),E.ct(h.t,i,16,16,t,1,1)}}class P{constructor(t){this.ti={...t},this.title="REACH THE EXIT \nTO SURVIVE",this.mi=ot.ht[3],this.Ft=4}bt(){let t=R.fi();for(let i of t){let t=j(i.xt);if(t._t===this.ti._t&&t.r===this.ti.r)return void(ct.screen=new g)}}kt(){let t=z(this.ti);ot.gt(ot.ht[3],t)}Ri(){return[m]}}const G={s(){this.c()},kt(){let t=this.Dt[0].Ct,i=J({x:0,y:0});for(let s=0;s<t.length;s++)for(let e=0;e<t[0].length;e++)t[s][e]>0&&h.t.drawImage(ot.Ct[t[s][e]-1].st,8*e+i.h,8*s+i.o);for(let t of this.ht)t.kt()},Wi(){let t=this.Ct,i=J({x:0,y:0});for(let s=0;s<t.length;s++)for(let e=0;e<t[0].length;e++)if(t[s][e]>0){let t=1-$(this.Fi[s][e]/5,.1,1);0===this.Bi[s][e]&&(t=1),h.t.globalAlpha=t,h.t.drawImage(ot.Zi[0].st,8*e+i.h,8*s+i.o)}h.t.globalAlpha=1},c(){this.Dt=O.Dt.map((t=>({Ct:t.Ct.map((t=>[...t])),Yt:t.Yt.map((t=>({...t})))}))),this.bounds=O.bounds,this.Vt={_t:O.Vt[0],r:O.Vt[1]},this.ht=[],this.ht.push(new b(this.Vt));for(let t of this.Dt[0].Yt)"EARTH"===t.name?this.ht.push(new p({_t:t.x,r:t.y})):"EXIT"===t.name&&this.ht.push(new P({_t:t.x,r:t.y}));this.selected=void 0,this.Ct=this.Dt[0].Ct,this.width=this.Ct[0].length,this.height=this.Ct.length,this.Fi=it(this.width,this.height,(()=>0)),this.Bi=it(this.width,this.height,(()=>0)),this.ji={},this.Ki()},E(){for(let t of this.ht)t.bt();this.Xi()},zi(t){return 46===this.Ji(t)},Qi(t){return this._i.includes(this.Dt[t.z].Ct[t.y][t.x])},$i(t){this.Dt[t.z]},Ei(t){let i=j(_(t)),s=this.Ji(i);if(!s||s>=8||!this.Bi[i.r][i._t])this.selected=void 0;else if(this.selected&&this.selected._t===i._t&&this.selected.r===i.r){let t=this.ii(this.selected);if(t){let i=t.Ri();i[0]&&i[0].Ai()&&i[0].Ei()}else m.Ei()}else this.selected=i,this.ii(this.selected)},Ji(t){if(t)return this.Dt[0].Ct[t.r]?.[t._t]},ii(t){if(t)for(let i of this.ht)if(i.ti._t===t._t&&i.ti.r===t.r)return i},Xi(){let t=[];for(let i of this.ht)i.Ft&&t.push({...i.ti,ts:i.Ft});for(let i of ct.as)i.Ft&&t.push({...j(i.xt),ts:i.Ft});this.Fi=function(t,i,s=1/0){let h=it(t[0].length,t.length,(()=>0)),e=[...i];for(;e.length>0;){let{_t:t,r:i,ts:n}=e.shift();h[i][t]>=n||(h[i][t]=n--,h[i][t]>=s||(st(t+1,i)&&h[i][t+1]<n&&e.push({_t:t+1,r:i,ts:n}),st(t-1,i)&&h[i][t-1]<n&&e.push({_t:t-1,r:i,ts:n}),st(t,i+1)&&h[i+1][t]<n&&e.push({_t:t,r:i+1,ts:n}),st(t,i-1)&&h[i-1][t]<n&&e.push({_t:t,r:i-1,ts:n})))}return h}(this.Ct,t);for(let t=0;t<this.Fi.length;t++)for(let i=0;i<this.Fi[0].length;i++)this.Fi[t][i]>this.Bi[t][i]&&(this.Bi[t][i]=1)},ri(t,i){let s=j(t),h=j(i);var e,n;if(e=s,n=h,Math.abs(e._t-n._t)+Math.abs(e.r-n.r)<=1)return i;let r=[h._t,h.r].join(","),o=this.ji[r];o||(o=this.ji[r]=function(t,i,s=1/0){let h=it(t[0].length,t.length,(()=>1/0)),e=[{...i,ss:0}];for(;e.length>0;){let{_t:t,r:i,ss:n}=e.shift();h[i][t]<=n||(h[i][t]=n++,h[i][t]>=s||(ht(t+1,i)&&h[i][t+1]>n&&e.push({_t:t+1,r:i,ss:n}),ht(t-1,i)&&h[i][t-1]>n&&e.push({_t:t-1,r:i,ss:n}),ht(t,i+1)&&h[i+1][t]>n&&e.push({_t:t,r:i+1,ss:n}),ht(t,i-1)&&h[i-1][t]>n&&e.push({_t:t,r:i-1,ss:n})))}return h}(this.Ct,h)),console.log(Object.keys(this.ji).length);let l=[[s._t+1,s.r],[s._t-1,s.r],[s._t,s.r+1],[s._t,s.r-1]];for(let t of l)t.push(o[t[1]][t[0]]);return l.sort(((t,i)=>t[2]-i[2])),Q(z({_t:l[0][0],r:l[0][1]}))},Ki(){for(let t=0;t<this.Ct.length;t++)for(let i=0;i<this.Ct[0].length;i++)if(14===this.Ct[t][i]){let s=0;(this.Ct[t-1]?.[i-1]||99)<8&&(s|=256),(this.Ct[t-1]?.[i]||99)<8&&(s|=128),(this.Ct[t-1]?.[i+1]||99)<8&&(s|=64),(this.Ct[t]?.[i-1]||99)<8&&(s|=32),(this.Ct[t]?.[i+1]||99)<8&&(s|=8),(this.Ct[t+1]?.[i-1]||99)<8&&(s|=4),(this.Ct[t+1]?.[i]||99)<8&&(s|=2),(this.Ct[t+1]?.[i+1]||99)<8&&(s|=1),ot.hs(s),this.Ct[t][i]=20+s}}},Z=18,B={E(){if(G.selected){let t=G.ii(G.selected);this.actions=t?t.Ri():[m,U]}else this.actions=[];M.J&&(this.es=void 0)},kt(){if(ct.Vi)if(ct.Vi.Pi)E.ut(h.t,"INCOMING",40,3);else{let t=Math.ceil(ct.Vi.Ci/60);E.ut(h.t,"COUNTDOWN "+t,40,3)}let t=ct.as.filter((t=>t instanceof R));for(let i=0;i<t.length;i++)h.t.drawImage(ot.oi[1].st,2+4*i,2);let i,s=ct.ni+"e",e=E.dt(s,1);if(h.t.fillStyle="rgba(0, 0, 0, 0.1)",E.ut(h.t,s,h.width-e-2,2),M.P){let t=M.P.h,i=M.P.o,s=_(M.P),e=j(s);if(E.ut(h.t,t+","+i+". "+s.x+","+s.y+". "+e._t+","+e.r+".",h.width-100,20),G.selected){let t=G.Ct[G.selected.r][G.selected._t];t>20&&(t-=20),E.ut(h.t,G.selected._t+","+G.selected.r+". "+t.toString(2).padStart(9,"0"),h.width-100,29)}}if(G.selected){let t=J({x:8*G.selected._t,y:8*G.selected.r});h.t.fillStyle=et(255,212,163,.25),h.t.fillRect(t.h,t.o,9,9)}if(h.t.fillStyle="#ffd4a3",h.t.fillRect(0,h.height-Z,h.width,1),h.t.fillStyle="#8d697a",h.t.fillRect(0,h.height-Z+1,h.width,1),h.t.fillStyle="#203c56",h.t.fillRect(0,h.height-Z+2,h.width,16),h.t.fillStyle="#8d697a",h.t.fillRect(0,h.height-2,h.width,2),h.t.drawImage(ot.ns[0].st,-2,h.height-Z+1),h.t.drawImage(ot.ns[0].st,64,h.height-Z+1),h.t.drawImage(ot.ns[0].st,h.width-3,h.height-Z+1),G.selected){let t=G.ii(G.selected);if(t)h.t.drawImage(t.mi.st,2,h.height-Z-1),E.ct(h.t,t.title,13,h.height-Z+3,h.width);else{let t=G.Ji(G.selected);h.t.drawImage(ot.Zi[1].st,3,h.height-Z+6),h.t.drawImage(ot.Ct[t-1].st,2,h.height-Z+5),E.ct(h.t,"EMPTY SPACE",13,h.height-Z+3,h.width)}}for(let t=0;t<this.actions.length;t++){let s=this.actions[t],e=this.rs(t);h.t.drawImage(ot.ns[0].st,e.h+11,h.height-Z+1),h.t.drawImage(s.wi().st,e.h,e.o),this.es===s&&(i=t)}if(i>=0){let t=this.rs(i);h.t.drawImage(ot.os[0].st,t.h-23,t.o-19),h.t.drawImage(this.es.Mi().st,t.h,t.o),this.es.yi(t.h-23+3,t.o-19+3)}M.P&&(ct.ls&&(h.t.globalAlpha=.5),ot.gt(ot.fs,_(M.P)),h.t.globalAlpha=1)},rs:t=>({h:68+15*t,o:h.height-15}),Ei(t){if(t.o>h.height-Z){for(let i=0;i<this.actions.length;i++){let s=this.rs(i);if(t.h>=s.h&&t.h<=s.h+12&&t.o>=s.o&&t.o<=s.o+12)return this.actions[i]===this.es?this.es.Ei()&&(this.es=void 0):this.es=this.actions[i],!0}return this.es=void 0,!0}return this.es=void 0,!1}},W={s(){this.xt={x:0,y:0,z:0}},E(){M.mt[M.A.D]&&(this.us={...this.xt}),M.J&&(this.xt={x:this.us.x-M._.x,y:this.us.y-M._.y})}};function q(t){let i=Math.sqrt(t.x*t.x+t.y*t.y);return 0===i?{x:0,y:0,S:0}:{x:t.x/i,y:t.y/i,S:i}}function F(t,i){return q({x:i.x-t.x,y:i.y-t.y})}function V(t,i){return{x:Math.cos(t),y:Math.sin(t),S:i||1}}function X(t){return{x:t.x*(t.S||1),y:t.y*(t.S||1)}}function K(...t){let i={x:0,y:0,S:1};for(let s of t)i.x+=s.x*(s.S||1),i.y+=s.y*(s.S||1);return i}function j(t){return{_t:t.x/8|0,r:t.y/8|0}}function z(t){return{x:8*t._t,y:8*t.r}}function J(t){return{h:t.x+h.i.h-W.xt.x,o:t.y+h.i.o-W.xt.y}}function _(t){return{x:t.h-h.i.h+W.xt.x,y:t.o-h.i.o+W.xt.y}}function Q(t){return{x:t.x+4,y:t.y+4}}function $(t,i,s){return t<i?i:t>s?s:t}function tt(t,i,s,h){if(Math.max(t.x,i.x)+s<h[0].x||Math.min(t.x,i.x)-s>h[1].x||Math.max(t.y,i.y)+s<h[0].y||Math.min(t.y,i.y)-s>h[1].y)return;let e=i.x-t.x,n=i.y-t.y,r=0===e?0:1/e,o=0===n?0:1/n,l=1/0,f=1/0;if(t.x-s<h[0].x&&i.x+s>h[0].x){let i=(h[0].x-s-t.x)*r;if(i>=0&&i<=1){let s=n*i+t.y;if(s>=h[0].y&&s<=h[1].y)return{x:e*i+t.x,y:s,Rt:i,Hi:-1,Ni:0,cs:h[0].x,ds:s}}l=h[0].x}if(t.x+s>h[1].x&&i.x-s<h[1].x){let o=(t.x-(h[1].x+s))*-r;if(o>=0&&o<=1){let s=n*o+i.y;if(s>=h[0].y&&s<=h[1].y)return{x:e*o+t.x,y:s,Rt:o,Hi:1,Ni:0,cs:h[1].x,ds:s}}l=h[1].x}if(t.y-s<h[0].y&&i.y+s>h[0].y){let i=(h[0].y-s-t.y)*o;if(i>=0&&i<=1){let s=e*i+t.x;if(s>=h[0].x&&s<=h[1].x)return{x:s,y:n*i+t.y,Rt:i,Hi:0,Ni:-1,cs:s,ds:h[0].y}}f=h[0].y}if(t.y+s>h[1].y&&i.y-s<h[1].y){let i=(t.y-(h[1].y+s))*-o;if(i>=0&&i<=1){let s=e*i+t.x;if(s>=h[0].x&&s<=h[1].x)return{x:s,y:n*i+t.y,Rt:i,Hi:0,Ni:1,cs:s,ds:h[0].y}}f=h[1].y}if(l===1/0&&f===1/0)return;l!==1/0&&f===1/0&&(f=n>0?h[1].y:h[0].y),f!==1/0&&l===1/0&&(l=e>0?h[1].x:h[0].x);let u=1/s,a=Math.sqrt(e*e+n*n),c=l-t.x,M=f-t.y,A=Math.sqrt(c*c+M*M),d=Math.acos((c*e+M*n)/(a*A));if(A<s)return;if(0===d){let i=(A-s)/a;if(i>1||i<0)return;let h=i*e+t.x,r=i*n+t.y,o=c/A,u=M/A;return isNaN(h)?void 0:{x:h,y:r,Rt:i,Hi:o,Ni:u,cs:l,ds:f}}let E=Math.sin(d),y=E*A*u;if(Math.abs(y)>1)return;let w=Math.PI-Math.asin(y),x=Math.PI-d-w,S=s*Math.sin(x)/E/a;if(S>1||S<0)return;let O=S*e+t.x,R=S*n+i.y,T=(O-l)*u,U=(R-f)*u;return isNaN(O)?void 0:{x:O,y:R,Rt:S,Hi:T,Ni:U,cs:l,ds:f}}function it(t,i,s){return Array.from({length:i},(()=>Array.from({length:t},s)))}function st(t,i){let s=G.Dt[0].Ct;return!(t<0||i<0||i>=s.length||t>=s[i].length)}function ht(t,i){let s=G.Dt[0].Ct;return!(t<0||i<0||i>=s.length||t>=s[i].length)&&1===s[i][t]}function et(t,i,s,h){return`rgba(${t},${i},${s},${h})`}function nt(t,i){let s=document.createElement("canvas");s.width=t,s.height=i;let h=s.getContext("2d");return{e:s,t:h}}const rt={ht:[[0,0,8,16],[8,0,8,16],[16,0,8,16],[24,0,8,16]],di:[[0,16,3,3]],buttons:[[0,19,12,12],[12,19,12,12],[24,19,12,12],[36,19,12,12],[48,19,12,12],[60,19,12,12],[72,19,12,12],[84,19,12,12]],cursor:[[0,31,10,8]],ls:[[0,39,15,15],[15,39,15,15],[30,39,15,15]],font:[[0,54,180,12]],ki:[[0,66,5,5]],vt:[[0,71,5,5],[5,71,5,5],[10,71,5,5],[15,71,5,5]],As:[[0,76,9,9]],ws:[[0,85,13,16]],ns:[[0,101,5,16]],os:[[0,117,60,18]],Si:[[0,135,7,7],[7,135,7,7],[14,135,7,7],[21,135,7,7],[28,135,7,7],[35,135,7,7],[42,135,7,7],[49,135,7,7]],Ms:[[0,142,7,9],[7,142,7,9]],oi:[[0,151,3,3],[3,151,3,3],[6,151,3,3]],Zi:[[0,154,8,8],[8,154,8,8]],Ct:[[0,162,8,8],[8,162,8,8],[16,162,8,8],[24,162,8,8],[32,162,8,8],[40,162,8,8],[48,162,8,8],[56,162,8,8],[64,162,8,8],[72,162,8,8],[80,162,8,8],[88,162,8,8],[96,162,8,8],[104,162,8,8]],ys:[[0,170,4,4],[4,170,4,4]],xs:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAACuCAMAAACoXtf9AAAAY1BMVEUAAADuw5oAAAANK0UgPFYhIickGhQuCAFTV1JUTmhcDwBtbnN1EgCNaXqPn6iRm6ObrbemraXCHQDJAADL2/zQgVnfcSbmAADm5rjuw5ru6WTwJAD78jb/ql7/1KP/7Nb///+u5EtCAAAAAnRSTlMAlm//+0kAAAPoSURBVHja7ZmLkps6DIZd8J5T0uPe9742vP9THv8gR2ZISpcaYnX0OV7ZSsJ8UcVlpkYpjaIoHc0qeRhZ5h2o1Zn/zoFw/dLee5NxD6puDziHNvhcmmbFxYZzS9bOjwlQuTRX2k1dgbUYaefv772cSofgxzpHa6505aCwQvhg5PHhWaS1kYgnsA5Eyfwe+I7wxgRHhHL5HZ2BD+5M2JL3kZQPEYT9pH0cSSLEwXKe5TgPfCYdkjR/HrkdpUmB5SZ1CACSCyPXK3o1X097ZHKw43z2efzZTzqOsxzGht49XJr6ECP1IYYnt6w9Uu9SOuXd8dIrJxZJkEOS5nzg/FK6jp7ekBd9c9HbeG8E0ku07kMvUVqgdR+Movx9NICWpkmM63qVn8Ao2DxhMxHX8VWpM1vmO+yxq9F6abm0lieNvqnZGX5LaURZ0iuotErLuHqo9PF3RCDu2UPkU17FDO/M5wxD/BReaWJMG4rrB0rf5+PwMaYBaF1AmiSnFe0yzyGN9WPMhuG5Jr2B6TCLKlHlzu+tSKfvcBF4P7A05bZYXpLmytLkPO23VTrb/0mlh3nMejq1CUWe2K9L82e5unlP5+eLQJa/kuP0qxbjoF/LPc5iieti/E9yseMKQWa8Zlg2H0vpYVb5uTT3bllnvqYjMFxp2uY/jgdfYtg4CXO+pDML8px78clIkd9kmexDZlZZynJub6jyeZsIp+97ec4Y4qSBOQKVPrI7lMdzeDX/nYQIn35g9Xwyp++vkBbECZOdBYn/K+aZ+ghU+oWmsi/DwEHRntZL3o1wOXKkOzvRCZImZ1jLkbaMSqu0Squ0Su+OSuttXB+YGGHSRhhddO6MMGznOitO2jqr0iqt0keh0iqt0nob1wcmB4w0wmZu6Ow2E24obTciSlqlVVqlVVqlVVqlVbr8Y17+HwSXCdU9UM+kw0VMfWTSpkb6/n2hR7glLLEeegqgmkpHfhWYGqxJYN02x9RFLt1LkObKs/PlUCUrZ+WNaUAKQmje3pqvn5vm81esVHqOSueIkf4aQaUR95RW6c+goWDKo9dpJsQhjECvndFi/0O0hEqrtEqrtErXRfuHGKJ1ziLO8tY55MdIlJG2HbDviCHfG6K99+Pa3d97zEn63sMZ9u2Uvy8j3U2MMfxWDLBGxGoh7b2Pk6XttGrvkb/3haVDZIzdr2OXIj7P0n6SthOkiiS/b60vLA2J34wLae5phno6fx/74tJxrEsj0B7REtQecywn8b61xdtjW0wn3hVp7mn63K2uHrOYTrzWX5L2fPVIJ2gJvnz58tFI48unT3fm5zeB0t/ujCg+3t2JMgb/A+XXDyp0x1KCAAAAAElFTkSuQmCC"},ot={Es(t){let i=new Image;i.onload=t,i.src=rt.xs,ot.Gs=i},s(){ot.font=lt(rt.font[0]),ot.Ts=lt(rt.Ms[0]),ot.ps=lt(rt.Ms[1]),ot.oi=rt.oi.map(lt),ot.vt=rt.vt.map(lt),ot.As=rt.As.map(lt),ot.fs=rt.cursor.map((t=>lt(t,{x:0,y:0})))[0],ot.di=rt.di.map(lt),ot.ws=rt.ws.map(lt),ot.ns=rt.ns.map(lt),ot.os=rt.os.map(lt),ot.Si=rt.Si.map((t=>lt(t,{x:-1,y:-1}))),ot.Ct=rt.Ct.map(lt),ot.Zi=rt.Zi.map(lt),ot.ki=rt.ki.map(lt),ot.ht=rt.ht.map((t=>lt(t,{x:0,y:8}))),ot.buttons=rt.buttons.map(lt),ot.Os=ft(function(t){let i=nt(544,334);for(let s=0;s<334;s+=32)for(let h=0;h<544;h+=32)i.t.drawImage(t,h,s);return i.e}(ot.Ct[0].st)),ot.ot=ft(function(){let t=nt(500,500),i=t.t.createRadialGradient(250,250,0,250,250,250);return i.addColorStop(.3,et(0,0,0,0)),i.addColorStop(1,et(0,0,0,.9)),t.t.fillStyle=i,t.t.fillRect(0,0,500,500),t.e}());let t=rt.ls.map(lt);ot.Ss=ft(function(t,i){let s=nt(130,45);return s.t.drawImage(ut(t).e,0,5),s.t.drawImage(i,5,0),s.e}(t[0].st,t[2].st)),ot.Rs=ft(ut(t[1].st).e)},Us(t,i,s,h){t.drawImage(i.st,s-i.Zs.x,h-i.Zs.y)},gt(t,i,s){let{h:e,o:n}=this.bs(t,i);s?(h.t.save(),h.t.translate(e+t.Zs.x,n+t.Zs.y),h.t.rotate(s),h.t.drawImage(t.st,-t.Zs.x,-t.Zs.y),h.t.restore()):h.t.drawImage(t.st,e,n)},bs:(t,i)=>({h:i.x-t.Zs.x-W.xt.x+h.i.h,o:i.y-t.Zs.y-W.xt.y+h.i.o}),hs(t){return this.Ct[t+20-1]||(this.Ct[t+20-1]=ft(function(t,i){let s=nt(8,8);return 256&i&&s.t.drawImage(t[12].st,0,0,4,4,0,0,4,4),64&i&&s.t.drawImage(t[12].st,5,0,3,3,5,0,3,3),1&i&&s.t.drawImage(t[12].st,6,6,2,2,6,6,2,2),4&i&&s.t.drawImage(t[12].st,0,5,3,3,0,5,3,3),8&i&&s.t.drawImage(t[11].st,5,0,3,8,5,0,3,8),32&i&&s.t.drawImage(t[9].st,0,0,4,8,0,0,4,8),2&i&&s.t.drawImage(t[8].st,0,5,8,3,0,5,8,3),128&i&&s.t.drawImage(t[10].st,0,0,8,4,0,0,8,4),160==(160&i)&&s.t.drawImage(t[13].st,0,0,5,5,0,0,5,5),136==(136&i)&&s.t.drawImage(t[13].st,4,0,4,4,4,0,4,4),10==(10&i)&&s.t.drawImage(t[13].st,4,4,4,4,4,4,4,4),34==(34&i)&&s.t.drawImage(t[13].st,0,4,5,4,0,4,5,4),s.e}(this.Ct,t),{x:0,y:0})),this.Ct[t+20-1]}};function lt(t,i){return ft(function(t,i,s,h){const e=ot.Gs,n=nt(s,h);return n.t.drawImage(e,t,i,s,h,0,0,s,h),n.e}(...t),i)}function ft(t,i){let s=t.width,h=t.height;return{st:t,Zs:"object"==typeof i?i:{x:s/2|0,y:h/2|0}}}function ut(t){let i=nt(130,40);for(let s=0;s<40;s+=5)for(let h=0;h<130;h+=5){let e=0===h?0:125===h?10:5,n=0===s?0:35===s?10:5;i.t.drawImage(t,e,n,5,5,h,s,5,5)}return i}class at{constructor(){this.frames=0}E(){return this.frames++,M.mt[M.A.j]&&this.frames>30&&ct.c(),!0}kt(){h.t.fillStyle=et(36,26,20,$(this.frames/200,0,1)),h.t.fillRect(0,0,h.width,h.height);let t=h.width-32,i="DEFEAT... \n                    \nYOUR LAST MOTH GONE, THIS WORLD SLIPS FROM YOUR GRASP. YOU CURSE THE VILLAGE AND ITS INHABITANTS AS YOU TUMBLE TOWARDS THAT BLEAK BEYOND. \n \nYOUR REIGN OF TERROR HAS ENDED. \n \nTAP TO TRY AGAIN!";i=i.slice(0,this.frames),E.ct(h.t,i,16,16,t,1,1,E.ft)}}const ct=new class{s(){ot.Es((()=>{h.s(),ot.s(),E.s(),M.s(),u.s(),W.s(),G.s(),window.addEventListener("blur",(()=>this.at())),window.addEventListener("focus",(()=>this.pt())),this.c(),this.start()}))}c(){this.as=[],this.Is={},this.ks={},this.gs={},this.vs=0,this.Ls=[],this.Gi=[],this.Hs=0,W.xt=Q(z(G.Vt)),this.ni=250,this.Ns=0,this.as.push(new R(W.xt)),this.screen=void 0,this.Vi=void 0,G.c()}start(){this.is=0,this.qs=[0],this.E(),window.requestAnimationFrame((t=>this.Ds(t)))}Ds(t){let i=(new Date).getTime();this.qs.length>=40&&this.qs.shift(),this.Cs=1e3/((this.qs[this.qs.length-1]-this.qs[0])/this.qs.length),this.is++,h.n(),this.E(),this.kt(h.t),window.requestAnimationFrame((t=>this.Ds(t)));let s=(new Date).getTime();this.qs.push(this.qs[this.qs.length-1]+s-i)}E(){if(this.Vi||(this.Vi=new Y(this.Hs++)),M.E(),!(this.screen&&this.screen.E()||(M.mt[M.A.j]&&this.Ei(M.P),B.E(),this.Bs))){this.Vi.E(),this.Ps(),console.log(ct.as);for(let t of ct.as)t.bt&&t.bt();v.gi(this.as),C.gi(this.as),W.E(),this.as=this.as.filter((t=>!t.It)),G.ht=G.ht.filter((t=>!t.It)),this.Ls=this.Ls.filter((t=>t.E())),G.E(),0===this.as.filter((t=>t instanceof R)).length&&(ct.screen=new at),ct.is%6==0&&(this.vs=10*Math.random()|0),30===ct.is&&ct.Ls.push(new x(20,20,20)),M.mt[M.A.W]&&!ct.Ys&&(ct.Ys=!0)}}kt(){h.t.setTransform(1,0,0,1,0,0),h.t.scale(h.scale,h.scale),h.t.fillStyle=et(36,26,20,1),h.t.fillRect(0,0,h.width,h.height),G.kt();for(let t of this.as)(!t.z||t.z<100)&&t.kt();for(let t of this.as)t.z&&t.z>100&&t.kt();G.Wi(),B.kt(),ct.is<120&&(h.t.fillStyle=et(0,0,0,1-ct.is/120),h.l()),this.screen&&this.screen.kt()}at(){this.Bs||(this.Bs=!0)}pt(){this.Bs&&(this.Bs=!1)}Ei(t){for(let i of[B,G])if(i.Ei(t))break}Ui(){return this.as.filter((t=>t instanceof R)).length}xi(t){if(this.ni>=t)return!0}Ti(t){this.ni-=t}Ps(){let t=this.Gi[0];if(t)for(let i=0;i<10;i++){let i=Math.floor(Math.random()*G.Dt[0].Ct[0].length),s=Math.floor(Math.random()*G.Dt[0].Ct.length);if(1!==G.Ct[s][i])continue;if(0!==G.Fi[s][i])continue;let h=z({_t:i,r:s});console.log("NEW monster"+h.x+","+h.y+","+G.Fi[s][i]),ct.as.push(new t(h)),this.Gi.shift();break}}};ct.s()}();
//# sourceMappingURL=app.js.map</script>
<style>body,html{margin:0;padding:0;background-color:#000}div{position:absolute;top:0;bottom:0;left:0;right:0}#canvas{width:100%;height:100%;touch-action:none}</style><div><canvas id="canvas"></canvas></div><script>!function(){"use strict";const t=["CAVE FLOOR","DOOM PIT","DOOM PIT"],i=45*Math.PI/180,s=90*Math.PI/180,h=360*Math.PI/180,e={s(){e.e=document.getElementById("canvas"),e.t=e.e.getContext("2d"),e.n(!0)},n(t){let i=window.devicePixelRatio,s=e.e.clientWidth,h=e.e.clientHeight,n=s*i,r=h*i;(t||e.e.width!==n||e.e.height!==r)&&(e.e.width=n,e.e.height=r,e.scale=(10*Math.max(n/240,r/135)|0)/10,e.width=Math.ceil(n/e.scale),e.height=Math.ceil(r/e.scale),e.i={h:e.width/2|0,o:e.height/2|0},e.clientWidth=s,e.clientHeight=h,e.t.imageSmoothingEnabled=!1),e.e.style.cursor="none"},l(){e.t.fillRect(0,0,e.width,e.height)}},n={s(){n.map={KeyW:y.A.u,KeyA:y.A.M,KeyS:y.A.T,KeyD:y.A.m,ArrowUp:y.A.u,ArrowLeft:y.A.M,ArrowDown:y.A.T,ArrowRight:y.A.m,Escape:y.A.p},n.O=[{x:0,y:0,S:0},{x:0,y:-s,S:1},{x:0,y:s,S:1},{x:0,y:0,S:0},{x:-s,y:0,S:1},{x:-i,y:-i,S:1},{x:-i,y:i,S:1},{x:-s,y:0,S:1},{x:s,y:0,S:1},{x:i,y:-i,S:1},{x:i,y:i,S:1},{x:s,y:0,S:1},{x:0,y:0,S:0},{x:0,y:-s,S:1},{x:0,y:s,S:1},{x:0,y:0,S:0}],n.R=[],window.addEventListener("keydown",(t=>{let i=n.map[t.code];i&&(n.R[i]=!0)})),window.addEventListener("keyup",(t=>{let i=n.map[t.code];i&&(n.R[i]=!1)})),n.c()},w(){let t=(n.R[y.A.u]?1:0)+(n.R[y.A.T]?2:0)+(n.R[y.A.M]?4:0)+(n.R[y.A.m]?8:0);n.E=n.O[t]},c(){n.E=n.O[0];for(let t of Object.values(y.A))n.R[t]=!1}},r=(t=1,i=.05,s=220,h=0,e=0,n=.1,r=0,f=1,u=0,a=0,c=0,A=0,y=0,M=0,d=0,w=0,T=0,x=1,E=0,O=0)=>{let S,R,I=2*Math.PI,U=u*=500*I/l**2,N=(0<d?1:-1)*I/4,v=s*=(1+2*i*Math.random()-i)*I/l,m=[],L=0,D=0,H=0,V=1,p=0,C=0,b=0;for(a*=500*I/l**3,d*=I/l,c*=I/l,A*=l,y=l*y|0,R=(h=99+l*h)+(E*=l)+(e*=l)+(n*=l)+(T*=l)|0;H<R;m[H++]=b)++C%(100*w|0)||(b=r?1<r?2<r?3<r?Math.sin((L%I)**3):Math.max(Math.min(Math.tan(L),1),-1):1-(2*L/I%2+2)%2:1-4*Math.abs(Math.round(L/I)-L/I):Math.sin(L),b=(y?1-O+O*Math.sin(2*Math.PI*H/y):1)*(0<b?1:-1)*Math.abs(b)**f*t*o*(H<h?H/h:H<h+E?1-(H-h)/E*(1-x):H<h+E+e?x:H<R-T?(R-H-T)/n*x:0),b=T?b/2+(T>H?0:(H<R-T?1:(R-H)/T)*m[H-T|0]/2):b),S=(s+=u+=a)*Math.sin(D*d-N),L+=S-S*M*(1-1e9*(Math.sin(H)+1)%2),D+=S-S*M*(1-1e9*(Math.sin(H)**2+1)%2),V&&++V>A&&(s+=c,v+=c,V=0),!y||++p%y||(s=v,u=U,V=V||1);return m},o=.3,l=44100,f=new(top.AudioContext||webkitAudioContext);f.destination;const u=[[[1.3,0,23,,,.2,3,5],[1.5,0,4e3,,,.03,2,1.25,,,,,.02,6.8,-.3,,.5],[.7,0,2100,,,.2,3,3,,,-400,,,2],[,0,655,,,.11,2,1.65,,,,,,3.8,-.1,.1]],[[[,-.5,13,,,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,14,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,14,,,,],[1,.3,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,],[2,1,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,],[,.6,,,,,13,,18,,19,,,,,,,,19,,18,,,,16,,,,13,,,,,,,,,,13,,18,,19,,,,,,,,18,19,18,,,,13,14,13,,16,,18,,19,,],[3,-1,,,13,,,,,,,,,,,,13,,,,,,,,,,,,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,,,13,13,13,13]],[[,-.5,13,,,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,14,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,,,13,,,,14,,,,],[1,.3,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,,,13,,13,,13,,13,,13,,],[2,1,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,,,,,,,,,13,,,,,,,,,,,,13,,,,,,,,,,,,]]],[1,1,0,0,0,0,1,0],,],a={s(){a.U=!1,a.t=f,a.I=a.t.createGain(),a.I.connect(a.t.destination),a.N=[,.01,140,.01,.02,.45,4,2.42,.1,-.1,,,,1.2,,.3,.04,.8,.02],a.b=[,,1233,,.01,.2,1,1.43,,,539,.1,,,,,,.51,.03,.01],a.v=[,,68,.01,,.14,1,1.53,7.5,.1,50,.02,-.01,-.2,.1,.2,,.47,.01],a.g=[,,391,,.19,.01,2,.54,-4,20,,,,,,,.02,.9],a.k=[,,970,.12,.25,.35,,.39,8.1,,10,.1,.2,,.1,,,.6,.09,.13],a.L=[,,454,.06,.86,.71,2,.63,-.7,1.7,-83,.09,.27,.3,.2,,.18,.95,.02,.02],a.D=((t,i,s,h=125)=>{let e,n,o,f,u,a,c,A,y,M,d,w,T,x,E,O=[],S=[],R=[],I=0,U=1,N={},v=l/h*60>>2;for(;U;I++)O=[U=A=w=0],s.map(((h,l)=>{for(c=i[h][I]||[0,0,0],U|=!!i[h][I],x=w+(i[h][0].length-2-!A)*v,n=2,f=w;n<c.length+(l==s.length-1);A=++n){for(u=c[n],y=M!=(c[0]||0)|u|0,o=0;o<v&&A;o++>v-99&&y?d+=(d<1)/99:0)a=(1-d)*O[T++]/2||0,S[f]=(S[f]||0)+a*E-a,R[f]=(R[f++]||0)+a*E+a;u&&(d=u%1,E=c[1]||0,(u|=0)&&(O=N[[M=c[T=0]||0,u]]=N[[M,u]]||(e=[...t[M]],e[2]*=2**((u-12)/12),r(...e))))}w=x}));return[S,R]})(...u),localStorage.V=JSON.stringify(u)},w(){},Q(t){},at(){},mt(){}},c={s(){this.map=[],this.map[0]=y.A.H,this.map[2]=y.A.q,this.R=[],window.addEventListener("mousemove",(t=>{this.C||(this.C={}),this.C.h=t.clientX*e.width/e.clientWidth|0,this.C.o=t.clientY*e.height/e.clientHeight|0,y.mode=2})),window.addEventListener("mouseout",(()=>{this.C=void 0})),window.addEventListener("mousedown",(t=>{let i=this.map[t.button];i&&(this.R[i]=!0),a.U=!0,At.P="mousedown",y.mode=2,this.X={h:t.clientX*e.width/e.clientWidth|0,o:t.clientY*e.height/e.clientHeight|0}})),window.addEventListener("mouseup",(t=>{let i=this.map[t.button];i&&(this.R[i]=!1),At.P="mouseup",y.mode=2})),window.addEventListener("click",(t=>{t.preventDefault(),At.P="click"})),window.addEventListener("contextmenu",(t=>{let i=this.map[t.button];i&&(this.R[i]=!0),this.B=2,t.preventDefault()})),c.c()},w(){this.B&&(this.B--,0===this.B&&(this.R[y.A.q]=!1))},c(){this.C=void 0;for(let t of Object.values(y.A))this.R[t]=!1}},A={s(){this.map=[],this.map[0]=y.A.H,this.R=[],window.addEventListener("touchmove",(t=>{this.C||(this.C={});let i=t.changedTouches[0];this.C.h=i.clientX*e.width/e.clientWidth|0,this.C.o=i.clientY*e.height/e.clientHeight|0,y.mode=1})),window.addEventListener("touchstart",(t=>{let i=this.map[0];i&&(this.R[i]=!0),a.U=!0,At.P="TOUCHSTART",y.mode=1;let s=t.changedTouches[0];this.X={h:s.clientX*e.width/e.clientWidth|0,o:s.clientY*e.height/e.clientHeight|0},this.C={...this.X}})),window.addEventListener("touchend",(t=>{let i=this.map[0];i&&(this.R[i]=!1),At.P="TOUCHEND",y.mode=1})),this.c()},w(){},c(){this.C=void 0;for(let t of Object.values(y.A))this.R[t]=!1}},y={A:{u:11,T:12,M:13,m:14,j:21,q:30,p:96,W:97,Y:98,H:40,F:41,G:42},s(){this.E={x:0,y:0,S:0},this.pt={},this.Z={},this.R={},this.K={},n.s(),c.s(),A.s(),this.mode=1,this.J=!1},w(){n.w();let t=2===this.mode?c:A;for(let i of Object.values(y.A)){let s=t.R[i]||n.R[i];this.pt[i]=!this.R[i]&&s,this.Z[i]=this.R[i]&&!s,this.pt[i]?this.K[i]=1:this.R[i]&&s&&this.K[i]++,this.R[i]=s}this.C=t.C,this.E=n.E,this.R[y.A.H]&&(this.K[y.A.H]>20&&(this.J=!0),Math.abs(t.X.h-t.C.h)+Math.abs(t.X.o-t.C.o)>5&&(this.J=!0)),this.J&&t.C&&(this._={x:t.C.h-t.X.h,y:t.C.o-t.X.o}),this.Z[y.A.H]&&(this.J?this.J=!1:(this.pt[y.A.G]=!0,this.K[y.A.G]=1))},$(t){},tt(t){}},M={10:0,32:3,33:3,39:2,44:3,46:3,73:2},d={},w={s(){w.it=lt.font.st;let t=[[101,lt.ht[2]]];for(let i of t)d[i[0]]=i[1],M[i[0]]=i[1].st.width+1;w.et=T(w.it,nt(0,0,0,1)),w.nt=T(w.it,nt(90,20,90,.15)),w.blue=T(w.it,nt(200,40,220,1)),w.rt=T(w.it,nt(240,50,200,.2)),w.ot=T(w.it,nt(240,240,255,.25)),w.red=T(w.it,nt(240,50,50,1)),w.lt=x(w.it,"#ffaa5e","#ffd4a3"),w.ft=x(w.it,"#ffaa5e","#ffd4a3",nt(255,0,0,.7))},ut(t,i,s,h,e=1,n=w.lt,r){for(let o=0;o<i.length;o++){let l=i.charCodeAt(o);if(119!==l)if(114!==l){if(d[l])t.drawImage(d[l].st,s,h-(d[l].st.height+4)/2);else{let i=4*(l-32);r&&t.drawImage(r,i%180,6*(i/180|0),3,5,s+1,h+1,3*e,5*e),t.drawImage(n,i%180,6*(i/180|0),3,5,s,h,3*e,5*e)}s+=(M[l]||4)*e}else n=w.ft;else n=w.lt}},ct(t,i,s,h,e,n,r=1,o=w.lt,l){let f=s,u=h,a=i.split(" ");for(let i of a){for(;"\n"===i[0];)i=i.slice(1),f=s,u+=6*r;let h=w.dt(i,r);f+h-s>e&&(f=s,u+=6*r),w.ut(t,i,f,u,r,o,l),f+=h+(M[32]||4)}},dt:(t,i)=>t.split("").reduce(((t,i)=>t+(M[i.charCodeAt(0)]||4)),0)*i};function T(t,i){let s=rt(t.width,t.height);return s.t.fillStyle=i,s.t.fillRect(0,0,t.width,t.height),s.t.globalCompositeOperation="destination-in",s.t.drawImage(t,0,0),s.e}function x(t,i,s,h){let e=rt(t.width,t.height);return e.t.fillStyle=s,e.t.fillRect(0,0,t.width,t.height),e.t.fillStyle=i,e.t.fillRect(0,0,t.width,1),e.t.fillRect(0,6,t.width,1),h&&(e.t.fillStyle=h,e.t.fillRect(0,0,t.width,t.height)),e.t.globalCompositeOperation="destination-in",e.t.drawImage(t,0,0),e.e}class E{constructor(t,i,s){this.frames=t,this.At=i,this.yt=s,this.wt=[],this.Mt=[];var h=t/2;for(let t=0;t<h;t++)this.wt.push(2*Math.random()-1),this.Mt.push(2*Math.random()-1);this.is=-1}w(){if(this.is++,this.is>=this.frames)return!1;let t=this.is/2,i=0|t,s=i+1,h=1-this.is/this.frames;return this.x=this.At*h*(this.wt[i]+(t-i)*(this.wt[s]-this.wt[i])),this.y=this.yt*h*(this.Mt[i]+(t-i)*(this.Mt[s]-this.Mt[i])),!0}}class O{constructor(t,s,h){this.Tt={...t},this.angle=s,this.xt=K(q(this.angle,h?8:5)),this.a=i,this.Et=!0,this.f=h,this.Ot=!0,this.St=1,this.r=0,this.Rt=-1,this.d=0===this.f?45:70,this.Ut=!0}It(){++this.Rt===this.d&&(this.Nt=!0),this.xt.x*=.9,this.xt.y*=.9,this.a*=.95,this.r+=this.a}vt(){lt.gt(lt.bt[this.f],this.Tt,this.r)}}O.g=t=>O.kt(t,8,(()=>0)),O.Lt=t=>O.kt(t,16,(()=>4*Math.random()|0)),O.kt=(t,e,n)=>{let r=t.Dt?function(t){let i=Math.atan2(t.y,t.x);return i<0&&(i+=h),i}(t.Dt.Vt):Math.random()*h;for(let o=0;o<e*(At.L?2:1);o++){let e=Math.random()*t.St,o=Q(t.Tt,q(Math.random()*h,e));At.as.push(new O(o,r+Math.random()*s-i,n()))}};const S={Ht:[{name:"1F",qt:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,0,0,14,14,14,14,14,14,14,14,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,1,1,14,0,14,14,1,2,1,1,1,1,14,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,14,1,1,14,14,1,14,0,14,1,1,1,1,1,1,1,14,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,14,1,1,1,1,1,14,0,14,1,2,1,1,1,1,1,14,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,14,1,1,2,1,1,14,0,14,1,1,1,1,1,1,1,14,0,0],[14,14,14,14,14,14,14,0,0,0,0,0,14,14,1,1,1,1,14,14,14,14,14,14,1,14,14,14,14,0,0],[14,1,1,1,1,1,14,0,0,0,0,0,0,14,14,14,14,1,1,14,14,14,1,1,1,1,14,0,0,0,0],[14,1,1,1,1,1,14,0,0,0,0,0,0,0,0,0,14,1,1,1,1,14,1,1,1,1,14,0,0,0,0],[14,1,1,1,1,1,14,0,0,0,0,0,0,0,0,0,14,14,1,1,1,14,1,1,1,1,14,14,14,14,14],[14,14,1,1,1,1,14,14,0,0,0,0,0,14,14,14,14,14,14,1,14,14,1,1,1,1,1,1,1,1,14],[0,14,1,1,1,1,1,14,0,0,0,0,0,14,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,14],[0,14,1,1,1,1,1,14,14,14,14,14,14,14,1,1,1,1,1,14,14,14,14,1,1,1,1,1,1,1,14],[0,14,1,1,1,1,1,1,1,1,1,1,1,1,1,1,14,14,14,14,0,0,14,14,14,14,1,1,1,1,14],[0,14,14,1,1,1,1,1,1,1,1,1,1,1,1,1,14,0,0,0,0,0,0,0,0,14,1,1,1,1,14],[0,0,14,14,1,1,1,1,1,1,1,1,2,1,1,1,14,0,0,0,0,0,0,0,0,14,14,14,14,14,14],[0,0,0,14,14,14,14,14,14,1,1,1,1,1,1,1,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,14,14,14,14,14,14,14,14,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],Ct:[],Pt:[{name:"SPAWN",x:28,y:11},{name:"EARTH",x:26,y:9},{name:"EARTH",x:24,y:11},{name:"EARTH",x:25,y:2},{name:"EXIT",x:3,y:7}],Xt:[],id:0}],bounds:[[0,0],[31,17]],Bt:[28,11,0]};class R{constructor(t){this.Tt={...t},this.target={...this.Tt},this.xt={x:0,y:0},this.jt=1,this.g=[],this.St=3,this.ms=2,this.Et=!0,this.Ut=!0,this.Wt=7,this.Yt=[],this.Ft=0,this.offset={x:0,y:0},this.Gt=0,this.Zt=500,this.Kt=3,this.Qt=0,this.is=0,this.zt=Math.floor(16*Math.random()),this.Jt=At.is;let i=Z(this.Tt);this.moveTo({_t:i._t,r:i.r-1})}It(){0===this.Yt.length&&this.Yt.push({$t:2});let t=this.Yt[this.Yt.length-1];if(this.is=Math.floor(At.is/8)%2+1,9===this.ms)return void(this.Nt=!0);if(3===t.$t)this.target=$(_(t.ti)),G(this.Tt,this.target).S<6&&this.Yt.pop();else if(6===t.$t){if(this.target=$(_(t.ti)),G(this.Tt,this.target).S<6){this.is=0;let i=j.ii(t.ti);i.si++,i.si>=i.hi&&this.Yt.pop()}}else if(4===t.$t){this.target=$(_(t.ti));let i=G(this.Tt,this.target),s=j.ii(t.ti);s?i.S<6&&(this.is=0,this.Gt+=this.Kt,s.ei-=this.Kt,this.Gt>=this.Zt&&this.Yt.push({$t:5,ti:{_t:j.Bt._t,r:j.Bt.r}})):(this.Yt.pop(),this.Yt.push({$t:5,ti:{_t:j.Bt._t,r:j.Bt.r}}))}else 5===t.$t&&(this.target=$(_(t.ti)),G(this.Tt,this.target).S<6&&(this.is=0,this.Gt-=this.Kt,this.Qt+=this.Kt,this.Qt>=100&&(At.ni++,this.Qt-=100),this.Gt<=0&&this.Yt.pop()));let i=j.ri(this.Tt,this.target);console.log([this.target,i]);let s=G(this.Tt,i);s.S=tt(s.S,0,.5);let h=K(s);this.xt={x:(this.xt.x+h.x)/2,y:(this.xt.y+h.y)/2}}vt(){let t=3;0===this.is&&t--;let i=Math.cos((At.is+this.zt)/16)*t,s=1*Math.sin((At.is+this.zt)/16);lt.gt(lt.oi[this.is],{x:this.Tt.x+i,y:this.Tt.y+s})}li(t){this.Yt=[{$t:4,ti:t}],this.Jt=At.is}construct(t){this.Yt.push({$t:6,ti:t}),this.Jt=At.is}moveTo(t){this.Yt=[{$t:3,ti:t}],this.Jt=At.is}ai(){let t=this.Yt[this.Yt.length-1];return t&&2!==t.$t}}R.fi=()=>{let t=At.as.filter((t=>t instanceof R));return t.sort(((t,i)=>t.ai()&&!i.ai()?1:!t.ai()&&i.ai()?-1:t.Jt-i.Jt)),t},R.assign=t=>{let i=R.fi();for(let s=0;s<i.length&&!(s>0&&i[s].ai());s++)t(i[s])};class I{constructor(t,i,s){this.Tt={...t},this.target=i,this.xt={x:0,y:0},this.g=s||70}It(){let t=G(this.Tt,this.target.Tt);t.S=tt(t.S,0,2),this.xt={x:(this.xt.x+t.x*t.S)/2,y:(this.xt.y+t.y*t.S)/2},t.S<1&&(this.target.g.push({ui:this.g,Vt:t,ci:0}),this.Nt=!0,console.log("HIT"))}vt(){lt.gt(lt.di[0],this.Tt,this.r)}}const U={Ai:()=>!!j.ii(j.selected),yi:()=>lt.buttons[6],wi:()=>lt.buttons[7],Mi(t,i){let s=j.ii(j.selected),h=At.Ti(15)?"BUILD TOWER \ne15":"BUILD TOWER \ner15";s&&(h="FINISH BUILDING"),w.ct(e.t,h,t,i)},xi(){if(j.ii(j.selected))R.assign((t=>t.construct(j.selected)));else if(At.Ti(15))return At.mi(15),j.ht.push(new N(j.selected)),R.assign((t=>t.construct(j.selected))),!0}};class N{constructor(t){this.ti={...t},this.Ei=10,this.Wt=7,this.ms=21,this.si=0,this.hi=180,this.title="TOWER",this.pi=lt.ht[0]}It(){this.si>=this.hi&&(this.ms=22);let t,i,s=$(_(this.ti));if(!this.target||this.target.Nt){for(let h of At.as){if(!h.Oi)continue;let e=G(s,h.Tt);e.S<32&&(!i||e.S<i.S)&&(t=h,i=e)}console.log("ATTEMPTED to pick target for building",t),this.target=t}this.Ei>0&&this.Ei--,this.target&&0===this.Ei&&(G(s,this.target),At.as.push(new I(s,this.target)),this.Ei=100)}vt(){let t=_(this.ti);if(z($(t)),e.t.globalAlpha=21===this.ms?.5:1,lt.gt(lt.ht[0],t),e.t.globalAlpha=1,21===this.ms){let i=tt(Math.floor(8*this.si/this.hi),0,7);e.t.globalAlpha=.5,lt.gt(lt.Si[7],t),e.t.globalAlpha=1,lt.gt(lt.Si[i],t)}}Ri(){return this.si<this.hi?[U]:[]}}const v=[0,2];for(let t=2;t<=19;t++)v[t]=Math.floor(1.5*v[t-1]+1);for(let t=0;t<20;t++)v[t]=5*v[t];const m={Ai:()=>!1,yi:()=>lt.buttons[0],wi:()=>lt.buttons[1],Mi(t,i){let s=v[At.Ui()],h=At.Ti(s)?"LURE MOTH \ne"+s:"LURE MOTH \ner"+s;w.ct(e.t,h,t,i)},xi(){let t=v[At.Ui()];if(At.Ti(t))return At.mi(t),At.as.push(new R($(_(j.selected)))),!0}};class L{constructor(t){this.ti={...t},this.title="YOUR COFFIN \nLAST CHANCE",this.pi=lt.ht[1],this.Wt=9}It(){}vt(){let t=_(this.ti);lt.gt(lt.ht[1],t)}Ri(){return[m]}}class D{constructor(t){this.Tt={...t},this.jt=100,this.g=[],this.xt={x:0,y:0},this.St=2,this.Ii=.2,this.Ni=0,this.ms=11,this.Oi=!0}It(){let t=At.as.filter((t=>t instanceof R)),i=t[0];if(console.log(t.map((t=>t.Tt))),!i)return;let s=G(this.Tt,i.Tt);for(let h=1;h<t.length;h++){let e=G(this.Tt,t[h].Tt);e.S<s.S&&(i=t[h],s=e)}const h=j.ri(this.Tt,i.Tt);let e=G(this.Tt,h);11===this.ms?s.S<8?(console.log("KILL"),i.g.push({ui:10,Vt:e,ci:0}),this.Nt=!0):(e.S=tt(e.S,0,.4),this.xt={x:(this.xt.x+e.x*e.S)/2,y:(this.xt.y+e.y*e.S)/2}):9===this.ms&&(this.Nt=!0,O.Lt(this))}vt(){let t=lt.vi[0];lt.gt(t,this.Tt)}}const H={Ai:()=>!0,yi:()=>lt.buttons[2],wi:()=>lt.buttons[3],Mi(t,i){w.ct(e.t,"GATHER EARTH",t,i)},xi:()=>(R.assign((t=>t.li(j.selected))),!0)};class V{constructor(t){this.ti={...t},this.ei=1e4,this.title="EARTH",this.pi=lt.ht[2]}It(){this.title="EARTH \n"+Math.ceil(this.ei/100)+" REMAINING",this.ei<1&&(this.Nt=!0)}vt(){let t=_(this.ti);lt.gt(lt.ht[2],t)}Ri(){return[H]}}const p={Ai:()=>!0,yi:()=>lt.buttons[4],wi:()=>lt.buttons[5],Mi(t,i){w.ct(e.t,"EXPLORE",t,i)},xi:()=>(R.assign((t=>t.moveTo(j.selected))),!0)},C={gi(t){let i=t.filter((t=>t.Tt&&t.xt&&!t.Nt));for(let t=0;t<5;t++){for(let t=0;t<i.length-1;t++)for(let s=t+1;s<i.length;s++)C.bi(i[t],i[s]);for(let t of i)C.ki(t)}for(let t of i)t.Tt.x+=t.xt.x,t.Tt.y+=t.xt.y},bi(t,i){if(t.Et||i.Et)return;let s=function(t,i,s,h,e,n){[s,n]=[K(s),K(n)];let r=G({x:t.x+s.x,y:t.y+s.y},{x:h.x+n.x,y:h.y+n.y});if(r.S<i+e)return{Li:r.x,Di:r.y,S:i+e-r.S}}(t.Tt,t.St,t.xt,i.Tt,i.St,i.xt);if(s)if(t.Ot&&i.Ot)t.xt.x=-s.Li*s.S,t.xt.y=-s.Di*s.S,i.xt.x=s.Li*s.S,i.xt.y=s.Di*s.S;else{let h=W(t.xt).S+i.Ii,e=W(i.xt).S+t.Ii,n=t.Ot?.1:1,r=i.Ot?.1:1;t.xt.x-=s.Li*s.S*n*h/(h+e),t.xt.y-=s.Di*s.S*n*h/(h+e),i.xt.x+=s.Li*s.S*r*e/(h+e),i.xt.y+=s.Di*s.S*r*e/(h+e)}},ki(t){if(!t.Ut){t.Tt.y<-1e3&&console.log("FUUUUUUUUUUUUUUUU");for(let i of function*(t,i,s){yield*function*(t,i,s){let h=[{x:Math.min(t.x,i.x)-s,y:Math.min(t.y,i.y)-s},{x:Math.max(t.x,i.x)+s,y:Math.max(t.y,i.y)+s}];yield*function*(t){for(let i=t[0].y/8|0;8*i<t[1].y;i++)for(let s=t[0].x/8|0;8*s<t[1].x;s++)yield{_t:s,r:i}}(h)}(t,{x:t.x+i.x,y:t.y+i.y},s)}(t.Tt,t.xt,t.St))if(!et(i._t,i.r)){let s=[_(i),_({_t:i._t+1,r:i.r+1})],h=it(t.Tt,{x:t.Tt.x+t.xt.x,y:t.Tt.y+t.xt.y},t.St,s);h&&(t.Ot?0===h.Li?t.xt.y=-t.xt.y:0===h.Di?t.xt.x=-t.xt.x:(t.xt.x+=h.Li,t.xt.y+=h.Di):0===h.Li?t.xt.y=h.y-t.Tt.y:0===h.Di?t.xt.x=h.x-t.Tt.x:(t.xt.x+=h.Li,t.xt.y+=h.Di))}}}},b={gi(t){for(let i of t)if(i.jt){if(i.g.length>0){if(9!==i.ms&&1!==i.ms)for(let t of i.g)i===At.Vi&&At.as.push(new HealthChunkAnimation(i.jt,t.ui)),i.jt-=t.ui,t.Vt.S=t.ci,i.xt=Q(i.xt,t.Vt),i.Dt=t,O.g(i);i.g=[]}i.jt<=0&&9!==i.ms&&(i.ms=9)}}},X=[[[0,1],[5,1],[10,1],[15,1],[20,1],[21,1],[22,1]]];class g{constructor(t){t%=X.length,this.Hi=[...X[t]],this.qi=1800,this.Ci=!1,this.is=0,this.Pi=60*this.Hi[this.Hi.length-1][0]}w(){if(this.qi--,this.qi<=0){this.Ci=!0;for(let t=0;t<this.Hi.length;t++)this.is===60*this.Hi[t][0]&&At.Xi.push(D);this.is++}this.is>=this.Pi&&(At.Bi=void 0)}}class B{constructor(){this.frames=0}w(){this.frames++}vt(){e.t.fillStyle=nt(36,26,20,tt(this.frames/200,0,1)),e.t.fillRect(0,0,e.width,e.height);let t=e.width-32,i="ESCAPE! \n                    \nVILLAGERS STIR UNEASILY IN THEIR BEDS AS YOU EMERGE INTO MOONLIGHT. YOU SENSE WARM BODIES ALL AROUND YOU, RIPE FOR PICKING. IT IS ONLY A MATTER OF TIME NOW BEFORE YOU REGAIN YOUR FULL NECROMANTIC POWER. \n                    \nCONGRATULATIONS... AND THE END.";i=i.slice(0,this.frames),w.ct(e.t,i,16,16,t,1,1)}}class Y{constructor(t){this.ti={...t},this.title="REACH EXIT \nTO ESCAPE",this.pi=lt.ht[3],this.Wt=4}It(){let t=R.fi();for(let i of t){let t=Z(i.Tt);if(t._t===this.ti._t&&t.r===this.ti.r)return void(At.screen=new B)}}vt(){let t=_(this.ti);lt.gt(lt.ht[3],t)}Ri(){return[p]}}const j={s(){this.c()},vt(){let t=this.Ht[0].qt,i=z({x:0,y:0});for(let s=0;s<t.length;s++)for(let h=0;h<t[0].length;h++)t[s][h]>0&&e.t.drawImage(lt.qt[t[s][h]-1].st,8*h+i.h,8*s+i.o);for(let t of this.ht)t.vt()},ji(){let t=this.qt,i=z({x:0,y:0});for(let s=0;s<t.length;s++)for(let h=0;h<t[0].length;h++)if(t[s][h]>0){let t=1-tt(this.Wi[s][h]/5,.1,1);0===this.Yi[s][h]&&(t=1),e.t.globalAlpha=t,e.t.drawImage(lt.Fi[0].st,8*h+i.h,8*s+i.o)}e.t.globalAlpha=1},c(){this.Ht=S.Ht.map((t=>({qt:t.qt.map((t=>[...t])),Pt:t.Pt.map((t=>({...t})))}))),this.bounds=S.bounds,this.Bt={_t:S.Bt[0],r:S.Bt[1]},this.ht=[],this.ht.push(new L(this.Bt));for(let t of this.Ht[0].Pt)"EARTH"===t.name?this.ht.push(new V({_t:t.x,r:t.y})):"EXIT"===t.name&&(this.ht.push(new Y({_t:t.x,r:t.y})),this.Gi={_t:t.x,r:t.y});this.selected=void 0,this.qt=this.Ht[0].qt,this.width=this.qt[0].length,this.height=this.qt.length,this.Wi=st(this.width,this.height,(()=>0)),this.Yi=st(this.width,this.height,(()=>0)),this.Zi={},this.Ki()},w(){for(let t of this.ht)t.It();this.Qi()},zi(t){return 46===this.Ji(t)},_i(t){return this.$i.includes(this.Ht[t.z].qt[t.y][t.x])},ts(t){this.Ht[t.z]},xi(t){let i=Z(J(t)),s=this.Ji(i);if(!s||s>=8||!this.Yi[i.r][i._t])this.selected=void 0;else if(this.selected&&this.selected._t===i._t&&this.selected.r===i.r){let t=this.ii(this.selected);if(t){let i=t.Ri();i[0]&&i[0].Ai()&&i[0].xi()}else p.xi()}else this.selected=i,this.ii(this.selected)},Ji(t){if(t)return this.Ht[0].qt[t.r]?.[t._t]},ii(t){if(t)for(let i of this.ht)if(i.ti._t===t._t&&i.ti.r===t.r)return i},Qi(){let t=[];for(let i of this.ht)i.Wt&&t.push({...i.ti,ss:i.Wt});for(let i of At.as)i.Wt&&t.push({...Z(i.Tt),ss:i.Wt});this.Wi=function(t,i,s=1/0){let h=st(t[0].length,t.length,(()=>0)),e=[...i];for(;e.length>0;){let{_t:t,r:i,ss:n}=e.shift();h[i][t]>=n||(h[i][t]=n--,h[i][t]>=s||(ht(t+1,i)&&h[i][t+1]<n&&e.push({_t:t+1,r:i,ss:n}),ht(t-1,i)&&h[i][t-1]<n&&e.push({_t:t-1,r:i,ss:n}),ht(t,i+1)&&h[i+1][t]<n&&e.push({_t:t,r:i+1,ss:n}),ht(t,i-1)&&h[i-1][t]<n&&e.push({_t:t,r:i-1,ss:n})))}return h}(this.qt,t);for(let t=0;t<this.Wi.length;t++)for(let i=0;i<this.Wi[0].length;i++)this.Wi[t][i]>this.Yi[t][i]&&(this.Yi[t][i]=1)},ri(t,i){let s=Z(t),h=Z(i);var e,n;if(e=s,n=h,Math.abs(e._t-n._t)+Math.abs(e.r-n.r)<=1)return i;let r=[h._t,h.r].join(","),o=this.Zi[r];o||(o=this.Zi[r]=function(t,i,s=1/0){let h=st(t[0].length,t.length,(()=>1/0)),e=[{...i,hs:0}];for(;e.length>0;){let{_t:t,r:i,hs:n}=e.shift();h[i][t]<=n||(h[i][t]=n++,h[i][t]>=s||(et(t+1,i)&&h[i][t+1]>n&&e.push({_t:t+1,r:i,hs:n}),et(t-1,i)&&h[i][t-1]>n&&e.push({_t:t-1,r:i,hs:n}),et(t,i+1)&&h[i+1][t]>n&&e.push({_t:t,r:i+1,hs:n}),et(t,i-1)&&h[i-1][t]>n&&e.push({_t:t,r:i-1,hs:n})))}return h}(this.qt,h)),console.log(Object.keys(this.Zi).length);let l=[[s._t+1,s.r],[s._t-1,s.r],[s._t,s.r+1],[s._t,s.r-1]];for(let t of l)t.push(o[t[1]][t[0]]);return l.sort(((t,i)=>t[2]-i[2])),$(_({_t:l[0][0],r:l[0][1]}))},Ki(){for(let t=0;t<this.qt.length;t++)for(let i=0;i<this.qt[0].length;i++)if(14===this.qt[t][i]){let s=0;(this.qt[t-1]?.[i-1]||99)<8&&(s|=256),(this.qt[t-1]?.[i]||99)<8&&(s|=128),(this.qt[t-1]?.[i+1]||99)<8&&(s|=64),(this.qt[t]?.[i-1]||99)<8&&(s|=32),(this.qt[t]?.[i+1]||99)<8&&(s|=8),(this.qt[t+1]?.[i-1]||99)<8&&(s|=4),(this.qt[t+1]?.[i]||99)<8&&(s|=2),(this.qt[t+1]?.[i+1]||99)<8&&(s|=1),lt.es(s),this.qt[t][i]=20+s}}},P=18,k={w(){if(j.selected){let t=j.Ji(j.selected),i=j.ii(j.selected);this.actions=i?i.Ri():1===t?[p,U]:[]}else this.actions=[];y.J&&(this.ns=void 0)},vt(){if(At.Bi)if(At.Bi.Ci)w.ut(e.t,"INCOMING",40,3);else{let t=Math.ceil(At.Bi.qi/60);w.ut(e.t,"COUNTDOWN "+t,40,3)}let i=At.as.filter((t=>t instanceof R));for(let t=0;t<i.length;t++)e.t.drawImage(lt.oi[1].st,2+4*t,2);let s,h=At.ni+"e",n=w.dt(h,1);if(e.t.fillStyle="rgba(0, 0, 0, 0.1)",w.ut(e.t,h,e.width-n-2,2),y.C){let t=y.C.h,i=y.C.o,s=J(y.C),h=Z(s);if(w.ut(e.t,t+","+i+". "+s.x+","+s.y+". "+h._t+","+h.r+".",e.width-100,20),j.selected){let t=j.qt[j.selected.r][j.selected._t];t>20&&(t-=20),w.ut(e.t,j.selected._t+","+j.selected.r+". "+t.toString(2).padStart(9,"0"),e.width-100,29)}}if(j.selected){let t=z({x:8*j.selected._t,y:8*j.selected.r});e.t.fillStyle=nt(255,212,163,.25),e.t.fillRect(t.h,t.o,9,9)}if(e.t.fillStyle="#ffd4a3",e.t.fillRect(0,e.height-P,e.width,1),e.t.fillStyle="#8d697a",e.t.fillRect(0,e.height-P+1,e.width,1),e.t.fillStyle="#203c56",e.t.fillRect(0,e.height-P+2,e.width,16),e.t.fillStyle="#8d697a",e.t.fillRect(0,e.height-2,e.width,2),e.t.drawImage(lt.rs[0].st,-2,e.height-P+1),e.t.drawImage(lt.rs[0].st,64,e.height-P+1),e.t.drawImage(lt.rs[0].st,e.width-3,e.height-P+1),j.selected){let i=j.ii(j.selected);if(i)e.t.drawImage(i.pi.st,3,e.height-P-1),w.ct(e.t,i.title,14,e.height-P+3,e.width);else{let i=j.Ji(j.selected);console.log(j.selected,i,t[i-1]),e.t.drawImage(lt.Fi[1].st,4,e.height-P+6),e.t.drawImage(lt.qt[i-1].st,3,e.height-P+5),w.ct(e.t,t[i-1],14,e.height-P+3,e.width)}}for(let t=0;t<this.actions.length;t++){let i=this.actions[t],h=this.os(t);e.t.drawImage(lt.rs[0].st,h.h+11,e.height-P+1),e.t.drawImage(i.yi().st,h.h,h.o),this.ns===i&&(s=t)}if(s>=0){let t=this.os(s);e.t.drawImage(lt.ls[0].st,t.h-23,t.o-19),e.t.drawImage(this.ns.wi().st,t.h,t.o),this.ns.Mi(t.h-23+3,t.o-19+3)}y.C&&(At.fs&&(e.t.globalAlpha=.5),lt.gt(lt.us,J(y.C)),e.t.globalAlpha=1)},os:t=>({h:68+15*t,o:e.height-15}),xi(t){if(t.o>e.height-P){for(let i=0;i<this.actions.length;i++){let s=this.os(i);if(t.h>=s.h&&t.h<=s.h+12&&t.o>=s.o&&t.o<=s.o+12)return this.actions[i]===this.ns?this.ns.xi()&&(this.ns=void 0):this.ns=this.actions[i],!0}return this.ns=void 0,!0}return this.ns=void 0,!1}},F={s(){this.Tt={x:0,y:0},this.cs=void 0,this.xt={x:0,y:0}},w(){if(this.cs){let t=G(this.Tt,this.cs);if(t.S<1)return void(this.cs=void 0);t.S=tt(t.S,0,2);let i=K(t);this.xt={x:(this.xt.x+i.x)/2,y:(this.xt.y+i.y)/2},this.Tt.x+=this.xt.x,this.Tt.y+=this.xt.y}y.pt[y.A.H]&&(this.ds={...this.Tt}),y.J&&(this.Tt={x:this.ds.x-y._.x,y:this.ds.y-y._.y})}};function W(t){let i=Math.sqrt(t.x*t.x+t.y*t.y);return 0===i?{x:0,y:0,S:0}:{x:t.x/i,y:t.y/i,S:i}}function G(t,i){return W({x:i.x-t.x,y:i.y-t.y})}function q(t,i){return{x:Math.cos(t),y:Math.sin(t),S:i||1}}function K(t){return{x:t.x*(t.S||1),y:t.y*(t.S||1)}}function Q(...t){let i={x:0,y:0,S:1};for(let s of t)i.x+=s.x*(s.S||1),i.y+=s.y*(s.S||1);return i}function Z(t){return{_t:t.x/8|0,r:t.y/8|0}}function _(t){return{x:8*t._t,y:8*t.r}}function z(t){return{h:t.x+e.i.h-F.Tt.x,o:t.y+e.i.o-F.Tt.y}}function J(t){return{x:t.h-e.i.h+F.Tt.x,y:t.o-e.i.o+F.Tt.y}}function $(t){return{x:t.x+4,y:t.y+4}}function tt(t,i,s){return t<i?i:t>s?s:t}function it(t,i,s,h){if(Math.max(t.x,i.x)+s<h[0].x||Math.min(t.x,i.x)-s>h[1].x||Math.max(t.y,i.y)+s<h[0].y||Math.min(t.y,i.y)-s>h[1].y)return;let e=i.x-t.x,n=i.y-t.y,r=0===e?0:1/e,o=0===n?0:1/n,l=1/0,f=1/0;if(t.x-s<h[0].x&&i.x+s>h[0].x){let i=(h[0].x-s-t.x)*r;if(i>=0&&i<=1){let s=n*i+t.y;if(s>=h[0].y&&s<=h[1].y)return{x:e*i+t.x,y:s,Rt:i,Li:-1,Di:0,As:h[0].x,ys:s}}l=h[0].x}if(t.x+s>h[1].x&&i.x-s<h[1].x){let o=(t.x-(h[1].x+s))*-r;if(o>=0&&o<=1){let s=n*o+i.y;if(s>=h[0].y&&s<=h[1].y)return{x:e*o+t.x,y:s,Rt:o,Li:1,Di:0,As:h[1].x,ys:s}}l=h[1].x}if(t.y-s<h[0].y&&i.y+s>h[0].y){let i=(h[0].y-s-t.y)*o;if(i>=0&&i<=1){let s=e*i+t.x;if(s>=h[0].x&&s<=h[1].x)return{x:s,y:n*i+t.y,Rt:i,Li:0,Di:-1,As:s,ys:h[0].y}}f=h[0].y}if(t.y+s>h[1].y&&i.y-s<h[1].y){let i=(t.y-(h[1].y+s))*-o;if(i>=0&&i<=1){let s=e*i+t.x;if(s>=h[0].x&&s<=h[1].x)return{x:s,y:n*i+t.y,Rt:i,Li:0,Di:1,As:s,ys:h[0].y}}f=h[1].y}if(l===1/0&&f===1/0)return;l!==1/0&&f===1/0&&(f=n>0?h[1].y:h[0].y),f!==1/0&&l===1/0&&(l=e>0?h[1].x:h[0].x);let u=1/s,a=Math.sqrt(e*e+n*n),c=l-t.x,A=f-t.y,y=Math.sqrt(c*c+A*A),M=Math.acos((c*e+A*n)/(a*y));if(y<s)return;if(0===M){let i=(y-s)/a;if(i>1||i<0)return;let h=i*e+t.x,r=i*n+t.y,o=c/y,u=A/y;return isNaN(h)?void 0:{x:h,y:r,Rt:i,Li:o,Di:u,As:l,ys:f}}let d=Math.sin(M),w=d*y*u;if(Math.abs(w)>1)return;let T=Math.PI-Math.asin(w),x=Math.PI-M-T,E=s*Math.sin(x)/d/a;if(E>1||E<0)return;let O=E*e+t.x,S=E*n+i.y,R=(O-l)*u,I=(S-f)*u;return isNaN(O)?void 0:{x:O,y:S,Rt:E,Li:R,Di:I,As:l,ys:f}}function st(t,i,s){return Array.from({length:i},(()=>Array.from({length:t},s)))}function ht(t,i){let s=j.Ht[0].qt;return!(t<0||i<0||i>=s.length||t>=s[i].length)}function et(t,i){let s=j.Ht[0].qt;return!(t<0||i<0||i>=s.length||t>=s[i].length)&&1===s[i][t]}function nt(t,i,s,h){return`rgba(${t},${i},${s},${h})`}function rt(t,i){let s=document.createElement("canvas");s.width=t,s.height=i;let h=s.getContext("2d");return{e:s,t:h}}const ot={ht:[[0,0,8,16],[8,0,8,16],[16,0,8,16],[24,0,8,16]],di:[[0,16,3,3]],buttons:[[0,19,12,12],[12,19,12,12],[24,19,12,12],[36,19,12,12],[48,19,12,12],[60,19,12,12],[72,19,12,12],[84,19,12,12]],cursor:[[0,31,10,8]],fs:[[0,39,15,15],[15,39,15,15],[30,39,15,15]],font:[[0,54,180,12]],vi:[[0,66,5,5]],bt:[[0,71,5,5],[5,71,5,5],[10,71,5,5],[15,71,5,5]],ws:[[0,76,9,9]],Ms:[[0,85,13,16]],rs:[[0,101,5,16]],ls:[[0,117,60,18]],Si:[[0,135,7,7],[7,135,7,7],[14,135,7,7],[21,135,7,7],[28,135,7,7],[35,135,7,7],[42,135,7,7],[49,135,7,7]],Ts:[[0,142,7,9],[7,142,7,9]],oi:[[0,151,3,3],[3,151,3,3],[6,151,3,3]],Fi:[[0,154,8,8],[8,154,8,8]],qt:[[0,162,8,8],[8,162,8,8],[16,162,8,8],[24,162,8,8],[32,162,8,8],[40,162,8,8],[48,162,8,8],[56,162,8,8],[64,162,8,8],[72,162,8,8],[80,162,8,8],[88,162,8,8],[96,162,8,8],[104,162,8,8]],xs:[[0,170,4,4],[4,170,4,4]],Es:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAACuCAMAAACoXtf9AAAAY1BMVEUAAADuw5oAAAANK0UgPFYhIickGhQuCAFTV1JUTmhcDwBtbnN1EgCNaXqPn6iRm6ObrbemraXCHQDJAADL2/zQgVnfcSbmAADm5rjuw5ru6WTwJAD78jb/ql7/1KP/7Nb///+u5EtCAAAAAnRSTlMAlm//+0kAAAPySURBVHja7Z2JtuMmDIYZm7Tj3GbpcvcL5v2fssj8jmiIj0997QTN0UeIQFnOV1VeZjfK2iiK0mFWycuAKTgQtTrjuYCE65d2zpmMZ6Lq9iBn33qXS2NWXGxybmF9cEOCqFyaK31IXUFrMdIH9/zs5FTaezfUOVrXX2mAwkrgh5HHj3eR1kYiDtDagzXzW+A64IzxB+DXym/nDJw/XPBL8i4y5n2EwnbSLo5RwsfBcsgTnCdcJu1HaX4/5TaUhgLLJXUSICDnB6YrOpmvpz0yObLjfPZ+etpOOo6LHI1lvXtfafQhjbEPaTi4Ze0x9i7SY/5wf+mZAwsScIB0lvecL6Xr6OkFedEXF72M90YgvUTr3vcSpX0vUNr8eihKQ2AZN2BY16v8RgyCzVvcgLiOj0qd2ZJ32Df0VCGFZWEtUBp9UxVXloU0oijpGVRapWWcPVT6/ldEIOveQ+RdXsWE+fwkIYT4RBGTRtogzn8RPo9Ik78jDQLrFaQhmVbYZZ4hy0wTimF4zkkvIH1NUSVUDq9hMwV/hovA+8DSyC0glNJ4lPUJeH1xpfP9Nyodxlj09NgmiDxpPytd9LShfSaaHS8SKf4rOeIILkfKbwz3dC4GpsXy/yVlx61oV/QcYNl8lNIhr/yVNPfuus58TqfA5JWmiCeirGG4rFiaWwW5lQk8ARsFrBD5xVwmcNXzyiLLua1B5fM2EU7f9/KcaYiTJsw9UOl7dofyegmf5o+9EOH937R635v9X5+QlsKepixniP8u5p76Hqj0B6ayLSFwULSn9ZT3IA45cqQ7m+gEScOZrOVIW0alVVqlVVqlN0el9TKuN0yMMGkjjC46d0YYtjt0Vpy0PViVVmmVVmmVVmmVLi/jesOkt6aMX8wDnQ+L8Q+UtgtRaZVWaZVWaZVWaZUWJb3+bV7+CwS38dXdUP9H2t/E1EcmbWqk7/9f6Ck8GkjMhh6BqKbSkclQ8HBphHnbDFMXuXQvRBqVh/NkqJL5g/ORNMQYhNB8fTXnY9Mcz7RSaQBUOkeM9DlClaao0ltKH4kGwWyCnqeBj0MYHo+N0WL/Blqg0iqt0iqt0nXRfhMD2sPBDjHP28OB8kME60jbjrCtTbSA80X0+d6A9tlZ/PtXjmaSfnbkTPZtyj+vI90lCmlKRr0b0ZM1RVoV0s65OFnaplX7TPlnt7I0xkhy6srYjdHHyNIuSVuQVJHE69a6laWvnLmiZSykuacZ9HT+OvYrSoNZaQrYU7SA2qOU5iS9buN+Y+nEXBwPvAlp7mm8b92zxzXIz8XxwGvdLWnHZw+8z6zB6XT6aaRxenramX/+FCj9586I4uduJ8cY/AtKngu2kzNUTwAAAABJRU5ErkJggg=="},lt={ps(t){let i=new Image;i.onload=t,i.src=ot.Es,lt.Ys=i},s(){lt.font=ft(ot.font[0]),lt.Os=ft(ot.Ts[0]),lt.Ss=ft(ot.Ts[1]),lt.oi=ot.oi.map(ft),lt.bt=ot.bt.map(ft),lt.ws=ot.ws.map(ft),lt.us=ot.cursor.map((t=>ft(t,{x:0,y:0})))[0],lt.di=ot.di.map(ft),lt.Ms=ot.Ms.map(ft),lt.rs=ot.rs.map(ft),lt.ls=ot.ls.map(ft),lt.Si=ot.Si.map((t=>ft(t,{x:-1,y:-1}))),lt.qt=ot.qt.map(ft),lt.Fi=ot.Fi.map(ft),lt.vi=ot.vi.map(ft),lt.ht=ot.ht.map((t=>ft(t,{x:0,y:8}))),lt.buttons=ot.buttons.map(ft),lt.Rs=ut(function(t){let i=rt(544,334);for(let s=0;s<334;s+=32)for(let h=0;h<544;h+=32)i.t.drawImage(t,h,s);return i.e}(lt.qt[0].st)),lt.ot=ut(function(){let t=rt(500,500),i=t.t.createRadialGradient(250,250,0,250,250,250);return i.addColorStop(.3,nt(0,0,0,0)),i.addColorStop(1,nt(0,0,0,.9)),t.t.fillStyle=i,t.t.fillRect(0,0,500,500),t.e}());let t=ot.fs.map(ft);lt.Us=ut(function(t,i){let s=rt(130,45);return s.t.drawImage(at(t).e,0,5),s.t.drawImage(i,5,0),s.e}(t[0].st,t[2].st)),lt.Is=ut(at(t[1].st).e)},Ns(t,i,s,h){t.drawImage(i.st,s-i.js.x,h-i.js.y)},gt(t,i,s){let{h:h,o:n}=this.vs(t,i);s?(e.t.save(),e.t.translate(h+t.js.x,n+t.js.y),e.t.rotate(s),e.t.drawImage(t.st,-t.js.x,-t.js.y),e.t.restore()):e.t.drawImage(t.st,h,n)},vs:(t,i)=>({h:i.x-t.js.x-F.Tt.x+e.i.h,o:i.y-t.js.y-F.Tt.y+e.i.o}),es(t){return this.qt[t+20-1]||(this.qt[t+20-1]=ut(function(t,i){let s=rt(8,8);return 256&i&&s.t.drawImage(t[12].st,0,0,4,4,0,0,4,4),64&i&&s.t.drawImage(t[12].st,5,0,3,3,5,0,3,3),1&i&&s.t.drawImage(t[12].st,6,6,2,2,6,6,2,2),4&i&&s.t.drawImage(t[12].st,0,5,3,3,0,5,3,3),8&i&&s.t.drawImage(t[11].st,5,0,3,8,5,0,3,8),32&i&&s.t.drawImage(t[9].st,0,0,4,8,0,0,4,8),2&i&&s.t.drawImage(t[8].st,0,5,8,3,0,5,8,3),128&i&&s.t.drawImage(t[10].st,0,0,8,4,0,0,8,4),160==(160&i)&&s.t.drawImage(t[13].st,0,0,5,5,0,0,5,5),136==(136&i)&&s.t.drawImage(t[13].st,4,0,4,4,4,0,4,4),10==(10&i)&&s.t.drawImage(t[13].st,4,4,4,4,4,4,4,4),34==(34&i)&&s.t.drawImage(t[13].st,0,4,5,4,0,4,5,4),s.e}(this.qt,t),{x:0,y:0})),this.qt[t+20-1]}};function ft(t,i){return ut(function(t,i,s,h){const e=lt.Ys,n=rt(s,h);return n.t.drawImage(e,t,i,s,h,0,0,s,h),n.e}(...t),i)}function ut(t,i){let s=t.width,h=t.height;return{st:t,js:"object"==typeof i?i:{x:s/2|0,y:h/2|0}}}function at(t){let i=rt(130,40);for(let s=0;s<40;s+=5)for(let h=0;h<130;h+=5){let e=0===h?0:125===h?10:5,n=0===s?0:35===s?10:5;i.t.drawImage(t,e,n,5,5,h,s,5,5)}return i}class ct{constructor(){this.frames=0}w(){return this.frames++,y.pt[y.A.G]&&this.frames>30&&At.c(),!0}vt(){e.t.fillStyle=nt(36,26,20,tt(this.frames/200,0,1)),e.t.fillRect(0,0,e.width,e.height);let t=e.width-32,i="DEFEAT... \n                    \nYOUR LAST MOTH GONE, THIS WORLD SLIPS FROM YOUR GRASP. YOU CURSE THE VILLAGE AND ITS INHABITANTS AS YOU TUMBLE TOWARDS THAT BLEAK BEYOND. \n \nYOUR REIGN OF TERROR HAS ENDED. \n \nTAP TO TRY AGAIN!";i=i.slice(0,this.frames),w.ct(e.t,i,16,16,t,1,1,w.ft)}}const At=new class{s(){lt.ps((()=>{e.s(),lt.s(),w.s(),y.s(),a.s(),F.s(),j.s(),window.addEventListener("blur",(()=>this.at())),window.addEventListener("focus",(()=>this.mt())),this.c(),this.start()}))}c(){this.as=[],this.gs={},this.bs={},this.ks={},this.Ls=0,this.Ds=[],this.Xi=[],this.Vs=0,this.ni=250,this.Hs=0,this.as.push(new R(_(j.Bt))),this.screen=void 0,this.Bi=void 0,j.c(),F.Tt=$(_(j.Gi)),F.cs=$(_(j.Bt))}start(){this.is=0,this.qs=[0],this.w(),window.requestAnimationFrame((t=>this.Cs(t)))}Cs(t){let i=(new Date).getTime();this.qs.length>=40&&this.qs.shift(),this.Ps=1e3/((this.qs[this.qs.length-1]-this.qs[0])/this.qs.length),this.is++,e.n(),this.w(),this.vt(e.t),window.requestAnimationFrame((t=>this.Cs(t)));let s=(new Date).getTime();this.qs.push(this.qs[this.qs.length-1]+s-i)}w(){if(this.Bi||(this.Bi=new g(this.Vs++)),y.w(),!(this.screen&&this.screen.w()||(y.pt[y.A.G]&&this.xi(y.C),k.w(),this.Fs))){this.Bi.w(),this.Xs(),console.log(At.as);for(let t of At.as)t.It&&t.It();b.gi(this.as),C.gi(this.as),F.w(),this.as=this.as.filter((t=>!t.Nt)),j.ht=j.ht.filter((t=>!t.Nt)),this.Ds=this.Ds.filter((t=>t.w())),j.w(),0===this.as.filter((t=>t instanceof R)).length&&(At.screen=new ct),At.is%6==0&&(this.Ls=10*Math.random()|0),30===At.is&&At.Ds.push(new E(20,20,20)),y.pt[y.A.j]&&!At.Bs&&(At.Bs=!0)}}vt(){e.t.setTransform(1,0,0,1,0,0),e.t.scale(e.scale,e.scale),e.t.fillStyle=nt(36,26,20,1),e.t.fillRect(0,0,e.width,e.height),j.vt();for(let t of this.as)(!t.z||t.z<100)&&t.vt();for(let t of this.as)t.z&&t.z>100&&t.vt();j.ji(),k.vt(),At.is<120&&(e.t.fillStyle=nt(0,0,0,1-At.is/120),e.l()),this.screen&&this.screen.vt()}at(){this.Fs||(this.Fs=!0)}mt(){this.Fs&&(this.Fs=!1)}xi(t){for(let i of[k,j])if(i.xi(t))break}Ui(){return this.as.filter((t=>t instanceof R)).length}Ti(t){if(this.ni>=t)return!0}mi(t){this.ni-=t}Xs(){let t=this.Xi[0];if(t)for(let i=0;i<10;i++){let i=Math.floor(Math.random()*j.Ht[0].qt[0].length),s=Math.floor(Math.random()*j.Ht[0].qt.length);if(1!==j.qt[s][i])continue;if(0!==j.Wi[s][i])continue;let h=_({_t:i,r:s});console.log("NEW monster"+h.x+","+h.y+","+j.Wi[s][i]),At.as.push(new t(h)),this.Xi.shift();break}}};At.s()}();
//# sourceMappingURL=app.js.map</script>
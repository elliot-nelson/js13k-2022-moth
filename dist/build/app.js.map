{"version":3,"sources":["app.js"],"names":["TILE_DESCRIPTIONS","R45","Math","PI","R90","R360","Viewport","init","canvas","document","getElementById","ctx","getContext","resize","force","dpi","window","devicePixelRatio","width","clientWidth","height","clientHeight","dpiWidth","dpiHeight","scale","max","ceil","center","u","v","imageSmoothingEnabled","style","cursor","fillViewportRect","fillRect","KeyboardAdapter","map","KeyW","Input","Action","UP","KeyA","LEFT","KeyS","DOWN","KeyD","RIGHT","ArrowUp","ArrowLeft","ArrowDown","ArrowRight","Escape","MENU","arrowDirections","x","y","m","held","addEventListener","event","k","code","reset","update","state","direction","action","Object","values","ZZFX","volume","sampleRate","AudioContext","webkitAudioContext","destination","play","parameters","this","playSamples","buildSamples","samples","buffer","createBuffer","length","source","createBufferSource","d","i","getChannelData","set","connect","start","randomness","frequency","attack","sustain","release","shape","shapeCurve","slide","deltaSlide","pitchJump","pitchJumpTime","repeatTime","noise","modulation","bitCrush","delay","sustainVolume","decay","tremolo","PI2","f","startSlide","startFrequency","random","b","t","tm","j","r","c","s","sin","min","tan","abs","round","cos","getNote","semitoneOffset","rootNoteFrequency","Audio","readyToPlay","gain_","createGain","towerShoot","mothDeath","ghostDeath","buildingFinished","waveCountdown","sound","pause","gain","linearRampToValueAtTime","currentTime","unpause","MouseAdapter","RAW_TOUCH","RELOAD","pointer","clientX","clientY","mode","button","game","frogger","pointerDragStart","preventDefault","releaseRMBTick","TouchAdapter","p","changedTouches","ATTACK","MUTE","FREEZE","DRAG","TAP","pressed","released","framesHeld","dragging","pointerAdapter","dragVector","onDown","onUp","C_SHIFT","C_ICONS","Text","white","Sprite","font","img","icons","buildings","icon","black","recolor","rgba","black_shadow","blue","blue_shadow","shadow","red","duotone","recolorDuotone","duotone_red","drawText","text","idx","charCodeAt","drawImage","C_WIDTH","drawParagraph","w","h","cu","cv","phrases","split","phrase","slice","phraseWidth","measureWidth","reduce","sum","color","createCanvas","fillStyle","globalCompositeOperation","topColor","bottomColor","tint","C_HEIGHT","ScreenShake","constructor","frames","hAmplitude","vAmplitude","hSamples","vSamples","sampleCount","push","frame","s0","s1","Gore","pos","angle","vel","vector2point","angle2vector","a","noClipEntity","bounce","radius","noClipWall","think","cull","draw","drawViewportSprite","gore","damage","entity","spray","kill","count","cb","lastDamage","atan2","vector","victory","vectorAdd","entities","WorldData","Pt","name","Wt","Yt","Ft","zt","id","bounds","Bt","Moth","target","hp","lightlevel","tasks","carrying","offset","carryAmount","carryCapacity","carryPerFrame","transferAmount","circleOffset","floor","lastAssigned","qr","xy2qr","moveTo","q","task","centerxy","qr2xy","vectorBetween","pop","building","World","buildingAt","buildFrames","buildFramesTotal","dist","resourcesLeft","spawn","earth","pathToTarget","console","log","clamp","newVelocity","uv","moth","gather","construct","isBusy","sortMoths","moths","filter","e","sort","assign","fn","TowerGunk","diff","amount","knockback","bullet1","BuildTowerAction","defaultTapAction","selected","buttonSprite","buttons","buttonSelectedSprite","drawSelectedText","formatCost","tap","costs","canAfford","payCost","TowerBuilding","framesToNextShot","title","portraitSprite","closestTarget","closestVector","xy","enemy","xy2uv","globalAlpha","progress","hud_wip","hudActions","SPAWN_COST_EARTH","SpawnMothAction","activeMoths","TeleportCoffinAction","CoffinBuilding","AttackAnimation","z","rot","initialSpawn","Ghost","variant","mass","lastAttack","attackDistance","moveSpeed","maxhp","targets","bestTarget","bestDiff","attackFrames","attackTarget","fervor","sprite","ghost","enemy_healthbar","GatherEarthAction","EarthBuilding","MoveAction","Movement","perform","movers","rounds","clipVelocityEntityVsEntity","clipVelocityAgainstWalls","other","hit","p1","r1","v1","p2","r2","v2","delta","nx","ny","entityM","normalizeVector","otherM","entityI","otherI","tile","tileIsPassable","intersectCircleRectangle","Damage","player","HealthChunkAnimation","WAVES","Wave","waveNumber","upcoming","countdown","incoming","lastFrame","monstersPending","wave","VictoryScreen","message","ExitBuilding","screen","tiles","floors","drawLightmap","lightmap","fogofwar","tile_background","row","objects","object","exit","array2d","cachedFields","makePrettyWalls","updateLightmap","canMoveInto","tileAt","isSeeThrough","SEE_THROUGH","includes","refreshVisible","uv2xy","actions","lights","light","maze","froms","maxDistance","Infinity","result","stack","ii","xs","shift","tileOnMap","from","to","qrFrom","qrTo","qr1","qr2","key","join","field","cost","ws","keys","options","option","bitmask","getDynamicTile","TRAY_HEIGHT","Hud","wipCanvas","selectedAction","seconds","clearRect","beginPath","lineTo","arc","fill","selectedActionIndex","cornerText","String","padStart","cornerWidth","hud_tray_divider","uvAction","uvTrayAction","hud_tray_popup","dialog","hud_mouse","undefined","Camera","forceTarget","dragStart","sqrt","vectors","TILE_SIZE","value","dx","dy","invdx","invdy","cornerX","cornerY","ltime","ly","ix","iy","rtime","ry","ttime","tx","btime","bx","inverseRadius","lineLength","cornerdx","cornerdy","cornerDistance","innerAngle","acos","time","isNaN","innerAngleSin","angle1Sin","angle1","asin","angle2","Array","g","createElement","SpriteSheet","hud_crosshair","hud_tray_building","icon_mouse","walls","base64","loadSpritesheet","image","Image","onload","src","sheet","initBasicSprite","icon_mouse_lmb","icon_mouse_rmb","data","tilebg","initDynamicSprite","gradient","createRadialGradient","addColorStop","drawSprite","anchor","rotation","o","viewportSprite2uv","save","translate","rotate","restore","TILE_CORNER_OUTER","TILE_WALL_LEFT","TILE_WALL_RIGHT","TILE_WALL_TOP","TILE_WALL_BOTTOM","TILE_CORNER_INNER","sliceCanvas","DefeatScreen","dialogPending","dialogSeen","roomsCleared","shadowOffset","screenshakes","blood","framestamps","requestAnimationFrame","xyz","onFrame","currentms","startTime","Date","getTime","fps","endTime","paused","spawnMonsterIfPossible","screenshake","started","setTransform","ui","spawnFn"],"mappings":"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EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,GACA,GACA,EACA,GAEJ,CACI,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GAEJ,CACI,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GAEJ,CACI,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GAEJ,CACI,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GAEJ,CACI,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,EACA,GAEJ,CACI,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,EACA,EACA,EACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,GAEJ,CACI,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,GACA,GAEJ,CACI,EACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,GACA,GACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,IAEJ,CACI,EACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,IAEJ,CACI,EACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,IAEJ,CACI,EACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,IAEJ,CACI,EACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,GACA,GACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,GACA,EACA,GACA,GACA,EACA,EACA,EACA,GACA,IAEJ,CACI,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,GACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,EACA,EACA,EACA,GACA,EACA,EACA,GACA,GACA,GACA,GACA,GACA,GAEJ,CACI,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,GAEJ,CACI,EACA,EACA,EACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,GAEJ,CACI,EACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,GAEJ,CACI,EACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,EACA,EACA,GAEJ,CACI,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,EACA,EACA,GAEJ,CACI,GACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,GACA,GACA,GACA,GACA,GACA,EACA,GAEJ,CACI,GACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,GACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,GACA,GACA,GAEJ,CACI,GACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GAEJ,CACI,GACA,GACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GAEJ,CACI,EACA,GACA,EACA,EACA,EACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GAEJ,CACI,EACA,GACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,EACA,EACA,EACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,EACA,EACA,EACA,GACA,GACA,GAEJ,CACI,EACA,GACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,GACA,EACA,GACA,GACA,GACA,GACA,GACA,EACA,GAEJ,CACI,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,GACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GAEJ,CACI,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GAEJ,CACI,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GAEJ,CACI,EACA,EACA,EACA,EACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GAEJ,CACI,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,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","file":"app.js","sourcesContent":["(function () {\n    'use strict';\n\n    // Constants\n\n    // The game's desired dimensions in pixels - the actual dimensions can be adjusted\n    // slightly by the Viewport module.\n    const TARGET_GAME_WIDTH = 240; //320; //480;\n    const TARGET_GAME_HEIGHT = 135; //180; //270;\n\n    // Size in pixels of each map tile\n    const TILE_SIZE   = 8;\n\n    const INPUT_MODE_TOUCH = 1;\n    const INPUT_MODE_MOUSE = 2;\n    const TILE_WALL_TOP = 9;\n    const TILE_WALL_RIGHT = 10;\n    const TILE_WALL_BOTTOM = 11;\n    const TILE_WALL_LEFT = 12;\n    const TILE_CORNER_OUTER = 13;\n    const TILE_CORNER_INNER = 14;\n    const TILE_DYNAMIC = 20;\n\n    const TILE_DESCRIPTIONS = [\n        'CAVE FLOOR',\n        'CAVE FLOOR',\n        'CAVE FLOOR',\n        '',\n        '',\n        '',\n        'DOOM PIT',\n        'DOOM PIT'\n    ];\n\n    // Some pre-calculated radian values\n    const R0          =   0;\n    const R45         =  45 * Math.PI / 180;\n    const R90         =  90 * Math.PI / 180;\n    const R360        = 360 * Math.PI / 180;\n\n    // Moths must be within this number of pixels of their target\n    // to \"act\" (construct, gather, etc.).\n    const ACTION_DISTANCE = 6;\n\n    // Entity behaviors (states)\n    const SPAWN     = 1;\n    const IDLE      = 2;\n    const MOVE      = 3;\n    const PICKUP    = 4;\n    const DROPOFF   = 5;\n    const CONSTRUCT = 6;\n    const DEAD      = 9;\n\n    // Additional behaviors (enemies)\n    const CHASE     = 11;\n    const ATTACK    = 12;\n\n    // Additional behaviors (buildings)\n    const WIP       = 21;\n    const ONLINE    = 22;\n\n    // Viewport\n\n    /**\n     * Viewport\n     *\n     * Represents the game display (for us, a canvas).\n     */\n    const Viewport = {\n        init() {\n            Viewport.canvas = document.getElementById('canvas');\n            Viewport.ctx = Viewport.canvas.getContext('2d');\n            Viewport.resize(true);\n        },\n\n        // Resize the canvas to give us approximately our desired game display size.\n        //\n        // Rather than attempt to explain it, here's a concrete example:\n        //\n        //     we start with a desired game dimension:   480x270px\n        //          get the actual browser dimensions:  1309x468px\n        //          factor in the display's DPI ratio:  2618x936px\n        //         now calculate the horizontal scale:       5.45x\n        //                     and the vertical scale:       3.46x\n        //            our new offical game scaling is:        5.4x\n        //       and our official viewport dimensions:   484x173px\n        //\n        // This approach emphasizes correct aspect ratio and maintains full-window rendering, at\n        // the potential cost of limiting visibility of the game itself in either the X or Y axis.\n        // If you use this approach, make sure your GUI can \"float\" (otherwise there may be whole\n        // UI elements the player cannot see!).\n        resize(force) {\n            let dpi = window.devicePixelRatio,\n                width = Viewport.canvas.clientWidth,\n                height = Viewport.canvas.clientHeight,\n                dpiWidth = width * dpi,\n                dpiHeight = height * dpi;\n\n            if (\n                force ||\n                Viewport.canvas.width !== dpiWidth ||\n                Viewport.canvas.height !== dpiHeight\n            ) {\n                Viewport.canvas.width = dpiWidth;\n                Viewport.canvas.height = dpiHeight;\n\n                Viewport.scale = ((Math.max(dpiWidth / TARGET_GAME_WIDTH, dpiHeight / TARGET_GAME_HEIGHT) * 10) | 0) / 10;\n                Viewport.width = Math.ceil(dpiWidth / Viewport.scale);\n                Viewport.height = Math.ceil(dpiHeight / Viewport.scale);\n                Viewport.center = {\n                    u: (Viewport.width / 2) | 0,\n                    v: (Viewport.height / 2) | 0\n                };\n                Viewport.clientWidth = width;\n                Viewport.clientHeight = height;\n\n                // Note: smoothing flag gets reset on every resize by some browsers, which is why\n                // we do it here.\n                Viewport.ctx.imageSmoothingEnabled = false;\n            }\n\n            // We do this every frame, not just on resize, due to browser sometimes \"forgetting\".\n            Viewport.canvas.style.cursor = 'none';\n        },\n\n        fillViewportRect() {\n            Viewport.ctx.fillRect(0, 0, Viewport.width, Viewport.height);\n        }\n    };\n\n    /**\n     * KeyboardAdapter\n     *\n     * Maps keyboard inputs to game inputs.\n     */\n    const KeyboardAdapter = {\n        init() {\n            KeyboardAdapter.map = {\n                KeyW:        Input.Action.UP,\n                KeyA:        Input.Action.LEFT,\n                KeyS:        Input.Action.DOWN,\n                KeyD:        Input.Action.RIGHT,\n                ArrowUp:     Input.Action.UP,\n                ArrowLeft:   Input.Action.LEFT,\n                ArrowDown:   Input.Action.DOWN,\n                ArrowRight:  Input.Action.RIGHT,\n                Escape:      Input.Action.MENU\n            };\n\n            // For keyboard, we support 8-point movement (S, E, SE, etc.)\n            KeyboardAdapter.arrowDirections = [\n                { x:   R0, y:   R0, m: 0 },\n                { x:   R0, y: -R90, m: 1 },\n                { x:   R0, y:  R90, m: 1 },\n                { x:   R0, y:   R0, m: 0 },\n                { x: -R90, y:   R0, m: 1 },\n                { x: -R45, y: -R45, m: 1 },\n                { x: -R45, y:  R45, m: 1 },\n                { x: -R90, y:   R0, m: 1 },\n                { x:  R90, y:   R0, m: 1 },\n                { x:  R45, y: -R45, m: 1 },\n                { x:  R45, y:  R45, m: 1 },\n                { x:  R90, y:   R0, m: 1 },\n                { x:   R0, y:   R0, m: 0 },\n                { x:   R0, y: -R90, m: 1 },\n                { x:   R0, y:  R90, m: 1 },\n                { x:   R0, y:   R0, m: 0 }\n            ];\n\n            KeyboardAdapter.held = [];\n\n            window.addEventListener('keydown', event => {\n                let k = KeyboardAdapter.map[event.code];\n                // Debugging - key presses\n                // console.log(event.key, event.keyCode, event.code, k);\n                if (k) {\n                    KeyboardAdapter.held[k] = true;\n                }\n            });\n\n            window.addEventListener('keyup', event => {\n                let k = KeyboardAdapter.map[event.code];\n                if (k) {\n                    KeyboardAdapter.held[k] = false;\n                }\n            });\n\n            KeyboardAdapter.reset();\n        },\n\n        update() {\n            // For keyboards, we want to convert the state of the various arrow keys being held down\n            // into a directional vector. We use the browser's event to handle the held state of\n            // the other action buttons, so we don't need to process them here.\n            let state =\n                (KeyboardAdapter.held[Input.Action.UP] ? 1 : 0) +\n                (KeyboardAdapter.held[Input.Action.DOWN] ? 2 : 0) +\n                (KeyboardAdapter.held[Input.Action.LEFT] ? 4 : 0) +\n                (KeyboardAdapter.held[Input.Action.RIGHT] ? 8 : 0);\n\n            KeyboardAdapter.direction = KeyboardAdapter.arrowDirections[state];\n        },\n\n        reset() {\n            KeyboardAdapter.direction = KeyboardAdapter.arrowDirections[0];\n            for (let action of Object.values(Input.Action)) {\n                KeyboardAdapter.held[action] = false;\n            }\n        }\n    };\n\n    /*\n\n    ZzFX - Zuper Zmall Zound Zynth v1.1.8\n    By Frank Force 2019\n    https://github.com/KilledByAPixel/ZzFX\n\n    ZzFX Features\n\n    - Tiny synth engine with 20 controllable parameters.\n    - Play sounds via code, no need for sound assed files!\n    - Compatible with most modern web browsers.\n    - Small code footprint, the micro version is under 1 kilobyte.\n    - Can produce a huge variety of sound effect types.\n    - Sounds can be played with a short call. zzfx(...[,,,,.1,,,,9])\n    - A small bit of randomness appied to sounds when played.\n    - Use ZZFX.GetNote to get frequencies on a standard diatonic scale.\n    - Sounds can be saved out as wav files for offline playback.\n    - No additional libraries or dependencies are required.\n\n    */\n\n    // zzfx object with some extra functionalty\n    const ZZFX = {\n        // master volume scale\n        volume: .3,\n\n        // sample rate for audio\n        sampleRate: 44100,\n\n        // create shared audio context\n        x: new (window.AudioContext || webkitAudioContext),\n\n        destination: undefined,\n\n        // play a sound from zzfx paramerters\n        play: function(...parameters)\n        {\n            // build samples and start sound\n            return this.playSamples(this.buildSamples(...parameters));\n        },\n\n        // play an array of samples\n        playSamples: function(...samples)\n        {\n            // create buffer and source\n            const buffer = this.x.createBuffer(samples.length, samples[0].length, this.sampleRate),\n                source = this.x.createBufferSource();\n\n            samples.map((d,i)=> buffer.getChannelData(i).set(d));\n            source.buffer = buffer;\n            source.connect(this.destination);\n            source.start();\n            return source;\n        },\n\n        // build an array of samples\n        buildSamples: function\n        (\n            volume = 1,\n            randomness = .05,\n            frequency = 220,\n            attack = 0,\n            sustain = 0,\n            release = .1,\n            shape = 0,\n            shapeCurve = 1,\n            slide = 0,\n            deltaSlide = 0,\n            pitchJump = 0,\n            pitchJumpTime = 0,\n            repeatTime = 0,\n            noise = 0,\n            modulation = 0,\n            bitCrush = 0,\n            delay = 0,\n            sustainVolume = 1,\n            decay = 0,\n            tremolo = 0\n        )\n        {\n            // init parameters\n            const PI2 = Math.PI*2;\n            let sampleRate = this.sampleRate,\n            sign = v => v>0?1:-1,\n            startSlide = slide *= 500 * PI2 / sampleRate / sampleRate,\n            startFrequency = frequency *=\n                (1 + randomness*2*Math.random() - randomness) * PI2 / sampleRate,\n            b=[], t=0, tm=0, i=0, j=1, r=0, c=0, s=0, f, length;\n\n            // scale by sample rate\n            attack = attack * sampleRate + 9; // minimum attack to prevent pop\n            decay *= sampleRate;\n            sustain *= sampleRate;\n            release *= sampleRate;\n            delay *= sampleRate;\n            deltaSlide *= 500 * PI2 / sampleRate**3;\n            modulation *= PI2 / sampleRate;\n            pitchJump *= PI2 / sampleRate;\n            pitchJumpTime *= sampleRate;\n            repeatTime = repeatTime * sampleRate | 0;\n\n            // generate waveform\n            for(length = attack + decay + sustain + release + delay | 0;\n                i < length; b[i++] = s)\n            {\n                if (!(++c%(bitCrush*100|0)))                      // bit crush\n                {\n                    s = shape? shape>1? shape>2? shape>3?         // wave shape\n                        Math.sin((t%PI2)**3) :                    // 4 noise\n                        Math.max(Math.min(Math.tan(t),1),-1):     // 3 tan\n                        1-(2*t/PI2%2+2)%2:                        // 2 saw\n                        1-4*Math.abs(Math.round(t/PI2)-t/PI2):    // 1 triangle\n                        Math.sin(t);                              // 0 sin\n\n                    s = (repeatTime ?\n                            1 - tremolo + tremolo*Math.sin(PI2*i/repeatTime) // tremolo\n                            : 1) *\n                        sign(s)*(Math.abs(s)**shapeCurve) *       // curve 0=square, 2=pointy\n                        volume * this.volume * (                  // envelope\n                        i < attack ? i/attack :                   // attack\n                        i < attack + decay ?                      // decay\n                        1-((i-attack)/decay)*(1-sustainVolume) :  // decay falloff\n                        i < attack  + decay + sustain ?           // sustain\n                        sustainVolume :                           // sustain volume\n                        i < length - delay ?                      // release\n                        (length - i - delay)/release *            // release falloff\n                        sustainVolume :                           // release volume\n                        0);                                       // post release\n\n                    s = delay ? s/2 + (delay > i ? 0 :            // delay\n                        (i<length-delay? 1 : (length-i)/delay) *  // release delay\n                        b[i-delay|0]/2) : s;                      // sample delay\n                }\n\n                f = (frequency += slide += deltaSlide) *          // frequency\n                    Math.cos(modulation*tm++);                    // modulation\n                t += f - f*noise*(1 - (Math.sin(i)+1)*1e9%2);     // noise\n\n                if (j && ++j > pitchJumpTime)       // pitch jump\n                {\n                    frequency += pitchJump;         // apply pitch jump\n                    startFrequency += pitchJump;    // also apply to start\n                    j = 0;                          // stop pitch jump time\n                }\n\n                if (repeatTime && !(++r % repeatTime)) // repeat\n                {\n                    frequency = startFrequency;     // reset frequency\n                    slide = startSlide;             // reset slide\n                    j = j || 1;                     // reset pitch jump time\n                }\n            }\n\n            return b;\n        },\n\n        // get frequency of a musical note on a diatonic scale\n        getNote: function(semitoneOffset=0, rootNoteFrequency=440)\n        {\n            return rootNoteFrequency * 2**(semitoneOffset/12);\n        }\n\n    }; // ZZFX\n\n    const Audio = {\n        init() {\n            Audio.readyToPlay = false;\n\n            Audio.ctx = ZZFX.x;\n            Audio.gain_ = Audio.ctx.createGain();\n            Audio.gain_.connect(Audio.ctx.destination);\n            ZZFX.destination = Audio.gain_;\n\n            //Audio.damage = [,,391,,.19,.01,2,.54,-4,20,,,,,,,.02,.9];\n            // [,,961,.05,.06,1.17,1,4.67,.8,,,,,.8,-0.8,.1,.49,.62,.09];\n            //Audio.victory = [,,454,.06,.86,.71,2,.63,-0.7,1.7,-83,.09,.27,.3,.2,,.18,.95,.02,.02];\n            //Audio.song = zzfxM(...ObliqueMystique);\n\n            //Audio.towerShoot = [1.56,,225,,.05,,3,.79,-7.6,.2,,,.08,,2.1,,.07,.99];\n            //Audio.towerShoot = [,,1626,.01,.04,.13,1,.39,,,,,,,.9,,,.93,.04];\n            Audio.towerShoot = [1.01,,1250,.01,.09,.14,,1.77,-6.3,,,,,,23,,,.46,.02];\n\n            Audio.mothDeath = [1.04,,363,.01,.08,.52,2,.31,.3,,,,,1.5,,.9,,.34,.07];\n\n            //Audio.ghostDeath = [1.35,,968,.01,.02,,2,.12,-0.7,.1,-105,.06,,.1,,,.01,.66,.04];\n            Audio.ghostDeath = [2.01,,332,.02,.05,.16,1,.53,-0.8,,-7,.01,,.1,,,.03,.48,.04];\n\n            Audio.buildingFinished = [2.03,0,65.40639,.03,.66,.18,2,.95,,,,,.3,.4,,,.19,.21,.1,.04];\n\n            Audio.waveCountdown = [1.56,0,261.6256,,.13,.3,,.41,,,,,,.2,,,.05,.2,.19,.22];\n\n            // Save our background music in os13k, for fun!\n            //localStorage[`OS13kMusic,${TITLE} - Oblique Mystique`] = JSON.stringify(ObliqueMystique);\n        },\n\n        update() {\n            if (!Audio.readyToPlay) return;\n\n            return;\n        },\n\n        play(sound) {\n            if (!Audio.readyToPlay) return;\n            ZZFX.play(...sound);\n        },\n\n        // It's important we do pausing and unpausing as specific events and not in general update(),\n        // because update() is triggered by the animation frame trigger which does not run if the\n        // page is not visible. (So, if you want the music to fade in the background, for example,\n        // that's not helpful if it won't work because you aren't looking at the page!)\n\n        pause() {\n            Audio.gain_.gain.linearRampToValueAtTime(0, Audio.ctx.currentTime + 1);\n        },\n\n        unpause() {\n            Audio.gain_.gain.linearRampToValueAtTime(1, Audio.ctx.currentTime + 1);\n        }\n    };\n\n    // MouseAdapter\n\n    /**\n     * MouseAdapter\n     *\n     * Maps mouse inputs to game inputs.\n     */\n    const MouseAdapter = {\n        init() {\n            this.map = [];\n            this.map[0] = Input.Action.RAW_TOUCH; // LMB\n            this.map[2] = Input.Action.RELOAD; // RMB\n\n            this.held = [];\n\n            window.addEventListener('mousemove', event => {\n                if (!this.pointer) this.pointer = {};\n                this.pointer.u = ((event.clientX * Viewport.width) / Viewport.clientWidth) | 0;\n                this.pointer.v = ((event.clientY * Viewport.height) / Viewport.clientHeight) | 0;\n                Input.mode = INPUT_MODE_MOUSE;\n            });\n\n            window.addEventListener('mouseout', () => {\n                this.pointer = undefined;\n            });\n\n            window.addEventListener('mousedown', event => {\n                let k = this.map[event.button];\n                if (k) this.held[k] = true;\n\n                // Hack to ensure we initialize audio after user interacts with game\n                Audio.readyToPlay = true;\n                game.frogger = 'mousedown';\n                Input.mode = INPUT_MODE_MOUSE;\n\n                this.pointerDragStart = {\n                    u: ((event.clientX * Viewport.width) / Viewport.clientWidth) | 0,\n                    v: ((event.clientY * Viewport.height) / Viewport.clientHeight) | 0\n                };\n            });\n\n            window.addEventListener('mouseup', event => {\n                let k = this.map[event.button];\n                if (k) this.held[k] = false;\n                game.frogger = 'mouseup';\n                Input.mode = INPUT_MODE_MOUSE;\n            });\n\n            window.addEventListener('click', event => {\n                event.preventDefault();\n                game.frogger = 'click';\n            });\n\n            window.addEventListener('contextmenu', event => {\n                let k = this.map[event.button];\n                if (k) this.held[k] = true;\n                this.releaseRMBTick = 2;\n                event.preventDefault();\n            });\n\n            MouseAdapter.reset();\n        },\n\n        update() {\n            // Hacks: ideally we could use mousedown and mouseup for all clicks and preventDefault to\n            // avoid opening the browser's context menu. This hasn't worked for me so far when clicking\n            // on a canvas, so I need to use the context menu event to capture a right mouse click instead.\n            //\n            // We fake a down/up for RMB clicks, which means we can't determine how long the RMB is held\n            // (but luckily we don't need to for this game).\n            if (this.releaseRMBTick) {\n                this.releaseRMBTick--;\n                if (this.releaseRMBTick === 0) {\n                    this.held[Input.Action.RELOAD] = false;\n                }\n            }\n        },\n\n        reset() {\n            this.pointer = undefined;\n            for (let action of Object.values(Input.Action)) {\n                this.held[action] = false;\n            }\n        }\n    };\n\n    // TouchAdapter\n\n    /**\n     * TouchAdapter\n     *\n     * Maps touch inputs to game inputs.\n     */\n    const TouchAdapter = {\n        init() {\n            this.map = [];\n            this.map[0] = Input.Action.RAW_TOUCH;\n\n            this.held = [];\n\n            window.addEventListener('touchmove', event => {\n                if (!this.pointer) this.pointer = {};\n                let p = event.changedTouches[0];\n                this.pointer.u = ((p.clientX * Viewport.width) / Viewport.clientWidth) | 0;\n                this.pointer.v = ((p.clientY * Viewport.height) / Viewport.clientHeight) | 0;\n                Input.mode = INPUT_MODE_TOUCH;\n            });\n\n            window.addEventListener('touchstart', event => {\n                let k = this.map[0];\n                if (k) this.held[k] = true;\n\n                // Hack to ensure we initialize audio after user interacts with game\n                Audio.readyToPlay = true;\n                game.frogger = 'TOUCHSTART';\n                Input.mode = INPUT_MODE_TOUCH;\n\n                let p = event.changedTouches[0];\n                this.pointerDragStart = {\n                    u: ((p.clientX * Viewport.width) / Viewport.clientWidth) | 0,\n                    v: ((p.clientY * Viewport.height) / Viewport.clientHeight) | 0\n                };\n                this.pointer = { ...this.pointerDragStart };\n            });\n\n            window.addEventListener('touchend', event => {\n                let k = this.map[0];\n                if (k) this.held[k] = false;\n                game.frogger = 'TOUCHEND';\n                Input.mode = INPUT_MODE_TOUCH;\n            });\n\n            this.reset();\n        },\n\n        update() {\n        },\n\n        reset() {\n            this.pointer = undefined;\n            for (let action of Object.values(Input.Action)) {\n                this.held[action] = false;\n            }\n        }\n    };\n\n    // Input\n\n    /**\n     * This is our abstract game input handler.\n     *\n     * Each frame, we'll collect input data from all of our supported input adapters,\n     * and turn it into game input. This game input can then be used by the game\n     * update for the frame.\n     *\n     * The input adapters give us data like \"key X pressed\", or \"right mouse button\n     * clicked\", or \"button B\" pressed, and these are translated into a game input\n     * like \"dodge\".\n     */\n    const Input = {\n        // Game Inputs\n        //\n        // Note that moving the player around is actually not considered an action; it's\n        // a separate non-action input called \"direction\". It just so happens that on\n        // keyboard, for example, pressing the \"down arrow\" key is considered both a\n        // press of the in-game DOWN action and a directional input. It's up to the input\n        // consumer to decide which input is relevant (if any). For example, on a menu,\n        // we may consume the DOWN/UP actions to navigate the menu, but ignore directional\n        // inputs.\n        //\n        Action: {\n            UP: 11,\n            DOWN: 12,\n            LEFT: 13,\n            RIGHT: 14,\n            ATTACK: 21,\n            RELOAD: 30,\n            MENU: 96,\n            MUTE: 97,\n            FREEZE: 98,\n            RAW_TOUCH: 40,\n            DRAG: 41,\n            TAP: 42\n        },\n\n        init() {\n            // A vector representing the direction the user is pressing/facing,\n            // separate from pressing and releasing inputs. Treating \"direction\"\n            // separately makes it easier to handle gamepad sticks.\n            this.direction = { x: 0, y: 0, m: 0 };\n\n            // \"Pressed\" means an input was pressed THIS FRAME.\n            this.pressed = {};\n\n            // \"Released\" means an input was released THIS FRAME.\n            this.released = {};\n\n            // \"Held\" means an input is held down. The input was \"Pressed\" either\n            // this frame or in a past frame, and has not been \"Released\" yet.\n            this.held = {};\n\n            // How many frames was this input held down by the player. If [held]\n            // is false, it represents how long the input was last held down.\n            this.framesHeld = {};\n\n            KeyboardAdapter.init();\n            MouseAdapter.init();\n            TouchAdapter.init();\n\n            this.mode = INPUT_MODE_TOUCH;\n\n            this.dragging = false;\n        },\n\n        update() {\n            // We could have some kind of \"input adapter toggle\", but it's easier to just treat all inputs\n            // as valid -- if you're pressing the \"attack\" button on either gamepad or keyboard, then you're\n            // attacking. For directional input, we instead check whether there's movement on the thumbstick,\n            // and we use it if there is -- otherwise we try to extract movement from the keyboard instead.\n\n            KeyboardAdapter.update();\n\n            let pointerAdapter = this.mode === INPUT_MODE_MOUSE ? MouseAdapter : TouchAdapter;\n\n            for (let action of Object.values(Input.Action)) {\n                let held = pointerAdapter.held[action] || KeyboardAdapter.held[action];\n                this.pressed[action] = !this.held[action] && held;\n                this.released[action] = this.held[action] && !held;\n\n                if (this.pressed[action]) {\n                    this.framesHeld[action] = 1;\n                } else if (this.held[action] && held) {\n                    this.framesHeld[action]++;\n                }\n\n                this.held[action] = held;\n            }\n\n            this.pointer = pointerAdapter.pointer;\n            this.direction = KeyboardAdapter.direction;\n            //this.direction = this.gamepad.direction.m > 0 ? this.gamepad.direction : this.keyboard.direction;\n\n            if (this.held[Input.Action.RAW_TOUCH]) {\n                if (this.framesHeld[Input.Action.RAW_TOUCH] > 20) {\n                    this.dragging = true;\n                }\n\n                let diffPixels = Math.abs(pointerAdapter.pointerDragStart.u - pointerAdapter.pointer.u) + Math.abs(pointerAdapter.pointerDragStart.v - pointerAdapter.pointer.v);\n                if (diffPixels > 5) {\n                    this.dragging = true;\n                }\n            }\n\n            if (this.dragging && pointerAdapter.pointer) {\n                this.dragVector = {\n                    x: pointerAdapter.pointer.u - pointerAdapter.pointerDragStart.u,\n                    y: pointerAdapter.pointer.v - pointerAdapter.pointerDragStart.v\n                };\n            }\n\n            if (this.released[Input.Action.RAW_TOUCH]) {\n                if (this.dragging) {\n                    this.dragging = false;\n                } else {\n                    this.pressed[Input.Action.TAP] = true;\n                    this.framesHeld[Input.Action.TAP] = 1;\n                }\n            }\n        },\n\n        onDown(action) {},\n        onUp(action) {},\n    };\n\n    const C_WIDTH = 3;\n    const C_HEIGHT = 5;\n\n    // Very simple variable-width font implementation. The characters in the font strip\n    // are left-aligned in their 3x5 pixel boxes, so in order to have variable width,\n    // we just need to note the characters that AREN'T full width. Anything not in\n    // this list has full shift (3+1 = 4 pixels).\n    const C_SHIFT = {\n        10: 0, // LF (\\n)\n        32: 3, // Space ( )\n        33: 3, // Bang (!)\n        39: 2, // Apostrophe (')\n        44: 3, // Comma (,)\n        46: 3, // Period (.)\n        73: 2 // I\n    };\n\n    const C_ICONS = {};\n\n    /**\n     * Text\n     *\n     * Utilities for drawing text using in-game pixel font.\n     */\n    const Text = {\n        init() {\n            Text.white = Sprite.font.img;\n\n            let icons = [\n                [101, Sprite.buildings[2]],      // e = Earth\n                [102, Sprite.buildings[4]],      // f = Fervor\n                //[108, Sprite.icon_mouse_lmb],  // l\n                //[114, Sprite.icon_mouse_rmb],  // r\n            ];\n            for (let icon of icons) {\n                C_ICONS[icon[0]] = icon[1];\n                C_SHIFT[icon[0]] = icon[1].img.width + 1;\n            }\n\n            Text.black = recolor(Text.white, rgba(0, 0, 0, 1));\n            Text.black_shadow = recolor(Text.white, rgba(90, 20, 90, 0.15));\n            Text.blue = recolor(Text.white, rgba(200, 40, 220, 1));\n            Text.blue_shadow = recolor(Text.white, rgba(240, 50, 200, 0.2));\n            Text.shadow = recolor(Text.white, rgba(240, 240, 255, 0.25));\n            Text.red = recolor(Text.white, rgba(240, 50, 50, 1));\n\n            Text.duotone = recolorDuotone(Text.white, '#ffaa5e', '#ffd4a3');\n            Text.duotone_red = recolorDuotone(Text.white, '#ffaa5e', '#ffd4a3', rgba(255, 0, 0, 0.7));\n        },\n\n        drawText(ctx, text, u, v, scale = 1, font = Text.duotone, shadow) {\n            for (let idx = 0; idx < text.length; idx++) {\n                let c = text.charCodeAt(idx);\n                if (c === 119) {\n                    // w\n                    font = Text.duotone;\n                    continue;\n                } else if (c === 114) {\n                    // r\n                    font = Text.duotone_red;\n                    continue;\n                }\n\n                if (C_ICONS[c]) {\n                    ctx.drawImage(\n                        C_ICONS[c].img,\n                        u,\n                        v - (C_ICONS[c].img.height + 4) / 2\n                    );\n                } else {\n                    let k = (c - 32) * (C_WIDTH + 1);\n                    if (shadow) {\n                        ctx.drawImage(\n                            shadow,\n                            k % 180,\n                            (k / 180 | 0) * 6,\n                            C_WIDTH,\n                            C_HEIGHT,\n                            u + 1,\n                            v + 1,\n                            C_WIDTH * scale,\n                            C_HEIGHT * scale\n                        );\n                    }\n                    ctx.drawImage(\n                        font,\n                        k % 180,\n                        (k / 180 | 0) * 6,\n                        C_WIDTH,\n                        C_HEIGHT,\n                        u,\n                        v,\n                        C_WIDTH * scale,\n                        C_HEIGHT * scale\n                    );\n                }\n                u += (C_SHIFT[c] || C_WIDTH + 1) * scale;\n            }\n        },\n\n        /*\n        drawRightText(ctx, text, u, v, scale = 1, font = Text.white, shadow) {\n            u -= Text.measureWidth(text, scale);\n            Text.drawText(ctx, text, u, v, scale, font, shadow);\n        },\n        */\n\n        drawParagraph(ctx, text, u, v, w, h, scale = 1, font = Text.duotone, shadow) {\n            let cu = u,\n                cv = v,\n                phrases = text.split(' ');\n\n            for (let phrase of phrases) {\n                while (phrase[0] === '\\n') {\n                    phrase = phrase.slice(1);\n                    cu = u;\n                    cv += (C_HEIGHT + 1) * scale;\n                }\n                let phraseWidth = Text.measureWidth(phrase, scale);\n                if (cu + phraseWidth - u > w) {\n                    cu = u;\n                    cv += (C_HEIGHT + 1) * scale;\n                }\n                Text.drawText(ctx, phrase, cu, cv, scale, font, shadow);\n                cu += phraseWidth + (C_SHIFT[32] || 4);\n            }\n        },\n\n        measureWidth(text, scale) {\n            return text.split('').reduce((sum, c) => sum + (C_SHIFT[c.charCodeAt(0)] || 4), 0) * scale;\n        }\n    };\n\n    // Text utility functions\n\n\n    function recolor(font, color) {\n        let canvas = createCanvas(font.width, font.height);\n        canvas.ctx.fillStyle = color;\n        canvas.ctx.fillRect(0, 0, font.width, font.height);\n        canvas.ctx.globalCompositeOperation = 'destination-in';\n        canvas.ctx.drawImage(font, 0, 0);\n        return canvas.canvas;\n    }\n\n    function recolorDuotone(font, topColor, bottomColor, tint) {\n        // Note: shortcut assumes that the font image is exactly 2 rows of characters.\n        let canvas = createCanvas(font.width, font.height);\n        canvas.ctx.fillStyle = bottomColor;\n        canvas.ctx.fillRect(0, 0, font.width, font.height);\n        canvas.ctx.fillStyle = topColor;\n        canvas.ctx.fillRect(0, 0, font.width, 1);\n        canvas.ctx.fillRect(0, C_HEIGHT + 1, font.width, 1);\n        if (tint) {\n            canvas.ctx.fillStyle = tint;\n            canvas.ctx.fillRect(0, 0, font.width, font.height);\n        }\n        canvas.ctx.globalCompositeOperation = 'destination-in';\n        canvas.ctx.drawImage(font, 0, 0);\n        return canvas.canvas;\n    }\n\n    // https://jonny.morrill.me/en/blog/gamedev-how-to-implement-a-camera-shake-effect/\n\n    /**\n     * Shake it baby.\n     */\n    class ScreenShake {\n        constructor(frames, hAmplitude, vAmplitude) {\n            this.frames = frames;\n            this.hAmplitude = hAmplitude;\n            this.vAmplitude = vAmplitude;\n            this.hSamples = [];\n            this.vSamples = [];\n\n            var sampleCount = frames / 2;\n            for (let i = 0; i < sampleCount; i++) {\n                this.hSamples.push(Math.random() * 2 - 1);\n                this.vSamples.push(Math.random() * 2 - 1);\n            }\n            this.frame = -1;\n        }\n\n        update() {\n            this.frame++;\n            if (this.frame >= this.frames) {\n                return false;\n            }\n\n            //let s = (this.frames / 10) * (this.frame / this.frames);\n            let s = this.frame / 2;\n            let s0 = s | 0;\n            let s1 = s0 + 1;\n            let decay = 1 - this.frame / this.frames;\n\n            this.x =\n                this.hAmplitude *\n                decay *\n                (this.hSamples[s0] +\n                    (s - s0) * (this.hSamples[s1] - this.hSamples[s0]));\n            this.y =\n                this.vAmplitude *\n                decay *\n                (this.vSamples[s0] +\n                    (s - s0) * (this.vSamples[s1] - this.vSamples[s0]));\n\n            return true;\n        }\n    }\n\n    class Gore {\n        constructor(pos, angle, f) {\n            this.pos = { ...pos };\n            this.angle = angle;\n            this.vel = vector2point(angle2vector(this.angle, f ? 8 : 5));\n            this.a = R45;\n            this.noClipEntity = true;\n            this.f = f;\n            this.bounce = true;\n            this.radius = 1;\n            this.r = 0;\n            this.t = -1;\n            this.d = this.f === 0 ? 45 : 70;\n\n            // TEMPORARY\n            this.noClipWall = true;\n        }\n\n        think() {\n            if (++this.t === this.d) this.cull = true;\n            this.vel.x *= 0.9;\n            this.vel.y *= 0.9;\n            this.a *= 0.95;\n            this.r += this.a;\n        }\n\n        draw() {\n            Sprite.drawViewportSprite(\n                Sprite.gore[this.f],\n                this.pos,\n                this.r\n            );\n        }\n    }\n\n    Gore.damage = entity => Gore.spray(entity, 8, () => 0);\n    Gore.kill = entity => Gore.spray(entity, 16, () => (Math.random() * 4) | 0);\n    Gore.spray = (entity, count, cb) => {\n        let angle = entity.lastDamage ? vector2angle(entity.lastDamage.vector) : Math.random() * R360;\n\n        for (let i = 0; i < count * (game.victory ? 2 : 1); i++) {\n            let r = Math.random() * entity.radius,\n                p = vectorAdd(entity.pos, angle2vector(Math.random() * R360, r));\n            game.entities.push(\n                new Gore(p, angle + Math.random() * R90 - R45, cb())\n            );\n        }\n    };\n\n    // WorldData\n    //\n    // This file is generated by `gulp buildAssets`.\n\n    const WorldData =\n    /* <generated-data> */\n    {\n        \"floors\": [\n            {\n                \"name\": \"1F\",\n                \"tiles\": [\n                    [\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        0,\n                        0,\n                        0\n                    ],\n                    [\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        14,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        0,\n                        0\n                    ],\n                    [\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        14,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        0,\n                        0,\n                        14,\n                        14,\n                        14,\n                        3,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        0\n                    ],\n                    [\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        14,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        7,\n                        7,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        0\n                    ],\n                    [\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        7,\n                        8,\n                        8,\n                        7,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        2,\n                        14,\n                        0\n                    ],\n                    [\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        8,\n                        8,\n                        1,\n                        1,\n                        1,\n                        1,\n                        3,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        0\n                    ],\n                    [\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        1,\n                        3,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        3,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        14,\n                        0,\n                        0\n                    ],\n                    [\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        14,\n                        1,\n                        1,\n                        2,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        2,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        0,\n                        0,\n                        0,\n                        0\n                    ],\n                    [\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        14,\n                        3,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        14,\n                        14,\n                        0\n                    ],\n                    [\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        2,\n                        1,\n                        1,\n                        1,\n                        7,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        1,\n                        14,\n                        14,\n                        2,\n                        1,\n                        3,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14\n                    ],\n                    [\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        1,\n                        1,\n                        7,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        3,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14\n                    ],\n                    [\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        1,\n                        7,\n                        8,\n                        1,\n                        1,\n                        14,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        7,\n                        1,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        3,\n                        14\n                    ],\n                    [\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        0,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        2,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        7,\n                        1,\n                        1,\n                        1,\n                        14,\n                        1,\n                        7,\n                        1,\n                        14,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14\n                    ],\n                    [\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        14,\n                        1,\n                        2,\n                        14,\n                        14,\n                        0,\n                        0,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        14,\n                        14,\n                        1,\n                        1,\n                        2,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        1,\n                        8,\n                        1,\n                        14,\n                        0,\n                        14,\n                        14,\n                        1,\n                        1,\n                        2,\n                        14,\n                        14\n                    ],\n                    [\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        14,\n                        14,\n                        14,\n                        0,\n                        0,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        3,\n                        1,\n                        14,\n                        14,\n                        0,\n                        0,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        14,\n                        1,\n                        8,\n                        1,\n                        14,\n                        0,\n                        0,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        0\n                    ],\n                    [\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        1,\n                        1,\n                        7,\n                        1,\n                        1,\n                        1,\n                        14,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        2,\n                        14,\n                        14,\n                        14,\n                        1,\n                        8,\n                        1,\n                        14,\n                        14,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0\n                    ],\n                    [\n                        0,\n                        0,\n                        0,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        14,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        2,\n                        14,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0\n                    ],\n                    [\n                        0,\n                        14,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0\n                    ],\n                    [\n                        0,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        2,\n                        14,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0\n                    ],\n                    [\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        14,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0\n                    ],\n                    [\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        14,\n                        1,\n                        1,\n                        2,\n                        1,\n                        14,\n                        14,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        1,\n                        2,\n                        1,\n                        1,\n                        7,\n                        1,\n                        1,\n                        1,\n                        14,\n                        1,\n                        7,\n                        1,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        0,\n                        0\n                    ],\n                    [\n                        14,\n                        1,\n                        7,\n                        1,\n                        1,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        8,\n                        7,\n                        1,\n                        1,\n                        14,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        1,\n                        1,\n                        14,\n                        14,\n                        0\n                    ],\n                    [\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        0\n                    ],\n                    [\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        1,\n                        1,\n                        7,\n                        1,\n                        14,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        14,\n                        1,\n                        1,\n                        3,\n                        1,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        0\n                    ],\n                    [\n                        0,\n                        14,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        1,\n                        1,\n                        8,\n                        1,\n                        14,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        3,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        0\n                    ],\n                    [\n                        0,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        0\n                    ],\n                    [\n                        0,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        2,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        2,\n                        1,\n                        14,\n                        0,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        0,\n                        0\n                    ],\n                    [\n                        0,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        2,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        1,\n                        3,\n                        1,\n                        14,\n                        14,\n                        14,\n                        14,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0\n                    ],\n                    [\n                        0,\n                        0,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        3,\n                        1,\n                        14,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        1,\n                        1,\n                        14,\n                        14,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0\n                    ],\n                    [\n                        0,\n                        0,\n                        0,\n                        14,\n                        14,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        7,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        14,\n                        14,\n                        14,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0\n                    ],\n                    [\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        14,\n                        14,\n                        1,\n                        3,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        1,\n                        14,\n                        14,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0\n                    ],\n                    [\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        14,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0,\n                        0\n                    ]\n                ],\n                \"rooms\": [],\n                \"objects\": [\n                    {\n                        \"name\": \"SPAWN\",\n                        \"x\": 42,\n                        \"y\": 11\n                    },\n                    {\n                        \"name\": \"EARTH\",\n                        \"x\": 20,\n                        \"y\": 3\n                    },\n                    {\n                        \"name\": \"EXIT\",\n                        \"x\": 10,\n                        \"y\": 24\n                    },\n                    {\n                        \"name\": \"EARTH\",\n                        \"x\": 41,\n                        \"y\": 25\n                    },\n                    {\n                        \"name\": \"EARTH\",\n                        \"x\": 43,\n                        \"y\": 22\n                    },\n                    {\n                        \"name\": \"EARTH\",\n                        \"x\": 33,\n                        \"y\": 17\n                    },\n                    {\n                        \"name\": \"EARTH\",\n                        \"x\": 40,\n                        \"y\": 6\n                    },\n                    {\n                        \"name\": \"EARTH\",\n                        \"x\": 36,\n                        \"y\": 3\n                    },\n                    {\n                        \"name\": \"EARTH\",\n                        \"x\": 14,\n                        \"y\": 7\n                    },\n                    {\n                        \"name\": \"EARTH\",\n                        \"x\": 31,\n                        \"y\": 13\n                    },\n                    {\n                        \"name\": \"EARTH\",\n                        \"x\": 7,\n                        \"y\": 13\n                    }\n                ],\n                \"triggers\": [],\n                \"id\": 0\n            }\n        ],\n        \"bounds\": [\n            [\n                0,\n                0\n            ],\n            [\n                46,\n                32\n            ]\n        ],\n        \"spawn\": [\n            42,\n            11,\n            0\n        ]\n    }\n    /* </generated-data> */\n    ;\n\n    /**\n     * Monster\n     */\n    class Moth {\n        constructor(pos) {\n            this.pos = { ...pos };\n            this.target = { ...this.pos };\n            this.vel = { x: 0, y: 0 };\n            this.hp = 1;\n            this.damage = [];\n            this.radius = 3;\n            this.state = IDLE;\n            this.noClipEntity = true;\n            this.noClipWall = true;\n\n            this.lightlevel = 7;\n\n            this.tasks = [];\n            this.carrying = 0;\n\n            this.offset = { x: 0, y: 0 };\n\n            this.carryAmount = 0;\n            this.carryCapacity = 5_00;\n            this.carryPerFrame = 3;\n            this.transferAmount = 0;\n\n            this.frame = 0;\n            this.circleOffset = Math.floor(Math.random() * 16);\n\n            this.lastAssigned = game.frame;\n\n            let qr = xy2qr(this.pos);\n            this.moveTo({ q: qr.q, r: qr.r - 1 });\n        }\n\n        think() {\n            if (this.tasks.length === 0) {\n                this.tasks.push({ task: IDLE });\n            }\n            let task = this.tasks[this.tasks.length - 1];\n\n            this.frame = (Math.floor(game.frame / 8) % 2) + 1;\n\n            if (this.state === DEAD) {\n                Audio.play(Audio.mothDeath);\n                this.cull = true;\n                return;\n            }\n\n            if (task.task === MOVE) {\n                this.target = centerxy(qr2xy(task.qr));\n                let dist = vectorBetween(this.pos, this.target);\n\n                if (dist.m < ACTION_DISTANCE) {\n                    this.tasks.pop();\n                }\n            } else if (task.task === CONSTRUCT) {\n                this.target = centerxy(qr2xy(task.qr));\n                let dist = vectorBetween(this.pos, this.target);\n\n                if (dist.m < ACTION_DISTANCE) {\n                    this.frame = 0;\n                    let building = World.buildingAt(task.qr);\n                    building.buildFrames++;\n                    if (building.buildFrames >= building.buildFramesTotal) {\n                        this.tasks.pop();\n                    }\n                }\n            } else if (task.task === PICKUP) {\n                this.target = centerxy(qr2xy(task.qr));\n                let dist = vectorBetween(this.pos, this.target);\n\n                let building = World.buildingAt(task.qr);\n\n                if (!building) {\n                    this.tasks.pop();\n                    this.tasks.push({ task: DROPOFF, qr: { q: World.spawn.q, r: World.spawn.r } });\n                } else if (dist.m < ACTION_DISTANCE) {\n                    this.frame = 0;\n                    this.carryAmount += this.carryPerFrame;\n                    building.resourcesLeft -= this.carryPerFrame;\n                    if (this.carryAmount >= this.carryCapacity) {\n                        this.tasks.push({ task: DROPOFF, qr: { q: World.spawn.q, r: World.spawn.r } });\n                    }\n                }\n            } else if (task.task === DROPOFF) {\n                this.target = centerxy(qr2xy(task.qr));\n                let dist = vectorBetween(this.pos, this.target);\n\n                if (dist.m < ACTION_DISTANCE) {\n                    this.frame = 0;\n\n                    this.carryAmount -= this.carryPerFrame;\n                    this.transferAmount += this.carryPerFrame;\n                    if (this.transferAmount >= 100) {\n                        game.earth++;\n                        this.transferAmount -= 100;\n                    }\n\n                    if (this.carryAmount <= 0) {\n                        this.tasks.pop();\n                    }\n                }\n            }\n\n            let pathToTarget = World.pathToTarget(this.pos, this.target);\n            console.log([this.target, pathToTarget]);\n            let dist = vectorBetween(this.pos, pathToTarget);\n            dist.m = clamp(dist.m, 0, 0.5);\n\n            let newVelocity = vector2point(dist);\n\n            this.vel = {\n                x: (this.vel.x + newVelocity.x) / 2,\n                y: (this.vel.y + newVelocity.y) / 2\n            };\n        }\n\n        draw() {\n            let r = 3;\n            if (this.frame === 0) r--;\n\n            let uv = {\n                u: Math.cos((game.frame + this.circleOffset) / 16) * r,\n                v: Math.sin((game.frame + this.circleOffset) / 16) * 1\n            };\n\n            Sprite.drawViewportSprite(Sprite.moth[this.frame], { x: this.pos.x + uv.u, y: this.pos.y + uv.v });\n\n            //Sprite.drawViewportSprite(Sprite.spindoctor[0], this.pos, game.frame / 5);\n            //Sprite.drawViewportSprite(Sprite.spindoctor[1], this.pos);\n        }\n\n        gather(qr) {\n            //this.target = { x: qr.q * 8, y: qr.r * 8 };\n            this.tasks = [\n                { task: PICKUP, qr: qr }\n            ];\n            this.lastAssigned = game.frame;\n        }\n\n        construct(qr) {\n            //this.target = { x: qr.q * 8, y: qr.r * 8 };\n            this.tasks.push(\n                { task: CONSTRUCT, qr: qr }\n            );\n            this.lastAssigned = game.frame;\n        }\n\n        moveTo(qr) {\n            this.tasks = [\n                { task: MOVE, qr: qr }\n            ];\n            this.lastAssigned = game.frame;\n        }\n\n        isBusy() {\n            let task = this.tasks[this.tasks.length - 1];\n            return task && task.task !== IDLE;\n        }\n    }\n\n    Moth.sortMoths = () => {\n        let moths = game.entities.filter(e => e instanceof Moth);\n        moths.sort((a, b) => {\n            if (a.isBusy() && !b.isBusy()) {\n                return 1;\n            } else if (!a.isBusy() && b.isBusy()) {\n                return -1;\n            } else {\n                return a.lastAssigned - b.lastAssigned;\n            }\n        });\n        return moths;\n    };\n\n    Moth.assign = (fn) => {\n        let moths = Moth.sortMoths();\n\n        for (let i = 0; i < moths.length; i++) {\n            if (i > 0 && moths[i].isBusy()) break;\n            fn(moths[i]);\n        }\n    };\n\n    class TowerGunk {\n        constructor(pos, target, damage) {\n            this.pos = { ...pos };\n            this.target = target;\n            this.vel = { x: 0, y: 0 };\n            this.damage = damage || 70;\n        }\n\n        think() {\n            let diff = vectorBetween(this.pos, this.target.pos);\n            diff.m = clamp(diff.m, 0, 2);\n            this.vel = {\n                x: (this.vel.x + diff.x * diff.m) / 2,\n                y: (this.vel.y + diff.y * diff.m) / 2\n            };\n\n            if (diff.m < 1) {\n                this.target.damage.push({ amount: this.damage, vector: diff, knockback: 0 });\n                this.cull = true;\n                console.log('HIT');\n            }\n        }\n\n        draw() {\n            Sprite.drawViewportSprite(\n                Sprite.bullet1[0],\n                this.pos,\n                this.r\n            );\n        }\n    }\n\n    /**\n     * Monster\n     */\n    const BuildTowerAction = {\n        defaultTapAction() {\n            let building = World.buildingAt(World.selected);\n            return !!building;\n        },\n\n        buttonSprite() {\n            return Sprite.buttons[6];\n        },\n\n        buttonSelectedSprite() {\n            return Sprite.buttons[7];\n        },\n\n        drawSelectedText(u, v) {\n            let building = World.buildingAt(World.selected);\n            let costs = [15, 0];\n            let text = 'BUILD TOWER \\n' + game.formatCost(...costs);\n\n            if (building) {\n                text = 'FINISH BUILDING';\n            }\n\n            Text.drawParagraph(\n                Viewport.ctx,\n                text,\n                u,\n                v\n            );\n        },\n\n        tap() {\n            let building = World.buildingAt(World.selected);\n            let costs = [15, 0];\n\n            if (building) {\n                Moth.assign(moth => moth.construct(World.selected));\n            } else if (game.canAfford(...costs)) {\n                game.payCost(...costs);\n                World.buildings.push(new TowerBuilding(World.selected));\n                Moth.assign(moth => moth.construct(World.selected));\n                return true;\n            }\n        }\n    };\n\n    /**\n     * Monster\n     */\n    class TowerBuilding {\n        constructor(qr) {\n            this.qr = { ...qr };\n            this.framesToNextShot = 10;\n\n            this.lightlevel = 7;\n\n            this.state = WIP;\n            this.buildFrames = 0;\n            this.buildFramesTotal = 180;\n\n            this.title = 'TOWER';\n            this.portraitSprite = Sprite.buildings[0];\n        }\n\n        think() {\n            if (this.buildFrames >= this.buildFramesTotal) {\n                if (this.state !== ONLINE) {\n                    this.state = ONLINE;\n                    Audio.play(Audio.buildingFinished);\n                }\n            } else {\n                return;\n            }\n\n            let xy = centerxy(qr2xy(this.qr));\n\n            let closestTarget, closestVector;\n\n            if (!this.target || this.target.cull) {\n                for (let entity of game.entities) {\n                    if (!entity.enemy) continue;\n\n                    //let qr = xy2qr(entity.pos);\n                    let v = vectorBetween(xy, entity.pos);\n                    if (v.m < 32 && (!closestVector || v.m < closestVector.m)) {\n                        closestTarget = entity;\n                        closestVector = v;\n                    }\n                }\n\n                console.log('ATTEMPTED to pick target for building', closestTarget);\n                this.target = closestTarget;\n            }\n\n            if (this.framesToNextShot > 0) {\n                this.framesToNextShot--;\n            }\n\n            if (this.target && this.framesToNextShot === 0) {\n                vectorBetween(xy, this.target);\n                game.entities.push(new TowerGunk(xy, this.target));\n                this.framesToNextShot = 100;\n                Audio.play(Audio.towerShoot);\n            }\n        }\n\n        draw() {\n            let xy = qr2xy(this.qr);\n            xy2uv(centerxy(xy));\n\n            //Viewport.ctx.drawImage(Sprite.tiles[tiles[y][x] - 1].img, x * 8 + offset.u, y * 8 + offset.v);\n\n            Viewport.ctx.globalAlpha = this.state === WIP ? 0.5 : 1;\n            Sprite.drawViewportSprite(Sprite.buildings[0], xy);\n            Viewport.ctx.globalAlpha = 1;\n\n            /*\n            Viewport.ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';\n            Viewport.ctx.beginPath();\n            Viewport.ctx.arc(uv.u, uv.v, 4, 0, 2 * Math.PI * 0.7);\n            Viewport.ctx.fill();\n            */\n\n            if (this.state === WIP) {\n                let progress = clamp(Math.floor(8 * this.buildFrames / this.buildFramesTotal), 0, 7);\n\n                Viewport.ctx.globalAlpha = 0.5;\n                Sprite.drawViewportSprite(Sprite.hud_wip[7], xy);\n                Viewport.ctx.globalAlpha = 1;\n                Sprite.drawViewportSprite(Sprite.hud_wip[progress], xy);\n            }\n\n            //Sprite.drawViewportSprite(Sprite.spindoctor[0], this.pos, game.frame / 5);\n            //Sprite.drawViewportSprite(Sprite.spindoctor[1], this.pos);\n        }\n\n        hudActions() {\n            if (this.buildFrames < this.buildFramesTotal) {\n                return [BuildTowerAction];\n            } else {\n                return [];\n            }\n        }\n    }\n\n    const SPAWN_COST_EARTH = [0, 2];\n    for (let i = 2; i <= 19; i++) {\n        SPAWN_COST_EARTH[i] = Math.floor(SPAWN_COST_EARTH[i - 1] * 1.5 + 1);\n    }\n    for (let i = 0; i < 20; i++) {\n        SPAWN_COST_EARTH[i] = SPAWN_COST_EARTH[i] * 5;\n    }\n\n    const SpawnMothAction = {\n        defaultTapAction() {\n            return false;\n        },\n\n        buttonSprite() {\n            return Sprite.buttons[0];\n        },\n\n        buttonSelectedSprite() {\n            return Sprite.buttons[1];\n        },\n\n        drawSelectedText(u, v) {\n            let costs = [SPAWN_COST_EARTH[game.activeMoths()], 0];\n            let text = 'LURE MOTH \\n' + game.formatCost(...costs);\n\n            Text.drawParagraph(\n                Viewport.ctx,\n                text,\n                u,\n                v\n            );\n        },\n\n        tap() {\n            let costs = [SPAWN_COST_EARTH[game.activeMoths()], 0];\n\n            if (game.canAfford(...costs)) {\n                game.payCost(...costs);\n                game.entities.push(new Moth(centerxy(qr2xy(World.selected))));\n                return true;\n            }\n        }\n    };\n\n    /**\n     * Monster\n     */\n    const TeleportCoffinAction = {\n        defaultTapAction() {\n            let building = World.buildingAt(World.selected);\n            return !!building;\n        },\n\n        buttonSprite() {\n            return Sprite.buttons[8];\n        },\n\n        buttonSelectedSprite() {\n            return Sprite.buttons[9];\n        },\n\n        drawSelectedText(u, v) {\n            let building = World.buildingAt(World.selected);\n            let costs = [60, 10];\n            let text = 'MOVE COFFIN \\n' + game.formatCost(...costs);\n\n            if (building) {\n                text = 'FINISH BUILDING';\n            }\n\n            Text.drawParagraph(\n                Viewport.ctx,\n                text,\n                u,\n                v\n            );\n        },\n\n        tap() {\n            let building = World.buildingAt(World.selected);\n            let costs = [60, 10];\n\n            if (building) {\n                Moth.assign(moth => moth.construct(World.selected));\n            } else if (game.canAfford(...costs)) {\n                game.payCost(...costs);\n                World.buildings.push(new CoffinBuilding(World.selected));\n                Moth.assign(moth => moth.construct(World.selected));\n                return true;\n            }\n        }\n    };\n\n    class AttackAnimation {\n        constructor(pos) {\n            this.pos = { ...pos };\n            this.t = -1;\n            this.d = 3;\n            this.z = 101;\n            this.rot = Math.random() * Math.PI * 2;\n        }\n\n        think() {\n            if (++this.t === this.d) this.cull = true;\n            this.rot += 0.1;\n        }\n\n        draw() {\n            let frame = this.t < 2 ? 0 : 1;\n            Sprite.drawViewportSprite(Sprite.attack[frame], this.pos, this.rot);\n        }\n    }\n\n    /**\n     * Monster\n     */\n    class CoffinBuilding {\n        constructor(qr, initialSpawn) {\n            this.qr = { ...qr };\n\n            this.state = WIP;\n            this.buildFrames = 0;\n            this.buildFramesTotal = 180;\n\n            if (initialSpawn) {\n                this.buildFrames = 180;\n                this.state = ONLINE;\n            }\n\n            this.title = 'YOUR COFFIN \\nQARUL SOIL';\n            this.portraitSprite = Sprite.buildings[1];\n            this.lightlevel = 9;\n        }\n\n        think() {\n            if (this.buildFrames >= this.buildFramesTotal) {\n                if (this.state !== ONLINE) {\n                    this.state = ONLINE;\n                    Audio.play(Audio.buildingFinished);\n                    for (let building of World.buildings) {\n                        if (building instanceof CoffinBuilding && building !== this) {\n                            game.entities.push(new AttackAnimation(centerxy(qr2xy(building.qr))));\n                            building.cull = true;\n                        }\n                    }\n                }\n            } else {\n                return;\n            }\n        }\n\n        draw() {\n            let xy = qr2xy(this.qr);\n\n            //Viewport.ctx.drawImage(Sprite.tiles[tiles[y][x] - 1].img, x * 8 + offset.u, y * 8 + offset.v);\n            Sprite.drawViewportSprite(Sprite.buildings[1], xy);\n\n            //Sprite.drawViewportSprite(Sprite.spindoctor[0], this.pos, game.frame / 5);\n            //Sprite.drawViewportSprite(Sprite.spindoctor[1], this.pos);\n            if (this.state === WIP) {\n                let progress = clamp(Math.floor(8 * this.buildFrames / this.buildFramesTotal), 0, 7);\n\n                Viewport.ctx.globalAlpha = 0.5;\n                Sprite.drawViewportSprite(Sprite.hud_wip[7], xy);\n                Viewport.ctx.globalAlpha = 1;\n                Sprite.drawViewportSprite(Sprite.hud_wip[progress], xy);\n            }\n        }\n\n        hudActions() {\n            if (this.buildFrames < this.buildFramesTotal) {\n                return [TeleportCoffinAction];\n            } else {\n                return [SpawnMothAction];\n            }\n        }\n    }\n\n    // ghost?\n\n    /**\n     * Monster\n     */\n    class Ghost {\n        constructor(pos, variant) {\n            this.pos = { ...pos };\n            this.damage = [];\n            this.vel = { x: 0, y: 0 };\n            this.radius = 2;\n            this.mass = 0.2;\n            this.lastAttack = 0;\n            this.state = CHASE;\n            this.enemy = true;\n\n            this.variant = variant;\n\n            if (!variant) {\n                this.hp = 100;\n                this.attackDistance = 8;\n                this.moveSpeed = 0.3;\n            } else if (variant === 1) {\n                this.hp = 300;\n                this.attackDistance = 8;\n                this.moveSpeed = 0.3;\n            } else if (variant === 2) {\n                this.hp = 800;\n                this.attackDistance = 16;\n                this.moveSpeed = 0.1;\n            }\n\n            this.maxhp = this.hp;\n        }\n\n        think() {\n            let targets = game.entities.filter(x => x instanceof Moth);\n            let bestTarget = targets[0];\n\n            if (!bestTarget) return;\n\n            let bestDiff = vectorBetween(this.pos, bestTarget.pos);\n            for (let i = 1; i < targets.length; i++) {\n                let diff = vectorBetween(this.pos, targets[i].pos);\n                if (diff.m < bestDiff.m) {\n                    bestTarget = targets[i];\n                    bestDiff = diff;\n                }\n            }\n\n            const pathToTarget = World.pathToTarget(this.pos, bestTarget.pos);\n\n            let diff = vectorBetween(this.pos, pathToTarget);\n\n            if (this.state === CHASE) {\n                if (bestDiff.m < this.attackDistance) {\n                    this.state = ATTACK;\n                    this.attackFrames = 10;\n                    this.attackTarget = bestTarget;\n                } else {\n                    diff.m = clamp(diff.m, 0, this.moveSpeed);\n                    this.vel = {\n                        x: (this.vel.x + diff.x * diff.m) / 2,\n                        y: (this.vel.y + diff.y * diff.m) / 2\n                    };\n                }\n            } else if (this.state === ATTACK) {\n                this.vel = {\n                    x: this.vel.x * 0.9,\n                    y: this.vel.y * 0.9\n                };\n                this.attackFrames--;\n                if (this.attackFrames === 5) {\n                    this.attackTarget.damage.push({ amount: 10, vector: { x: 0, y: 0, m: 0 }, knockback: 0 });\n                } else if (this.attackFrames === -30) {\n                    this.state = CHASE;\n                }\n            } else if (this.state === DEAD) {\n                Audio.play(Audio.ghostDeath);\n                this.cull = true;\n                game.fervor += (this.variant + 1);\n                Gore.kill(this);\n            }\n        }\n\n        draw() {\n            //if (!this.lastQR) return;\n            let frame = (this.variant * 2) + (this.state === ATTACK ? 1 : 0);\n            let sprite = Sprite.ghost[frame];\n\n\n            /*for (let r = 0; r < this.targetField.length; r++) {\n                for (let q = 0; q < this.targetField[0].length; q++) {\n                    let uv = xy2uv(qr2xy({ q, r }));\n                    Text.drawText(\n                        Viewport.ctx,\n                        '' + this.targetField[r][q] || '',\n                        uv.u,\n                        uv.v\n                    );\n                }\n            }*/\n\n            /*\n            let uv = xy2uv(qr2xy(this.lastQR));\n            Viewport.ctx.fillStyle = rgba(255, 0, 0, 0.2);\n            Viewport.ctx.fillRect(uv.u + 1, uv.v + 1, 7, 7);\n\n            uv = xy2uv(qr2xy(this.nextQR));\n            Viewport.ctx.fillStyle = rgba(0, 255, 0, 0.2);\n            Viewport.ctx.fillRect(uv.u + 1, uv.v + 1, 7, 7);\n            */\n\n            /*let sprite = Sprite.stabguts[((game.frame / 12) | 0) % 2];\n            this.state === RELOAD && (sprite = Sprite.stabguts[2]);\n            this.state === ATTACK && (sprite = Sprite.stabguts[3]);*/\n            Sprite.drawViewportSprite(\n                sprite,\n                this.pos //,\n                //this.facingAngle + R90\n            );\n\n            if (this.hp < this.maxhp) {\n                let hp = Math.ceil(this.hp / this.maxhp * 7);\n                if (hp >= 0) {\n                    Sprite.drawViewportSprite(\n                        Sprite.enemy_healthbar[hp],\n                        this.pos\n                    );\n                }\n            }\n        }\n    }\n\n    // GatherEarthAction\n\n    const GatherEarthAction = {\n        defaultTapAction() {\n            return true;\n        },\n\n        buttonSprite() {\n            return Sprite.buttons[2];\n        },\n\n        buttonSelectedSprite() {\n            return Sprite.buttons[3];\n        },\n\n        drawSelectedText(u, v) {\n            let text = 'GATHER EARTH';\n\n            Text.drawParagraph(\n                Viewport.ctx,\n                text,\n                u,\n                v\n            );\n        },\n\n        tap() {\n            Moth.assign(moth => moth.gather(World.selected));\n            return true;\n        }\n    };\n\n    /**\n     * Monster\n     */\n    class EarthBuilding {\n        constructor(qr) {\n            this.qr = { ...qr };\n            this.resourcesLeft = 150_00;\n\n            this.title = 'EARTH';\n            this.portraitSprite = Sprite.buildings[2];\n        }\n\n        think() {\n            this.title = 'EARTH \\n' + Math.ceil(this.resourcesLeft / 100) + ' REMAINING';\n\n            if (this.resourcesLeft < 1) {\n                this.cull = true;\n            }\n        }\n\n        draw() {\n            let xy = qr2xy(this.qr);\n\n            //Viewport.ctx.drawImage(Sprite.tiles[tiles[y][x] - 1].img, x * 8 + offset.u, y * 8 + offset.v);\n            Sprite.drawViewportSprite(Sprite.buildings[2], xy);\n\n            //Sprite.drawViewportSprite(Sprite.spindoctor[0], this.pos, game.frame / 5);\n            //Sprite.drawViewportSprite(Sprite.spindoctor[1], this.pos);\n        }\n\n        hudActions() {\n            return [GatherEarthAction];\n        }\n    }\n\n    // GatherEarthAction\n\n    const MoveAction = {\n        defaultTapAction() {\n            return true;\n        },\n\n        buttonSprite() {\n            return Sprite.buttons[4];\n        },\n\n        buttonSelectedSprite() {\n            return Sprite.buttons[5];\n        },\n\n        drawSelectedText(u, v) {\n            let text = 'EXPLORE';\n\n            Text.drawParagraph(\n                Viewport.ctx,\n                text,\n                u,\n                v\n            );\n        },\n\n        tap() {\n            Moth.assign(moth => moth.moveTo(World.selected));\n            return true;\n        }\n    };\n\n    /**\n     * Movement\n     */\n    const Movement = {\n        perform(entities) {\n            // Movement only applies to active entities with positions and velocities\n            let movers = entities.filter(\n                entity => entity.pos && entity.vel && !entity.cull\n            );\n\n            // Very basic \"rounds\" of collision resolution, since we have no real physics.\n            // (As usual, \"detecting\" a collision is not the hard part... we need to resolve\n            // them too!)\n            for (let rounds = 0; rounds < 5; rounds++) {\n                // Each pair of entities only needs to interact once.\n                for (let i = 0; i < movers.length - 1; i++) {\n                    for (let j = i + 1; j < movers.length; j++) {\n                        Movement.clipVelocityEntityVsEntity(movers[i], movers[j]);\n                    }\n                }\n\n                for (let entity of movers) {\n                    Movement.clipVelocityAgainstWalls(entity);\n                }\n            }\n\n            // Now we perform all movement, even if it's not going to be perfect.\n            for (let entity of movers) {\n                entity.pos.x += entity.vel.x;\n                entity.pos.y += entity.vel.y;\n            }\n        },\n\n        clipVelocityEntityVsEntity(entity, other) {\n            if (entity.noClipEntity || other.noClipEntity) return;\n\n            let hit = intersectCircleCircle(\n                entity.pos,\n                entity.radius,\n                entity.vel,\n                other.pos,\n                other.radius,\n                other.vel\n            );\n            if (hit) {\n                if (entity.bounce && other.bounce) {\n                    entity.vel.x = -hit.nx * hit.m;\n                    entity.vel.y = -hit.ny * hit.m;\n                    other.vel.x = hit.nx * hit.m;\n                    other.vel.y = hit.ny * hit.m;\n                } else {\n                    // Not a bug: we \"add\" the mass of the opposing entity to our own velocity when deciding who\n                    // is at fault for the collision. Entity velocities adjust in relation to their fault level.\n                    let entityM = normalizeVector(entity.vel).m + other.mass,\n                        otherM = normalizeVector(other.vel).m + entity.mass,\n                        entityI = entity.bounce ? 0.1 : 1,\n                        otherI = other.bounce ? 0.1 : 1;\n                    entity.vel.x -=\n                        (hit.nx * hit.m * entityI * entityM) / (entityM + otherM);\n                    entity.vel.y -=\n                        (hit.ny * hit.m * entityI * entityM) / (entityM + otherM);\n                    other.vel.x +=\n                        (hit.nx * hit.m * otherI * otherM) / (entityM + otherM);\n                    other.vel.y +=\n                        (hit.ny * hit.m * otherI * otherM) / (entityM + otherM);\n                }\n            }\n        },\n\n        clipVelocityAgainstWalls(entity) {\n            if (entity.noClipWall) return;\n\n            if (entity.pos.y < -1000) {\n                console.log('FUUUUUUUUUUUUUUUU');\n            }\n\n\n            for (let tile of tilesHitByCircle(\n                entity.pos,\n                entity.vel,\n                entity.radius\n            )) {\n                if (!tileIsPassable(tile.q, tile.r)) {\n                    let bounds = [\n                        qr2xy(tile),\n                        qr2xy({ q: tile.q + 1, r: tile.r + 1 })\n                    ];\n                    let hit = intersectCircleRectangle(\n                        entity.pos,\n                        {\n                            x: entity.pos.x + entity.vel.x,\n                            y: entity.pos.y + entity.vel.y\n                        },\n                        entity.radius,\n                        bounds\n                    );\n\n                    // The \"math\" part of detecting collision with walls is buried in the geometry functions\n                    // above, but it's not the whole story -- if we do detect a collision, we still need to\n                    // decide what to do about it.\n                    //\n                    // If the normal vector is horizontal or vertical, we zero out the portion of the vector\n                    // moving into the wall, allowing frictionless sliding (if we wanted to perform friction,\n                    // we could also reduce the other axis slightly).\n                    //\n                    // If the normal vector is not 90*, we \"back up\" off the wall by exactly the normal vector.\n                    // If the player runs into a corner at EXACTLY a 45 degree angle, they will simply \"stick\"\n                    // on it -- but one degree left or right and they'll slide around the corner onto the wall,\n                    // which is the desired result.\n                    if (hit) {\n                        if (entity.bounce) {\n                            if (hit.nx === 0) {\n                                entity.vel.y = -entity.vel.y;\n                            } else if (hit.ny === 0) {\n                                entity.vel.x = -entity.vel.x;\n                            } else {\n                                entity.vel.x += hit.nx;\n                                entity.vel.y += hit.ny;\n                            }\n                        } else {\n                            if (hit.nx === 0) {\n                                entity.vel.y = hit.y - entity.pos.y;\n                            } else if (hit.ny === 0) {\n                                entity.vel.x = hit.x - entity.pos.x;\n                            } else {\n                                entity.vel.x += hit.nx;\n                                entity.vel.y += hit.ny;\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    };\n\n    // Damage\n\n    /**\n     * Damage\n     */\n    const Damage = {\n        perform(entities) {\n            for (let entity of entities) {\n                if (entity.hp) {\n                    if (entity.damage.length > 0) {\n                        if (entity.state !== DEAD && entity.state !== SPAWN) {\n                            for (let damage of entity.damage) {\n                                if (entity === game.player) {\n                                    game.entities.push(\n                                        new HealthChunkAnimation(\n                                            entity.hp,\n                                            damage.amount\n                                        )\n                                    );\n                                }\n                                entity.hp -= damage.amount;\n                                damage.vector.m = damage.knockback;\n                                entity.vel = vectorAdd(entity.vel, damage.vector);\n                                entity.lastDamage = damage;\n                                Gore.damage(entity);\n                                game.entities.push(new AttackAnimation(entity.pos));\n                            }\n                        }\n                        entity.damage = [];\n                    }\n                    if (entity.hp <= 0 && entity.state !== DEAD) {\n                        entity.state = DEAD;\n                    }\n                }\n            }\n        }\n    };\n\n    // Wave\n\n    const WAVES = [\n        // Wave 1\n        [\n            [0,   0],\n            [5,   0],\n            [10,  0],\n            [15,  0],\n        ],\n        // Wave 2\n        [\n            [0,   0],\n            [1,   0],\n            [2,   0],\n            [3,   0],\n            [10,  0],\n            [11,  0],\n            [12,  0],\n            [15,  0],\n            [15,  0],\n            [15,  0],\n        ],\n        // Wave 3\n        [\n            [0,   0],\n            [1,   0],\n            [2,   0],\n            [3,   0],\n            [4,   0],\n            [5,   0],\n            [10,  0],\n            [15,  1],\n        ],\n        // Wave 4\n        [\n            [0,   1],\n            [5,   0],\n            [5,   0],\n            [10,  1],\n            [15,  0],\n            [15,  0],\n            [20,  1],\n        ],\n        // Wave 5\n        [\n            [0,   1],\n            [5,   0],\n            [5,   0],\n            [10,  0],\n            [10,  0],\n            [15,  0],\n            [15,  1],\n            [20,  2],\n        ]\n    ];\n\n    class Wave {\n        constructor(waveNumber) {\n            this.waveNumber = waveNumber;\n\n            waveNumber = waveNumber % WAVES.length;\n\n            this.upcoming = [...WAVES[waveNumber]];\n            this.countdown = 12 * 60;\n            this.incoming = false;\n            this.frame = 0;\n            this.lastFrame = this.upcoming[this.upcoming.length - 1][0] * 60;\n        }\n\n        update() {\n            this.countdown--;\n\n            if (this.countdown >= 0 && this.countdown <= 2 * 60 && this.countdown % 60 === 0) {\n                Audio.play(Audio.waveCountdown);\n            }\n\n            if (this.countdown <= 0) {\n                this.incoming = true;\n\n                for (let i = 0; i < this.upcoming.length; i++) {\n                    if (this.frame === this.upcoming[i][0] * 60) {\n                        game.monstersPending.push(xy => new Ghost(xy, this.upcoming[i][1]));\n                    }\n                }\n\n                this.frame++;\n            }\n\n            if (this.frame >= this.lastFrame) {\n                let enemies = game.entities.filter(e => e.enemy);\n                if (enemies.length === 0) {\n                    game.wave = undefined;\n                }\n            }\n        }\n    }\n\n    class VictoryScreen {\n        constructor() {\n            this.frames = 0;\n        }\n\n        update() {\n            this.frames++;\n\n            return;\n        }\n\n        draw() {\n            //Viewport.ctx.fillStyle = rgba(13, 43, 69, clamp(this.frames / 200, 0, 1));\n            Viewport.ctx.fillStyle = rgba(36, 26, 20, clamp(this.frames / 200, 0, 1));\n            Viewport.ctx.fillRect(0, 0, Viewport.width, Viewport.height);\n\n            let width = Viewport.width - 32;\n            let x = 16;\n            let y = 16;\n\n            let message = 'ESCAPE! \\n' +\n                '                    \\n' +\n                'VILLAGERS STIR UNEASILY IN THEIR BEDS AS YOU EMERGE INTO MOONLIGHT. YOU SENSE WARM BODIES ALL AROUND YOU, RIPE FOR PICKING. IT IS ONLY A MATTER OF TIME NOW BEFORE YOU REGAIN YOUR FULL NECROMANTIC POWER. \\n' +\n                '                    \\n' +\n                'CONGRATULATIONS... AND THE END.';\n\n            message = message.slice(0, this.frames);\n\n            Text.drawParagraph(\n                Viewport.ctx,\n                message,\n                x,\n                y,\n                width,\n                1,\n                1\n            );\n        }\n    }\n\n    /**\n     * Monster\n     */\n    class ExitBuilding {\n        constructor(qr) {\n            this.qr = { ...qr };\n\n            this.title = 'REACH EXIT \\nTO ESCAPE';\n            this.portraitSprite = Sprite.buildings[3];\n            this.lightlevel = 4;\n        }\n\n        think() {\n            let moths = Moth.sortMoths();\n            let pos = centerxy(qr2xy(this.qr));\n\n            for (let moth of moths) {\n                let dist = vectorBetween(moth.pos, pos);\n                if (dist.m < ACTION_DISTANCE) {\n                    game.screen = new VictoryScreen();\n                    return;\n                }\n            }\n        }\n\n        draw() {\n            let xy = qr2xy(this.qr);\n\n            //Viewport.ctx.drawImage(Sprite.tiles[tiles[y][x] - 1].img, x * 8 + offset.u, y * 8 + offset.v);\n            Sprite.drawViewportSprite(Sprite.buildings[3], xy);\n\n            //Sprite.drawViewportSprite(Sprite.spindoctor[0], this.pos, game.frame / 5);\n            //Sprite.drawViewportSprite(Sprite.spindoctor[1], this.pos);\n        }\n\n        hudActions() {\n            return [MoveAction];\n        }\n    }\n\n    // World\n\n    const World = {\n        init() {\n            this.reset();\n        },\n\n        draw() {\n            let tiles = this.floors[0].tiles;\n            //console.log(Camera.pos);\n            //Camera.pos.x++;\n            let offset = xy2uv({ x: 0, y: 0 });\n\n            //console.log(offset);\n\n            for (let r = 0; r < tiles.length; r++) {\n                for (let q = 0; q < tiles[0].length; q++) {\n                    //Viewport.ctx.globalAlpha = clamp(this.lightmap[y][x] / 5, 0.1, 1);\n                    if (tiles[r][q] > 0) {\n                        //console.log(x, y, tiles[y][x], Sprite.tiles[tiles[y][x] - 1]);\n                       Viewport.ctx.drawImage(Sprite.tiles[tiles[r][q] - 1].img, q * TILE_SIZE + offset.u, r * TILE_SIZE + offset.v);\n\n\n                       //Text.drawText(Viewport.ctx, '' + this.lightmap[y][x], x * TILE_SIZE + offset.u, y * TILE_SIZE + offset.v);\n                    }\n                }\n            }\n\n            //Viewport.ctx.globalAlpha = 1;\n\n            /*\n            if (Game.frame % 133 === 0) {\n                //console.log('generating visions');\n                this.visions = [];\n                for (let i = 0; i < 10; i++) {\n                    this.visions.push([\n                        Math.floor(Math.random() * tiles[0].length),\n                        Math.floor(Math.random() * tiles.length),\n                        String.fromCharCode(97 + Math.floor(Math.random() * 26))\n                    ]);\n                }\n            } else if (Game.frame % 133 >= 5 && Game.frame % 133 <= 25) {\n                for (let vision of this.visions) {\n                    Screen.writeOnMap(vision[0], vision[1], vision[2], Screen.RED);\n                }\n            }\n            */\n\n            for (let building of this.buildings) {\n                building.draw();\n            }\n        },\n\n        drawLightmap() {\n            let tiles = this.tiles;\n            let offset = xy2uv({ x: 0, y: 0 });\n\n            for (let r = 0; r < tiles.length; r++) {\n                for (let q = 0; q < tiles[0].length; q++) {\n                    if (tiles[r][q] > 0) {\n                        let lightlevel = 1 - clamp(this.lightmap[r][q] / 5, 0.1, 1);\n                        if (this.fogofwar[r][q] === 0) lightlevel = 1;\n\n                        Viewport.ctx.globalAlpha = lightlevel;\n                        Viewport.ctx.drawImage(Sprite.tile_background[0].img, q * TILE_SIZE + offset.u, r * TILE_SIZE + offset.v);\n\n                        //Viewport.ctx.fillStyle = rgba(36, 26, 20, lightlevel);\n                        //Viewport.ctx.fillRect(q * TILE_SIZE + offset.u, r * TILE_SIZE + offset.v, TILE_SIZE, TILE_SIZE);\n                    }\n                }\n            }\n\n            Viewport.ctx.globalAlpha = 1;\n        },\n\n        reset() {\n            // We want to be careful and CLONE (not reference) the world data, because\n            // this will be our \"working copy\" -- rooms and objects and even tiles might\n            // get updated and moved during game logic.\n            this.floors = WorldData.floors.map(floor => {\n                return {\n                    tiles: floor.tiles.map(row => [...row]),\n                    objects: floor.objects.map(object => ({ ...object })),\n                    //objects: floor.objects.map(object => ({ id: object[0], x: object[1], y: object[2], type: object[3] })),\n                    // *COMBAT*\n                    //triggers: floor.triggers.map(trigger => ({ ...trigger }))\n                };\n            });\n            this.bounds = WorldData.bounds;\n            this.spawn = { q: WorldData.spawn[0], r: WorldData.spawn[1] };\n\n            this.buildings = [];\n            this.buildings.push(new CoffinBuilding(this.spawn, true));\n\n            for (let b of this.floors[0].objects) {\n                if (b.name === 'EARTH') {\n                    this.buildings.push(new EarthBuilding({ q: b.x, r: b.y }));\n                } else if (b.name === 'EXIT') {\n                    this.buildings.push(new ExitBuilding({ q: b.x, r: b.y }));\n                    this.exit = { q: b.x, r: b.y };\n                }\n            }\n\n            this.selected = undefined;\n\n            this.tiles = this.floors[0].tiles;\n            this.width = this.tiles[0].length;\n            this.height = this.tiles.length;\n\n            this.lightmap = array2d(this.width, this.height, () => 0);\n            this.fogofwar = array2d(this.width, this.height, () => 0);\n\n            this.cachedFields = {};\n\n            this.makePrettyWalls();\n        },\n\n        update() {\n            for (let building of this.buildings) {\n                building.think();\n            }\n\n            this.updateLightmap();\n        },\n\n        canMoveInto(pos) {\n            let tile = this.tileAt(pos);\n            if (tile === 46 /* . */) return true;\n            return false;\n        },\n\n        isSeeThrough(pos) {\n            return this.SEE_THROUGH.includes(this.floors[pos.z].tiles[pos.y][pos.x]);\n        },\n\n        refreshVisible(pos) {\n            this.floors[pos.z];\n            //FieldOfView.resetVisible(floor.visible);\n            //FieldOfView.refreshVisible(pos, floor.visible, floor.seen);\n        },\n\n        tap(uv) {\n            let qr = xy2qr(uv2xy(uv));\n            let tile = this.tileAt(qr);\n\n            if (!tile || tile > 8 || !this.fogofwar[qr.r][qr.q]) {\n                this.selected = undefined;\n            } else {\n                if (this.selected && this.selected.q === qr.q && this.selected.r === qr.r) {\n                    let building = this.buildingAt(this.selected);\n                    if (building) {\n                        let actions = building.hudActions();\n                        if (actions[0] && actions[0].defaultTapAction()) {\n                            actions[0].tap();\n                        }\n                    } else {\n                        MoveAction.tap();\n                    }\n                } else {\n                    // single tap, reselect\n                    this.selected = qr;\n                    this.buildingAt(this.selected);\n                    /*if (building) {\n                        let actions = building.hudActions();\n                        if (actions[0] && actions[0].defaultTapAction) {\n                            Hud.selectedAction = actions[0];\n                        }\n                    }*/\n                }\n            }\n        },\n\n        tileAt(qr) {\n            if (qr) {\n                return this.floors[0].tiles[qr.r]?.[qr.q];\n            }\n        },\n\n        buildingAt(qr) {\n            if (qr) {\n                for (let building of this.buildings) {\n                    if (building.qr.q === qr.q && building.qr.r === qr.r) return building;\n                }\n            }\n        },\n\n        updateLightmap() {\n            /*\n            for (let r = 0; r < this.height; r++) {\n                for (let q = 0; q < this.width; q++) {\n                    this.lightmap[r][q] = 0;\n                }\n            }\n\n            for (let b of this.buildings) {\n                for (let r = -3; r <= 3; r++) {\n                    for (let q = -3; q <= 3; q++) {\n                        let diff = 5 - Math.abs(r) - Math.abs(q);\n                        if (diff <= 0) continue;\n\n                        let tq = b.qr.q + q, tr = b.qr.r + r;\n                        if (tq >= 0 && tr >= 0 && tq < this.width && tr < this.height) {\n                            if (this.lightmap[tr][tq] < diff) {\n                                this.lightmap[tr][tq] = diff;\n                            }\n                        }\n                    }\n                }\n            }\n\n            for (let e of game.entities) {\n                if (!(e instanceof Moth)) continue;\n                let qr = xy2qr(e.pos);\n                for (let r = -4; r <= 4; r++) {\n                    for (let q = -4; q <= 4; q++) {\n                        let diff = 9 - Math.abs(r) - Math.abs(q);\n                        if (diff <= 0) continue;\n\n                        let tq = qr.q + q, tr = qr.r + r;\n                        if (tq >= 0 && tr >= 0 && tq < this.width && tr < this.height) {\n                            if (this.lightmap[tr][tq] < diff) {\n                                this.lightmap[tr][tq] = diff;\n                            }\n                        }\n                    }\n                }\n            }*/\n\n            let lights = [];\n\n            for (let building of this.buildings) {\n                if (building.lightlevel) {\n                    lights.push({ ...building.qr, light: building.lightlevel });\n                }\n            }\n\n            for (let entity of game.entities) {\n                if (entity.lightlevel) {\n                    lights.push({ ...xy2qr(entity.pos), light: entity.lightlevel });\n                }\n            }\n\n            this.lightmap = floodlight(this.tiles, lights);\n            for (let r = 0; r < this.lightmap.length; r++) {\n                for (let q = 0; q < this.lightmap[0].length; q++) {\n                    if (this.lightmap[r][q] > this.fogofwar[r][q]) {\n                        this.fogofwar[r][q] = 1;\n                    }\n                }\n            }\n        },\n\n        pathToTarget(from, to) {\n            let qrFrom = xy2qr(from);\n            let qrTo = xy2qr(to);\n\n            let dist = manhattan(qrFrom, qrTo);\n            if (dist <= 1) {\n                return to;\n            }\n\n            let key = [qrTo.q, qrTo.r].join(',');\n\n            // Our game doesn't support any kinds of doors or world destruction or\n            // anything like that, so once we've calculated a field we don't need to\n            // recalculate it.\n            let field = this.cachedFields[key];\n            if (!field) {\n                field = this.cachedFields[key] = flood(this.tiles, qrTo);\n            }\n            console.log(Object.keys(this.cachedFields).length);\n\n            let options = [\n                [qrFrom.q + 1, qrFrom.r],\n                [qrFrom.q - 1, qrFrom.r],\n                [qrFrom.q, qrFrom.r + 1],\n                [qrFrom.q, qrFrom.r - 1]\n            ];\n\n            for (let option of options) {\n                option.push(field[option[1]][option[0]]);\n            }\n            options.sort((a, b) => a[2] - b[2]);\n\n            return centerxy(qr2xy({ q: options[0][0], r: options[0][1] }));\n        },\n\n        makePrettyWalls() {\n            for (let r = 0; r < this.tiles.length; r++) {\n                for (let q = 0; q < this.tiles[0].length; q++) {\n                    if (this.tiles[r][q] === TILE_CORNER_INNER) {\n                        let bitmask = 0;\n\n                        if ((this.tiles[r - 1]?.[q - 1] || 99) < 8) bitmask |= 0b100_000_000;\n                        if ((this.tiles[r - 1]?.[q] || 99) < 8)     bitmask |= 0b010_000_000;\n                        if ((this.tiles[r - 1]?.[q + 1] || 99) < 8) bitmask |= 0b001_000_000;\n                        if ((this.tiles[r]?.[q - 1] || 99) < 8)     bitmask |= 0b000_100_000;\n                        if ((this.tiles[r]?.[q + 1] || 99) < 8)     bitmask |= 0b000_001_000;\n                        if ((this.tiles[r + 1]?.[q - 1] || 99) < 8) bitmask |= 0b000_000_100;\n                        if ((this.tiles[r + 1]?.[q] || 99) < 8)     bitmask |= 0b000_000_010;\n                        if ((this.tiles[r + 1]?.[q + 1] || 99) < 8) bitmask |= 0b000_000_001;\n\n                        Sprite.getDynamicTile(bitmask);\n                        this.tiles[r][q] = TILE_DYNAMIC + bitmask;\n                    }\n                }\n            }\n        }\n    };\n\n    // Hud\n\n    const TRAY_HEIGHT = 18;\n\n    /**\n     * Hud\n     *\n     * Health bars, ammo, etc.\n     */\n    const Hud = {\n        init() {\n            this.wipCanvas = createCanvas(7, 7);\n        },\n\n        update() {\n            if (World.selected) {\n                let tile = World.tileAt(World.selected);\n                let building = World.buildingAt(World.selected);\n                if (building) {\n                    this.actions = building.hudActions();\n                } else if (tile >= 1 && tile <= 4) {\n                    this.actions = [MoveAction, BuildTowerAction, TeleportCoffinAction];\n                } else {\n                    this.actions = [];\n                }\n            } else {\n                this.actions = [];\n            }\n\n            if (Input.dragging) {\n                this.selectedAction = undefined;\n            }\n        },\n\n        draw() {\n            Viewport.ctx.fillStyle = rgba(36, 26, 20, 0.4);\n            Viewport.ctx.fillRect(0, 0, Viewport.width, 9);\n            // Glyphs\n\n            if (game.wave) {\n                if (game.wave.incoming) {\n                    let text = 'WAVE ' + (game.wave.waveNumber + 1);\n                    let width = Text.measureWidth(text, 1);\n                    let u = (Viewport.width - width) / 2;\n                    let color = Math.floor(game.frame / 60) % 2 === 0 ? Text.duotone : Text.duotone_red;\n                    Text.drawText(Viewport.ctx, text, u, 2, 1, color);\n                } else {\n                    let seconds = Math.ceil(game.wave.countdown / 60);\n\n                    if (seconds <= 30) {\n                        let text = 'NEXT WAVE';\n                        let width = Text.measureWidth(text, 1) + 2;\n                        let u = (Viewport.width - width) / 2;\n                        Text.drawText(Viewport.ctx, 'NEXT WAVE ', u, 2);\n\n                        this.wipCanvas.ctx.clearRect(0, 0, 7, 7);\n                        this.wipCanvas.ctx.fillStyle = rgba(255, 212, 163, 1);\n                        this.wipCanvas.ctx.beginPath();\n                        this.wipCanvas.ctx.moveTo(3.5, 3.5);\n                        this.wipCanvas.ctx.lineTo(3.5, 0);\n                        this.wipCanvas.ctx.arc(3.5, 3.5, 3, Math.PI * 1.5, Math.PI * 1.5 + (seconds / 30 * Math.PI * 2));\n                        this.wipCanvas.ctx.fill();\n\n                        Viewport.ctx.drawImage(this.wipCanvas.canvas, u + width, 1);\n                    }\n                }\n            }\n\n            let moths = game.entities.filter(x => x instanceof Moth);\n            for (let i = 0; i < moths.length; i++) {\n                Viewport.ctx.drawImage(Sprite.moth[1].img, 2 + i * 4, 2);\n            }\n\n            let cornerText = '' + game.earth + 'e ' + String(game.fervor).padStart(2) + 'f';\n            let cornerWidth = Text.measureWidth(cornerText, 1);\n\n            Viewport.ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';\n            Text.drawText(Viewport.ctx, cornerText, Viewport.width - cornerWidth - 2, 2);\n\n\n            /*\n            // SHOW DEBUGGING INFO\n\n            if (Input.pointer) {\n                let u = Input.pointer.u;\n                let v = Input.pointer.v;\n                let xy = uv2xy(Input.pointer);\n                let qr = xy2qr(xy);\n\n                Text.drawText(Viewport.ctx, '' + u + ',' + v + '. ' + xy.x + ',' + xy.y + '. ' + qr.q + ',' + qr.r + '.', Viewport.width - 100, 20);\n                if (World.selected) {\n                    let tile = World.tiles[World.selected.r][World.selected.q];\n                    if (tile > 20) tile = tile - 20;\n                    Text.drawText(Viewport.ctx, '' + World.selected.q + ',' + World.selected.r + '. ' + tile.toString(2).padStart(9, '0'), Viewport.width - 100, 29);\n                }\n            }\n            */\n\n            // Health\n            /*\n            let hp = clamp(game.player.hp, 0, 100);\n            Viewport.ctx.drawImage(Sprite.hud_healthbar[0].img, 2, 2);\n            Viewport.ctx.drawImage(\n                Sprite.hud_healthbar[1].img,\n                0,\n                0,\n                hp + 8,\n                8,\n                2,\n                2,\n                hp + 8,\n                8\n            );\n            */\n\n            // Shells\n            /*let sprite = Sprite.hud_shells_full;\n            for (let i = 0; i < game.player.shellsMax; i++) {\n                if (i + 1 > game.player.shellsLeft)\n                    sprite = Sprite.hud_shells_empty;\n                Viewport.ctx.drawImage(sprite.img, 15 + 6 * i, 10);\n            }*/\n\n            // Glyphs\n            // Text.drawText(Viewport.ctx, 'stuvw', Viewport.width - HUD_PAGE_TEXT_U - 60, 4, 2, Text.blue, Text.blue_shadow);\n\n            if (World.selected) {\n                /*Viewport.ctx.globalAlpha = 0.5;\n                let uv = xy2uv(qr2xy(World.selected));\n                Viewport.ctx.drawImage(Sprite.hud_tile_selected[Math.floor(game.frame / 30) % 2].img, uv.u, uv.v);\n                Viewport.ctx.globalAlpha = 1;*/\n\n                let uv = xy2uv({ x: World.selected.q * 8, y: World.selected.r * 8 });\n                Viewport.ctx.fillStyle = rgba(255, 212, 163, 0.25);\n                Viewport.ctx.fillRect(uv.u, uv.v, 9, 9);\n            }\n\n            // Debugging - viewport width/height\n            /*\n            Text.drawRightText(\n                Viewport.ctx,\n                [Viewport.scale, Viewport.width, Viewport.height, 'stuvwx'].join(', '),\n                Viewport.width - 4,\n                Viewport.height - 18\n            );\n            */\n\n            Viewport.ctx.fillStyle = '#ffd4a3';\n            Viewport.ctx.fillRect(0, Viewport.height - TRAY_HEIGHT, Viewport.width, 1);\n\n            Viewport.ctx.fillStyle = '#8d697a';\n            Viewport.ctx.fillRect(0, Viewport.height - TRAY_HEIGHT + 1, Viewport.width, 1);\n\n            Viewport.ctx.fillStyle = '#203c56';\n            Viewport.ctx.fillRect(0, Viewport.height - TRAY_HEIGHT + 2, Viewport.width, TRAY_HEIGHT - 2);\n\n            Viewport.ctx.fillStyle = '#8d697a';\n            Viewport.ctx.fillRect(0, Viewport.height - 2, Viewport.width, 2);\n\n            //Viewport.ctx.drawImage(Sprite.hud_tray_building[0].img, 0, Viewport.height - TRAY_HEIGHT + 1);\n\n            Viewport.ctx.drawImage(Sprite.hud_tray_divider[0].img, -2, Viewport.height - TRAY_HEIGHT + 1);\n            Viewport.ctx.drawImage(Sprite.hud_tray_divider[0].img, 64, Viewport.height - TRAY_HEIGHT + 1);\n            Viewport.ctx.drawImage(Sprite.hud_tray_divider[0].img, Viewport.width - 3, Viewport.height - TRAY_HEIGHT + 1);\n\n            if (World.selected) {\n                let building = World.buildingAt(World.selected);\n                if (building) {\n                    Viewport.ctx.drawImage(building.portraitSprite.img, 3, Viewport.height - TRAY_HEIGHT - 1);\n\n                    Text.drawParagraph(\n                        Viewport.ctx,\n                        building.title,\n                        14,\n                        Viewport.height - TRAY_HEIGHT + 3,\n                        Viewport.width\n                    );\n                } else {\n                    let tile = World.tileAt(World.selected);\n                    console.log(World.selected, tile, TILE_DESCRIPTIONS[tile - 1]);\n                    Viewport.ctx.drawImage(Sprite.tile_background[1].img, 4, Viewport.height - TRAY_HEIGHT + 6);\n                    Viewport.ctx.drawImage(Sprite.tiles[tile - 1].img, 3, Viewport.height - TRAY_HEIGHT + 5);\n                    Text.drawParagraph(\n                        Viewport.ctx,\n                        TILE_DESCRIPTIONS[tile - 1],\n                        14,\n                        Viewport.height - TRAY_HEIGHT + 3,\n                        Viewport.width\n                    );\n                }\n            }\n\n            let selectedActionIndex;\n\n            for (let i = 0; i < this.actions.length; i++) {\n                let action = this.actions[i];\n                let uvAction = this.uvTrayAction(i);\n                Viewport.ctx.drawImage(Sprite.hud_tray_divider[0].img, uvAction.u + 11, Viewport.height - TRAY_HEIGHT + 1);\n                Viewport.ctx.drawImage(action.buttonSprite().img, uvAction.u, uvAction.v);\n\n                if (this.selectedAction === action) selectedActionIndex = i;\n            }\n\n            if (selectedActionIndex >= 0) {\n                let uvAction = this.uvTrayAction(selectedActionIndex);\n\n                Viewport.ctx.drawImage(Sprite.hud_tray_popup[0].img, uvAction.u - 23, uvAction.v - 19);\n\n                Viewport.ctx.drawImage(this.selectedAction.buttonSelectedSprite().img, uvAction.u, uvAction.v);\n\n                this.selectedAction.drawSelectedText(uvAction.u - 23 + 3, uvAction.v - 19 + 3);\n            }\n\n            if (Input.pointer) {\n                if (game.dialog) {\n                    Viewport.ctx.globalAlpha = 0.5;\n                }\n                //Sprite.drawViewportSprite(Sprite.hud_crosshair[0], uv2xy(Input.pointer), game.frame / 72);\n                Sprite.drawViewportSprite(Sprite.hud_mouse, uv2xy(Input.pointer));\n                Viewport.ctx.globalAlpha = 1;\n            }\n\n            /*\n            Visual Effect Warning\n            let gorp = game.frame % 60;\n            let x = (gorp / 60) * (Viewport.width + 100) - 50;\n\n            Viewport.ctx.fillStyle = 'rgba(255, 0, 0, 0.6)';\n            Viewport.ctx.beginPath();\n            Viewport.ctx.moveTo(x + 20, 0);\n            Viewport.ctx.lineTo(x +0, Viewport.height);\n            Viewport.ctx.lineTo(x+40, Viewport.height);\n            Viewport.ctx.lineTo(x+60, 0);\n            Viewport.ctx.closePath();\n            Viewport.ctx.fill();\n            */\n        },\n\n        uvTrayAction(i) {\n            return { u: 68 + i * 15, v: Viewport.height - 15 };\n        },\n\n        tap(uv) {\n            if (uv.v > Viewport.height - TRAY_HEIGHT) {\n                for (let i = 0; i < this.actions.length; i++) {\n                    let uvAction = this.uvTrayAction(i);\n                    if (uv.u >= uvAction.u && uv.u <= uvAction.u + 12 && uv.v >= uvAction.v && uv.v <= uvAction.v + 12) {\n                        if (this.actions[i] === this.selectedAction) {\n                            if (this.selectedAction.tap()) {\n                                this.selectedAction = undefined;\n                            }\n                        } else {\n                            this.selectedAction = this.actions[i];\n                        }\n                        return true;\n                    }\n                }\n\n                this.selectedAction = undefined;\n                return true;\n            }\n\n            this.selectedAction = undefined;\n            return false;\n        }\n    };\n\n    // Camera\n\n    const Camera = {\n        init() {\n            this.pos = { x: 0, y: 0 };\n            this.forceTarget = undefined;\n            this.vel = { x: 0, y: 0 };\n        },\n\n        update() {\n            if (this.forceTarget) {\n                let dist = vectorBetween(this.pos, this.forceTarget);\n\n                if (dist.m < 1) {\n                    this.forceTarget = undefined;\n                    return;\n                }\n\n                dist.m = clamp(dist.m, 0, 2);\n\n                let newVelocity = vector2point(dist);\n                this.vel = {\n                    x: (this.vel.x + newVelocity.x) / 2,\n                    y: (this.vel.y + newVelocity.y) / 2\n                };\n\n                this.pos.x += this.vel.x;\n                this.pos.y += this.vel.y;\n            }\n\n            if (Input.pressed[Input.Action.RAW_TOUCH]) {\n                this.dragStart = { ...this.pos };\n            }\n\n            if (Input.dragging) {\n                this.pos = {\n                    x: this.dragStart.x - Input.dragVector.x,\n                    y: this.dragStart.y - Input.dragVector.y\n                };\n            }\n\n            //this.pos = Game.player.pos;\n            //this.pos = { x: 0, y: 0, z: 0 };\n        }\n    };\n\n    function normalizeVector(p) {\n        let m = Math.sqrt(p.x * p.x + p.y * p.y);\n        return m === 0 ? { x: 0, y: 0, m: 0 } : { x: p.x / m, y: p.y / m, m };\n    }\n\n    function vectorBetween(p1, p2) {\n        return normalizeVector({ x: p2.x - p1.x, y: p2.y - p1.y });\n    }\n\n    function angle2vector(r, m) {\n        return { x: Math.cos(r), y: Math.sin(r), m: m || 1 };\n    }\n\n    function vector2angle(v) {\n        let angle = Math.atan2(v.y, v.x);\n        if (angle < 0) angle += R360;\n        return angle;\n    }\n\n    function vector2point(v) {\n        return { x: v.x * (v.m || 1), y: v.y * (v.m || 1) };\n    }\n\n    // Takes a series of vectors and denormalizes them and adds them together, usually resulting\n    // in a point in space. Wrap in normalizeVector to get a normalized vector again, if desired.\n    function vectorAdd(...vectors) {\n        let v = { x: 0, y: 0, m: 1 };\n        for (let vector of vectors) {\n            v.x += vector.x * (vector.m || 1);\n            v.y += vector.y * (vector.m || 1);\n        }\n        return v;\n    }\n\n    function xy2qr(pos) {\n        return { q: (pos.x / TILE_SIZE) | 0, r: (pos.y / TILE_SIZE) | 0 };\n    }\n\n    function qr2xy(pos) {\n        return { x: pos.q * TILE_SIZE, y: pos.r * TILE_SIZE };\n    }\n\n    function xy2uv(pos) {\n        return {\n            u: pos.x + Viewport.center.u - Camera.pos.x,\n            v: pos.y + Viewport.center.v - Camera.pos.y\n        };\n    }\n\n    function uv2xy(pos) {\n        return {\n            x: pos.u - Viewport.center.u + Camera.pos.x,\n            y: pos.v - Viewport.center.v + Camera.pos.y\n        };\n    }\n\n    function centerxy(pos) {\n        return {\n            x: pos.x + TILE_SIZE / 2,\n            y: pos.y + TILE_SIZE / 2\n        };\n    }\n\n    function clamp(value, min, max) {\n        return value < min ? min : value > max ? max : value;\n    }\n\n    function manhattan(qr1, qr2) {\n        return Math.abs(qr1.q - qr2.q) + Math.abs(qr1.r - qr2.r);\n    }\n\n    /**\n     * @param {XY[]} bounds  the upper-left and lower-right bounds\n     * @yields {QR}\n     */\n    function* tilesHitInBounds(bounds) {\n        for (let r = bounds[0].y / TILE_SIZE | 0; r * TILE_SIZE < bounds[1].y; r++) {\n            for (let q = bounds[0].x / TILE_SIZE | 0; q * TILE_SIZE <  bounds[1].x; q++) {\n                yield { q, r };\n            }\n        }\n    }\n\n    /**\n     * @param {XY} p1  the starting position\n     * @param {XY} p2  the ending position\n     * @param {number} r  the radius of the moving circle\n     * @yields {QR}\n     */\n    function* tilesHitBetweenCircle(p1, p2, r) {\n        let bounds = [\n            { x: Math.min(p1.x, p2.x) - r, y: Math.min(p1.y, p2.y) - r },\n            { x: Math.max(p1.x, p2.x) + r, y: Math.max(p1.y, p2.y) + r }\n        ];\n        yield* tilesHitInBounds(bounds);\n    }\n\n    /**\n     * @param {XY} p  the starting position\n     * @param {XY} v  the velocity (movement)\n     * @param {number} r  the radius of the moving circle\n     * @yields {QR}\n     */\n    function* tilesHitByCircle(p, v, r) {\n        yield* tilesHitBetweenCircle(p, { x: p.x + v.x, y: p.y + v.y }, r);\n    }\n\n    // See https://stackoverflow.com/a/18790389/80630\n    function intersectCircleRectangle(p1, p2, r, bounds) {\n        // If the bounding box around the start and end points (+radius on all\n        // sides) does not intersect with the rectangle, definitely not an\n        // intersection\n        if (\n            Math.max(p1.x, p2.x) + r < bounds[0].x ||\n            Math.min(p1.x, p2.x) - r > bounds[1].x ||\n            Math.max(p1.y, p2.y) + r < bounds[0].y ||\n            Math.min(p1.y, p2.y) - r > bounds[1].y\n        )\n            return;\n\n        let dx = p2.x - p1.x;\n        let dy = p2.y - p1.y;\n        let invdx = dx === 0 ? 0 : 1 / dx;\n        let invdy = dy === 0 ? 0 : 1 / dy;\n        let cornerX = Infinity;\n        let cornerY = Infinity;\n\n        // Check each side of the rectangle for a single-side intersection\n        // Left Side\n        if (p1.x - r < bounds[0].x && p2.x + r > bounds[0].x) {\n            let ltime = (bounds[0].x - r - p1.x) * invdx;\n            if (ltime >= 0 && ltime <= 1) {\n                let ly = dy * ltime + p1.y;\n                if (ly >= bounds[0].y && ly <= bounds[1].y) {\n                    return {\n                        x: dx * ltime + p1.x,\n                        y: ly,\n                        t: ltime,\n                        nx: -1,\n                        ny: 0,\n                        ix: bounds[0].x,\n                        iy: ly\n                    };\n                }\n            }\n            cornerX = bounds[0].x;\n        }\n        // Right Side\n        if (p1.x + r > bounds[1].x && p2.x - r < bounds[1].x) {\n            let rtime = (p1.x - (bounds[1].x + r)) * -invdx;\n            if (rtime >= 0 && rtime <= 1) {\n                let ry = dy * rtime + p2.y;\n                if (ry >= bounds[0].y && ry <= bounds[1].y) {\n                    return {\n                        x: dx * rtime + p1.x,\n                        y: ry,\n                        t: rtime,\n                        nx: 1,\n                        ny: 0,\n                        ix: bounds[1].x,\n                        iy: ry\n                    };\n                }\n            }\n            cornerX = bounds[1].x;\n        }\n        // Top Side\n        if (p1.y - r < bounds[0].y && p2.y + r > bounds[0].y) {\n            let ttime = (bounds[0].y - r - p1.y) * invdy;\n            if (ttime >= 0 && ttime <= 1) {\n                let tx = dx * ttime + p1.x;\n                if (tx >= bounds[0].x && tx <= bounds[1].x) {\n                    return {\n                        x: tx,\n                        y: dy * ttime + p1.y,\n                        t: ttime,\n                        nx: 0,\n                        ny: -1,\n                        ix: tx,\n                        iy: bounds[0].y\n                    };\n                }\n            }\n            cornerY = bounds[0].y;\n        }\n        // Bottom Side\n        if (p1.y + r > bounds[1].y && p2.y - r < bounds[1].y) {\n            let btime = (p1.y - (bounds[1].y + r)) * -invdy;\n            if (btime >= 0 && btime <= 1) {\n                let bx = dx * btime + p1.x;\n                if (bx >= bounds[0].x && bx <= bounds[1].x) {\n                    return {\n                        x: bx,\n                        y: dy * btime + p1.y,\n                        t: btime,\n                        nx: 0,\n                        ny: 1,\n                        ix: bx,\n                        iy: bounds[0].y\n                    };\n                }\n            }\n            cornerY = bounds[1].y;\n        }\n\n        // If we haven't touched anything, there is no collision\n        if (cornerX === Infinity && cornerY === Infinity) return;\n\n        // We didn't pass through a side but may be hitting the corner\n        if (cornerX !== Infinity && cornerY === Infinity) {\n            cornerY = dy > 0 ? bounds[1].y : bounds[0].y;\n        }\n        if (cornerY !== Infinity && cornerX === Infinity) {\n            cornerX = dx > 0 ? bounds[1].x : bounds[0].x;\n        }\n\n        /* Solve the triangle between the start, corner, and intersection point.\n         *\n         *           +-----------T-----------+\n         *           |                       |\n         *          L|                       |R\n         *           |                       |\n         *           C-----------B-----------+\n         *          / \\\n         *         /   \\r     _.-E\n         *        /     \\ _.-'\n         *       /    _.-I\n         *      / _.-'\n         *     S-'\n         *\n         * S = start of circle's path\n         * E = end of circle's path\n         * LTRB = sides of the rectangle\n         * I = {ix, iY} = point at which the circle intersects with the rectangle\n         * C = corner of intersection (and collision point)\n         * C=>I (r) = {nx, ny} = radius and intersection normal\n         * S=>C = cornerdist\n         * S=>I = intersectionDistance\n         * S=>E = lineLength\n         * <S = innerAngle\n         * <I = angle1\n         * <C = angle2\n         */\n        let inverseRadius = 1 / r;\n        let lineLength = Math.sqrt(dx * dx + dy * dy);\n        let cornerdx = cornerX - p1.x;\n        let cornerdy = cornerY - p1.y;\n        let cornerDistance = Math.sqrt(cornerdx * cornerdx + cornerdy * cornerdy);\n        let innerAngle = Math.acos(\n            (cornerdx * dx + cornerdy * dy) / (lineLength * cornerDistance)\n        );\n\n        // If the circle is too close, no intersection\n        if (cornerDistance < r) return;\n\n        // If inner angle is zero, it's going to hit the corner straight on.\n        if (innerAngle === 0) {\n            let time = (cornerDistance - r) / lineLength;\n\n            // Ignore if time is outside boundaries of (p1, p2)\n            if (time > 1 || time < 0) return;\n\n            let ix = time * dx + p1.x;\n            let iy = time * dy + p1.y;\n            let nx = cornerdx / cornerDistance;\n            let ny = cornerdy / cornerDistance;\n\n            return isNaN(ix)\n                ? undefined\n                : { x: ix, y: iy, t: time, nx, ny, ix: cornerX, iy: cornerY };\n        }\n\n        let innerAngleSin = Math.sin(innerAngle);\n        let angle1Sin = innerAngleSin * cornerDistance * inverseRadius;\n\n        // If the angle is too large, there is no collision\n        if (Math.abs(angle1Sin) > 1) return;\n\n        let angle1 = Math.PI - Math.asin(angle1Sin);\n        let angle2 = Math.PI - innerAngle - angle1;\n        let intersectionDistance = (r * Math.sin(angle2)) / innerAngleSin;\n        let time = intersectionDistance / lineLength;\n\n        // Ignore if time is outside boundaries of (p1, p2)\n        if (time > 1 || time < 0) return;\n\n        let ix = time * dx + p1.x;\n        let iy = time * dy + p2.y;\n        let nx = (ix - cornerX) * inverseRadius;\n        let ny = (iy - cornerY) * inverseRadius;\n\n        return isNaN(ix)\n            ? undefined\n            : { x: ix, y: iy, t: time, nx, ny, ix: cornerX, iy: cornerY };\n    }\n\n    // https://stackoverflow.com/questions/18683179/how-to-fix-circles-overlap-in-collision-response\n    //\n    // This is an incredibly simple implementation that ASSUMES very small velocities. It doesn't attempt\n    // to answer the question about \"when\" the intersection happened like the method above - may\n    // fix that in future.\n    function intersectCircleCircle(p1, r1, v1, p2, r2, v2) {\n        [v1, v2] = [vector2point(v1), vector2point(v2)];\n        let a1 = { x: p1.x + v1.x, y: p1.y + v1.y };\n        let a2 = { x: p2.x + v2.x, y: p2.y + v2.y };\n        let delta = vectorBetween(a1, a2);\n        if (delta.m < r1 + r2) {\n            return { nx: delta.x, ny: delta.y, m: r1 + r2 - delta.m };\n        }\n    }\n\n    function flood(maze, to, maxDistance = Infinity) {\n        let result = array2d(maze[0].length, maze.length, () => Infinity);\n        let stack = [{ ...to, cost: 0 }];\n        while (stack.length > 0) {\n            let { q, r, cost } = stack.shift();\n            if (result[r][q] <= cost) continue;\n            result[r][q] = cost++;\n            if (result[r][q] >= maxDistance) continue;\n            if (tileIsPassable(q + 1, r) && result[r][q + 1] > cost)\n                stack.push({ q: q + 1, r, cost });\n            if (tileIsPassable(q - 1, r) && result[r][q - 1] > cost)\n                stack.push({ q: q - 1, r, cost });\n            if (tileIsPassable(q, r + 1) && result[r + 1][q] > cost)\n                stack.push({ q, r: r + 1, cost });\n            if (tileIsPassable(q, r - 1) && result[r - 1][q] > cost)\n                stack.push({ q, r: r - 1, cost });\n        }\n        return result;\n    }\n\n    function floodlight(maze, froms, maxDistance = Infinity) {\n        let result = array2d(maze[0].length, maze.length, () => 0);\n        let stack = [...froms];\n\n        while (stack.length > 0) {\n            let { q, r, light } = stack.shift();\n            if (result[r][q] >= light) continue;\n            result[r][q] = light--;\n            if (result[r][q] >= maxDistance) continue;\n            if (tileOnMap(q + 1, r) && result[r][q + 1] < light)\n                stack.push({ q: q + 1, r, light });\n            if (tileOnMap(q - 1, r) && result[r][q - 1] < light)\n                stack.push({ q: q - 1, r, light });\n            if (tileOnMap(q, r + 1) && result[r + 1][q] < light)\n                stack.push({ q, r: r + 1, light });\n            if (tileOnMap(q, r - 1) && result[r - 1][q] < light)\n                stack.push({ q, r: r - 1, light });\n        }\n        return result;\n    }\n\n    function array2d(width, height, fn) {\n        return Array.from({ length: height }, () =>\n            Array.from({ length: width }, fn)\n        );\n    }\n\n    function tileOnMap(q, r) {\n        let tiles = World.floors[0].tiles;\n        if (q < 0 || r < 0 || r >= tiles.length || q >= tiles[r].length) {\n            return false;\n        }\n        return true;\n    }\n\n    function tileIsPassable(q, r) {\n        let tiles = World.floors[0].tiles;\n        if (q < 0 || r < 0 || r >= tiles.length || q >= tiles[r].length) {\n            return false;\n        }\n        if (tiles[r][q] >= 1 && tiles[r][q] <= 4) {\n            return true;\n        }\n\n        return false;\n    }\n\n    function rgba(r, g, b, a) {\n        return `rgba(${r},${g},${b},${a})`;\n    }\n\n    function createCanvas(width, height) {\n        let canvas = document.createElement('canvas');\n        canvas.width = width;\n        canvas.height = height;\n        let ctx = canvas.getContext('2d');\n        return { canvas, ctx };\n    }\n\n    /**\n     * This module is generated by `gulp buildAssets`.\n     */\n    const SpriteSheet =\n        /* <generated> */\n    { attack: [ [ 0, 0, 10, 10 ], [ 10, 0, 10, 10 ] ],\n      buildings:\n       [ [ 0, 10, 8, 16 ],\n         [ 8, 10, 8, 16 ],\n         [ 16, 10, 8, 16 ],\n         [ 24, 10, 8, 16 ],\n         [ 32, 10, 8, 16 ] ],\n      bullet1: [ [ 0, 26, 3, 3 ] ],\n      buttons:\n       [ [ 0, 29, 12, 12 ],\n         [ 12, 29, 12, 12 ],\n         [ 24, 29, 12, 12 ],\n         [ 36, 29, 12, 12 ],\n         [ 48, 29, 12, 12 ],\n         [ 60, 29, 12, 12 ],\n         [ 72, 29, 12, 12 ],\n         [ 84, 29, 12, 12 ],\n         [ 96, 29, 12, 12 ],\n         [ 108, 29, 12, 12 ] ],\n      cursor: [ [ 0, 41, 10, 8 ] ],\n      enemy_healthbar:\n       [ [ 0, 49, 9, 9 ],\n         [ 9, 49, 9, 9 ],\n         [ 18, 49, 9, 9 ],\n         [ 27, 49, 9, 9 ],\n         [ 36, 49, 9, 9 ],\n         [ 45, 49, 9, 9 ],\n         [ 54, 49, 9, 9 ],\n         [ 63, 49, 9, 9 ] ],\n      font: [ [ 0, 58, 180, 12 ] ],\n      ghost:\n       [ [ 0, 70, 9, 9 ],\n         [ 9, 70, 9, 9 ],\n         [ 18, 70, 9, 9 ],\n         [ 27, 70, 9, 9 ],\n         [ 36, 70, 9, 9 ],\n         [ 45, 70, 9, 9 ] ],\n      gore: [ [ 0, 79, 5, 5 ], [ 5, 79, 5, 5 ], [ 10, 79, 5, 5 ], [ 15, 79, 5, 5 ] ],\n      hud_crosshair: [ [ 0, 84, 9, 9 ] ],\n      hud_tray_building: [ [ 0, 93, 13, 16 ] ],\n      hud_tray_divider: [ [ 0, 109, 5, 16 ] ],\n      hud_tray_popup: [ [ 0, 125, 60, 18 ] ],\n      hud_wip:\n       [ [ 0, 143, 7, 7 ],\n         [ 7, 143, 7, 7 ],\n         [ 14, 143, 7, 7 ],\n         [ 21, 143, 7, 7 ],\n         [ 28, 143, 7, 7 ],\n         [ 35, 143, 7, 7 ],\n         [ 42, 143, 7, 7 ],\n         [ 49, 143, 7, 7 ] ],\n      icon_mouse: [ [ 0, 150, 7, 9 ], [ 7, 150, 7, 9 ] ],\n      moth: [ [ 0, 159, 3, 3 ], [ 3, 159, 3, 3 ], [ 6, 159, 3, 3 ] ],\n      tile_background: [ [ 0, 162, 8, 8 ], [ 8, 162, 8, 8 ] ],\n      tiles:\n       [ [ 0, 170, 8, 8 ],\n         [ 8, 170, 8, 8 ],\n         [ 16, 170, 8, 8 ],\n         [ 24, 170, 8, 8 ],\n         [ 32, 170, 8, 8 ],\n         [ 40, 170, 8, 8 ],\n         [ 48, 170, 8, 8 ],\n         [ 56, 170, 8, 8 ],\n         [ 64, 170, 8, 8 ],\n         [ 72, 170, 8, 8 ],\n         [ 80, 170, 8, 8 ],\n         [ 88, 170, 8, 8 ],\n         [ 96, 170, 8, 8 ],\n         [ 104, 170, 8, 8 ] ],\n      walls: [ [ 0, 178, 4, 4 ], [ 4, 178, 4, 4 ] ],\n      base64:\n       'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAC2CAMAAABH21cLAAAAZlBMVEUAAADuw5oAAAANK0UgPFYhIickGhQuCAFTV1JUTmhcDwBtbnN1EgCNaXqPGxuPn6iRm6ObrbemraXCHQDJAADL2/zQgVnRFRXfcSbmAADuw5ru6WTwJAD78jb/ql7/1KP/7Nb///+8jDFnAAAAAnRSTlMAlm//+0kAAAQuSURBVHja7JmJkqM4DIY1ifcgs557YK628fu/5CL4YznlUOQi2BV9jltC0NTXatEndVQj3QcCSGrgQxe1O7Vel642a7S6oxqtP6j107QlpXro6HVRFEVpsIvkxwhlWKZUZ7zNYOHypZ1zlNAyRY8HO/u9d6k0NjlyhTabnfewtm4sMBzbYRUqLZ22LRqMbVtbvLR1beuk02ztqFxp793Y58FaOo23pYLG1sA7qo93v6q0phpxgHMP1q/fh2uAI/IW+PXr9zoD523E31J3A8e6H0B9OhOvH0/4+6Vd46KEH5bISd1KnYEETkA6ud6n1zvHL9zf8+teaShIJ46dcwzk/MhCR8/XcfsoPW7//PFI5OypHCNy63V6WFGO182zOyPt2BfjxBfzur/TowCv4xzycnBLxgOzC4tYtwvSY5NlzB71IM4/WCLBWyRGIMHMS899JleZ6bXrNX5zecFv4z1VSN/XKO37GqUrtO49PQ9FURRFUZQPE0Q+Jj4mPiY+Jj4mPiaenk5Yrs8SQiDi13HzwgHOLd8I7yv3kXtMi5H8XmlIThmOEs+QVOYJ2SLZ89K3M94m6xI6F88tSB/fR5ogx0GkUbuBkEvjlfcn4PzNnU6P7+h0kCgzLR0eQJSN+oK0XCvdTWc6fV7qI/8oJeIJztdUXxuZcRGLzIjJp2Rm4h4EzCQXRDZduXRIO38inc7uY53lazoHIe00dJBS3sMQM5EO2LH2YIJsIEYBGaKcTGWCdD3tLKpSW5vYeRmTl6LjVZZR181Uel583I+Ltqfv+8lwSLqLKtuTd3G5sjk9Mwox9UovV7aXph7jiiYuVgqi66i7vKK8Dj9j+EP/HSoRPnzj7NeBDl//QLoWDrzhXJf4P1QHgZ6BSv/GVtYlBAmKzrR+ydsIm1KPdGMmmoqk4czW9UgbQaVVWqVVWqVXR6X127j+wCRUJk2V0QzODVWGaWxjqpM21qi0Squ0Sqv0s1Bp/TauPzBZhmrD38yGzvZm/IbS5kZeQFqlVVqlVVqlVVqlVRrWZ0n/QXAeX9wP1CfS/ixUHok0lUjfXxd6DlsDicXQIzDFdHpgNmRsLo1wmS2gskil+0qk0Xk4z4YiWXgqN2bHxFAHu7e33eePu93Hz5yp9CkqnVKN9OeBsdMDa0qr9Edmh0CroF+ngR9WZXi8Vkab/TfYA5VWaZVWaZUui/2dENhba8aY1o21XB8jeIy0aRiTxTnMRCbdulHatq3jPUm3jp3Zfj/V28dINxNZvFXaOcc7Spsp27dcb92Dpc2F0uPKpd0kbSagiiLOm+F4m07DeWamBcx0eh7Hz5bOMYDHI5eWIp83w/GjpY1IDxIXcnzwZqRlpnHdal89xHmZ44O3d+eknXz1kAf0fj59+vQv1can9+//ou9fKpT+8hdVxf/jYGVlHWqpAwCN7xvOCARuigAAAABJRU5ErkJggg==' };\n    /* </generated> */\n\n    /**\n     * Sprite\n     *\n     * Encapsulates loading sprite slices from the spritesheet, organizing them, and\n     * modifying them or constructing using primitives. To save space, we use some techniques\n     * like storing only a small slice of an image in the spritesheet, then using code\n     * to duplicate it, add some randomness, etc.\n     */\n    const Sprite = {\n        // This is an exception to the rule, loading the spritesheet is a special action that\n        // happens BEFORE everything is initialized.\n        loadSpritesheet(cb) {\n            let image = new Image();\n            image.onload = cb;\n            image.src = SpriteSheet.base64;\n            Sprite.sheet = image;\n        },\n\n        init() {\n            // Base pixel font and icons (see `Text.init` for additional variations)\n            Sprite.font = initBasicSprite(SpriteSheet.font[0]);\n            Sprite.icon_mouse_lmb = initBasicSprite(SpriteSheet.icon_mouse[0]);\n            Sprite.icon_mouse_rmb = initBasicSprite(SpriteSheet.icon_mouse[1]);\n\n            // Enemies\n            //Sprite.stabguts = SpriteSheet.stabguts.map(initBasicSprite);\n            //Sprite.spindoctor = SpriteSheet.spindoctor.map(initBasicSprite);\n\n            Sprite.moth = SpriteSheet.moth.map(initBasicSprite);\n\n            // Gore/blood\n            Sprite.gore = SpriteSheet.gore.map(initBasicSprite);\n\n            // GUI\n            //Sprite.hud_healthbar = SpriteSheet.hud_healthbar.map(initBasicSprite);\n            //Sprite.hud_healthbar.push(initDynamicSprite(createHealthChunk(Sprite.hud_healthbar[1].img)));\n            Sprite.hud_crosshair = SpriteSheet.hud_crosshair.map(initBasicSprite);\n\n            Sprite.hud_mouse = SpriteSheet.cursor.map(data => initBasicSprite(data, { x: 0, y: 0 }))[0];\n\n            Sprite.bullet1 = SpriteSheet.bullet1.map(initBasicSprite);\n\n            Sprite.hud_tray_building = SpriteSheet.hud_tray_building.map(initBasicSprite);\n            Sprite.hud_tray_divider = SpriteSheet.hud_tray_divider.map(initBasicSprite);\n            Sprite.hud_tray_popup = SpriteSheet.hud_tray_popup.map(initBasicSprite);\n\n            Sprite.hud_wip = SpriteSheet.hud_wip.map(data => initBasicSprite(data, { x: -1, y: -1 }));\n\n            // Tiles\n            Sprite.tiles = SpriteSheet.tiles.map(initBasicSprite);\n            Sprite.tile_background = SpriteSheet.tile_background.map(initBasicSprite);\n\n            // Ghost enemy\n            Sprite.ghost = SpriteSheet.ghost.map(initBasicSprite);\n\n            // Buildins\n            Sprite.buildings = SpriteSheet.buildings.map(data => initBasicSprite(data, { x: 0, y: 8 }));\n\n            // Buttons\n            Sprite.buttons = SpriteSheet.buttons.map(initBasicSprite);\n\n            Sprite.tilebg = initDynamicSprite(createTileBg(Sprite.tiles[0].img));\n            Sprite.shadow = initDynamicSprite(createShadow());\n\n            Sprite.attack = SpriteSheet.attack.map(initBasicSprite);\n            Sprite.enemy_healthbar = SpriteSheet.enemy_healthbar.map(initBasicSprite);\n\n            // Dialog\n            //let dialog = SpriteSheet.dialog.map(initBasicSprite);\n            //Sprite.dialog_speech = initDynamicSprite(createDialogSpeech(dialog[0].img, dialog[2].img));\n            //Sprite.dialog_hint = initDynamicSprite(createDialogHint(dialog[1].img));\n        },\n\n        /**\n         * A small helper that draws a sprite onto a canvas, respecting the anchor point of\n         * the sprite. Note that the canvas should be PRE-TRANSLATED and PRE-ROTATED, if\n         * that's appropriate!\n         */\n        drawSprite(ctx, sprite, u, v) {\n            ctx.drawImage(sprite.img, u - sprite.anchor.x, v - sprite.anchor.y);\n        },\n\n        drawViewportSprite(sprite, pos, rotation) {\n            let { u, v } = this.viewportSprite2uv(\n                sprite,\n                pos\n            );\n            if (rotation) {\n                Viewport.ctx.save();\n                Viewport.ctx.translate(u + sprite.anchor.x, v + sprite.anchor.y);\n                Viewport.ctx.rotate(rotation);\n                Viewport.ctx.drawImage(\n                    sprite.img,\n                    -sprite.anchor.x,\n                    -sprite.anchor.y\n                );\n                Viewport.ctx.restore();\n            } else {\n                Viewport.ctx.drawImage(sprite.img, u, v);\n            }\n        },\n\n        viewportSprite2uv(sprite, pos) {\n            return {\n                u: pos.x - sprite.anchor.x - Camera.pos.x + Viewport.center.u,\n                v: pos.y - sprite.anchor.y - Camera.pos.y + Viewport.center.v\n            };\n        },\n\n        getDynamicTile(bitmask) {\n            if (!this.tiles[bitmask + TILE_DYNAMIC - 1]) {\n                this.tiles[bitmask + TILE_DYNAMIC - 1] = initDynamicSprite(createDynamicTile(this.tiles, bitmask), { x: 0, y: 0 });\n            }\n\n            return this.tiles[bitmask + TILE_DYNAMIC - 1];\n        }\n    };\n\n    // Sprite utility functions\n\n    function initBasicSprite(data, anchor) {\n        return initDynamicSprite(loadCacheSlice(...data), anchor);\n    }\n\n    function initDynamicSprite(source, anchor) {\n        let w = source.width,\n            h = source.height;\n\n        return {\n            img: source,\n            // Hack! Using a flat `.map(initBasicSprite)` is actually going to pass the\n            // element INDEX as second argument, resulting in \"anchor=1\". The right solution\n            // here is \"typeof anchor === 'object' ?\", but to save bytes I avoid using\n            // the typeof and instanceof keywords anywhere in the codebase. Hence,\n            // \"anchor && anchor.x\".\n            anchor: (typeof anchor === 'object') ? anchor : { x: (w / 2) | 0, y: (h / 2) | 0 }\n        };\n    }\n\n    function loadCacheSlice(x, y, w, h) {\n        const source = Sprite.sheet;\n        const sliceCanvas = createCanvas(w, h);\n        sliceCanvas.ctx.drawImage(source, x, y, w, h, 0, 0, w, h);\n        return sliceCanvas.canvas;\n    }\n\n    // Given wall tile, create a full screen tiled version to render in background\n    function createTileBg(source) {\n        let canvas = createCanvas(544, 334);\n        for (let y = 0; y < 334; y += 32) {\n            for (let x = 0; x < 544; x += 32) {\n                canvas.ctx.drawImage(source, x, y);\n            }\n        }\n        return canvas.canvas;\n    }\n\n    // \"Shadow\" overlay (gives flickering shadows in corners)\n    function createShadow() {\n        let canvas = createCanvas(500, 500);\n        let gradient = canvas.ctx.createRadialGradient(\n            250,\n            250,\n            0,\n            250,\n            250,\n            250\n        );\n        gradient.addColorStop(0.3, rgba(0, 0, 0, 0));\n        gradient.addColorStop(1, rgba(0, 0, 0, 0.9));\n        canvas.ctx.fillStyle = gradient;\n        canvas.ctx.fillRect(0, 0, 500, 500);\n        return canvas.canvas;\n    }\n\n    function createDynamicTile(tiles, bitmask) {\n        let canvas = createCanvas(TILE_SIZE, TILE_SIZE);\n\n        // First, we render outer corners\n\n        if (bitmask & 0b100_000_000) {\n            canvas.ctx.drawImage(tiles[TILE_CORNER_OUTER - 1].img, 0, 0, 4, 4, 0, 0, 4, 4);\n        }\n        if (bitmask & 0b001_000_000) {\n            canvas.ctx.drawImage(tiles[TILE_CORNER_OUTER - 1].img, 5, 0, 3, 3, 5, 0, 3, 3);\n        }\n        if (bitmask & 0b000_000_001) {\n            canvas.ctx.drawImage(tiles[TILE_CORNER_OUTER - 1].img, 6, 6, 2, 2, 6, 6, 2, 2);\n        }\n        if (bitmask & 0b000_000_100) {\n            canvas.ctx.drawImage(tiles[TILE_CORNER_OUTER - 1].img, 0, 5, 3, 3, 0, 5, 3, 3);\n        }\n\n        // Next we render standard walls (potentially overwriting outer corners above)\n\n        if (bitmask & 0b000_001_000) {\n            canvas.ctx.drawImage(tiles[TILE_WALL_LEFT - 1].img, 5, 0, 3, 8, 5, 0, 3, 8);\n        }\n        if (bitmask & 0b000_100_000) {\n            canvas.ctx.drawImage(tiles[TILE_WALL_RIGHT - 1].img, 0, 0, 4, 8, 0, 0, 4, 8);\n        }\n        if (bitmask & 0b000_000_010) {\n            canvas.ctx.drawImage(tiles[TILE_WALL_TOP - 1].img, 0, 5, 8, 3, 0, 5, 8, 3);\n        }\n        if (bitmask & 0b010_000_000) {\n            canvas.ctx.drawImage(tiles[TILE_WALL_BOTTOM - 1].img, 0, 0, 8, 4, 0, 0, 8, 4);\n        }\n\n        // Next we render inner corners (potentially overwriting parts of walls above)\n\n        if ((bitmask & 0b010_100_000) === 0b010_100_000) {\n            canvas.ctx.drawImage(tiles[TILE_CORNER_INNER - 1].img, 0, 0, 5, 5, 0, 0, 5, 5);\n        }\n        if ((bitmask & 0b010_001_000) === 0b010_001_000) {\n            canvas.ctx.drawImage(tiles[TILE_CORNER_INNER - 1].img, 4, 0, 4, 4, 4, 0, 4, 4);\n        }\n        if ((bitmask & 0b000_001_010) === 0b000_001_010) {\n            canvas.ctx.drawImage(tiles[TILE_CORNER_INNER - 1].img, 4, 4, 4, 4, 4, 4, 4, 4);\n        }\n        if ((bitmask & 0b000_100_010) === 0b000_100_010) {\n            canvas.ctx.drawImage(tiles[TILE_CORNER_INNER - 1].img, 0, 4, 5, 4, 0, 4, 5, 4);\n        }\n\n        return canvas.canvas;\n    }\n\n    class DefeatScreen {\n        constructor() {\n            this.frames = 0;\n        }\n\n        update() {\n            this.frames++;\n\n            if (Input.pressed[Input.Action.TAP] && this.frames > 30) {\n                // Reset sequence\n                game.reset();\n            }\n\n            return true;\n        }\n\n        draw() {\n            //Viewport.ctx.fillStyle = rgba(13, 43, 69, clamp(this.frames / 200, 0, 1));\n            Viewport.ctx.fillStyle = rgba(36, 26, 20, clamp(this.frames / 200, 0, 1));\n            Viewport.ctx.fillRect(0, 0, Viewport.width, Viewport.height);\n\n            let width = Viewport.width - 32;\n            let x = 16;\n            let y = 16;\n\n            let message = 'DEFEAT... \\n' +\n                '                    \\n' +\n                'YOUR LAST MOTH GONE, THIS WORLD SLIPS FROM YOUR GRASP. YOU CURSE THE VILLAGE AND ITS INHABITANTS AS YOU TUMBLE TOWARDS THAT BLEAK BEYOND. \\n \\n'  +\n                'YOUR REIGN OF TERROR HAS ENDED. \\n \\n' +\n                'TAP TO TRY AGAIN!';\n\n            message = message.slice(0, this.frames);\n\n            Text.drawParagraph(\n                Viewport.ctx,\n                message,\n                x,\n                y,\n                width,\n                1,\n                1,\n                Text.duotone_red\n            );\n        }\n    }\n\n    /**\n     * Game state.\n     */\n    class Game {\n        init() {\n            Sprite.loadSpritesheet(() => {\n                Viewport.init();\n                Sprite.init();\n                Text.init();\n                Input.init();\n                Audio.init();\n                Hud.init();\n\n                Camera.init();\n                World.init();\n\n                window.addEventListener('blur', () => this.pause());\n                window.addEventListener('focus', () => this.unpause());\n\n                this.reset();\n\n                this.start();\n            });\n        }\n\n        reset() {\n            this.entities = [];\n            this.dialogPending = {};\n            this.dialogSeen = {};\n            this.roomsCleared = {};\n            this.shadowOffset = 0;\n            this.screenshakes = [];\n            this.monstersPending = [];\n            this.waveNumber = 0;\n            this.earth = 250;\n            this.fervor = 25;\n            this.blood = 0;\n            this.entities.push(new Moth(qr2xy(World.spawn)));\n            this.screen = undefined;\n            this.wave = undefined;\n            World.reset();\n\n            Camera.pos = centerxy(qr2xy(World.exit));\n            Camera.forceTarget = centerxy(qr2xy(World.spawn));\n        }\n\n        start() {\n            this.frame = 0;\n            this.framestamps = [0];\n            this.update();\n            window.requestAnimationFrame((xyz) => this.onFrame(xyz));\n        }\n\n        onFrame(currentms) {\n            let startTime= new Date().getTime();\n\n            /*this.framestamps.push(currentms);*/\n            if (this.framestamps.length >= 40) {\n                this.framestamps.shift();\n            }\n            this.fps = 1000 / ((this.framestamps[this.framestamps.length - 1] - this.framestamps[0]) / this.framestamps.length);\n\n            this.frame++;\n            Viewport.resize();\n            this.update();\n            this.draw(Viewport.ctx);\n            window.requestAnimationFrame((xyz) => this.onFrame(xyz));\n\n            let endTime = new Date().getTime();\n            this.framestamps.push(this.framestamps[this.framestamps.length - 1] + endTime - startTime);\n        }\n\n        update() {\n            if (!this.wave) {\n                this.wave = new Wave(this.waveNumber++);\n            }\n\n            // Pull in frame by frame button pushes / keypresses / mouse clicks\n            Input.update();\n\n            if (this.screen) {\n                if (this.screen.update()) return;\n            }\n\n            if (Input.pressed[Input.Action.TAP]) {\n                this.tap(Input.pointer);\n            }\n\n            Hud.update();\n\n            //if (Input.pressed[Input.Action.MENU]) {\n            //    this.paused ? this.unpause() : this.pause();\n            //}\n\n            if (this.paused) return;\n\n            this.wave.update();\n\n            this.spawnMonsterIfPossible();\n\n            // Behavior (AI, player input, etc.)\n            //perform(this.entities); <-- cut to save space\n            console.log(game.entities);\n            for (let entity of game.entities) {\n                if (entity.think) entity.think();\n            }\n\n            // perform any queued damage\n            Damage.perform(this.entities);\n\n            // Movement (perform entity velocities to position)\n            Movement.perform(this.entities);\n\n            Camera.update();\n\n            // Culling (typically when an entity dies)\n            this.entities = this.entities.filter(entity => !entity.cull);\n            World.buildings = World.buildings.filter(building => !building.cull);\n\n            // Camera logic\n            /*let diff = {\n                x: this.player.pos.x - this.camera.pos.x,\n                y: this.player.pos.y - this.camera.pos.y\n            };\n            this.camera.pos.x += diff.x * 0.2;\n            this.camera.pos.y += diff.y * 0.2;*/\n\n            // Tick screenshakes and cull finished screenshakes\n            this.screenshakes = this.screenshakes.filter(screenshake =>\n                screenshake.update()\n            );\n\n            World.update();\n\n            if (this.entities.filter(e => e instanceof Moth).length === 0) {\n                game.screen = new DefeatScreen();\n            }\n\n            // Flickering shadows\n            if (game.frame % 6 === 0) this.shadowOffset = (Math.random() * 10) | 0;\n\n            // Intro screenshake\n            if (game.frame === 30) game.screenshakes.push(new ScreenShake(20, 20, 20));\n\n            // Initial \"click\" to get game started\n            if (Input.pressed[Input.Action.ATTACK] && !game.started) game.started = true;\n        }\n\n        draw() {\n            // Reset canvas transform and scale\n            Viewport.ctx.setTransform(1, 0, 0, 1, 0, 0);\n            Viewport.ctx.scale(Viewport.scale, Viewport.scale);\n\n            //Viewport.ctx.fillStyle = rgba(13, 43, 69, 1);\n            //Viewport.ctx.fillStyle = rgba(84, 78, 104, 1);\n            //Viewport.ctx.fillStyle = rgba(32, 60, 86, 1);\n            Viewport.ctx.fillStyle = rgba(36, 26, 20, 1);\n            Viewport.ctx.fillRect(0, 0, Viewport.width, Viewport.height);\n\n            // Render screenshakes (canvas translation)\n            /*\n            let shakeX = 0, shakeY = 0;\n            this.screenshakes.forEach(shake => {\n                shakeX += shake.x;\n                shakeY += shake.y;\n            });\n            Viewport.ctx.translate(shakeX, shakeY);\n            */\n\n            /*\n            Viewport.ctx.drawImage(\n                Sprite.shadow.img,\n                0, 0,\n                500, 500,\n                -this.shadowOffset, -this.shadowOffset,\n                Viewport.width + this.shadowOffset * 2,\n                Viewport.height + this.shadowOffset * 2\n            );\n            */\n\n            World.draw();\n\n            for (let entity of this.entities) {\n                if (!entity.z || entity.z < 100) entity.draw();\n            }\n\n            for (let entity of this.entities) {\n                if (entity.z && entity.z > 100) entity.draw();\n            }\n\n            World.drawLightmap();\n\n            Hud.draw();\n\n            if (game.frame < 120) {\n                Viewport.ctx.fillStyle = rgba(0, 0, 0, 1 - game.frame / 120);\n                Viewport.fillViewportRect();\n            }\n\n            /*\n            if (game.frame >= 30 && !game.started) {\n                //let width = Text.measureWidth(TITLE, 3);\n                Text.drawText(\n                    Viewport.ctx, TITLE, Viewport.center.u - Text.measureWidth(TITLE, 3) / 2, Viewport.center.v, 3,\n                    Text.white,\n                    Text.red\n                );\n            }\n            */\n\n            if (this.screen) {\n                this.screen.draw();\n            }\n\n            /*\n            if (game.frame % 100 === 0) {\n                let pos = {\n                    x: Math.random() * 100 - 50,\n                    y: Math.random() * 100 - 50\n                };\n                game.entities.push(new Ghost(pos));\n            }\n            */\n        }\n\n        pause() {\n            if (this.paused) return;\n            this.paused = true;\n            Audio.pause();\n        }\n\n        unpause() {\n            if (!this.paused) return;\n            this.paused = false;\n            Audio.unpause();\n        }\n\n        tap(uv) {\n            for (let ui of [Hud, World]) {\n                if (ui.tap(uv)) break;\n            }\n        }\n\n        activeMoths() {\n            return this.entities.filter(x => x instanceof Moth).length;\n        }\n\n        formatCost(earth, fervor) {\n            return (earth > this.earth ? 're' : 'we') + earth + (fervor > 0 ? (fervor > this.fervor ? ' rf' : ' wf') + fervor : '');\n        }\n\n        canAfford(earth, fervor) {\n            return (this.earth >= earth && this.fervor >= fervor);\n        }\n\n        payCost(earth, fervor) {\n            this.earth -= earth;\n            this.fervor -= fervor;\n        }\n\n        spawnMonsterIfPossible() {\n            let spawnFn = this.monstersPending[0];\n\n            if (spawnFn) {\n                // A spawn is attempted up to 10 times\n                for (let i = 0; i < 10; i++) {\n                    let q = Math.floor(Math.random() * World.floors[0].tiles[0].length);\n                    let r = Math.floor(Math.random() * World.floors[0].tiles.length);\n                    if (World.tiles[r][q] !== 1) {\n                        continue;\n                    }\n                    if (World.lightmap[r][q] !== 0) {\n                        continue;\n                    }\n\n                    let xy = qr2xy({ q, r });\n                    console.log('NEW monster' + xy.x + ',' + xy.y + ',' + World.lightmap[r][q]);\n                    game.entities.push(spawnFn(xy));\n                    this.monstersPending.shift();\n                    break;\n                }\n            }\n        }\n    }\n\n    const game = new Game();\n\n    /**\n     * Create and launch game.\n     */\n    game.init();\n\n})();\n"]}